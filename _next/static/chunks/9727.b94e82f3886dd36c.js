"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9727],{37783:(e,t,n)=>{n.d(t,{Aq:()=>i,Ay:()=>a});let r="http://localhost:44667";class i{static formatDateTime(e){let t=new Date(e),n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return"".concat(n,"-").concat(r,"-").concat(i," ").concat(a,":").concat(l)}static async copyToClipboard(e,t){let{onSuccess:n,onError:r}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==n||n(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==n||n(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==n||n(),!0}catch(e){return null==r||r(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(r).concat(e):e.startsWith("/api/")?"".concat(r,"/api/backend").concat(e.slice(4)):"".concat(r).concat(e)}static async backendFetch(e,t){return fetch(i.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,n;let r="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===r.length)return null!=(n=null==(t=r.pop())?void 0:t.split(";").shift())?n:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let a={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},50886:(e,t,n)=>{n.d(t,{I:()=>i});var r=n(12115);let i=()=>{let[e,t]=(0,r.useState)(()=>window.innerWidth<768);return(0,r.useEffect)(()=>{let e=()=>{t(window.innerWidth<768)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}},69727:(e,t,n)=>{n.r(t),n.d(t,{default:()=>eV});var r=n(95155);n(92932);var i=n(12115),a=n(19279),l=n(43324),s=n(89543),o=n(43561),d=n(81184),c=n(65982),p=n(99667),g=n(785),u=n(92362),h=n(63646),x=n(19782),m=n(94260),y=n(79),f=n(82854),b=n(30606),j=n(52492),v=n(2995),S=n(32051),w=n(33631),A=n(9485),k=n(71841),_=n(37783),C=n(90925),z=n(96750),B=n(50886),I=n(26934);let M=new Map,P=e=>{let{size:t}=e;return(0,r.jsx)("div",{style:{width:t,height:t,background:"rgba(99, 102, 241, 0.1)",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(I.A,{style:{fontSize:.5*t,color:"#818cf8"}})})},T=e=>{let{shortname:t,displayName:n,size:a=48}=e,l=t?"https://www.rustplus.cn/item/images/".concat(t,".png"):"",s=l?M.get(l):"error",[o,d]=(0,i.useState)("loaded"===s?"loaded":"error"===s?"error":"loading");(0,i.useEffect)(()=>{if(!t)return void d("error");let e=M.get(l);"loaded"===e?d("loaded"):"error"===e?d("error"):d("loading")},[t,l]);let c=(0,i.useCallback)(e=>{e.currentTarget.naturalWidth>0&&(M.set(l,"loaded"),d("loaded"))},[l]),p=(0,i.useCallback)(()=>{M.set(l,"error"),d("error")},[l]);return t&&"error"!==o?(0,r.jsxs)("div",{style:{width:a,height:a,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",position:"relative"},children:[(0,r.jsx)("img",{src:l,alt:n,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"contain",opacity:+("loaded"===o),position:"absolute"},onLoad:c,onError:p}),"loading"===o&&(0,r.jsx)(P,{size:a})]}):(0,r.jsx)(P,{size:a})},R=e=>{let{state:t,error:n}=e;return n?(0,r.jsx)(o.A,{icon:(0,r.jsx)(A.A,{}),style:{background:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#ef4444",borderRadius:8},children:"异常"}):null===t?(0,r.jsx)(o.A,{icon:(0,r.jsx)(j.A,{spin:!0}),children:"未知"}):(0,r.jsx)(o.A,{icon:t?(0,r.jsx)(v.A,{}):(0,r.jsx)(S.A,{}),style:{background:t?"rgba(16, 185, 129, 0.15)":"rgba(239, 68, 68, 0.15)",border:"1px solid ".concat(t?"rgba(16, 185, 129, 0.3)":"rgba(239, 68, 68, 0.3)"),color:t?"#10b981":"#ef4444",borderRadius:8},children:t?"开启":"关闭"})};var E=n(39578),O=n(40080),D=n(50329),L=n(8805);let{Text:N}=a.A,q=e=>{let{serverInfo:t}=e;return(0,r.jsxs)(E.A,{title:(0,r.jsxs)(h.A,{children:[(0,r.jsx)(m.A,{}),(0,r.jsx)("span",{children:"服务器信息"})]}),style:{background:"#27272c",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)",overflow:"hidden",position:"relative"},children:[(null==t?void 0:t.headerImage)&&(0,r.jsx)("div",{style:{position:"absolute",top:0,right:0,width:"50%",height:"100%",backgroundImage:"url(".concat(t.headerImage,")"),backgroundSize:"cover",backgroundPosition:"center",opacity:.35,maskImage:"linear-gradient(to right, transparent 0%, rgba(0,0,0,0.5) 50%, black 100%)",WebkitMaskImage:"linear-gradient(to right, transparent 0%, rgba(0,0,0,0.5) 50%, black 100%)",pointerEvents:"none"}}),(0,r.jsxs)("div",{style:{position:"relative",zIndex:1},children:[(0,r.jsxs)(d.A,{gutter:[24,24],children:[(0,r.jsx)(c.A,{xs:24,sm:12,md:6,children:(0,r.jsxs)("div",{className:"stat-card",children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,r.jsx)(N,{type:"secondary",style:{fontSize:13},children:"服务器"}),(0,r.jsx)(O.A,{style:{color:"rgba(255,255,255,0.3)"}})]}),(0,r.jsx)(N,{strong:!0,style:{fontSize:16,color:"#fff",display:"block"},ellipsis:!0,children:(null==t?void 0:t.name)||"未知"})]})}),(0,r.jsx)(c.A,{xs:24,sm:12,md:6,children:(0,r.jsxs)("div",{className:"stat-card",children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,r.jsx)(N,{type:"secondary",style:{fontSize:13},children:"在线玩家"}),(0,r.jsx)(D.A,{style:{color:"rgba(255,255,255,0.3)"}})]}),(0,r.jsxs)(N,{strong:!0,style:{fontSize:24,color:"#fff"},children:[(null==t?void 0:t.players)||0,(0,r.jsxs)(N,{type:"secondary",style:{fontSize:14,marginLeft:4},children:["/ ",(null==t?void 0:t.maxPlayers)||0]})]})]})}),(0,r.jsx)(c.A,{xs:24,sm:12,md:6,children:(0,r.jsxs)("div",{className:"stat-card",children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,r.jsx)(N,{type:"secondary",style:{fontSize:13},children:"游戏时间"}),(0,r.jsx)(L.A,{style:{color:"rgba(255,255,255,0.3)"}})]}),(0,r.jsx)(N,{strong:!0,style:{fontSize:24,color:"#fff"},children:(null==t?void 0:t.time)||"00:00"})]})}),(0,r.jsx)(c.A,{xs:24,sm:12,md:6,children:(0,r.jsxs)("div",{className:"stat-card",children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,r.jsx)(N,{type:"secondary",style:{fontSize:13},children:"排队人数"}),(0,r.jsx)(y.A,{style:{color:"rgba(255,255,255,0.3)"}})]}),(0,r.jsx)(N,{strong:!0,style:{fontSize:24,color:"#fff"},children:(null==t?void 0:t.queuedPlayers)||0})]})})]}),(0,r.jsxs)(d.A,{gutter:[16,16],style:{marginTop:20},children:[(null==t?void 0:t.wipeTime)&&t.wipeTime>0&&(0,r.jsx)(c.A,{xs:24,sm:12,md:8,children:(0,r.jsxs)("div",{style:{padding:"12px 14px",background:"rgba(255,255,255,0.03)",borderRadius:10},children:[(0,r.jsx)(N,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"上次清档"}),(0,r.jsx)(N,{style:{color:"#fff"},children:new Date(1e3*t.wipeTime).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]})}),(null==t?void 0:t.mapSize)&&t.mapSize>0&&(0,r.jsx)(c.A,{xs:12,sm:6,md:4,children:(0,r.jsxs)("div",{style:{padding:"12px 14px",background:"rgba(255,255,255,0.03)",borderRadius:10},children:[(0,r.jsx)(N,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"地图大小"}),(0,r.jsx)(N,{style:{color:"#fff"},children:t.mapSize})]})}),(null==t?void 0:t.seed)&&t.seed>0&&(0,r.jsx)(c.A,{xs:12,sm:6,md:4,children:(0,r.jsxs)("div",{style:{padding:"12px 14px",background:"rgba(255,255,255,0.03)",borderRadius:10},children:[(0,r.jsx)(N,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"地图种子"}),(0,r.jsx)(N,{style:{color:"#fff"},children:t.seed})]})}),(null==t?void 0:t.url)&&(0,r.jsx)(c.A,{xs:24,sm:12,md:8,children:(0,r.jsxs)("div",{style:{padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",borderRadius:10,border:"1px solid rgba(99, 102, 241, 0.2)"},children:[(0,r.jsx)(N,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"服务器网站"}),(0,r.jsx)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",style:{color:"#818cf8"},children:t.url})]})})]})]})]})};var W=n(36060),H=n(95873),F=n(37076);let{Text:Y}=a.A,G=e=>{let{switches:t,switchesDataReceived:n,connected:i,wsStatus:a,onSwitchToggle:l}=e;return(0,r.jsx)(E.A,{title:(0,r.jsxs)(h.A,{children:[(0,r.jsx)(H.A,{}),(0,r.jsx)("span",{children:"开关控制"})]}),style:{background:"#27272c",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)"},children:n?t.length>0?(0,r.jsx)(d.A,{gutter:[16,16],children:t.map(e=>(0,r.jsx)(c.A,{xs:24,sm:12,md:8,lg:6,children:(0,r.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.03)",borderRadius:14,border:"1px solid rgba(255, 255, 255, 0.06)",padding:20,opacity:e.error?.6:1,transition:"all 0.2s"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,r.jsx)(Y,{strong:!0,style:{fontSize:15},children:e.name}),(0,r.jsx)(R,{state:e.state,error:e.error})]}),(0,r.jsx)(Y,{type:e.error?"danger":"secondary",style:{color:e.error?"#ef4444":e.noteColor||"rgba(255,255,255,0.5)",fontSize:13,display:"block",marginBottom:16},children:e.error?"开关连接异常":e.note||"无备注"}),(0,r.jsx)(g.Ay,{type:e.state?"default":"primary",danger:e.state||e.error,icon:(0,r.jsx)(H.A,{}),loading:e.loading,onClick:()=>!e.error&&l(e.id,e.state||!1),disabled:!i||"connected"!==a||e.error,block:!0,style:{height:44,borderRadius:12,background:e.error||e.state?"rgba(239, 68, 68, 0.15)":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:e.error||e.state?"1px solid rgba(239, 68, 68, 0.3)":"none"},children:e.error?"开关异常":e.state?"关闭":"开启"})]})},e.id))}):(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,r.jsx)(Y,{type:"secondary",children:"暂无开关设备"})}):(0,r.jsxs)("div",{style:{textAlign:"center",padding:"40px 0"},children:[(0,r.jsx)(W.A,{indicator:(0,r.jsx)(F.A,{style:{fontSize:24,color:"#818cf8"},spin:!0})}),(0,r.jsx)(Y,{type:"secondary",style:{display:"block",marginTop:12},children:"正在加载开关数据..."})]})})};var V=n(98946),X=n(21038),J=n(97170);let{Text:U}=a.A,K=e=>{let{teamMembers:t,teamDataReceived:n,leaderSteamId:i,onMemberClick:a}=e;return(0,r.jsx)(E.A,{title:(0,r.jsxs)(h.A,{children:[(0,r.jsx)(y.A,{}),(0,r.jsx)("span",{children:"队伍成员"})]}),style:{background:"#27272c",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)",height:"100%"},children:t.length>0?(0,r.jsx)(V.A,{dataSource:t,renderItem:e=>{var t,n,l,s,d,c,p,u,x;let m=e.steamId===i,y=null==(t=e.steamBan)?void 0:t.VACBanned,f=(null!=(x=null==(n=e.steamBan)?void 0:n.NumberOfGameBans)?x:0)>0,b=null==(l=e.steamBan)?void 0:l.CommunityBanned,j=(null==(s=e.steamProfile)?void 0:s.gameid)&&(null==(d=e.steamProfile)?void 0:d.gameextrainfo);return(0,r.jsx)(V.A.Item,{style:{borderBottom:"none",padding:"6px 0"},children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,width:"100%",padding:"12px 14px",borderRadius:12,background:"rgba(255, 255, 255, 0.03)",border:j?"1px solid rgba(96, 165, 250, 0.3)":y||f||b?"1px solid rgba(239, 68, 68, 0.3)":"1px solid rgba(255,255,255,0.06)",position:"relative",overflow:"hidden"},children:[j&&(0,r.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:"url(https://shared.st.dl.eccdnx.com/store_item_assets/steam/apps/".concat(null==(c=e.steamProfile)?void 0:c.gameid,"/header.jpg)"),backgroundSize:"cover",backgroundPosition:"center",opacity:.15,pointerEvents:"none"}}),(0,r.jsxs)("div",{style:{position:"relative",flexShrink:0,zIndex:1},children:[(null==(p=e.steamProfile)?void 0:p.avatarfull)?(0,r.jsx)(X.A,{src:e.steamProfile.avatarfull,size:44,style:{border:e.isOnline?"2px solid #52c41a":"2px solid #595959"}}):(0,r.jsx)(X.A,{icon:(0,r.jsx)(D.A,{}),size:44,style:{background:e.isOnline?"rgba(16, 185, 129, 0.2)":"rgba(255,255,255,0.1)",color:e.isOnline?"#10b981":"rgba(255,255,255,0.5)"}}),(0,r.jsx)("div",{style:{position:"absolute",bottom:0,right:0,width:12,height:12,borderRadius:"50%",background:e.isOnline?"#52c41a":"#595959",border:"2px solid #27272c"}})]}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0,zIndex:1},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap",marginBottom:4},children:[(0,r.jsx)(U,{strong:!0,style:{color:"#fff",fontSize:14},children:e.name}),m&&(0,r.jsxs)(o.A,{color:"gold",style:{margin:0,fontSize:10,lineHeight:"16px",padding:"0 5px"},children:[(0,r.jsx)(J.A,{})," 队长"]}),j&&(0,r.jsxs)(o.A,{color:"blue",style:{margin:0,fontSize:10,lineHeight:"16px",padding:"0 5px"},children:["\uD83C\uDFAE ",null==(u=e.steamProfile)?void 0:u.gameextrainfo]})]}),(0,r.jsxs)(U,{type:"secondary",style:{fontSize:11,display:"block",marginBottom:4},children:["SteamID: ",e.steamId]}),(0,r.jsxs)(h.A,{size:4,wrap:!0,children:[(0,r.jsx)(o.A,{style:{margin:0,fontSize:10,lineHeight:"16px",padding:"0 5px",background:e.isOnline?"rgba(16, 185, 129, 0.15)":"rgba(255,255,255,0.05)",border:"1px solid ".concat(e.isOnline?"rgba(16, 185, 129, 0.3)":"rgba(255,255,255,0.1)"),color:e.isOnline?"#10b981":"rgba(255,255,255,0.5)",borderRadius:4},children:e.isOnline?"在线":"离线"}),e.isOnline&&(0,r.jsx)(o.A,{style:{margin:0,fontSize:10,lineHeight:"16px",padding:"0 5px",background:e.isAlive?"rgba(16, 185, 129, 0.15)":"rgba(239, 68, 68, 0.15)",border:"1px solid ".concat(e.isAlive?"rgba(16, 185, 129, 0.3)":"rgba(239, 68, 68, 0.3)"),color:e.isAlive?"#10b981":"#ef4444",borderRadius:4},children:e.isAlive?"存活":"死亡"}),e.steamBan&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.A,{style:{margin:0,fontSize:10,lineHeight:"16px",padding:"0 5px",background:y?"rgba(239, 68, 68, 0.15)":"rgba(16, 185, 129, 0.15)",border:"1px solid ".concat(y?"rgba(239, 68, 68, 0.3)":"rgba(16, 185, 129, 0.3)"),color:y?"#ef4444":"#10b981",borderRadius:4},children:["VAC ",y?e.steamBan.NumberOfVACBans:"✓"]}),(0,r.jsxs)(o.A,{style:{margin:0,fontSize:10,lineHeight:"16px",padding:"0 5px",background:f?"rgba(239, 68, 68, 0.15)":"rgba(16, 185, 129, 0.15)",border:"1px solid ".concat(f?"rgba(239, 68, 68, 0.3)":"rgba(16, 185, 129, 0.3)"),color:f?"#ef4444":"#10b981",borderRadius:4},children:["游戏 ",f?e.steamBan.NumberOfGameBans:"✓"]})]})]})]}),(0,r.jsx)(g.Ay,{type:"text",size:"small",icon:(0,r.jsx)(D.A,{}),onClick:()=>a(e),style:{color:"rgba(255,255,255,0.65)",flexShrink:0,zIndex:1}})]})})}}):(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:n?(0,r.jsx)(U,{type:"secondary",children:"暂无队伍成员信息"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(W.A,{indicator:(0,r.jsx)(F.A,{style:{fontSize:24,color:"#818cf8"},spin:!0})}),(0,r.jsx)(U,{type:"secondary",style:{display:"block",marginTop:12},children:"正在加载队伍数据..."})]})})})};var Z=n(57544);let{Text:Q}=a.A,$=e=>{let{chatHistory:t,chatDataReceived:n}=e;return(0,r.jsx)(E.A,{title:(0,r.jsxs)(h.A,{children:[(0,r.jsx)(Z.A,{}),(0,r.jsx)("span",{children:"聊天记录"})]}),style:{background:"#27272c",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)",height:"100%"},children:n?t.length>0?(0,r.jsx)("div",{style:{maxHeight:400,overflowY:"auto",display:"flex",flexDirection:"column-reverse"},children:(0,r.jsx)(V.A,{dataSource:[...t].reverse(),renderItem:e=>(0,r.jsx)(V.A.Item,{style:{borderBottom:"1px solid rgba(255,255,255,0.06)",padding:"10px 0",alignItems:"flex-start"},children:(0,r.jsxs)("div",{style:{width:"100%"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[(0,r.jsx)(Q,{strong:!0,style:{color:e.color||"#818cf8",fontSize:13},children:e.name}),(0,r.jsx)(Q,{type:"secondary",style:{fontSize:11},children:new Date(e.timestamp).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),(0,r.jsx)(Q,{style:{color:"rgba(255,255,255,0.85)",fontSize:14,wordBreak:"break-all"},children:e.message})]})})})}):(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,r.jsx)(Q,{type:"secondary",children:"暂无聊天记录"})}):(0,r.jsxs)("div",{style:{textAlign:"center",padding:"40px 0"},children:[(0,r.jsx)(W.A,{indicator:(0,r.jsx)(F.A,{style:{fontSize:24,color:"#818cf8"},spin:!0})}),(0,r.jsx)(Q,{type:"secondary",style:{display:"block",marginTop:12},children:"正在加载聊天记录..."})]})})};var ee=n(19588),et=n(59103),en=n(49073),er=n(36627),ei=n(44241),ea=n(20276);let{Text:el}=a.A,es=e=>{let{storageMonitors:t,selectedMonitorId:n,storageMonitorData:a,onSelectMonitor:l,showAsCard:s=!0,isMobile:o=!1}=e,[p,g]=(0,i.useState)(""),u=(0,i.useMemo)(()=>{if(!p.trim())return t;let e=p.toLowerCase();return t.filter(t=>(t.name||"监视器 ".concat(t.id)).toLowerCase().includes(e))},[t,p]),x=(0,i.useMemo)(()=>a&&"toolCupboard"===a.storageType?(e=>{if(e<=0)return"已过期";let t=e-Math.floor(Date.now()/1e3);if(t<=0)return"已过期";let n=Math.floor(t/86400),r=Math.floor(t%86400/3600),i=Math.floor(t%3600/60);return n>0?"".concat(n,"天 ").concat(r,"小时 ").concat(i,"分钟"):r>0?"".concat(r,"小时 ").concat(i,"分钟"):"".concat(i,"分钟")})(a.protectionExpiry):"",[null==a?void 0:a.protectionExpiry,null==a?void 0:a.storageType]),m=(0,i.useMemo)(()=>{let e=t.find(e=>e.id===n);return(null==e?void 0:e.name)||"监视器 ".concat(n)},[t,n]);if(0===t.length)return(0,r.jsxs)("div",{style:{textAlign:"center",padding:"60px 0"},children:[(0,r.jsx)(f.A,{style:{fontSize:48,color:"rgba(255,255,255,0.2)",marginBottom:16}}),(0,r.jsx)(el,{type:"secondary",style:{display:"block"},children:"暂无存储监视器"})]});let y=()=>{var e;return n?a?a.error?(0,r.jsxs)("div",{style:{textAlign:"center",padding:"60px 0"},children:[(0,r.jsx)(A.A,{style:{fontSize:48,color:"#ef4444",marginBottom:16}}),(0,r.jsx)(el,{type:"secondary",style:{display:"block"},children:a.errorMessage||"获取数据失败"})]}):(0,r.jsxs)("div",{children:["toolCupboard"===a.storageType&&(0,r.jsxs)("div",{style:{background:"已过期"!==x?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)",border:"1px solid ".concat("已过期"!==x?"rgba(16, 185, 129, 0.3)":"rgba(239, 68, 68, 0.3)"),borderRadius:12,padding:"12px 16px",marginBottom:16,display:"flex",alignItems:"center",gap:12},children:[(0,r.jsx)(ei.A,{style:{fontSize:20,color:"已过期"!==x?"#10b981":"#ef4444"}}),(0,r.jsxs)("div",{children:[(0,r.jsx)(el,{style:{color:"#fff",display:"block"},children:"领地柜维护"}),(0,r.jsxs)(el,{style:{color:"已过期"!==x?"#10b981":"#ef4444",fontSize:13},children:["剩余时间: ",x]})]})]}),0===a.capacity?(0,r.jsxs)("div",{style:{textAlign:"center",padding:"40px 0"},children:[(0,r.jsx)(A.A,{style:{fontSize:32,color:"#f59e0b",marginBottom:12}}),(0,r.jsx)(el,{type:"secondary",style:{display:"block"},children:"存储监视器未连接到容器"}),(0,r.jsx)(el,{type:"secondary",style:{display:"block",fontSize:12,marginTop:4},children:"请确保存储监视器已正确放置在容器上"})]}):a.items&&a.items.length>0?(0,r.jsx)(d.A,{gutter:[12,12],children:a.items.map((e,t)=>(0,r.jsx)(c.A,{xs:12,sm:8,md:6,lg:4,children:(0,r.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.03)",borderRadius:10,border:"1px solid rgba(255, 255, 255, 0.06)",padding:12,textAlign:"center"},children:[(0,r.jsx)(T,{shortname:e.shortname,displayName:e.displayName}),(0,r.jsxs)(el,{style:{color:"#fff",fontSize:12,display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.displayName,children:[e.displayName,e.itemIsBlueprint&&" (蓝图)"]}),(0,r.jsxs)(el,{style:{color:"#818cf8",fontSize:14,fontWeight:600},children:["x",e.quantity.toLocaleString()]})]})},t))}):(0,r.jsx)(ee.A,{description:"容器为空",style:{padding:"40px 0"}}),a.capacity>0&&(0,r.jsxs)("div",{style:{marginTop:16,textAlign:"right",color:"rgba(255,255,255,0.5)",fontSize:12},children:["物品种类: ",(null==(e=a.items)?void 0:e.length)||0," / 容量: ",a.capacity]})]}):(0,r.jsxs)("div",{style:{textAlign:"center",padding:"60px 0"},children:[(0,r.jsx)(W.A,{indicator:(0,r.jsx)(F.A,{style:{fontSize:32},spin:!0})}),(0,r.jsx)(el,{type:"secondary",style:{display:"block",marginTop:16},children:"正在获取数据..."})]}):(0,r.jsxs)("div",{style:{textAlign:"center",padding:"60px 0"},children:[(0,r.jsx)(I.A,{style:{fontSize:48,color:"rgba(255,255,255,0.2)",marginBottom:16}}),(0,r.jsx)(el,{type:"secondary",style:{display:"block"},children:"请选择一个存储监视器"})]})};if(o){let e=(0,r.jsxs)("div",{style:{minHeight:400},children:[(0,r.jsx)("div",{style:{marginBottom:16},children:(0,r.jsx)(et.A,{value:n,onChange:l,placeholder:"选择存储监视器",style:{width:"100%"},showSearch:!0,filterOption:(e,t)=>{var n;return null==t||null==(n=t.label)?void 0:n.toLowerCase().includes(e.toLowerCase())},options:t.map(e=>({value:e.id,label:e.name||"监视器 ".concat(e.id)}))})}),y()]});return s?(0,r.jsx)(E.A,{title:(0,r.jsxs)(h.A,{children:[(0,r.jsx)(f.A,{}),(0,r.jsx)("span",{children:"存储监视器"})]}),style:{marginTop:24,background:"#27272c",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)"},children:e}):e}let b=(0,r.jsxs)("div",{style:{display:"flex",minHeight:500,background:"rgba(39, 39, 44, 0.5)",borderRadius:12,overflow:"hidden",border:"1px solid rgba(255,255,255,0.06)"},children:[(0,r.jsxs)("div",{style:{width:220,minWidth:220,background:"rgba(255,255,255,0.02)",borderRight:"1px solid rgba(255,255,255,0.06)",display:"flex",flexDirection:"column"},children:[(0,r.jsx)("div",{style:{padding:"12px 12px 8px"},children:(0,r.jsx)(en.A,{placeholder:"搜索监视器...",prefix:(0,r.jsx)(ea.A,{style:{color:"rgba(255,255,255,0.3)"}}),value:p,onChange:e=>g(e.target.value),allowClear:!0,style:{background:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.1)"}})}),(0,r.jsxs)("div",{style:{padding:"4px 16px 8px",fontSize:12,color:"rgba(255,255,255,0.4)",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:["共 ",t.length," 个",p&&" (显示 ".concat(u.length," 个)")]}),(0,r.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:u.map(e=>{let t=n===e.id,i=e.name||"监视器 ".concat(e.id);return(0,r.jsxs)("div",{onClick:()=>l(e.id),style:{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",margin:"2px 8px",borderRadius:8,cursor:"pointer",background:t?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"transparent",color:t?"#fff":"rgba(255,255,255,0.7)",transition:"all 0.15s"},onMouseEnter:e=>{t||(e.currentTarget.style.background="rgba(255,255,255,0.08)")},onMouseLeave:e=>{t||(e.currentTarget.style.background="transparent")},children:[(0,r.jsx)(I.A,{style:{fontSize:16,flexShrink:0}}),(0,r.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:13},children:i})]},e.id)})})]}),(0,r.jsxs)("div",{style:{flex:1,padding:20,overflowY:"auto"},children:[n&&(0,r.jsx)("div",{style:{marginBottom:16,paddingBottom:12,borderBottom:"1px solid rgba(255,255,255,0.06)"},children:(0,r.jsxs)(h.A,{children:[(0,r.jsx)(er.A,{status:"processing"}),(0,r.jsx)(el,{style:{color:"#fff",fontSize:16,fontWeight:500},children:m})]})}),y()]})]});return s?(0,r.jsx)(E.A,{title:(0,r.jsxs)(h.A,{children:[(0,r.jsx)(f.A,{}),(0,r.jsx)("span",{children:"存储监视器"})]}),style:{marginTop:24,background:"#27272c",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)"},children:b}):b};var eo=n(15856),ed=n(67641),ec=n(30832),ep=n(91255);let{Text:eg}=a.A;var eu=function(e){return e[e.Player=1]="Player",e[e.Explosion=2]="Explosion",e[e.VendingMachine=3]="VendingMachine",e[e.CH47=4]="CH47",e[e.CargoShip=5]="CargoShip",e[e.Crate=6]="Crate",e[e.GenericRadius=7]="GenericRadius",e[e.PatrolHelicopter=8]="PatrolHelicopter",e[e.TravelingVendor=9]="TravelingVendor",e}(eu||{});let eh={Player:1,Explosion:2,VendingMachine:3,CH47:4,CargoShip:5,Crate:6,GenericRadius:7,PatrolHelicopter:8,TravelingVendor:9},ex="https://www.rustplus.cn/zy/icons",em={1:{color:"#52c41a"},2:{color:"#fa541c",iconPath:"".concat(ex,"/explosion.png")},3:{color:"#52c41a",iconPath:"".concat(ex,"/vending.png")},4:{color:"#722ed1",iconPath:"".concat(ex,"/ch47.png")},5:{color:"#fa8c16",iconPath:"".concat(ex,"/cargo.png")},6:{color:"#faad14",iconPath:"".concat(ex,"/crate.png")},7:{color:"#666"},8:{color:"#f5222d",iconPath:"".concat(ex,"/patrol.png")},9:{color:"#1890ff",iconPath:"".concat(ex,"/vendor.png")}},ey={airfield_display_name:"".concat(ex,"/airfield.png"),bandit_camp:"".concat(ex,"/banditcamp.png"),dome_monument_name:"".concat(ex,"/dome.png"),harbor_display_name:"".concat(ex,"/harbour.png"),harbor_2_display_name:"".concat(ex,"/harbour2.png"),junkyard_display_name:"".concat(ex,"/junkyard.png"),large_oil_rig:"".concat(ex,"/largeoilrig.png"),launch_site:"".concat(ex,"/launchsite.png"),lighthouse_display_name:"".concat(ex,"/lighthouse.png"),military_tunnels_display_name:"".concat(ex,"/militarytunnel.png"),mining_outpost_display_name:"".concat(ex,"/miningoutpost.png"),oil_rig_small:"".concat(ex,"/oilrig.png"),outpost:"".concat(ex,"/outpost.png"),power_plant_display_name:"".concat(ex,"/powerplant.png"),radtown:"".concat(ex,"/radtown.png"),satellite_dish_display_name:"".concat(ex,"/satellitedish.png"),sewer_display_name:"".concat(ex,"/sewerbranch.png"),supermarket:"".concat(ex,"/supermarket.png"),train_yard_display_name:"".concat(ex,"/trainyard.png"),water_treatment_plant_display_name:"".concat(ex,"/watertreatment.png"),mining_quarry_hqm_display_name:"".concat(ex,"/hqmquarry.png"),mining_quarry_stone_display_name:"".concat(ex,"/stonequarry.png"),mining_quarry_sulfur_display_name:"".concat(ex,"/sulfurquarry.png"),fishing_village_display_name:"".concat(ex,"/fishingvillage.png"),large_fishing_village_display_name:"".concat(ex,"/fishingvillagelarge.png"),stables_a:"".concat(ex,"/stable.png"),stables_b:"".concat(ex,"/stable.png"),train_tunnel_display_name:"".concat(ex,"/Corel Auto-Preserve/traintunnel.png"),ferryterminal:"".concat(ex,"/ferryterminal.png"),arctic_base_a:"".concat(ex,"/arcticresearch.png"),missile_silo_monument:"".concat(ex,"/missilesilo.png"),AbandonedMilitaryBase:"".concat(ex,"/militarybase.png"),jungle_ziggurat:"".concat(ex,"/jungle.png"),underwater_lab:"".concat(ex,"/underwater.png"),gas_station:"".concat(ex,"/gasstation.png"),oxums:"".concat(ex,"/gasstation.png"),excavator:"".concat(ex,"/excavator.png"),arctic_research_base:"".concat(ex,"/arcticresearch.png"),swamp_a:"".concat(ex,"/swamp.png"),swamp_b:"".concat(ex,"/swamp.png"),swamp_c:"".concat(ex,"/swamp.png")},ef={airfield_display_name:"机场",bandit_camp:"强盗营地",dome_monument_name:"大铁球",harbor_display_name:"港口1",harbor_2_display_name:"港口2",junkyard_display_name:"垃圾场",large_oil_rig:"大型石油钻井平台",launch_site:"发射场",lighthouse_display_name:"灯塔",military_tunnels_display_name:"军事隧道",mining_outpost_display_name:"仓库",oil_rig_small:"小型石油钻井平台",outpost:"前哨站",power_plant_display_name:"发电厂",radtown:"辐射镇",satellite_dish_display_name:"雷达残骸",sewer_display_name:"下水道",supermarket:"超市",train_yard_display_name:"列车站",water_treatment_plant_display_name:"污水处理厂",mining_quarry_hqm_display_name:"高级金属矿场",mining_quarry_stone_display_name:"采石矿场",mining_quarry_sulfur_display_name:"硫磺矿场",fishing_village_display_name:"渔村",large_fishing_village_display_name:"大型渔村",stables_a:"马厩",stables_b:"马厩",train_tunnel_display_name:"火车隧道",ferryterminal:"渡轮码头",arctic_base_a:"基地科研中心",missile_silo_monument:"导弹发射井",AbandonedMilitaryBase:"废弃军事基地",jungle_ziggurat:"丛林金字塔",underwater_lab:"水下实验室",gas_station:"加油站",oxums:"奥克萨姆加油站",excavator:"挖掘机",arctic_research_base:"北极研究基地",compound:"安全区",swamp_a:"沼泽",swamp_b:"沼泽",swamp_c:"沼泽"},eb={0:"#ffffff",1:"#f5222d",2:"#52c41a",3:"#1890ff",4:"#faad14",5:"#722ed1"};function ej(e){return"number"==typeof e?e:eh[e]||0}function ev(e){return!e||e<1e3?0:Math.floor(e/146.28571428571428)}function eS(e){let t=e%26,n=Math.floor(e/26),r=t?String.fromCharCode(64+t):(n--,"Z");return n?eS(n)+r:r}function ew(e,t,n){let r=ev(n);if(r<=0)return"??";let i=Math.floor(e/146.28571428571428),a=Math.floor((n-t)/146.28571428571428);return i<0||i>=r||a<0||a>=r?"??":"".concat(eS(i+1)).concat(a)}let eA={5:"货轮",8:"巡逻直升机",4:"支奴干",1:"",2:"",3:"",6:"",7:"",9:""};function ek(e){var t,n,a;let{mapData:l,markers:s,teamMembers:d,teamPositions:c=[],mapNotes:p=[],loading:u,onRefresh:h,height:x=500,isMobile:m=!1}=e,[y,f]=(0,i.useState)(null),[b,j]=(0,i.useState)(2),[v,S]=(0,i.useState)({x:0,y:0}),[w,A]=(0,i.useState)(!1),[k,_]=(0,i.useState)({x:0,y:0}),[C,z]=(0,i.useState)(null),[B,I]=(0,i.useState)([]),[M,P]=(0,i.useState)(""),R=(0,i.useRef)(null),E=(0,i.useRef)(null),O=(0,i.useRef)(null),D=(0,i.useRef)(null),L=(0,i.useRef)(new Map),N=(0,i.useRef)(new Map),q=(0,i.useRef)(new Set),H=(0,i.useRef)(v),Y=(0,i.useRef)(b);H.current=v,Y.current=b;let G=(null==l?void 0:l.mapSize)||4500,V=(0,i.useMemo)(()=>ev(G),[G]),X=(0,i.useMemo)(()=>{let e=[];return p.forEach((t,n)=>{let r=eb[t.colourIndex]||"#ffffff",i=ew(t.x,t.y,G),a=0===t.type;e.push({key:"note-".concat(n),name:t.label||(a?"死亡标记":"地图标记"),coord:i,color:a?"#f5222d":r,noteType:a?"death":"pin",noteX:t.x,noteY:t.y})}),c.forEach(t=>{let n=d.find(e=>String(e.steamId)===String(t.steamId)),r=ew(t.x,t.y,G),i="#595959";t.isOnline&&(i=t.isAlive?"#52c41a":"#f5222d"),e.push({key:"player-".concat(t.steamId),name:(null==n?void 0:n.name)||t.steamId,coord:r,color:i,steamId:t.steamId})}),e},[p,d,c,G]),J=(0,i.useCallback)(e=>{if(N.current.has(e)||q.current.has(e))return;q.current.add(e);let t=new Image;t.onload=()=>{N.current.set(e,t),q.current.delete(e)},t.onerror=()=>{q.current.delete(e)},t.src=e},[]),U=(0,i.useCallback)(()=>{let e=E.current,t=R.current;if(!e||!t||!O.current||!l)return;let n=e.getContext("2d");if(!n)return;let r=t.clientWidth,i=t.clientHeight,a=window.devicePixelRatio||1;e.width=r*a,e.height=i*a,e.style.width="".concat(r,"px"),e.style.height="".concat(i,"px"),n.scale(a,a),n.fillStyle="#1b1b1f",n.fillRect(0,0,r,i);let o=r-16,g=i-16,u=Math.min(o,g),h=8+(o-u)/2,x=8+(g-u)/2,m=r/2,f=i/2;n.save(),n.translate(m+v.x,f+v.y),n.scale(b,b),n.translate(-m,-f),n.drawImage(O.current,h,x,u,u);let j=l.width||u,S=l.height||u,w=l.oceanMargin||0,A=(j-2*w)/j,k=w/j,_=h+k*u,C=x+k*u,z=u*A/V,B=z*V,I={ctx:n,scale:b,mapSize:G,gridCount:V,mapAreaX:h,mapAreaY:x,mapAreaSize:u,cellSizeCanvas:z,gridAreaX:_,gridAreaY:C,gridAreaSize:B,gameToCanvas:function(e,t,n,r,i,a,l){let s=t-2*r,o=n-2*r;return(d,c)=>({x:i+(s/e*d+r)/t*l,y:a+(n-(o/e*c+r))/n*l})}(G,j,S,w,h,x,u),iconCache:N.current,loadIcon:J};!function(e){let{ctx:t,scale:n,gridCount:r,cellSizeCanvas:i,gridAreaX:a,gridAreaY:l,gridAreaSize:s}=e;if(!(r<=0)){t.strokeStyle="#000000",t.lineWidth=.5/n;for(let e=0;e<=r;e++){let n=a+e*i;t.beginPath(),t.moveTo(n,l),t.lineTo(n,l+s),t.stroke()}for(let e=0;e<=r;e++){let n=l+e*i;t.beginPath(),t.moveTo(a,n),t.lineTo(a+s,n),t.stroke()}}}(I),function(e){let{ctx:t,scale:n,gridCount:r,cellSizeCanvas:i,gridAreaX:a,gridAreaY:l}=e;if(r<=0)return;let s=Math.max(1,1.5/n);t.font="300 ".concat(s,"px Arial"),t.fillStyle="#000000",t.textAlign="left",t.textBaseline="top";for(let e=0;e<r;e++)for(let s=0;s<r;s++){let r=a+e*i+1/n,o=l+s*i+1/n,d="".concat(eS(e+1)).concat(s);t.fillText(d,r,o)}}(I),function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",{ctx:i,scale:a,gameToCanvas:l,iconCache:s,loadIcon:o}=e,d=Math.max(4,6/a),c=Math.max(8,12/a),p=Math.max(2,3/a);n.current.clear(),t.forEach(e=>{var t;let g=ej(e.type);if(1===g)return;let u=l(e.x,e.y),h=em[g]||{color:"#666",icon:"●"};n.current.set(e.id,{x:u.x,y:u.y,marker:e});let x=r&&3===g&&(null==(t=e.sellOrders)?void 0:t.some(e=>{var t;return null==(t=e.itemName)?void 0:t.toLowerCase().includes(r.toLowerCase())})),m=5===g||8===g||4===g,y=m?c:d;if(i.save(),h.iconPath&&!s.has(h.iconPath)&&o(h.iconPath),x){let e=1.5*y;if(i.shadowColor="#ff6b6b",i.shadowBlur=8/a,i.strokeStyle="#ff6b6b",i.lineWidth=2/a,i.beginPath(),i.arc(u.x,u.y,e/2+2/a,0,2*Math.PI),i.stroke(),i.shadowBlur=0,h.iconPath&&s.has(h.iconPath)){let t=s.get(h.iconPath);i.drawImage(t,u.x-e/2,u.y-e/2,e,e)}else i.fillStyle="#ff6b6b",i.beginPath(),i.arc(u.x,u.y,e/2,0,2*Math.PI),i.fill()}else if(h.iconPath&&s.has(h.iconPath)){let e=s.get(h.iconPath);i.drawImage(e,u.x-y/2,u.y-y/2,y,y)}else i.fillStyle=h.color,i.beginPath(),i.arc(u.x,u.y,y/2,0,2*Math.PI),i.fill();if(m){let e=eA[g]||"";if(e){i.font="".concat(p,"px Arial"),i.textAlign="center",i.textBaseline="bottom";let t=i.measureText(e).width,n=.5/a,r=p+2*n,l=u.y-y/2-r-1/a;i.fillStyle="rgba(0, 0, 0, 0.7)",i.fillRect(u.x-t/2-n,l,t+2*n,r),i.fillStyle=h.color,i.fillText(e,u.x,u.y-y/2-1/a)}}i.restore()})}(I,s,L,M),function(e,t){let{ctx:n,scale:r,gameToCanvas:i,iconCache:a,loadIcon:l}=e;if(!t||0===t.length)return;let s=Math.max(2,3/r),o=Math.max(4,8/r);t.filter(e=>!(e.token.includes("module_")||e.token.includes("underwater-lab-base"))).forEach(e=>{let t=i(e.x,e.y),d=function(e){var t;if(ef[e])return ef[e];if(e.includes("/")){let t=e.split("/"),n=t[t.length-1].replace(".prefab","");if(n.includes("underwater_lab"))return"水下实验室";if(n.includes("moonpool"))return"月池模块"}return(null==(t=e.split("/").pop())?void 0:t.replace(".prefab","").replace(/_/g," "))||e}(e.token),c=ey[e.token],p="train_tunnel_display_name"===e.token;if(n.save(),c&&a.has(c)){let e=a.get(c);n.drawImage(e,t.x-o/2,t.y-o/2,o,o)}else c&&l(c),n.fillStyle="#ffa500",n.beginPath(),n.arc(t.x,t.y,Math.max(.5,.8/r),0,2*Math.PI),n.fill();if(!p){n.font="".concat(s,"px Arial"),n.textAlign="center",n.textBaseline="bottom";let e=n.measureText(d).width,i=.5/r,a=s+2*i,l=t.y-o/2-a-1/r;n.fillStyle="rgba(0, 0, 0, 0.7)",n.fillRect(t.x-e/2-i,l,e+2*i,a),n.fillStyle="#ffa500",n.fillText(d,t.x,t.y-o/2-1/r)}n.restore()})}(I,l.monuments||[]),function(e,t){let{ctx:n,scale:r,gameToCanvas:i}=e;if(!t||0===t.length)return;let a=Math.max(3,6/r),l=Math.max(2,3/r);t.forEach(e=>{let t=i(e.x,e.y),s=eb[e.colourIndex]||"#ffffff",o=0===e.type;if(n.save(),o)n.font="".concat(1.2*a,"px Arial"),n.textAlign="center",n.textBaseline="middle",n.fillText("\uD83D\uDC80",t.x,t.y);else{let e=1.5*a,i=.4*e,l=t.y-e+i+.3*i;n.beginPath(),n.moveTo(t.x,t.y),n.quadraticCurveTo(t.x-.8*i,t.y-.35*e,t.x-i,l),n.arc(t.x,l,i,Math.PI,0,!1),n.quadraticCurveTo(t.x+.8*i,t.y-.35*e,t.x,t.y),n.closePath(),n.fillStyle=s,n.fill(),n.strokeStyle="rgba(0, 0, 0, 0.5)",n.lineWidth=.5/r,n.stroke(),n.fillStyle="#fff",n.beginPath(),n.arc(t.x,l,.45*i,0,2*Math.PI),n.fill()}if(e.label&&e.label.trim()){n.font="".concat(l,"px Arial"),n.textAlign="center",n.textBaseline="bottom";let i=n.measureText(e.label).width,d=.5/r,c=l+2*d,p=o?t.y-.8*a:t.y-1.6*a;n.fillStyle="rgba(0, 0, 0, 0.7)",n.fillRect(t.x-i/2-d,p-c,i+2*d,c),n.fillStyle=s,n.fillText(e.label,t.x,p)}n.restore()})}(I,p);let{ctx:P,scale:T,gameToCanvas:D}=I,q=Math.max(1.5,1.5/T);c.forEach(e=>{let t=d.find(t=>String(t.steamId)===String(e.steamId)),n=(null==t?void 0:t.name)||e.steamId,r=D(e.x,e.y),i=y===String(e.steamId),a=i?1.4*q:q;P.save();let l="#595959";e.isOnline&&(l=e.isAlive?"#52c41a":"#f5222d"),P.fillStyle=l,P.beginPath(),P.arc(r.x,r.y,a/2,0,2*Math.PI),P.fill(),i&&(P.strokeStyle="#fff",P.lineWidth=2/T,P.beginPath(),P.arc(r.x,r.y,a/2+3/T,0,2*Math.PI),P.stroke()),P.fillStyle=e.isOnline?"#fff":"rgba(255,255,255,0.5)",P.font="bold ".concat(Math.max(8,10/T),"px Arial"),P.textAlign="center",P.textBaseline="bottom",P.fillText(n,r.x,r.y-a/2-3/T),P.restore()}),n.restore()},[l,s,d,c,p,b,v,y,V,G,M,J]);(0,i.useEffect)(()=>{if(!(null==l?void 0:l.base64)){O.current=null;return}let e=new Image;return e.onload=()=>{O.current=e,D.current&&cancelAnimationFrame(D.current),D.current=requestAnimationFrame(U)},e.onerror=()=>{console.error("地图图片加载失败"),O.current=null},e.src="data:image/jpeg;base64,".concat(l.base64),()=>{O.current=null}},[null==l?void 0:l.base64]),(0,i.useEffect)(()=>(D.current&&cancelAnimationFrame(D.current),D.current=requestAnimationFrame(U),()=>{D.current&&cancelAnimationFrame(D.current)}),[U]),(0,i.useEffect)(()=>{let e=()=>{D.current&&cancelAnimationFrame(D.current),D.current=requestAnimationFrame(U)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[U]),(0,i.useEffect)(()=>{let e=R.current;if(!e)return;let t=e=>{e.preventDefault(),e.stopPropagation(),j(t=>Math.min(Math.max(t*(e.deltaY>0?.9:1.1),2),12))};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)});let K=(0,i.useCallback)((e,t)=>{let n=R.current;if(!n)return e;let r=n.clientWidth,i=Math.min(r-16,n.clientHeight-16),a=Math.max(0,(i*t-i)/2);return{x:Math.max(-a,Math.min(a,e.x)),y:Math.max(-a,Math.min(a,e.y))}},[]),Z=(0,i.useRef)({isSingleTouch:!1,touchStartPos:{x:0,y:0},startOffset:{x:0,y:0},pinchStartDistance:0,pinchStartScale:1}),Q=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=Z.current;if(1===e.touches.length)t.isSingleTouch=!0,t.touchStartPos={x:e.touches[0].clientX,y:e.touches[0].clientY},t.startOffset={...H.current};else if(e.touches.length>=2){t.isSingleTouch=!1;let n=e.touches[0].clientX-e.touches[1].clientX,r=e.touches[0].clientY-e.touches[1].clientY;t.pinchStartDistance=Math.sqrt(n*n+r*r),t.pinchStartScale=Y.current}},[]),$=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=Z.current;if(1===e.touches.length&&t.isSingleTouch){let n=e.touches[0].clientX-t.touchStartPos.x,r=e.touches[0].clientY-t.touchStartPos.y;S(K({x:t.startOffset.x+n,y:t.startOffset.y+r},Y.current))}else if(e.touches.length>=2&&t.pinchStartDistance>0){let n=e.touches[0].clientX-e.touches[1].clientX,r=e.touches[0].clientY-e.touches[1].clientY,i=Math.sqrt(n*n+r*r)/t.pinchStartDistance,a=Math.min(Math.max(t.pinchStartScale*i,2),12);j(a),S(e=>K(e,a))}},[K]),er=(0,i.useCallback)(e=>{let t=Z.current;0===e.touches.length?(t.isSingleTouch=!1,t.pinchStartDistance=0):1===e.touches.length&&(t.isSingleTouch=!0,t.touchStartPos={x:e.touches[0].clientX,y:e.touches[0].clientY},t.startOffset={...H.current},t.pinchStartDistance=0)},[]),ei=(0,i.useCallback)(e=>{A(!0),_({x:e.clientX-v.x,y:e.clientY-v.y})},[v]),el=(0,i.useCallback)(e=>{w&&S(K({x:e.clientX-k.x,y:e.clientY-k.y},b))},[w,k,b,K]),es=(0,i.useCallback)(()=>A(!1),[]),eu=(0,i.useCallback)(e=>{if(!R.current||!l)return;let t=R.current,n=t.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,a=t.clientWidth,s=t.clientHeight,o=a/2,d=s/2,c=(r-o-v.x)/b+o,p=(i-d-v.y)/b+d,g=1.5*Math.max(4,6/b),u=[];for(let[,{x:e,y:t,marker:n}]of L.current)3===ej(n.type)&&Math.sqrt((c-e)**2+(p-t)**2)<=g&&u.push(n);1===u.length?(I(u),z(u[0])):u.length>1&&(I(u),z(u[0]))},[l,b,v]),eh=(0,i.useCallback)(e=>{let t=c.find(t=>String(t.steamId)===String(e));if(!t||!R.current||!l)return;let n=R.current,r=n.clientWidth,i=n.clientHeight,a=r-16,s=i-16,o=Math.min(a,s),d=l.width||o,p=l.height||o,g=l.oceanMargin||0,u=t.x*((d-2*g)/G)+g,h=p-(t.y*((p-2*g)/G)+g);j(2.5),S({x:-(2.5*(8+(a-o)/2+u/d*o-r/2)),y:-(2.5*(8+(s-o)/2+h/p*o-i/2))}),f(e)},[c,G,l]),ex=(0,i.useCallback)((e,t)=>{if(!R.current||!l)return;let n=R.current,r=n.clientWidth,i=n.clientHeight,a=r-16,s=i-16,o=Math.min(a,s),d=l.width||o,c=l.height||o,p=l.oceanMargin||0,g=(d-2*p)/G*e+p,u=c-((c-2*p)/G*t+p);j(10),S({x:-(10*(8+(a-o)/2+g/d*o-r/2)),y:-(10*(8+(s-o)/2+u/c*o-i/2))}),f(null)},[G,l]),ek=(0,i.useCallback)(()=>{j(2),S({x:0,y:0}),f(null)},[]),e_=(0,i.useMemo)(()=>c.map(e=>{let t=d.find(t=>String(t.steamId)===String(e.steamId));return{value:e.steamId,label:(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",backgroundColor:e.isOnline?e.isAlive?"#52c41a":"#f5222d":"#595959",marginRight:8}}),(null==t?void 0:t.name)||e.steamId,!e.isOnline&&(0,r.jsx)("span",{style:{color:"rgba(255,255,255,0.4)",marginLeft:4},children:"(离线)"})]})}}),[d,c]),eC=(0,i.useMemo)(()=>(0,r.jsxs)("div",{style:{background:"rgba(255,255,255,0.03)",borderRadius:8,padding:"8px 0",height:m?200:"100%",overflowY:"auto"},children:[(0,r.jsx)("div",{style:{padding:"4px 12px 8px",borderBottom:"1px solid rgba(255,255,255,0.06)",marginBottom:4},children:(0,r.jsxs)(eg,{style:{color:"rgba(255,255,255,0.6)",fontSize:12},children:["标记列表 (",X.length,")"]})}),0===X.length?(0,r.jsx)("div",{style:{padding:"20px 12px",textAlign:"center"},children:(0,r.jsx)(eg,{style:{color:"rgba(255,255,255,0.4)",fontSize:12},children:"暂无标记"})}):X.map(e=>(0,r.jsxs)("div",{onClick:()=>{void 0!==e.noteX&&void 0!==e.noteY?ex(e.noteX,e.noteY):e.steamId&&eh(e.steamId)},style:{display:"flex",alignItems:"center",padding:"6px 12px",cursor:"pointer",transition:"background 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="rgba(255,255,255,0.05)",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:["death"===e.noteType?(0,r.jsx)("span",{style:{fontSize:12,marginRight:8,flexShrink:0},children:"\uD83D\uDC80"}):"pin"===e.noteType?(0,r.jsxs)("svg",{width:"10",height:"14",viewBox:"0 0 14 18",style:{marginRight:8,flexShrink:0},children:[(0,r.jsx)("path",{d:"M7 0C3.13 0 0 3.13 0 7c0 5.25 7 11 7 11s7-5.75 7-11c0-3.87-3.13-7-7-7z",fill:e.color,stroke:"rgba(0,0,0,0.5)",strokeWidth:"0.8"}),(0,r.jsx)("circle",{cx:"7",cy:"7",r:"4",fill:e.color}),(0,r.jsx)("circle",{cx:"7",cy:"7",r:"2.5",fill:"#fff"})]}):(0,r.jsx)("span",{style:{display:"inline-block",width:10,height:10,borderRadius:"50%",backgroundColor:e.color,marginRight:8,flexShrink:0}}),(0,r.jsx)("div",{style:{flex:1,minWidth:0},children:(0,r.jsx)("div",{style:{color:"#fff",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name})}),(0,r.jsx)(o.A,{style:{background:"".concat(e.color,"20"),border:"1px solid ".concat(e.color,"40"),color:e.color,fontSize:11,padding:"0 6px",marginLeft:8},children:e.coord})]},e.key))]}),[X,m,ex,eh]);return u&&!l?(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:x,background:"#27272c",borderRadius:12},children:[(0,r.jsx)(W.A,{indicator:(0,r.jsx)(F.A,{style:{fontSize:32,color:"#818cf8"},spin:!0})}),(0,r.jsx)(eg,{style:{color:"rgba(255,255,255,0.6)",marginLeft:12},children:"加载地图中..."})]}):l?(0,r.jsxs)("div",{style:{position:"relative",height:m?x:"auto"},children:[(0,r.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:m?8:12,padding:m?"6px 8px":"8px 12px",background:"rgba(255,255,255,0.03)",borderRadius:8,flexWrap:"wrap",gap:8},children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:m?8:12,flex:1},children:[(0,r.jsx)(et.A,{placeholder:"聚焦队友",style:{width:m?"100%":160,flex:m?1:"none"},options:e_,value:y,onChange:e=>e&&eh(e),allowClear:!0,onClear:ek,size:"small"}),!m&&(0,r.jsx)(g.Ay,{icon:(0,r.jsx)(ec.A,{}),onClick:ek,size:"small",children:"重置视图"}),(0,r.jsx)(en.A,{placeholder:"搜索商品...",prefix:(0,r.jsx)(ea.A,{style:{color:"rgba(255,255,255,0.4)"}}),value:M,onChange:e=>P(e.target.value),allowClear:!0,size:"small",style:{width:m?120:160,background:"#1b1b1f",borderColor:"rgba(255,255,255,0.1)"}})]})}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:12,height:m?"calc(".concat("number"==typeof x?x+"px":x," - 50px)"):x},children:[(0,r.jsxs)("div",{style:{flex:1,position:"relative",height:"100%"},children:[(0,r.jsx)("div",{ref:R,style:{width:"100%",height:"100%",background:"#1b1b1f",borderRadius:12,overflow:"hidden",cursor:w?"grabbing":"grab",touchAction:"none",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},onMouseDown:ei,onMouseMove:el,onMouseUp:es,onMouseLeave:es,onClick:eu,onTouchStart:Q,onTouchMove:$,onTouchEnd:er,onTouchCancel:er,children:(0,r.jsx)("canvas",{ref:E,style:{width:"100%",height:"100%",display:"block",touchAction:"none"}})}),(0,r.jsxs)("div",{style:{position:"absolute",bottom:12,right:12,padding:"4px 8px",background:"rgba(0,0,0,0.6)",borderRadius:4,fontSize:12,color:"rgba(255,255,255,0.6)"},children:[Math.round(100*b),"%"]})]}),!m&&(0,r.jsx)("div",{style:{width:220,height:"100%",flexShrink:0},children:eC})]}),(0,r.jsx)(eo.A,{title:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsx)(ep.A,{style:{color:"#52c41a"}}),(0,r.jsxs)("span",{children:["售货机 (",B.length,")"]})]}),open:B.length>0,onCancel:()=>{I([]),z(null)},footer:null,width:m?"95vw":700,styles:{content:{background:"#27272c",border:"1px solid rgba(255,255,255,0.1)"},header:{background:"#27272c",borderBottom:"1px solid rgba(255,255,255,0.1)"},body:{padding:0}},children:(0,r.jsxs)("div",{style:{display:"flex",height:m?400:450,flexDirection:m?"column":"row"},children:[m?(0,r.jsx)("div",{style:{padding:"12px",borderBottom:"1px solid rgba(255,255,255,0.06)",flexShrink:0},children:(0,r.jsx)(et.A,{value:null==C?void 0:C.id,onChange:e=>{let t=B.find(t=>t.id===e);t&&z(t)},style:{width:"100%"},options:B.map((e,t)=>{var n;return{value:e.id,label:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)("span",{children:e.name||"售货机 ".concat(t+1)}),(0,r.jsxs)("span",{style:{color:"rgba(255,255,255,0.5)",fontSize:12},children:[ew(e.x,e.y,G)," \xb7 ",(null==(n=e.sellOrders)?void 0:n.length)||0,"件"]})]})}})})}):(0,r.jsx)("div",{style:{width:180,height:"100%",borderRight:"1px solid rgba(255,255,255,0.06)",overflowY:"auto",flexShrink:0},children:B.map((e,t)=>{var n;let i=(null==C?void 0:C.id)===e.id,a=(null==(n=e.sellOrders)?void 0:n.length)||0;return(0,r.jsxs)("div",{onClick:()=>z(e),style:{padding:"10px 12px",cursor:"pointer",background:i?"rgba(99, 102, 241, 0.15)":"transparent",borderLeft:i?"3px solid #6366f1":"3px solid transparent",borderBottom:"1px solid rgba(255,255,255,0.04)",transition:"all 0.15s"},onMouseEnter:e=>!i&&(e.currentTarget.style.background="rgba(255,255,255,0.03)"),onMouseLeave:e=>!i&&(e.currentTarget.style.background="transparent"),children:[(0,r.jsx)("div",{style:{color:i?"#fff":"rgba(255,255,255,0.8)",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",marginBottom:4},children:e.name||"售货机 ".concat(t+1)}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,r.jsx)(o.A,{style:{background:"#52c41a20",border:"none",color:"#52c41a",fontSize:10,padding:"0 4px",margin:0},children:ew(e.x,e.y,G)}),(0,r.jsxs)("span",{style:{color:"rgba(255,255,255,0.4)",fontSize:11},children:[a,"件"]})]})]},e.id)})}),(0,r.jsx)("div",{style:{flex:1,overflowY:"auto",padding:"8px 0"},children:C&&(null!=(a=null==(t=C.sellOrders)?void 0:t.length)?a:0)>0?(0,r.jsx)("div",{children:null==(n=C.sellOrders)?void 0:n.map((e,t)=>(0,r.jsxs)("div",{style:{padding:m?"10px 12px":"10px 16px",borderBottom:"1px solid rgba(255,255,255,0.04)",display:"flex",alignItems:"center",gap:m?6:10},children:[(0,r.jsx)(T,{shortname:e.shortname,displayName:e.itemName,size:m?28:36}),(0,r.jsxs)("div",{style:{width:m?70:120,flexShrink:0},children:[(0,r.jsx)("div",{style:{color:"#fff",fontSize:m?11:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.3},children:e.itemName}),(0,r.jsxs)("div",{style:{color:"rgba(255,255,255,0.5)",fontSize:m?10:11,display:"flex",alignItems:"center",gap:4},children:["x",e.quantity,e.itemIsBlueprint&&(0,r.jsx)(o.A,{color:"blue",style:{fontSize:9,padding:"0 3px",margin:0,lineHeight:"14px"},children:"蓝图"})]})]}),(0,r.jsx)("span",{style:{color:"rgba(255,255,255,0.3)",fontSize:m?10:14,flexShrink:0},children:"→"}),(0,r.jsx)(T,{shortname:e.currencyShortname,displayName:e.currencyName,size:m?22:28}),(0,r.jsxs)("div",{style:{width:m?50:80,flexShrink:0},children:[(0,r.jsx)("div",{style:{color:"#faad14",fontSize:m?10:12,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.3},children:e.currencyName}),(0,r.jsxs)("div",{style:{color:"rgba(255,255,255,0.5)",fontSize:m?9:11},children:["x",e.costPerItem]})]}),(0,r.jsx)(o.A,{color:e.amountInStock>0?"green":"red",style:{flexShrink:0,fontSize:m?9:11,padding:m?"0 4px":"0 6px",margin:0},children:e.amountInStock})]},t))}):C?(0,r.jsx)(ee.A,{description:(0,r.jsx)(eg,{style:{color:"rgba(255,255,255,0.5)"},children:"暂无商品"}),image:ee.A.PRESENTED_IMAGE_SIMPLE,style:{marginTop:60}}):(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"rgba(255,255,255,0.4)"},children:[(0,r.jsx)(ep.A,{style:{fontSize:40,marginBottom:12}}),(0,r.jsx)("span",{children:"选择左侧售货机查看商品"})]})})]})})]}):(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:x,background:"#27272c",borderRadius:12},children:[(0,r.jsx)(ee.A,{description:(0,r.jsx)(eg,{style:{color:"rgba(255,255,255,0.6)"},children:"暂无地图数据"}),image:ee.A.PRESENTED_IMAGE_SIMPLE}),h&&(0,r.jsx)(g.Ay,{type:"primary",icon:(0,r.jsx)(ed.A,{}),onClick:h,style:{marginTop:16},children:"刷新"})]})}let e_=e=>{let{mapData:t,mapMarkers:n,teamMembers:i,teamPositions:a,mapNotes:l=[],mapLoading:s,showAsCard:o=!0,height:d=500,isMobile:c=!1}=e,p=(0,r.jsx)(ek,{mapData:t,markers:n,teamMembers:i,teamPositions:a,mapNotes:l,loading:s,height:d,isMobile:c});return o?(0,r.jsx)(E.A,{title:(0,r.jsxs)(h.A,{children:[(0,r.jsx)(b.A,{}),(0,r.jsx)("span",{children:"服务器地图"})]}),style:{marginTop:24,background:"#27272c",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)"},children:p}):p},{Text:eC}=a.A,ez=e=>{var t,n,i,a,l;let{visible:s,member:d,leaderSteamId:c,onClose:p,onCopySteamId:u}=e;return(0,r.jsx)(eo.A,{title:null,open:s,onCancel:p,footer:null,centered:!0,width:420,children:(0,r.jsx)("div",{style:{padding:"8px 0"},children:d?(0,r.jsxs)(r.Fragment,{children:[(null==(t=d.steamProfile)?void 0:t.gameid)&&(0,r.jsxs)("div",{style:{position:"relative",marginBottom:20,borderRadius:12,overflow:"hidden"},children:[(0,r.jsx)("img",{src:"https://shared.st.dl.eccdnx.com/store_item_assets/steam/apps/".concat(d.steamProfile.gameid,"/header.jpg"),alt:"Game",style:{width:"100%",height:120,objectFit:"cover",objectPosition:"center"}}),(0,r.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"8px 12px",background:"linear-gradient(transparent, rgba(0,0,0,0.8))"},children:(0,r.jsxs)(o.A,{color:"blue",style:{margin:0},children:["\uD83C\uDFAE 正在游玩: ",d.steamProfile.gameextrainfo]})})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:20},children:[(0,r.jsxs)("div",{style:{position:"relative"},children:[(null==(n=d.steamProfile)?void 0:n.avatarfull)?(0,r.jsx)(X.A,{src:d.steamProfile.avatarfull,size:72,style:{border:d.isOnline?"3px solid #52c41a":"3px solid #595959"}}):(0,r.jsx)(X.A,{icon:(0,r.jsx)(D.A,{}),size:72,style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)"}}),(0,r.jsx)("div",{style:{position:"absolute",bottom:2,right:2,width:18,height:18,borderRadius:"50%",background:d.isOnline?"#52c41a":"#595959",border:"3px solid #1f1f23"}})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,r.jsx)(eC,{strong:!0,style:{fontSize:18},children:d.name}),d.steamId===c&&(0,r.jsxs)(o.A,{color:"gold",style:{margin:0},children:[(0,r.jsx)(J.A,{})," 队长"]})]}),(0,r.jsx)(eC,{type:"secondary",style:{fontSize:13},children:d.isOnline?"\uD83D\uDFE2 在线":"⚫ 离线"})]})]}),(0,r.jsx)("div",{style:{padding:14,borderRadius:10,background:"rgba(99, 102, 241, 0.08)",border:"1px solid rgba(99, 102, 241, 0.15)",marginBottom:16},children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(eC,{type:"secondary",style:{fontSize:12,display:"block"},children:"SteamID"}),(0,r.jsx)(eC,{style:{fontSize:14,fontFamily:"monospace"},children:d.steamId})]}),(0,r.jsx)(g.Ay,{type:"text",size:"small",onClick:()=>u(d.steamId||""),style:{color:"#818cf8"},children:"复制"})]})}),d.steamBan&&(0,r.jsxs)("div",{style:{padding:14,borderRadius:10,background:d.steamBan.VACBanned||d.steamBan.NumberOfGameBans||d.steamBan.CommunityBanned?"rgba(239, 68, 68, 0.1)":"rgba(16, 185, 129, 0.1)",border:d.steamBan.VACBanned||d.steamBan.NumberOfGameBans||d.steamBan.CommunityBanned?"1px solid rgba(239, 68, 68, 0.2)":"1px solid rgba(16, 185, 129, 0.2)",marginBottom:16},children:[(0,r.jsx)(eC,{strong:!0,style:{display:"block",marginBottom:8,color:d.steamBan.VACBanned||d.steamBan.NumberOfGameBans||d.steamBan.CommunityBanned?"#f87171":"#6ee7b7"},children:d.steamBan.VACBanned||d.steamBan.NumberOfGameBans||d.steamBan.CommunityBanned?"⚠️ 存在封禁记录":"✓ 账号状态良好"}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,r.jsxs)("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:d.steamBan.VACBanned?"rgba(239, 68, 68, 0.2)":"rgba(16, 185, 129, 0.2)",color:d.steamBan.VACBanned?"#f87171":"#6ee7b7"},children:["VAC: ",d.steamBan.NumberOfVACBans||0]}),(0,r.jsxs)("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:d.steamBan.NumberOfGameBans?"rgba(239, 68, 68, 0.2)":"rgba(16, 185, 129, 0.2)",color:d.steamBan.NumberOfGameBans?"#f87171":"#6ee7b7"},children:["游戏封禁: ",d.steamBan.NumberOfGameBans||0]}),(0,r.jsxs)("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:d.steamBan.CommunityBanned?"rgba(239, 68, 68, 0.2)":"rgba(16, 185, 129, 0.2)",color:d.steamBan.CommunityBanned?"#f87171":"#6ee7b7"},children:["社区: ",d.steamBan.CommunityBanned?"封禁":"正常"]})]}),(null!=(l=d.steamBan.DaysSinceLastBan)?l:0)>0&&(0,r.jsxs)(eC,{type:"secondary",style:{fontSize:11,display:"block",marginTop:6},children:["距上次封禁 ",d.steamBan.DaysSinceLastBan," 天"]})]}),(null==(i=d.steamProfile)?void 0:i.timecreated)&&(0,r.jsxs)("div",{style:{padding:14,borderRadius:10,background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.06)",marginBottom:16},children:[(0,r.jsx)(eC,{strong:!0,style:{fontSize:13,display:"block",marginBottom:10,color:"rgba(255,255,255,0.85)"},children:"账号信息"}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,r.jsx)(eC,{type:"secondary",style:{fontSize:13},children:"注册时间"}),(0,r.jsx)(eC,{style:{fontSize:13},children:new Date(1e3*d.steamProfile.timecreated).toLocaleDateString("zh-CN")})]}),d.steamProfile.loccountrycode&&(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,r.jsx)(eC,{type:"secondary",style:{fontSize:13},children:"地区"}),(0,r.jsx)(eC,{style:{fontSize:13},children:d.steamProfile.loccountrycode})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,r.jsx)(eC,{type:"secondary",style:{fontSize:13},children:"账号年龄"}),(0,r.jsxs)(eC,{style:{fontSize:13},children:[Math.floor((Date.now()/1e3-d.steamProfile.timecreated)/31536e3)," 年"]})]})]}),(null==(a=d.steamProfile)?void 0:a.profileurl)&&(0,r.jsx)(g.Ay,{type:"primary",block:!0,onClick:()=>{var e;return window.open(null==(e=d.steamProfile)?void 0:e.profileurl,"_blank")},style:{height:40,borderRadius:10,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:"查看 Steam 主页"})]}):(0,r.jsx)("div",{style:{textAlign:"center",padding:"20px 0"},children:(0,r.jsx)(W.A,{})})})})},{Text:eB}=a.A,eI=e=>{let{authStatus:t,serverDataReceived:n}=e;return"pending"!==t&&n?null:(0,r.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(27, 27, 31, 0.95)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:1e3},children:[(0,r.jsxs)("div",{style:{position:"relative",width:100,height:100},children:[(0,r.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:80,height:80,borderRadius:20,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",objectFit:"contain",boxShadow:"0 8px 32px rgba(99, 102, 241, 0.3)"}}),(0,r.jsx)(W.A,{indicator:(0,r.jsx)(F.A,{style:{fontSize:100,color:"rgba(99, 102, 241, 0.6)"},spin:!0})})]}),(0,r.jsx)(eB,{style:{color:"rgba(255,255,255,0.7)",fontSize:15,marginTop:8},children:"pending"===t?"正在鉴权...":"正在获取服务器数据..."})]})},{Title:eM,Text:eP}=a.A,{Sider:eT,Content:eR}=l.A;function eE(e){let{appid:t,onAuthFailed:n}=e,{message:a}=s.A.useApp(),I=(0,B.I)(),[M,P]=(0,i.useState)(null),[T,R]=(0,i.useState)([]),[E,O]=(0,i.useState)(!0),[D,L]=(0,i.useState)(!1),[N,W]=(0,i.useState)("从未更新"),[H,F]=(0,i.useState)("disconnected"),[Y,V]=(0,i.useState)("pending"),[X,J]=(0,i.useState)(!0),[U,Z]=(0,i.useState)([]),[Q,ee]=(0,i.useState)(""),[et,en]=(0,i.useState)([]),[er,ei]=(0,i.useState)([]),[ea,el]=(0,i.useState)(null),[eo,ed]=(0,i.useState)(null),[ec,ep]=(0,i.useState)(!1),[eg,eu]=(0,i.useState)(null),[eh,ex]=(0,i.useState)(!1),[em,ey]=(0,i.useState)(!1),[ef,eb]=(0,i.useState)(!1),[ej,ev]=(0,i.useState)(!1),[eS,ew]=(0,i.useState)(null),[eA,ek]=(0,i.useState)([]),[eC,eB]=(0,i.useState)([]),[eE,eO]=(0,i.useState)([]),[eD,eL]=(0,i.useState)(!1),[eN,eq]=(0,i.useState)("server"),[eW,eH]=(0,i.useState)(null),[eF,eY]=(0,i.useState)(!1),[eG,eV]=(0,i.useState)(!1),eX=(0,i.useRef)(null),eJ=async()=>{if(!await (0,z.C)())return void a.error("无法与服务器建立连接");let e=new URL(_.Aq.getGatewayUrl("/api/o/receivedata"));e.searchParams.append("a",t);let r=new C.EventSourcePolyfill(e.toString(),{headers:{Authorization:_.Aq.getCookie("appToken".concat(t))||""}});eX.current=r,r.onmessage=e=>{J(!1),L(!0);try{eU(JSON.parse(e.data))}catch(e){console.warn("SSE message parse error:",e)}W(new Date().toLocaleTimeString())},r.addEventListener("welcome",e=>{let t=e.data,i=null;try{let n=JSON.parse(e.data);t=n.code||n,i=n.connectionId||null}catch(e){}"200"===t?(V("authenticated"),F("connected"),i&&eH(i)):(V("failed"),r.close(),null==n||n())}),r.addEventListener("end",()=>{r.close()}),r.onerror=e=>{console.error("SSE error:",e),401===e.status&&(V("failed"),r.close(),null==n||n())}},eU=e=>{if(e.info&&(ex(!0),O(!1),e.switches||ev(!0)),e.info){let t="00:00";if(e.time){let n=e.time.time,r=n*e.time.dayLengthMinutes/e.time.timeScale,i=Math.floor(r/60),a=Math.floor(r%60);t="".concat(i.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0"))}P({name:e.info.name||"未知",players:e.info.players||0,maxPlayers:e.info.maxPlayers||0,time:t,queuedPlayers:e.info.queuedPlayers||0,headerImage:e.info.headerImage||"",url:e.info.url||"",map:e.info.map||"",mapSize:e.info.mapSize||0,wipeTime:e.info.wipeTime||0,seed:e.info.seed||0})}e.switches&&(ev(!0),R(e.switches.map(e=>({id:e.id,name:e.name,note:e.note,noteColor:e.noteColor,loading:!1,state:e.state,error:e.error})))),"updateswitch"===e.cmd&&e.data&&R(t=>t.map(t=>t.id===e.data.id?{...t,state:e.data.state}:t)),"chat"===e.cmd&&e.data&&(eb(!0),en(e.data)),"team"===e.cmd&&(ey(!0),e.data&&Z(e.data),e.leaderSteamId&&ee(e.leaderSteamId)),"storageMonitorList"===e.cmd&&e.data&&ei(e.data),"storageMonitor"===e.cmd&&e.data&&ed(t=>t&&t.id===e.data.id?{...e.data,protectionExpiry:e.data.protectionExpiry>0?e.data.protectionExpiry:t.protectionExpiry}:e.data),"map"===e.cmd&&e.data&&(ew(e.data),eL(!1)),"mapMarkers"===e.cmd&&e.data&&ek(e.data),"teamPositions"===e.cmd&&e.data&&eB(e.data),"mapNotes"===e.cmd&&e.data&&eO(e.data)},eK=async(e,n)=>{if("connected"!==H)return void a.error("未连接到服务器");try{R(t=>t.map(t=>t.id===e?{...t,loading:!0}:t)),_.Aq.backendFetch("/api/o/setswitch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({a:t,switchid:e,switchstate:!n})}),setTimeout(()=>{R(t=>t.map(t=>t.id===e?{...t,state:!t.state,loading:!1}:t))},1e3)}catch(e){console.error("Error toggling switch:",e)}};(0,i.useEffect)(()=>(eJ(),()=>{eX.current&&(eX.current.close(),eX.current=null)}),[]),(0,i.useEffect)(()=>{eW&&er.length>0&&!ea&&eZ(er[0].id)},[eW,er]);let eZ=async e=>{if(el(e),!e)return void ed(null);if(!eW)return void console.warn("SSE 连接未建立，无法选择监视器");ed(null);try{let n=await _.Aq.backendFetch("/api/o/selectmonitor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({a:t,monitorId:e,connectionId:eW})}),r=await n.json();200===r.status&&r.data&&ed(r.data)}catch(e){console.error("选择存储监视器失败:",e)}},eQ=e=>{eu(e),ep(!0)},e$=async e=>{await _.Aq.copyToClipboard(e),a.success("已复制 SteamID")};(0,i.useEffect)(()=>{I||eV(!1)},[I]);let e0=[{key:"server",icon:(0,r.jsx)(m.A,{}),label:"服务器"},{key:"team",icon:(0,r.jsx)(y.A,{}),label:"队伍"},{key:"storage",icon:(0,r.jsx)(f.A,{}),label:"存储"},{key:"map",icon:(0,r.jsx)(b.A,{}),label:"地图"}],e2=()=>"connected"!==H?(0,r.jsx)(o.A,{icon:(0,r.jsx)(j.A,{spin:!0}),style:{background:"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)",color:"#818cf8",borderRadius:8,margin:0},children:"连接中..."}):(0,r.jsx)(o.A,{icon:D?(0,r.jsx)(v.A,{}):(0,r.jsx)(S.A,{}),color:D?"success":"error",style:{borderRadius:8,margin:0},children:D?"已连接":"未连接"}),e5=()=>{switch(eN){case"server":return(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[(0,r.jsx)(q,{serverInfo:M}),(0,r.jsx)(G,{switches:T,switchesDataReceived:ej,connected:D,wsStatus:H,onSwitchToggle:eK})]});case"team":return(0,r.jsxs)(d.A,{gutter:[24,24],children:[(0,r.jsx)(c.A,{xs:24,lg:12,children:(0,r.jsx)(K,{teamMembers:U,teamDataReceived:em,leaderSteamId:Q,onMemberClick:eQ})}),(0,r.jsx)(c.A,{xs:24,lg:12,children:(0,r.jsx)($,{chatHistory:et,chatDataReceived:ef})})]});case"storage":return(0,r.jsx)(es,{storageMonitors:er,selectedMonitorId:ea,storageMonitorData:eo,onSelectMonitor:eZ,showAsCard:!1,isMobile:I});case"map":return(0,r.jsx)(e_,{mapData:eS,mapMarkers:eA,teamMembers:U,teamPositions:eC,mapNotes:eE,mapLoading:eD,showAsCard:!1,height:I?"calc(100vh - 80px)":"calc(100vh - 140px)",isMobile:I});default:return null}},e1=(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",background:"#27272c"},children:[(0,r.jsxs)("div",{style:{padding:eF?"16px 8px":"16px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)",display:"flex",alignItems:"center",gap:12,justifyContent:eF?"center":"flex-start"},children:[(0,r.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:40,height:40,borderRadius:12,objectFit:"contain"}}),!eF&&(0,r.jsxs)("div",{children:[(0,r.jsx)(eM,{level:5,style:{margin:0,color:"#fff",fontSize:14},children:"控制面板"}),(0,r.jsx)(eP,{type:"secondary",style:{fontSize:11},children:N})]})]}),(0,r.jsx)("div",{style:{padding:eF?"12px 8px":"12px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)",display:"flex",justifyContent:"center"},children:e2()}),(0,r.jsx)(p.A,{mode:"inline",selectedKeys:[eN],onClick:e=>{let{key:n}=e;eq(n),I&&eV(!1),"map"!==n||eS||eL(!0),eW&&_.Aq.backendFetch("/api/o/setactivetab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({a:t,tab:n,connectionId:eW})}).catch(e=>{console.error("设置活动 Tab 失败:",e)})},items:e0,style:{background:"transparent",border:"none",flex:1,padding:"8px 0"}}),!I&&(0,r.jsx)("div",{style:{padding:"12px",borderTop:"1px solid rgba(255,255,255,0.06)",display:"flex",justifyContent:"center"},children:(0,r.jsx)(g.Ay,{type:"text",icon:(0,r.jsx)(w.A,{style:{transform:eF?"rotate(180deg)":"none"}}),onClick:()=>eY(!eF),style:{color:"rgba(255,255,255,0.6)"}})})]});if("failed"===Y)return(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f",padding:24},children:[(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.1) 0%, transparent 50%)",pointerEvents:"none"}}),(0,r.jsx)(u.Ay,{icon:(0,r.jsx)(A.A,{style:{color:"#f59e0b"}}),title:(0,r.jsx)("span",{style:{color:"#fff"},children:"需要配对服务器"}),subTitle:(0,r.jsx)("span",{style:{color:"rgba(255,255,255,0.6)"},children:"您需要先配对服务器，才能请求数据"}),style:{background:"#27272c",borderRadius:20,padding:40}})]});if(I){var e8;return(0,r.jsxs)("div",{style:{minHeight:"100vh",background:"#1b1b1f"},children:[(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.08) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.05) 0%, transparent 50%)",pointerEvents:"none"}}),(0,r.jsx)(eI,{authStatus:Y,serverDataReceived:eh}),(0,r.jsxs)("div",{style:{position:"sticky",top:0,zIndex:100,background:"#27272c",borderBottom:"1px solid rgba(255,255,255,0.08)",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)(h.A,{align:"center",size:12,children:[(0,r.jsx)(g.Ay,{type:"text",icon:(0,r.jsx)(k.A,{}),onClick:()=>eV(!0),style:{color:"#fff"}}),(0,r.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:32,height:32,borderRadius:8}}),(0,r.jsx)(eM,{level:5,style:{margin:0,color:"#fff"},children:(null==(e8=e0.find(e=>e.key===eN))?void 0:e8.label)||"控制面板"})]}),e2()]}),(0,r.jsx)(x.A,{placement:"left",open:eG,onClose:()=>eV(!1),width:260,styles:{body:{padding:0,background:"#27272c"},header:{display:"none"}},children:e1}),(0,r.jsx)("div",{style:{padding:"map"===eN?8:16,position:"relative",zIndex:1},children:e5()}),(0,r.jsx)(ez,{visible:ec,member:eg,leaderSteamId:Q,onClose:()=>ep(!1),onCopySteamId:e$})]})}return(0,r.jsxs)(l.A,{style:{minHeight:"100vh",background:"#1b1b1f"},children:[(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.08) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.05) 0%, transparent 50%)",pointerEvents:"none"}}),(0,r.jsx)(eI,{authStatus:Y,serverDataReceived:eh}),(0,r.jsx)(eT,{width:220,collapsedWidth:72,collapsed:eF,style:{background:"#27272c",borderRight:"1px solid rgba(255,255,255,0.08)",position:"fixed",left:0,top:0,bottom:0,zIndex:100},children:e1}),(0,r.jsx)(eR,{style:{marginLeft:eF?72:220,padding:24,transition:"margin-left 0.2s",position:"relative",zIndex:1},children:(0,r.jsx)("div",{style:{maxWidth:1400,margin:"0 auto"},children:e5()})}),(0,r.jsx)(ez,{visible:ec,member:eg,leaderSteamId:Q,onClose:()=>ep(!1),onCopySteamId:e$})]})}var eO=n(20058),eD=n(86133),eL=n(20063),eN=n(83487);let eq=_.Aq.backendFetch,{Title:eW,Text:eH}=a.A,eF="https://cap.rustplus.cn/336bfb3b1a/";function eY(e){let{params:t,onLoginSuccess:n}=e,a=(0,eL.useRouter)(),{message:l}=s.A.useApp(),[o,d]=(0,i.useState)(""),[c,p]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1),[x,m]=(0,i.useState)(!1),[y,f]=(0,i.useState)(!1),[b,j]=(0,i.useState)(0),v=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:eF});e.addEventListener("progress",e=>{j(e.detail.progress||0)}),v.current=e,m(!0);return}let e=document.createElement("script");e.src="/cap-widget.js",e.async=!0,e.onload=()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:eF});e.addEventListener("progress",e=>{j(e.detail.progress||0)}),v.current=e,m(!0)}},document.head.appendChild(e)},[]);let S=(0,i.useCallback)(async()=>{if(!x||!v.current)return l.error("人机验证组件未加载完成，请稍后重试"),null;try{return f(!0),j(0),(await v.current.solve()).token}catch(e){return l.error("人机验证失败，请重试"),null}finally{f(!1),j(0)}},[x,l]),w=async()=>{if(!o)return void l.warning("请输入密码");let e=await S();if(!e)return;p(!0);let{appid:r}=await t;eq("/api/o/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({a:r.join("/"),password:o,capToken:e})}).then(async e=>{if(!e)return;let t=await e.json();200===t.status?(l.success("登录成功"),h(!0),n&&n(),a.refresh()):l.error(t.errmessage||"登录失败")}).catch(e=>{e&&l.error("请检查网络连接")}).finally(()=>{p(!1)})};return c&&!y||u?(0,r.jsx)(eN.Ay,{text:u?"登录成功，正在跳转...":"正在登录..."}):(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f",padding:20},children:[(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.15) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.1) 0%, transparent 50%)",pointerEvents:"none"}}),(0,r.jsxs)("div",{style:{width:"100%",maxWidth:400,background:"#27272c",borderRadius:24,border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",padding:"40px 36px",position:"relative"},children:[(0,r.jsxs)("div",{style:{textAlign:"center",marginBottom:32},children:[(0,r.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:56,height:56,borderRadius:16,marginBottom:20,boxShadow:"0 8px 24px rgba(99, 102, 241, 0.3)",display:"block",margin:"0 auto 20px auto"}}),(0,r.jsx)(eW,{level:3,style:{margin:0,color:"#fff"},children:"Rust 工具箱"}),(0,r.jsx)(eH,{type:"secondary",style:{fontSize:14},children:"请输入密码访问用户页"})]}),(0,r.jsxs)(eD.A,{layout:"vertical",onFinish:w,requiredMark:!1,children:[(0,r.jsx)(eD.A.Item,{name:"password",rules:[{required:!0,message:"请输入密码"}],children:(0,r.jsx)(en.A.Password,{prefix:(0,r.jsx)(eO.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"请输入访问密码",value:o,onChange:e=>d(e.target.value),size:"large",style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48}})}),y&&(0,r.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,r.jsx)(eH,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,r.jsxs)(eH,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[b,"%"]})]}),(0,r.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,r.jsx)("div",{style:{height:"100%",width:"".concat(b,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,r.jsx)(eD.A.Item,{style:{marginBottom:0},children:(0,r.jsx)(g.Ay,{type:"primary",htmlType:"submit",block:!0,loading:c||y,disabled:!x,style:{height:48,borderRadius:12,background:!x||c||y?"rgba(255,255,255,0.1)":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,fontSize:15,boxShadow:!x||c||y?"none":"0 4px 14px rgba(99, 102, 241, 0.35)"},children:y?"验证中 ".concat(b,"%"):c?"登录中...":"登录"})})]}),(0,r.jsx)("div",{style:{textAlign:"center",marginTop:24},children:(0,r.jsxs)(eH,{type:"secondary",style:{fontSize:12},children:["Powered by"," ",(0,r.jsx)("a",{href:"https://www.rustplus.cn",target:"_blank",rel:"noopener noreferrer",style:{color:"#818cf8"},children:"Rust 工具箱"})]})})]})]})}let eG=_.Aq.backendFetch;function eV(e){let{appid:t,autoLogin:n,token:a}=e,[l,s]=(0,i.useState)(null),[o,d]=(0,i.useState)(!1),[c,p]=(0,i.useState)(null);(0,i.useEffect)(()=>{if("1"===n&&a)return void g(a);let e=new URLSearchParams(window.location.search),r=e.get("autoLogin"),i=e.get("token");"1"===r&&i?g(i):s(!document.cookie.includes("appToken".concat(t,"=")))},[t,n,a]);let g=async e=>{d(!0),p(null);try{let n=await eG("/api/o/autologin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({a:t,token:e})}),r=await n.json();if(200===r.status){let e=window.location.hash;if(e.includes("?")){let t=e.split("?")[0];window.history.replaceState({},"",window.location.pathname+t)}s(!1)}else{p(r.errmessage||"自动登录失败"),setTimeout(()=>{let e=window.location.hash;if(e.includes("?")){let t=e.split("?")[0];window.history.replaceState({},"",window.location.pathname+t)}s(!0),d(!1)},2e3);return}}catch(e){p("网络错误，请重试"),setTimeout(()=>{let e=window.location.hash;if(e.includes("?")){let t=e.split("?")[0];window.history.replaceState({},"",window.location.pathname+t)}s(!0),d(!1)},2e3);return}d(!1)},u=(0,i.useCallback)(()=>{s(!0)},[]),h=(0,i.useCallback)(()=>{s(!1)},[]);return o?(0,r.jsx)(eN.Ay,{text:c||"正在自动登录..."}):null===l?(0,eN.bT)()?null:(0,r.jsx)(eN.Ay,{}):((0,eN.Jy)(),l)?(0,r.jsx)(eY,{params:Promise.resolve({appid:t.split("/")}),onLoginSuccess:h}):(0,r.jsx)(eE,{appid:t,onAuthFailed:u})}},83487:(e,t,n)=>{n.d(t,{Ay:()=>o,Jy:()=>l,bT:()=>s,ek:()=>a});var r=n(95155),i=n(12115);function a(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");e&&e.classList.remove("hidden")}}function l(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");e&&e.classList.add("hidden")}}function s(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");return null!==e&&!e.classList.contains("hidden")}return!1}function o(e){let{text:t="加载中...",subText:n}=e;return i.useEffect(()=>{l()},[]),(0,r.jsxs)("div",{className:"fullscreen-loader",children:[(0,r.jsx)("div",{className:"fullscreen-loader-bg"}),(0,r.jsxs)("div",{className:"fullscreen-loader-content",children:[(0,r.jsxs)("div",{className:"fullscreen-loader-logo-container",children:[(0,r.jsx)("img",{className:"fullscreen-loader-logo",src:"https://www.rustplus.cn/logo.png",alt:"Logo"}),(0,r.jsx)("div",{className:"fullscreen-loader-spinner"})]}),(0,r.jsx)("div",{className:"fullscreen-loader-text",children:t}),n&&(0,r.jsx)("div",{className:"fullscreen-loader-subtext",children:n})]})]})}},96750:(e,t,n)=>{n.d(t,{C:()=>r});async function r(){return window.location.origin}}}]);