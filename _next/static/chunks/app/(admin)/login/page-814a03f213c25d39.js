(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8369],{19284:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>D});var s=r(95155),n=r(12115),i=r(36060),a=r(37076);r(92932);var o=r(69176),l=r(90262),d=r(93764),c=r(56922),g=r(20058),u=r(22530),p=r(31199),h=r(88795),f=r(87480),b=r(44241),m=r(19279),y=r(89543),x=r(86133),j=r(39286),w=r(785),v=r(49073),k=r(35078),A=r(15856),S=r(63646),C=r(37783),I=r(83487);let T=C.Aq.backendFetch,{Title:z,Text:B}=m.A,E="https://cap.rustplus.cn/336bfb3b1a/",R="2026.01.01",P="user_agreement_accepted",L="userpage_history",W=()=>(()=>{try{let e=localStorage.getItem(P);if(e)return JSON.parse(e).version||null}catch(e){}return null})()!==R,O=()=>{try{let e=localStorage.getItem(L);if(e)return JSON.parse(e)}catch(e){}return[]},N=e=>{try{let t=e.sort((e,t)=>t.lastConnected-e.lastConnected).slice(0,10);localStorage.setItem(L,JSON.stringify(t))}catch(e){}},F=e=>{let{onSolve:t,apiEndpoint:r}=e,i=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(!i.current)return;i.current.innerHTML="";let e=document.createElement("cap-widget");e.setAttribute("data-cap-api-endpoint",r),e.setAttribute("data-cap-i18n-initial-state","我是人类"),e.setAttribute("data-cap-i18n-verifying-label","验证中..."),e.setAttribute("data-cap-i18n-solved-label","验证通过"),e.setAttribute("data-cap-i18n-error-label","验证失败，请重试"),i.current.appendChild(e);let s=e=>{t(e.detail.token)};return e.addEventListener("solve",s),()=>{e.removeEventListener("solve",s),i.current&&(i.current.innerHTML="")}},[r,t]),(0,s.jsx)("div",{ref:i})};function q(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)(I.Ay,{}),children:(0,s.jsx)(M,{})})}function M(){let{message:e}=y.A.useApp(),[t,r]=(0,n.useState)("login"),[a,o]=(0,n.useState)(!1),[f,b]=(0,n.useState)(0),[m,C]=(0,n.useState)(!1),[L,q]=(0,n.useState)(!1),[M,_]=(0,n.useState)(!1),[H,D]=(0,n.useState)(!1),[U,V]=(0,n.useState)(0),G=(0,n.useRef)(null),[Y,Z]=(0,n.useState)(!1),[K,Q]=(0,n.useState)(!1),[X,ee]=(0,n.useState)(""),[et,er]=(0,n.useState)(!1),[es,en]=(0,n.useState)(!1),[ei,ea]=(0,n.useState)(!1),[eo,el]=(0,n.useState)(!1),[ed]=x.A.useForm(),[ec]=x.A.useForm(),[eg]=x.A.useForm(),[eu,ep]=(0,n.useState)(!1),[eh,ef]=(0,n.useState)([]),[eb,em]=(0,n.useState)(""),[ey,ex]=(0,n.useState)(""),[ej,ew]=(0,n.useState)(!1),[ev,ek]=(0,n.useState)(!1),[eA]=x.A.useForm(),[eS,eC]=(0,n.useState)(null),[eI,eT]=(0,n.useState)(0),ez=(0,n.useCallback)(e=>{eC(e)},[]);(0,n.useEffect)(()=>{W()||(Z(!0),en(!0)),ef(O())},[]),(0,n.useEffect)(()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:E});e.addEventListener("progress",e=>{V(e.detail.progress||0)}),G.current=e,_(!0);return}let e=document.createElement("script");e.src="/cap-widget.js",e.async=!0,e.onload=()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:E});e.addEventListener("progress",e=>{V(e.detail.progress||0)}),G.current=e,_(!0)}},document.head.appendChild(e)},[]);let eB=(0,n.useCallback)(async()=>{if(!M||!G.current)return e.error("人机验证组件未加载完成，请稍后重试"),null;try{return D(!0),V(0),(await G.current.solve()).token}catch(t){return e.error("人机验证失败，请重试"),null}finally{D(!1),V(0)}},[M,e]);(0,n.useEffect)(()=>{"register"===t?(Z(!1),ea(!1)):"login"!==t||W()||Z(!0)},[t]);let eE=(0,n.useCallback)(async()=>{if(!X){er(!0);try{let e=await fetch("/user-agreement.md");if(e.ok){let t=await e.text();ee(t)}else ee("协议内容加载失败，请刷新页面重试。")}catch(e){ee("协议内容加载失败，请刷新页面重试。")}finally{er(!1)}}},[X]),eR=(0,n.useCallback)(()=>{eE(),el(!1),Q(!0)},[eE]),eP=(0,n.useCallback)(e=>{let t=e.target;t.scrollHeight-t.scrollTop-t.clientHeight<30&&!eo&&el(!0)},[eo]),eL=(0,n.useCallback)(()=>{Z(!0),en(!0),ea(!0);try{localStorage.setItem(P,JSON.stringify({version:R,acceptedAt:new Date().toISOString()}))}catch(e){}Q(!1)},[]),eW=(0,n.useCallback)(e=>{if(e&&(W()&&!es||"register"===t&&!ei))return void eR();Z(e)},[es,ei,t,eR]),eO=(0,n.useCallback)(()=>{ef(O()),em(""),ex(""),ew(!1),eC(null),eT(e=>e+1),eA.resetFields(),ep(!0)},[eA]),eN=(0,n.useCallback)(()=>{eC(null),eT(e=>e+1)},[]),eF=(0,n.useCallback)(async(t,r)=>{let s=(t||eb).trim(),n=r||ey;if(!s)return void e.warning("请输入用户页ID");if(!n)return void e.warning("请输入访问密码");if(!eS)return void e.warning("请先完成人机验证");ek(!0);try{let t=window.location.origin,r=await T("/api/o/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({a:s,password:n,capToken:eS})}),a=await r.json();if(200===a.status){var i={appid:s,url:"".concat(t,"/#/user/").concat(s),password:ej?n:void 0,lastConnected:Date.now()};let r=O(),a=r.findIndex(e=>e.appid===i.appid);a>=0?r[a]={...r[a],...i,lastConnected:Date.now()}:r.unshift({...i,lastConnected:Date.now()}),N(r),e.success("连接成功，正在跳转..."),ep(!1),window.location.href="".concat(t,"/#/user/").concat(s)}else e.error(a.errmessage||"连接失败，请检查ID和密码"),eN()}catch(t){e.error("网络错误，请稍后重试"),eN()}finally{ek(!1)}},[eb,ey,ej,e,eS,eN]),eq=(0,n.useCallback)(e=>{e.password?eF(e.appid,e.password):(em(e.appid),eA.setFieldsValue({appid:e.appid}))},[eF,eA]),eM=(0,n.useCallback)((t,r)=>{r.stopPropagation(),N(O().filter(e=>e.appid!==t)),ef(O()),e.success("已删除")},[e]);(0,n.useEffect)(()=>{if(f>0){let e=setInterval(()=>{b(e=>e-1)},1e3);return()=>clearInterval(e)}},[f]);let eJ=async(t,r)=>{try{C(!0);let s=await r.validateFields(["phone"]),n=await eB();if(!n)return void C(!1);let i=await T("/api/v/get".concat(t,"smsverify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:s.phone,capToken:n})}),a=await i.json();if(200===a.status){e.success("验证码已发送到手机"),b(60);return}10003===a.status?e.warning("发送太频繁，请稍后再试"):e.error(a.errmessage||"发送失败")}catch(t){e.error("请填写完整信息")}finally{C(!1)}},e$=async t=>{try{C(!0);let r=(await t.validateFields(["account"])).account,s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),n=/^1[3-9]\d{9}$/.test(r);if(!s&&!n){e.error("请输入有效的邮箱或手机号"),C(!1);return}let i=await eB();if(!i)return void C(!1);let a=await T(s?"/api/v/getresetpasswordverifyemail":"/api/v/getresetpasswordsmsverify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({[s?"email":"phone"]:r,capToken:i})}),o=await a.json();if(200===o.status){e.success(s?"验证码已发送到邮箱":"验证码已发送到手机"),b(60);return}10003===o.status?e.warning("发送太频繁，请稍后再试"):e.error(o.errmessage||"发送失败")}catch(t){e.error("请填写完整信息")}finally{C(!1)}},e_=async r=>{o(!0);try{let s="",n={};switch(t){case"login":let i=await eB();if(!i)return void o(!1);s="/api/v/login",n={account:r.account,password:r.password,remember:r.remember,capToken:i};break;case"register":s="/api/v/registerbyphone",n={phone:r.phone,password:r.password,smscode:r.smsCode};break;case"resetpassword":let a=r.account;/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?(s="/api/v/resetpasswordbyemail",n={email:a,password:r.password,emailcode:r.verifyCode}):(s="/api/v/resetpasswordbyphone",n={phone:a,password:r.password,smscode:r.verifyCode})}let l=await T(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),d=await l.json();200===d.status?(q(!0),window.location.href="/admin"):e.error(d.errmessage||"操作失败")}catch(t){e.error("网络请求异常")}finally{o(!1)}},eH={login:{form:ed,title:"欢迎回来",subtitle:"登录你的账户继续使用"},register:{form:ec,title:"创建账户",subtitle:"通过手机号注册新账户"},resetpassword:{form:eg,title:"重置密码",subtitle:"通过邮箱或手机号验证重置密码"}}[t];if(a&&!H||L){let e=L?"登录成功，正在跳转...":"login"===t?"正在登录...":"register"===t?"正在注册...":"正在处理...";return(0,s.jsx)(I.Ay,{text:e})}return(0,s.jsxs)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#1b1b1f",padding:20},children:[(0,s.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.15) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.1) 0%, transparent 50%)",pointerEvents:"none"}}),(0,s.jsxs)("div",{style:{width:"100%",maxWidth:420,background:"#27272c",borderRadius:24,border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",padding:"40px 36px",position:"relative"},children:[(0,s.jsx)(j.A,{title:"访问队友分享的用户页，控制智能开关",children:(0,s.jsx)(w.Ay,{type:"text",icon:(0,s.jsx)(l.A,{}),onClick:eO,style:{position:"absolute",top:12,right:12,color:"#818cf8",borderRadius:8,background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",fontSize:12,height:28,padding:"0 10px"},children:"用户页"})}),(0,s.jsxs)("div",{style:{textAlign:"center",marginBottom:32},children:[(0,s.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:56,height:56,borderRadius:16,display:"block",margin:"0 auto",marginBottom:20,objectFit:"contain"}}),(0,s.jsx)(z,{level:3,style:{margin:0,color:"#fff"},children:eH.title}),(0,s.jsx)(B,{type:"secondary",style:{fontSize:14},children:eH.subtitle})]}),"resetpassword"!==t&&(0,s.jsxs)("div",{style:{display:"flex",background:"rgba(255, 255, 255, 0.03)",borderRadius:12,padding:4,marginBottom:28},children:[(0,s.jsx)(w.Ay,{type:"text",onClick:()=>r("login"),style:{flex:1,height:40,borderRadius:10,background:"login"===t?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"transparent",color:"login"===t?"#fff":"rgba(255,255,255,0.6)",border:"none",fontWeight:500},children:"登录"}),(0,s.jsx)(w.Ay,{type:"text",onClick:()=>r("register"),style:{flex:1,height:40,borderRadius:10,background:"register"===t?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"transparent",color:"register"===t?"#fff":"rgba(255,255,255,0.6)",border:"none",fontWeight:500},children:"注册"})]}),"resetpassword"===t&&(0,s.jsx)(w.Ay,{type:"text",icon:(0,s.jsx)(d.A,{}),onClick:()=>r("login"),style:{marginBottom:20,color:"rgba(255,255,255,0.6)",padding:0},children:"返回登录"}),"login"===t&&(0,s.jsxs)(x.A,{form:ed,onFinish:e_,layout:"vertical",requiredMark:!1,children:[(0,s.jsx)(x.A.Item,{name:"account",rules:[{required:!0,message:"请输入邮箱或手机号"}],children:(0,s.jsx)(v.A,{prefix:(0,s.jsx)(c.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"邮箱或手机号",size:"large",style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48}})}),(0,s.jsx)(x.A.Item,{name:"password",rules:[{required:!0,message:"请输入密码"}],children:(0,s.jsx)(v.A.Password,{prefix:(0,s.jsx)(g.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"密码",size:"large",style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48}})}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,s.jsx)(x.A.Item,{name:"remember",valuePropName:"checked",noStyle:!0,children:(0,s.jsx)(k.A,{style:{color:"rgba(255,255,255,0.6)"},children:"记住登录"})}),(0,s.jsx)(w.Ay,{type:"link",onClick:()=>r("resetpassword"),style:{padding:0,color:"#818cf8"},children:"忘记密码?"})]}),(0,s.jsxs)("div",{style:{marginBottom:24},children:[(0,s.jsx)(k.A,{checked:Y,onChange:e=>eW(e.target.checked),style:{color:"rgba(255,255,255,0.6)"},children:"我已阅读并同意"}),(0,s.jsx)(w.Ay,{type:"link",onClick:eR,style:{padding:0,color:"#818cf8"},icon:(0,s.jsx)(u.A,{}),children:"《用户服务协议》"})]}),H&&(0,s.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,s.jsx)(B,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,s.jsxs)(B,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[U,"%"]})]}),(0,s.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,s.jsx)("div",{style:{height:"100%",width:"".concat(U,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,s.jsx)(x.A.Item,{style:{marginBottom:0},children:(0,s.jsx)(w.Ay,{type:"primary",htmlType:"submit",block:!0,loading:a||H,disabled:!Y,style:{height:48,borderRadius:12,background:!Y||a||H?"rgba(255,255,255,0.1)":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,fontSize:15,boxShadow:!Y||a||H?"none":"0 4px 14px rgba(99, 102, 241, 0.35)"},children:H?"验证中 ".concat(U,"%"):a?"登录中...":"登录"})})]}),"register"===t&&(0,s.jsx)(J,{form:ec,loading:a,loadingVerift:m,countdown:f,onFinish:e_,onGetSmsCode:()=>eJ("register",ec),agreementChecked:Y,onAgreementCheckChange:eW,onOpenAgreement:eR,registerHasReadAgreement:ei,capVerifying:H,capProgress:U}),"resetpassword"===t&&(0,s.jsx)($,{form:eg,loading:a,loadingVerift:m,countdown:f,onFinish:e_,onGetCode:()=>e$(eg),capVerifying:H,capProgress:U}),(0,s.jsx)("div",{style:{textAlign:"center",marginTop:28},children:(0,s.jsxs)(B,{type:"secondary",style:{fontSize:12},children:["遇到问题？",(0,s.jsx)("a",{href:"https://www.rustplus.cn",target:"_blank",rel:"noopener noreferrer",style:{color:"#818cf8",marginLeft:4},children:"联系客服"})]})})]}),(0,s.jsx)(A.A,{title:(0,s.jsxs)("span",{children:[(0,s.jsx)(u.A,{style:{marginRight:8}}),"用户服务协议"]}),open:K,onCancel:()=>Q(!1),footer:[(0,s.jsx)(w.Ay,{onClick:()=>Q(!1),children:"取消"},"cancel"),(0,s.jsx)(w.Ay,{type:"primary",onClick:eL,disabled:!eo,style:{background:eo?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"rgba(255,255,255,0.1)",border:"none"},children:eo?"我已阅读并同意":"请阅读完整协议"},"confirm")],width:700,styles:{body:{maxHeight:"60vh",overflowY:"auto",padding:0,background:"#1b1b1f"},header:{background:"#27272c",borderBottom:"1px solid rgba(255,255,255,0.08)"},content:{background:"#27272c"},footer:{background:"#27272c",borderTop:"1px solid rgba(255,255,255,0.08)"}},children:et?(0,s.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,s.jsx)(i.A,{tip:"加载中..."})}):(0,s.jsxs)("div",{onScroll:eP,style:{maxHeight:"60vh",overflowY:"auto",padding:"20px 24px"},children:[(0,s.jsx)("div",{style:{color:"rgba(255,255,255,0.85)",lineHeight:1.8,fontSize:14},children:X.split("\n").map((e,t)=>{let r=e=>e.split(/(\*\*[^*]+\*\*)/g).map((e,t)=>e.startsWith("**")&&e.endsWith("**")?(0,s.jsx)("strong",{style:{color:"#fff"},children:e.slice(2,-2)},t):e);return e.startsWith("# ")?(0,s.jsx)("h1",{style:{fontSize:20,marginTop:16,marginBottom:12,color:"#fff"},children:e.slice(2)},t):e.startsWith("## ")?(0,s.jsx)("h2",{style:{fontSize:17,marginTop:20,marginBottom:10,color:"#fff"},children:e.slice(3)},t):e.startsWith("### ")?(0,s.jsx)("h3",{style:{fontSize:15,marginTop:16,marginBottom:8,color:"#fff"},children:e.slice(4)},t):e.startsWith("---")?(0,s.jsx)("hr",{style:{border:"none",borderTop:"1px solid rgba(255,255,255,0.1)",margin:"16px 0"}},t):e.startsWith("- ")?(0,s.jsxs)("p",{style:{paddingLeft:16,margin:"4px 0"},children:["• ",r(e.slice(2))]},t):""===e.trim()?(0,s.jsx)("div",{style:{height:8}},t):(0,s.jsx)("p",{style:{margin:"4px 0"},children:r(e)},t)})}),!eo&&(0,s.jsx)("div",{style:{textAlign:"center",padding:"16px 0",color:"rgba(255,255,255,0.5)",fontSize:13},children:"↓ 请滚动阅读完整协议 ↓"})]})}),(0,s.jsxs)(A.A,{title:(0,s.jsxs)("span",{children:[(0,s.jsx)(l.A,{style:{marginRight:8}}),"访问队友的用户页"]}),open:eu,onCancel:()=>{ep(!1),eC(null)},footer:null,width:420,styles:{body:{padding:"20px 24px",background:"#1b1b1f"},header:{background:"#27272c",borderBottom:"1px solid rgba(255,255,255,0.08)"},content:{background:"#27272c"}},children:[(0,s.jsx)("div",{style:{padding:"12px 16px",background:"rgba(99, 102, 241, 0.1)",borderRadius:10,border:"1px solid rgba(99, 102, 241, 0.2)",marginBottom:20},children:(0,s.jsx)(B,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,lineHeight:1.6},children:"输入队友分享给您的用户页账号和密码，即可通过网页控制队友配对的智能开关。"})}),eh.length>0&&(0,s.jsxs)("div",{style:{marginBottom:20},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8,color:"rgba(255,255,255,0.6)",fontSize:13},children:[(0,s.jsx)(p.A,{style:{marginRight:6}}),"历史记录"]}),(0,s.jsx)("div",{style:{maxHeight:120,overflowY:"auto",background:"rgba(255,255,255,0.02)",borderRadius:8,border:"1px solid rgba(255,255,255,0.06)"},children:eh.map((e,t)=>(0,s.jsxs)("div",{onClick:()=>eq(e),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",cursor:"pointer",borderBottom:t<eh.length-1?"1px solid rgba(255,255,255,0.04)":"none",transition:"background 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="rgba(99, 102, 241, 0.1)",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:[(0,s.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,s.jsx)(B,{style:{color:"#818cf8",fontSize:13,display:"block"},children:e.appid}),(0,s.jsx)(B,{type:"secondary",style:{fontSize:11},children:e.password?"点击快速连接":"需要输入密码"})]}),(0,s.jsxs)(S.A,{size:4,children:[e.password&&(0,s.jsx)(w.Ay,{type:"text",size:"small",icon:(0,s.jsx)(l.A,{}),style:{color:"#10b981"}}),(0,s.jsx)(w.Ay,{type:"text",size:"small",icon:(0,s.jsx)(h.A,{}),onClick:t=>eM(e.appid,t),style:{color:"rgba(255,255,255,0.3)"}})]})]},e.appid))})]}),(0,s.jsxs)(x.A,{form:eA,layout:"vertical",requiredMark:!1,children:[(0,s.jsx)(x.A.Item,{name:"appid",label:(0,s.jsx)(B,{type:"secondary",style:{fontSize:13},children:"用户页账号"}),style:{marginBottom:12},children:(0,s.jsx)(v.A,{placeholder:"输入用户页账号",value:eb,onChange:e=>em(e.target.value),style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,height:44}})}),(0,s.jsx)(x.A.Item,{name:"password",label:(0,s.jsx)(B,{type:"secondary",style:{fontSize:13},children:"用户页密码"}),style:{marginBottom:12},children:(0,s.jsx)(v.A.Password,{placeholder:"输入用户页密码",value:ey,onChange:e=>ex(e.target.value),style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,height:44}})}),(0,s.jsx)(x.A.Item,{style:{marginBottom:16},children:(0,s.jsx)(k.A,{checked:ej,onChange:e=>ew(e.target.checked),style:{color:"rgba(255,255,255,0.6)"},children:"记住密码"})}),(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)("style",{children:"\n                            cap-widget {\n                                --cap-background: rgba(255, 255, 255, 0.03);\n                                --cap-border-color: rgba(255, 255, 255, 0.08);\n                                --cap-color: rgba(255, 255, 255, 0.85);\n                                --cap-checkbox-background: rgba(255, 255, 255, 0.05);\n                                --cap-checkbox-border: 1px solid rgba(255, 255, 255, 0.15);\n                                --cap-spinner-color: #6366f1;\n                                --cap-spinner-background-color: rgba(255, 255, 255, 0.1);\n                                --cap-widget-width: 100%;\n                                --cap-border-radius: 12px;\n                            }\n                            cap-widget::part(attribution) {\n                                display: none !important;\n                            }\n                        "}),(0,s.jsx)(F,{onSolve:ez,apiEndpoint:E},eI)]}),(0,s.jsx)(w.Ay,{type:"primary",block:!0,loading:ev,disabled:!eS,onClick:()=>eF(),style:{height:44,borderRadius:10,background:eS?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"rgba(255,255,255,0.1)",border:"none",fontWeight:500},children:"连接"})]})]})]})}let J=e=>{let{form:t,loading:r,loadingVerift:n,countdown:i,onFinish:a,onGetSmsCode:o,agreementChecked:l,onAgreementCheckChange:d,onOpenAgreement:c,registerHasReadAgreement:g,capVerifying:p,capProgress:h}=e,m={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48};return(0,s.jsxs)(x.A,{form:t,onFinish:a,layout:"vertical",requiredMark:!1,children:[(0,s.jsx)(x.A.Item,{name:"phone",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式错误"}],children:(0,s.jsx)(v.A,{prefix:(0,s.jsx)(f.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"手机号",size:"large",style:m,maxLength:11})}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,s.jsx)(x.A.Item,{name:"password",rules:[{required:!0,message:"请输入密码"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]+$/,message:"需包含字母和数字，仅支持特殊字符 !@#$%^&*()_+-=[]{};':\"\\|,.<>/?~`"},{min:8,message:"至少8位"},{max:20,message:"最多20位"}],children:(0,s.jsx)(v.A.Password,{placeholder:"设置密码",size:"large",style:m})}),(0,s.jsx)(x.A.Item,{name:"confirm",dependencies:["password"],rules:[{required:!0,message:"请确认密码"},e=>{let{getFieldValue:t}=e;return{validator:(e,r)=>r&&t("password")!==r?Promise.reject(Error("密码不一致")):Promise.resolve()}}],children:(0,s.jsx)(v.A.Password,{placeholder:"确认密码",size:"large",style:m})})]}),(0,s.jsx)(x.A.Item,{name:"smsCode",rules:[{required:!0,message:"请输入短信验证码"}],children:(0,s.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,s.jsx)(v.A,{prefix:(0,s.jsx)(b.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"短信验证码",size:"large",style:{...m,flex:1},maxLength:6}),(0,s.jsx)(w.Ay,{onClick:o,disabled:i>0||n||p,loading:n,style:{height:48,width:120,borderRadius:12,background:i>0?"rgba(255,255,255,0.03)":"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)",color:"#818cf8"},children:n&&p?"".concat(h,"%"):i?"".concat(i,"s"):"获取验证码"})]})}),p&&n&&(0,s.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,s.jsx)(B,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,s.jsxs)(B,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[h,"%"]})]}),(0,s.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,s.jsx)("div",{style:{height:"100%",width:"".concat(h,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)(k.A,{checked:l,onChange:e=>d(e.target.checked),style:{color:"rgba(255,255,255,0.6)"},children:"我已阅读并同意"}),(0,s.jsx)(w.Ay,{type:"link",onClick:c,style:{padding:0,color:"#818cf8"},icon:(0,s.jsx)(u.A,{}),children:"《用户服务协议》"}),!g&&(0,s.jsx)(B,{type:"warning",style:{display:"block",fontSize:12,marginTop:4},children:"注册前请先阅读用户协议"})]}),(0,s.jsx)(x.A.Item,{style:{marginBottom:0},children:(0,s.jsx)(w.Ay,{type:"primary",htmlType:"submit",block:!0,loading:r,disabled:!l||!g,style:{height:48,borderRadius:12,background:l&&g&&!r?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"rgba(255,255,255,0.1)",border:"none",fontWeight:500,fontSize:15,boxShadow:l&&g&&!r?"0 4px 14px rgba(99, 102, 241, 0.35)":"none"},children:r?"注册中...":"注册"})})]})},$=e=>{let{form:t,loading:r,loadingVerift:n,countdown:i,onFinish:a,onGetCode:o,capVerifying:l,capProgress:d}=e,g={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48};return(0,s.jsxs)(x.A,{form:t,onFinish:a,layout:"vertical",requiredMark:!1,children:[(0,s.jsx)(x.A.Item,{name:"account",rules:[{required:!0,message:"请输入邮箱或手机号"},{validator:(e,t)=>{if(!t)return Promise.resolve();let r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),s=/^1[3-9]\d{9}$/.test(t);return r||s?Promise.resolve():Promise.reject(Error("请输入有效的邮箱或手机号"))}}],children:(0,s.jsx)(v.A,{prefix:(0,s.jsx)(c.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"注册时使用的邮箱或手机号",size:"large",style:g})}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,s.jsx)(x.A.Item,{name:"password",rules:[{required:!0,message:"请输入新密码"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]+$/,message:"需包含字母和数字，仅支持特殊字符 !@#$%^&*()_+-=[]{};':\"\\|,.<>/?~`"},{min:8,message:"至少8位"},{max:20,message:"最多20位"}],children:(0,s.jsx)(v.A.Password,{placeholder:"新密码",size:"large",style:g})}),(0,s.jsx)(x.A.Item,{name:"confirm",dependencies:["password"],rules:[{required:!0,message:"请确认密码"},e=>{let{getFieldValue:t}=e;return{validator:(e,r)=>r&&t("password")!==r?Promise.reject(Error("密码不一致")):Promise.resolve()}}],children:(0,s.jsx)(v.A.Password,{placeholder:"确认新密码",size:"large",style:g})})]}),(0,s.jsx)(x.A.Item,{name:"verifyCode",rules:[{required:!0,message:"请输入验证码"}],children:(0,s.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,s.jsx)(v.A,{prefix:(0,s.jsx)(b.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"邮箱/短信验证码",size:"large",style:{...g,flex:1},maxLength:6}),(0,s.jsx)(w.Ay,{onClick:o,disabled:i>0||n||l,loading:n,style:{height:48,width:120,borderRadius:12,background:i>0?"rgba(255,255,255,0.03)":"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)",color:"#818cf8"},children:n&&l?"".concat(d,"%"):i?"".concat(i,"s"):"获取验证码"})]})}),l&&n&&(0,s.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,s.jsx)(B,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,s.jsxs)(B,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[d,"%"]})]}),(0,s.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,s.jsx)("div",{style:{height:"100%",width:"".concat(d,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,s.jsx)(x.A.Item,{style:{marginBottom:0},children:(0,s.jsx)(w.Ay,{type:"primary",htmlType:"submit",block:!0,loading:r,style:{height:48,borderRadius:12,background:r?"rgba(255,255,255,0.1)":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,fontSize:15,boxShadow:r?"none":"0 4px 14px rgba(99, 102, 241, 0.35)"},children:r?"重置中...":"重置密码"})})]})};function _(){let{isAuthenticated:e,isLoading:t,checkAuth:r}=(0,o.A)(),[i,a]=n.useState(!1);return((0,n.useEffect)(()=>{r()},[]),(0,n.useEffect)(()=>{t||!e||i||(a(!0),window.location.href="/admin")},[t,e,i]),t||i||e)?null:((0,I.Jy)(),(0,s.jsx)(q,{}))}function H(){return(0,s.jsx)(_,{})}function D(){let[e,t]=(0,n.useState)(!0),[r,o]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{(function(){if("undefined"==typeof document)return!1;for(let e of document.cookie.split(";")){let[t,r]=e.trim().split("=");if("authToken"===t&&r&&r.length>0)return!0}return!1})()&&(window.location.href="/admin",o(!0)),t(!1)},[]),e||r)?(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f"},children:(0,s.jsx)(i.A,{indicator:(0,s.jsx)(a.A,{style:{fontSize:48,color:"#6366f1"},spin:!0})})}):(0,s.jsx)(H,{})}},37783:(e,t,r)=>{"use strict";r.d(t,{Aq:()=>n,Ay:()=>i});let s="http://localhost:44667";class n{static formatDateTime(e){let t=new Date(e),r=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"-").concat(s,"-").concat(n," ").concat(i,":").concat(a)}static async copyToClipboard(e,t){let{onSuccess:r,onError:s}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==r||r(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==r||r(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==r||r(),!0}catch(e){return null==s||s(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(s).concat(e):e.startsWith("/api/")?"".concat(s,"/api/backend").concat(e.slice(4)):"".concat(s).concat(e)}static async backendFetch(e,t){return fetch(n.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,r;let s="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===s.length)return null!=(r=null==(t=s.pop())?void 0:t.split(";").shift())?r:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let i={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},69176:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>d});var s=r(95155),n=r(12115),i=r(37783);let{backendFetch:a}=i.Aq;function o(){let e=window.location.hostname;"localhost"===e||"127.0.0.1"===e||/^(\d{1,3}\.){3}\d{1,3}$/.test(e)||/^(\[)?([0-9a-fA-F:]+)(])?$/.test(e)?(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"):(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(i.Ay.domain,";"),document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(i.Ay.domain,";"))}let l=(0,n.createContext)(void 0);function d(e){let{children:t}=e,[r,i]=(0,n.useState)({isAuthenticated:!1,isLoading:!0,userInfo:null,activationStatus:"unknown"}),d=(0,n.useCallback)(e=>{i(t=>({...t,...e}))},[]),c=(0,n.useCallback)(async()=>{try{d({isLoading:!0});let e=await a("/api/f/getstate",{method:"POST",credentials:"include"});if(403===e.status){o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}let t=await e.json();if(403===t.status){o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}if(200===t.status)return void d({isAuthenticated:!0,isLoading:!1,userInfo:t.userinfo||null,activationStatus:"active"===t.data?"active":"inactive"});o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}catch(e){console.error("Auth check failed:",e),o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}},[d]),g=(0,n.useCallback)(()=>{d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})},[d]),u={...r,checkAuth:c,logout:g,setAuthState:d};return(0,s.jsx)(l.Provider,{value:u,children:t})}function c(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},83487:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>l,Jy:()=>a,bT:()=>o,ek:()=>i});var s=r(95155),n=r(12115);function i(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");e&&e.classList.remove("hidden")}}function a(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");e&&e.classList.add("hidden")}}function o(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");return null!==e&&!e.classList.contains("hidden")}return!1}function l(e){let{text:t="加载中...",subText:r}=e;return n.useEffect(()=>{a()},[]),(0,s.jsxs)("div",{className:"fullscreen-loader",children:[(0,s.jsx)("div",{className:"fullscreen-loader-bg"}),(0,s.jsxs)("div",{className:"fullscreen-loader-content",children:[(0,s.jsxs)("div",{className:"fullscreen-loader-logo-container",children:[(0,s.jsx)("img",{className:"fullscreen-loader-logo",src:"https://www.rustplus.cn/logo.png",alt:"Logo"}),(0,s.jsx)("div",{className:"fullscreen-loader-spinner"})]}),(0,s.jsx)("div",{className:"fullscreen-loader-text",children:t}),r&&(0,s.jsx)("div",{className:"fullscreen-loader-subtext",children:r})]})]})}},87584:(e,t,r)=>{Promise.resolve().then(r.bind(r,19284))}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,6060,9073,6133,5078,9991,8441,1255,7358],()=>e(e.s=87584)),_N_E=e.O()}]);