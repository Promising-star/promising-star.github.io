(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8369],{19284:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>$});var i=r(95155),s=r(12115),a=r(36060),n=r(37076);r(92932);var o=r(19279),l=r(69176),d=r(90262),c=r(93764),g=r(56922),p=r(20058),u=r(22530),h=r(31199),b=r(88795),x=r(87480),f=r(44241),y=r(89543),m=r(86133),j=r(39286),w=r(785),v=r(49073),k=r(35078),A=r(15856),S=r(63646);let C=r(37783).Aq.backendFetch,{Title:I,Text:T}=o.A,z="https://cap.rustplus.cn/336bfb3b1a/",R="2026.01.01",E="user_agreement_accepted",B="userpage_history",P=()=>(()=>{try{let e=localStorage.getItem(E);if(e)return JSON.parse(e).version||null}catch(e){}return null})()!==R,L=()=>{try{let e=localStorage.getItem(B);if(e)return JSON.parse(e)}catch(e){}return[]},W=e=>{try{let t=e.sort((e,t)=>t.lastConnected-e.lastConnected).slice(0,10);localStorage.setItem(B,JSON.stringify(t))}catch(e){}},O=e=>{let{onSolve:t,apiEndpoint:r}=e,a=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!a.current)return;a.current.innerHTML="";let e=document.createElement("cap-widget");e.setAttribute("data-cap-api-endpoint",r),e.setAttribute("data-cap-i18n-initial-state","我是人类"),e.setAttribute("data-cap-i18n-verifying-label","验证中..."),e.setAttribute("data-cap-i18n-solved-label","验证通过"),e.setAttribute("data-cap-i18n-error-label","验证失败，请重试"),a.current.appendChild(e);let i=e=>{t(e.detail.token)};return e.addEventListener("solve",i),()=>{e.removeEventListener("solve",i),a.current&&(a.current.innerHTML="")}},[r,t]),(0,i.jsx)("div",{ref:a})};function F(){return(0,i.jsx)(s.Suspense,{fallback:(0,i.jsx)(a.A,{tip:"加载中..."}),children:(0,i.jsx)(q,{})})}function q(){let{message:e}=y.A.useApp(),[t,r]=(0,s.useState)("login"),[l,x]=(0,s.useState)(!1),[f,B]=(0,s.useState)(0),[F,q]=(0,s.useState)(!1),[H,D]=(0,s.useState)(!1),[$,N]=(0,s.useState)(!1),[J,U]=(0,s.useState)(!1),[G,V]=(0,s.useState)(0),Y=(0,s.useRef)(null),[Z,X]=(0,s.useState)(!1),[K,Q]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(""),[er,ei]=(0,s.useState)(!1),[es,ea]=(0,s.useState)(!1),[en,eo]=(0,s.useState)(!1),[el,ed]=(0,s.useState)(!1),[ec]=m.A.useForm(),[eg]=m.A.useForm(),[ep]=m.A.useForm(),[eu,eh]=(0,s.useState)(!1),[eb,ex]=(0,s.useState)([]),[ef,ey]=(0,s.useState)(""),[em,ej]=(0,s.useState)(""),[ew,ev]=(0,s.useState)(!1),[ek,eA]=(0,s.useState)(!1),[eS]=m.A.useForm(),[eC,eI]=(0,s.useState)(null),[eT,ez]=(0,s.useState)(0),eR=(0,s.useCallback)(e=>{eI(e)},[]);(0,s.useEffect)(()=>{P()||(X(!0),ea(!0)),ex(L())},[]),(0,s.useEffect)(()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:z});e.addEventListener("progress",e=>{V(e.detail.progress||0)}),Y.current=e,N(!0);return}let e=document.createElement("script");e.src="/cap-widget.js",e.async=!0,e.onload=()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:z});e.addEventListener("progress",e=>{V(e.detail.progress||0)}),Y.current=e,N(!0)}},document.head.appendChild(e)},[]);let eE=(0,s.useCallback)(async()=>{if(!$||!Y.current)return e.error("人机验证组件未加载完成，请稍后重试"),null;try{return U(!0),V(0),(await Y.current.solve()).token}catch(t){return e.error("人机验证失败，请重试"),null}finally{U(!1),V(0)}},[$,e]);(0,s.useEffect)(()=>{"register"===t?(X(!1),eo(!1)):"login"!==t||P()||X(!0)},[t]);let eB=(0,s.useCallback)(async()=>{if(!ee){ei(!0);try{let e=await fetch("/user-agreement.md");if(e.ok){let t=await e.text();et(t)}else et("协议内容加载失败，请刷新页面重试。")}catch(e){et("协议内容加载失败，请刷新页面重试。")}finally{ei(!1)}}},[ee]),eP=(0,s.useCallback)(()=>{eB(),ed(!1),Q(!0)},[eB]),eL=(0,s.useCallback)(e=>{let t=e.target;t.scrollHeight-t.scrollTop-t.clientHeight<30&&!el&&ed(!0)},[el]),eW=(0,s.useCallback)(()=>{X(!0),ea(!0),eo(!0);try{localStorage.setItem(E,JSON.stringify({version:R,acceptedAt:new Date().toISOString()}))}catch(e){}Q(!1)},[]),eO=(0,s.useCallback)(e=>{if(e&&(P()&&!es||"register"===t&&!en))return void eP();X(e)},[es,en,t,eP]),eF=(0,s.useCallback)(()=>{ex(L()),ey(""),ej(""),ev(!1),eI(null),ez(e=>e+1),eS.resetFields(),eh(!0)},[eS]),eq=(0,s.useCallback)(()=>{eI(null),ez(e=>e+1)},[]),e_=(0,s.useCallback)(async(t,r)=>{let i=(t||ef).trim(),s=r||em;if(!i)return void e.warning("请输入用户页ID");if(!s)return void e.warning("请输入访问密码");if(!eC)return void e.warning("请先完成人机验证");eA(!0);try{let t=window.location.origin,r=await C("/api/o/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({a:i,password:s,capToken:eC})}),n=await r.json();if(200===n.status){var a={appid:i,url:"".concat(t,"/#/user/").concat(i),password:ew?s:void 0,lastConnected:Date.now()};let r=L(),n=r.findIndex(e=>e.appid===a.appid);n>=0?r[n]={...r[n],...a,lastConnected:Date.now()}:r.unshift({...a,lastConnected:Date.now()}),W(r),e.success("连接成功，正在跳转..."),eh(!1),window.location.href="".concat(t,"/#/user/").concat(i)}else e.error(n.errmessage||"连接失败，请检查ID和密码"),eq()}catch(t){e.error("网络错误，请稍后重试"),eq()}finally{eA(!1)}},[ef,em,ew,e,eC,eq]),eM=(0,s.useCallback)(e=>{e.password?e_(e.appid,e.password):(ey(e.appid),eS.setFieldsValue({appid:e.appid}))},[e_,eS]),eH=(0,s.useCallback)((t,r)=>{r.stopPropagation(),W(L().filter(e=>e.appid!==t)),ex(L()),e.success("已删除")},[e]);(0,s.useEffect)(()=>{if(f>0){let e=setInterval(()=>{B(e=>e-1)},1e3);return()=>clearInterval(e)}},[f]);let eD=async(t,r)=>{try{q(!0);let i=await r.validateFields(["phone"]),s=await eE();if(!s)return void q(!1);let a=await C("/api/v/get".concat(t,"smsverify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:i.phone,capToken:s})}),n=await a.json();if(200===n.status){e.success("验证码已发送到手机"),B(60);return}10003===n.status?e.warning("发送太频繁，请稍后再试"):e.error(n.errmessage||"发送失败")}catch(t){e.error("请填写完整信息")}finally{q(!1)}},e$=async t=>{try{q(!0);let r=(await t.validateFields(["account"])).account,i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),s=/^1[3-9]\d{9}$/.test(r);if(!i&&!s){e.error("请输入有效的邮箱或手机号"),q(!1);return}let a=await eE();if(!a)return void q(!1);let n=await C(i?"/api/v/getresetpasswordverifyemail":"/api/v/getresetpasswordsmsverify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({[i?"email":"phone"]:r,capToken:a})}),o=await n.json();if(200===o.status){e.success(i?"验证码已发送到邮箱":"验证码已发送到手机"),B(60);return}10003===o.status?e.warning("发送太频繁，请稍后再试"):e.error(o.errmessage||"发送失败")}catch(t){e.error("请填写完整信息")}finally{q(!1)}},eN=async r=>{x(!0);try{let i="",s={};switch(t){case"login":let a=await eE();if(!a)return void x(!1);i="/api/v/login",s={account:r.account,password:r.password,remember:r.remember,capToken:a};break;case"register":i="/api/v/registerbyphone",s={phone:r.phone,password:r.password,smscode:r.smsCode};break;case"resetpassword":let n=r.account;/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?(i="/api/v/resetpasswordbyemail",s={email:n,password:r.password,emailcode:r.verifyCode}):(i="/api/v/resetpasswordbyphone",s={phone:n,password:r.password,smscode:r.verifyCode})}let o=await C(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),l=await o.json();200===l.status?(D(!0),window.location.href="/admin"):e.error(l.errmessage||"操作失败")}catch(t){e.error("网络请求异常")}finally{x(!1)}},eJ={login:{form:ec,title:"欢迎回来",subtitle:"登录你的账户继续使用"},register:{form:eg,title:"创建账户",subtitle:"通过手机号注册新账户"},resetpassword:{form:ep,title:"重置密码",subtitle:"通过邮箱或手机号验证重置密码"}}[t];if(l&&!J||H){let e=H?"登录成功，正在跳转...":"login"===t?"正在登录...":"register"===t?"正在注册...":"正在处理...";return(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f"},children:[(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.1) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.08) 0%, transparent 50%)",pointerEvents:"none"}}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:20,position:"relative",zIndex:1},children:[(0,i.jsxs)("div",{style:{position:"relative",width:100,height:100},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:80,height:80,borderRadius:20,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",objectFit:"contain",boxShadow:"0 8px 32px rgba(99, 102, 241, 0.3)"}}),(0,i.jsx)(a.A,{indicator:(0,i.jsx)(n.A,{style:{fontSize:100,color:"rgba(99, 102, 241, 0.6)"},spin:!0})})]}),(0,i.jsx)(o.A.Text,{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:15,marginTop:8},children:e})]})]})}return(0,i.jsxs)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#1b1b1f",padding:20},children:[(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.15) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.1) 0%, transparent 50%)",pointerEvents:"none"}}),(0,i.jsxs)("div",{style:{width:"100%",maxWidth:420,background:"#27272c",borderRadius:24,border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",padding:"40px 36px",position:"relative"},children:[(0,i.jsx)(j.A,{title:"访问队友分享的用户页，控制智能开关",children:(0,i.jsx)(w.Ay,{type:"text",icon:(0,i.jsx)(d.A,{}),onClick:eF,style:{position:"absolute",top:12,right:12,color:"#818cf8",borderRadius:8,background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",fontSize:12,height:28,padding:"0 10px"},children:"用户页"})}),(0,i.jsxs)("div",{style:{textAlign:"center",marginBottom:32},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:56,height:56,borderRadius:16,display:"block",margin:"0 auto",marginBottom:20,objectFit:"contain"}}),(0,i.jsx)(I,{level:3,style:{margin:0,color:"#fff"},children:eJ.title}),(0,i.jsx)(T,{type:"secondary",style:{fontSize:14},children:eJ.subtitle})]}),"resetpassword"!==t&&(0,i.jsxs)("div",{style:{display:"flex",background:"rgba(255, 255, 255, 0.03)",borderRadius:12,padding:4,marginBottom:28},children:[(0,i.jsx)(w.Ay,{type:"text",onClick:()=>r("login"),style:{flex:1,height:40,borderRadius:10,background:"login"===t?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"transparent",color:"login"===t?"#fff":"rgba(255,255,255,0.6)",border:"none",fontWeight:500},children:"登录"}),(0,i.jsx)(w.Ay,{type:"text",onClick:()=>r("register"),style:{flex:1,height:40,borderRadius:10,background:"register"===t?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"transparent",color:"register"===t?"#fff":"rgba(255,255,255,0.6)",border:"none",fontWeight:500},children:"注册"})]}),"resetpassword"===t&&(0,i.jsx)(w.Ay,{type:"text",icon:(0,i.jsx)(c.A,{}),onClick:()=>r("login"),style:{marginBottom:20,color:"rgba(255,255,255,0.6)",padding:0},children:"返回登录"}),"login"===t&&(0,i.jsxs)(m.A,{form:ec,onFinish:eN,layout:"vertical",requiredMark:!1,children:[(0,i.jsx)(m.A.Item,{name:"account",rules:[{required:!0,message:"请输入邮箱或手机号"}],children:(0,i.jsx)(v.A,{prefix:(0,i.jsx)(g.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"邮箱或手机号",size:"large",style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48}})}),(0,i.jsx)(m.A.Item,{name:"password",rules:[{required:!0,message:"请输入密码"}],children:(0,i.jsx)(v.A.Password,{prefix:(0,i.jsx)(p.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"密码",size:"large",style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48}})}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,i.jsx)(m.A.Item,{name:"remember",valuePropName:"checked",noStyle:!0,children:(0,i.jsx)(k.A,{style:{color:"rgba(255,255,255,0.6)"},children:"记住登录"})}),(0,i.jsx)(w.Ay,{type:"link",onClick:()=>r("resetpassword"),style:{padding:0,color:"#818cf8"},children:"忘记密码?"})]}),(0,i.jsxs)("div",{style:{marginBottom:24},children:[(0,i.jsx)(k.A,{checked:Z,onChange:e=>eO(e.target.checked),style:{color:"rgba(255,255,255,0.6)"},children:"我已阅读并同意"}),(0,i.jsx)(w.Ay,{type:"link",onClick:eP,style:{padding:0,color:"#818cf8"},icon:(0,i.jsx)(u.A,{}),children:"《用户服务协议》"})]}),J&&(0,i.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(T,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,i.jsxs)(T,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[G,"%"]})]}),(0,i.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(G,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,i.jsx)(m.A.Item,{style:{marginBottom:0},children:(0,i.jsx)(w.Ay,{type:"primary",htmlType:"submit",block:!0,loading:l||J,disabled:!Z,style:{height:48,borderRadius:12,background:!Z||l||J?"rgba(255,255,255,0.1)":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,fontSize:15,boxShadow:!Z||l||J?"none":"0 4px 14px rgba(99, 102, 241, 0.35)"},children:J?"验证中 ".concat(G,"%"):l?"登录中...":"登录"})})]}),"register"===t&&(0,i.jsx)(_,{form:eg,loading:l,loadingVerift:F,countdown:f,onFinish:eN,onGetSmsCode:()=>eD("register",eg),agreementChecked:Z,onAgreementCheckChange:eO,onOpenAgreement:eP,registerHasReadAgreement:en,capVerifying:J,capProgress:G}),"resetpassword"===t&&(0,i.jsx)(M,{form:ep,loading:l,loadingVerift:F,countdown:f,onFinish:eN,onGetCode:()=>e$(ep),capVerifying:J,capProgress:G}),(0,i.jsx)("div",{style:{textAlign:"center",marginTop:28},children:(0,i.jsxs)(T,{type:"secondary",style:{fontSize:12},children:["遇到问题？",(0,i.jsx)("a",{href:"https://www.rustplus.cn",target:"_blank",rel:"noopener noreferrer",style:{color:"#818cf8",marginLeft:4},children:"联系客服"})]})})]}),(0,i.jsx)(A.A,{title:(0,i.jsxs)("span",{children:[(0,i.jsx)(u.A,{style:{marginRight:8}}),"用户服务协议"]}),open:K,onCancel:()=>Q(!1),footer:[(0,i.jsx)(w.Ay,{onClick:()=>Q(!1),children:"取消"},"cancel"),(0,i.jsx)(w.Ay,{type:"primary",onClick:eW,disabled:!el,style:{background:el?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"rgba(255,255,255,0.1)",border:"none"},children:el?"我已阅读并同意":"请阅读完整协议"},"confirm")],width:700,styles:{body:{maxHeight:"60vh",overflowY:"auto",padding:0,background:"#1b1b1f"},header:{background:"#27272c",borderBottom:"1px solid rgba(255,255,255,0.08)"},content:{background:"#27272c"},footer:{background:"#27272c",borderTop:"1px solid rgba(255,255,255,0.08)"}},children:er?(0,i.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,i.jsx)(a.A,{tip:"加载中..."})}):(0,i.jsxs)("div",{onScroll:eL,style:{maxHeight:"60vh",overflowY:"auto",padding:"20px 24px"},children:[(0,i.jsx)("div",{style:{color:"rgba(255,255,255,0.85)",lineHeight:1.8,fontSize:14},children:ee.split("\n").map((e,t)=>{let r=e=>e.split(/(\*\*[^*]+\*\*)/g).map((e,t)=>e.startsWith("**")&&e.endsWith("**")?(0,i.jsx)("strong",{style:{color:"#fff"},children:e.slice(2,-2)},t):e);return e.startsWith("# ")?(0,i.jsx)("h1",{style:{fontSize:20,marginTop:16,marginBottom:12,color:"#fff"},children:e.slice(2)},t):e.startsWith("## ")?(0,i.jsx)("h2",{style:{fontSize:17,marginTop:20,marginBottom:10,color:"#fff"},children:e.slice(3)},t):e.startsWith("### ")?(0,i.jsx)("h3",{style:{fontSize:15,marginTop:16,marginBottom:8,color:"#fff"},children:e.slice(4)},t):e.startsWith("---")?(0,i.jsx)("hr",{style:{border:"none",borderTop:"1px solid rgba(255,255,255,0.1)",margin:"16px 0"}},t):e.startsWith("- ")?(0,i.jsxs)("p",{style:{paddingLeft:16,margin:"4px 0"},children:["• ",r(e.slice(2))]},t):""===e.trim()?(0,i.jsx)("div",{style:{height:8}},t):(0,i.jsx)("p",{style:{margin:"4px 0"},children:r(e)},t)})}),!el&&(0,i.jsx)("div",{style:{textAlign:"center",padding:"16px 0",color:"rgba(255,255,255,0.5)",fontSize:13},children:"↓ 请滚动阅读完整协议 ↓"})]})}),(0,i.jsxs)(A.A,{title:(0,i.jsxs)("span",{children:[(0,i.jsx)(d.A,{style:{marginRight:8}}),"访问队友的用户页"]}),open:eu,onCancel:()=>{eh(!1),eI(null)},footer:null,width:420,styles:{body:{padding:"20px 24px",background:"#1b1b1f"},header:{background:"#27272c",borderBottom:"1px solid rgba(255,255,255,0.08)"},content:{background:"#27272c"}},children:[(0,i.jsx)("div",{style:{padding:"12px 16px",background:"rgba(99, 102, 241, 0.1)",borderRadius:10,border:"1px solid rgba(99, 102, 241, 0.2)",marginBottom:20},children:(0,i.jsx)(T,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,lineHeight:1.6},children:"输入队友分享给您的用户页账号和密码，即可通过网页控制队友配对的智能开关。"})}),eb.length>0&&(0,i.jsxs)("div",{style:{marginBottom:20},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8,color:"rgba(255,255,255,0.6)",fontSize:13},children:[(0,i.jsx)(h.A,{style:{marginRight:6}}),"历史记录"]}),(0,i.jsx)("div",{style:{maxHeight:120,overflowY:"auto",background:"rgba(255,255,255,0.02)",borderRadius:8,border:"1px solid rgba(255,255,255,0.06)"},children:eb.map((e,t)=>(0,i.jsxs)("div",{onClick:()=>eM(e),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",cursor:"pointer",borderBottom:t<eb.length-1?"1px solid rgba(255,255,255,0.04)":"none",transition:"background 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="rgba(99, 102, 241, 0.1)",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:[(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsx)(T,{style:{color:"#818cf8",fontSize:13,display:"block"},children:e.appid}),(0,i.jsx)(T,{type:"secondary",style:{fontSize:11},children:e.password?"点击快速连接":"需要输入密码"})]}),(0,i.jsxs)(S.A,{size:4,children:[e.password&&(0,i.jsx)(w.Ay,{type:"text",size:"small",icon:(0,i.jsx)(d.A,{}),style:{color:"#10b981"}}),(0,i.jsx)(w.Ay,{type:"text",size:"small",icon:(0,i.jsx)(b.A,{}),onClick:t=>eH(e.appid,t),style:{color:"rgba(255,255,255,0.3)"}})]})]},e.appid))})]}),(0,i.jsxs)(m.A,{form:eS,layout:"vertical",requiredMark:!1,children:[(0,i.jsx)(m.A.Item,{name:"appid",label:(0,i.jsx)(T,{type:"secondary",style:{fontSize:13},children:"用户页账号"}),style:{marginBottom:12},children:(0,i.jsx)(v.A,{placeholder:"输入用户页账号",value:ef,onChange:e=>ey(e.target.value),style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,height:44}})}),(0,i.jsx)(m.A.Item,{name:"password",label:(0,i.jsx)(T,{type:"secondary",style:{fontSize:13},children:"用户页密码"}),style:{marginBottom:12},children:(0,i.jsx)(v.A.Password,{placeholder:"输入用户页密码",value:em,onChange:e=>ej(e.target.value),style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,height:44}})}),(0,i.jsx)(m.A.Item,{style:{marginBottom:16},children:(0,i.jsx)(k.A,{checked:ew,onChange:e=>ev(e.target.checked),style:{color:"rgba(255,255,255,0.6)"},children:"记住密码"})}),(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)("style",{children:"\n                            cap-widget {\n                                --cap-background: rgba(255, 255, 255, 0.03);\n                                --cap-border-color: rgba(255, 255, 255, 0.08);\n                                --cap-color: rgba(255, 255, 255, 0.85);\n                                --cap-checkbox-background: rgba(255, 255, 255, 0.05);\n                                --cap-checkbox-border: 1px solid rgba(255, 255, 255, 0.15);\n                                --cap-spinner-color: #6366f1;\n                                --cap-spinner-background-color: rgba(255, 255, 255, 0.1);\n                                --cap-widget-width: 100%;\n                                --cap-border-radius: 12px;\n                            }\n                            cap-widget::part(attribution) {\n                                display: none !important;\n                            }\n                        "}),(0,i.jsx)(O,{onSolve:eR,apiEndpoint:z},eT)]}),(0,i.jsx)(w.Ay,{type:"primary",block:!0,loading:ek,disabled:!eC,onClick:()=>e_(),style:{height:44,borderRadius:10,background:eC?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"rgba(255,255,255,0.1)",border:"none",fontWeight:500},children:"连接"})]})]})]})}let _=e=>{let{form:t,loading:r,loadingVerift:s,countdown:a,onFinish:n,onGetSmsCode:o,agreementChecked:l,onAgreementCheckChange:d,onOpenAgreement:c,registerHasReadAgreement:g,capVerifying:p,capProgress:h}=e,b={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48};return(0,i.jsxs)(m.A,{form:t,onFinish:n,layout:"vertical",requiredMark:!1,children:[(0,i.jsx)(m.A.Item,{name:"phone",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式错误"}],children:(0,i.jsx)(v.A,{prefix:(0,i.jsx)(x.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"手机号",size:"large",style:b,maxLength:11})}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,i.jsx)(m.A.Item,{name:"password",rules:[{required:!0,message:"请输入密码"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]+$/,message:"需包含字母和数字，仅支持特殊字符 !@#$%^&*()_+-=[]{};':\"\\|,.<>/?~`"},{min:8,message:"至少8位"},{max:20,message:"最多20位"}],children:(0,i.jsx)(v.A.Password,{placeholder:"设置密码",size:"large",style:b})}),(0,i.jsx)(m.A.Item,{name:"confirm",dependencies:["password"],rules:[{required:!0,message:"请确认密码"},e=>{let{getFieldValue:t}=e;return{validator:(e,r)=>r&&t("password")!==r?Promise.reject(Error("密码不一致")):Promise.resolve()}}],children:(0,i.jsx)(v.A.Password,{placeholder:"确认密码",size:"large",style:b})})]}),(0,i.jsx)(m.A.Item,{name:"smsCode",rules:[{required:!0,message:"请输入短信验证码"}],children:(0,i.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,i.jsx)(v.A,{prefix:(0,i.jsx)(f.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"短信验证码",size:"large",style:{...b,flex:1},maxLength:6}),(0,i.jsx)(w.Ay,{onClick:o,disabled:a>0||s||p,loading:s,style:{height:48,width:120,borderRadius:12,background:a>0?"rgba(255,255,255,0.03)":"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)",color:"#818cf8"},children:s&&p?"".concat(h,"%"):a?"".concat(a,"s"):"获取验证码"})]})}),p&&s&&(0,i.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(T,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,i.jsxs)(T,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[h,"%"]})]}),(0,i.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(h,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(k.A,{checked:l,onChange:e=>d(e.target.checked),style:{color:"rgba(255,255,255,0.6)"},children:"我已阅读并同意"}),(0,i.jsx)(w.Ay,{type:"link",onClick:c,style:{padding:0,color:"#818cf8"},icon:(0,i.jsx)(u.A,{}),children:"《用户服务协议》"}),!g&&(0,i.jsx)(T,{type:"warning",style:{display:"block",fontSize:12,marginTop:4},children:"注册前请先阅读用户协议"})]}),(0,i.jsx)(m.A.Item,{style:{marginBottom:0},children:(0,i.jsx)(w.Ay,{type:"primary",htmlType:"submit",block:!0,loading:r,disabled:!l||!g,style:{height:48,borderRadius:12,background:l&&g&&!r?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"rgba(255,255,255,0.1)",border:"none",fontWeight:500,fontSize:15,boxShadow:l&&g&&!r?"0 4px 14px rgba(99, 102, 241, 0.35)":"none"},children:r?"注册中...":"注册"})})]})},M=e=>{let{form:t,loading:r,loadingVerift:s,countdown:a,onFinish:n,onGetCode:o,capVerifying:l,capProgress:d}=e,c={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48};return(0,i.jsxs)(m.A,{form:t,onFinish:n,layout:"vertical",requiredMark:!1,children:[(0,i.jsx)(m.A.Item,{name:"account",rules:[{required:!0,message:"请输入邮箱或手机号"},{validator:(e,t)=>{if(!t)return Promise.resolve();let r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),i=/^1[3-9]\d{9}$/.test(t);return r||i?Promise.resolve():Promise.reject(Error("请输入有效的邮箱或手机号"))}}],children:(0,i.jsx)(v.A,{prefix:(0,i.jsx)(g.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"注册时使用的邮箱或手机号",size:"large",style:c})}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,i.jsx)(m.A.Item,{name:"password",rules:[{required:!0,message:"请输入新密码"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]+$/,message:"需包含字母和数字，仅支持特殊字符 !@#$%^&*()_+-=[]{};':\"\\|,.<>/?~`"},{min:8,message:"至少8位"},{max:20,message:"最多20位"}],children:(0,i.jsx)(v.A.Password,{placeholder:"新密码",size:"large",style:c})}),(0,i.jsx)(m.A.Item,{name:"confirm",dependencies:["password"],rules:[{required:!0,message:"请确认密码"},e=>{let{getFieldValue:t}=e;return{validator:(e,r)=>r&&t("password")!==r?Promise.reject(Error("密码不一致")):Promise.resolve()}}],children:(0,i.jsx)(v.A.Password,{placeholder:"确认新密码",size:"large",style:c})})]}),(0,i.jsx)(m.A.Item,{name:"verifyCode",rules:[{required:!0,message:"请输入验证码"}],children:(0,i.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,i.jsx)(v.A,{prefix:(0,i.jsx)(f.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"邮箱/短信验证码",size:"large",style:{...c,flex:1},maxLength:6}),(0,i.jsx)(w.Ay,{onClick:o,disabled:a>0||s||l,loading:s,style:{height:48,width:120,borderRadius:12,background:a>0?"rgba(255,255,255,0.03)":"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)",color:"#818cf8"},children:s&&l?"".concat(d,"%"):a?"".concat(a,"s"):"获取验证码"})]})}),l&&s&&(0,i.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(T,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,i.jsxs)(T,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[d,"%"]})]}),(0,i.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(d,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,i.jsx)(m.A.Item,{style:{marginBottom:0},children:(0,i.jsx)(w.Ay,{type:"primary",htmlType:"submit",block:!0,loading:r,style:{height:48,borderRadius:12,background:r?"rgba(255,255,255,0.1)":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,fontSize:15,boxShadow:r?"none":"0 4px 14px rgba(99, 102, 241, 0.35)"},children:r?"重置中...":"重置密码"})})]})};function H(){let{isAuthenticated:e,isLoading:t,checkAuth:r}=(0,l.A)(),[d,c]=s.useState(!1);return((0,s.useEffect)(()=>{r()},[]),(0,s.useEffect)(()=>{t||!e||d||(c(!0),window.location.href="/admin")},[t,e,d]),t||d||e)?(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f"},children:[(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.1) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.08) 0%, transparent 50%)",pointerEvents:"none"}}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:20,position:"relative",zIndex:1},children:[(0,i.jsxs)("div",{style:{position:"relative",width:100,height:100},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:80,height:80,borderRadius:20,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",objectFit:"contain",boxShadow:"0 8px 32px rgba(99, 102, 241, 0.3)"}}),(0,i.jsx)(a.A,{indicator:(0,i.jsx)(n.A,{style:{fontSize:100,color:"rgba(99, 102, 241, 0.6)"},spin:!0})})]}),(0,i.jsx)(o.A.Text,{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:15,marginTop:8},children:d||e&&!t?"正在跳转...":"检查登录状态..."})]})]}):(0,i.jsx)(F,{})}function D(){return(0,i.jsx)(H,{})}function $(){let[e,t]=(0,s.useState)(!0),[r,o]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{document.cookie.includes("authToken=")&&(window.location.href="/admin",o(!0)),t(!1)},[]),e||r)?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f"},children:(0,i.jsx)(a.A,{indicator:(0,i.jsx)(n.A,{style:{fontSize:48,color:"#6366f1"},spin:!0})})}):(0,i.jsx)(D,{})}},37783:(e,t,r)=>{"use strict";r.d(t,{Aq:()=>s,Ay:()=>a});let i=r(70636).env.NEXT_PUBLIC_GATEWAY_URL||"https://gateway.rustplus.cn";class s{static formatDateTime(e){let t=new Date(e),r=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"-").concat(i,"-").concat(s," ").concat(a,":").concat(n)}static async copyToClipboard(e,t){let{onSuccess:r,onError:i}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==r||r(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==r||r(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==r||r(),!0}catch(e){return null==i||i(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")?"".concat(i).concat(e):e.startsWith("/api/")?"".concat(i,"/api/backend").concat(e.slice(4)):"".concat(i).concat(e)}static async backendFetch(e,t){return fetch(s.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,r;let i="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===i.length)return null!=(r=null==(t=i.pop())?void 0:t.split(";").shift())?r:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let a={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},43953:(e,t,r)=>{Promise.resolve().then(r.bind(r,19284))},69176:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>d});var i=r(95155),s=r(12115),a=r(37783);let{backendFetch:n}=a.Aq;function o(){let e=window.location.hostname;"localhost"===e||"127.0.0.1"===e||/^(\d{1,3}\.){3}\d{1,3}$/.test(e)||/^(\[)?([0-9a-fA-F:]+)(])?$/.test(e)?(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"):(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(a.Ay.domain,";"),document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(a.Ay.domain,";"))}let l=(0,s.createContext)(void 0);function d(e){let{children:t}=e,[r,a]=(0,s.useState)({isAuthenticated:!1,isLoading:!0,userInfo:null,activationStatus:"unknown"}),d=(0,s.useCallback)(e=>{a(t=>({...t,...e}))},[]),c=(0,s.useCallback)(async()=>{try{d({isLoading:!0});let e=await n("/api/f/getstate",{method:"POST",credentials:"include"});if(403===e.status){o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}let t=await e.json();if(403===t.status){o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}if(200===t.status)return void d({isAuthenticated:!0,isLoading:!1,userInfo:t.userinfo||null,activationStatus:"active"===t.data?"active":"inactive"});o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}catch(e){console.error("Auth check failed:",e),o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}},[d]),g=(0,s.useCallback)(()=>{d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})},[d]),p={...r,checkAuth:c,logout:g,setAuthState:d};return(0,i.jsx)(l.Provider,{value:p,children:t})}function c(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{e.O(0,[1721,9326,6083,785,6240,9279,2245,9543,6060,9073,6133,5078,9991,8441,1255,7358],()=>e(e.s=43953)),_N_E=e.O()}]);