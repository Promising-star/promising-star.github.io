(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8369],{19284:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>U});var i=r(95155),n=r(12115),s=r(36060),a=r(37076);r(92932);var o=r(69176),l=r(90262),d=r(93764),c=r(56922),u=r(20058),g=r(22530),p=r(31199),h=r(88795),f=r(87480),b=r(44241),m=r(19279),y=r(89543),x=r(86133),j=r(39286),v=r(785),w=r(49073),k=r(35078),A=r(15856),S=r(63646),C=r(20063),T=r(37783),I=r(83487);let z=T.Aq.backendFetch,{Title:R,Text:E}=m.A,B="https://cap.rustplus.cn/336bfb3b1a/",P="2026.01.01",L="user_agreement_accepted",W="userpage_history",O=()=>(()=>{try{let e=localStorage.getItem(L);if(e)return JSON.parse(e).version||null}catch(e){}return null})()!==P,N=()=>{try{let e=localStorage.getItem(W);if(e)return JSON.parse(e)}catch(e){}return[]},F=e=>{try{let t=e.sort((e,t)=>t.lastConnected-e.lastConnected).slice(0,10);localStorage.setItem(W,JSON.stringify(t))}catch(e){}},q=e=>{let{onSolve:t,apiEndpoint:r}=e,s=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(!s.current)return;s.current.innerHTML="";let e=document.createElement("cap-widget");e.setAttribute("data-cap-api-endpoint",r),e.setAttribute("data-cap-i18n-initial-state","我是人类"),e.setAttribute("data-cap-i18n-verifying-label","验证中..."),e.setAttribute("data-cap-i18n-solved-label","验证通过"),e.setAttribute("data-cap-i18n-error-label","验证失败，请重试"),s.current.appendChild(e);let i=e=>{t(e.detail.token)};return e.addEventListener("solve",i),()=>{e.removeEventListener("solve",i),s.current&&(s.current.innerHTML="")}},[r,t]),(0,i.jsx)("div",{ref:s})};function M(){return(0,i.jsx)(n.Suspense,{fallback:(0,i.jsx)(I.Ay,{}),children:(0,i.jsx)(J,{})})}function J(){let{message:e}=y.A.useApp(),t=(0,C.useSearchParams)();(0,C.useRouter)();let r=t.get("code")||"",a=t.get("action")||"",[o,f]=(0,n.useState)("register"===a?"register":"login"),[b,m]=(0,n.useState)(!1),[T,W]=(0,n.useState)(0),[M,J]=(0,n.useState)(!1),[H,D]=(0,n.useState)(!1),[U,V]=(0,n.useState)(r),[G,Y]=(0,n.useState)(!1),[Z,K]=(0,n.useState)(!1),[Q,X]=(0,n.useState)(0),ee=(0,n.useRef)(null),[et,er]=(0,n.useState)(!1),[ei,en]=(0,n.useState)(!1),[es,ea]=(0,n.useState)(""),[eo,el]=(0,n.useState)(!1),[ed,ec]=(0,n.useState)(!1),[eu,eg]=(0,n.useState)(!1),[ep,eh]=(0,n.useState)(!1),[ef]=x.A.useForm(),[eb]=x.A.useForm(),[em]=x.A.useForm(),[ey,ex]=(0,n.useState)(!1),[ej,ev]=(0,n.useState)([]),[ew,ek]=(0,n.useState)(""),[eA,eS]=(0,n.useState)(""),[eC,eT]=(0,n.useState)(!1),[eI,ez]=(0,n.useState)(!1),[eR]=x.A.useForm(),[eE,eB]=(0,n.useState)(null),[eP,eL]=(0,n.useState)(0),eW=(0,n.useCallback)(e=>{eB(e)},[]);(0,n.useEffect)(()=>{O()||(er(!0),ec(!0)),ev(N())},[]),(0,n.useEffect)(()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:B});e.addEventListener("progress",e=>{X(e.detail.progress||0)}),ee.current=e,Y(!0);return}let e=document.createElement("script");e.src="/cap-widget.js",e.async=!0,e.onload=()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:B});e.addEventListener("progress",e=>{X(e.detail.progress||0)}),ee.current=e,Y(!0)}},document.head.appendChild(e)},[]);let eO=(0,n.useCallback)(async()=>{if(!G||!ee.current)return e.error("人机验证组件未加载完成，请稍后重试"),null;try{return K(!0),X(0),(await ee.current.solve()).token}catch(t){return e.error("人机验证失败，请重试"),null}finally{K(!1),X(0)}},[G,e]);(0,n.useEffect)(()=>{"register"===o?(er(!1),eg(!1)):"login"!==o||O()||er(!0)},[o]);let eN=(0,n.useCallback)(async()=>{if(!es){el(!0);try{let e=await fetch("/user-agreement.md");if(e.ok){let t=await e.text();ea(t)}else ea("协议内容加载失败，请刷新页面重试。")}catch(e){ea("协议内容加载失败，请刷新页面重试。")}finally{el(!1)}}},[es]),eF=(0,n.useCallback)(()=>{eN(),eh(!1),en(!0)},[eN]),eq=(0,n.useCallback)(e=>{let t=e.target;t.scrollHeight-t.scrollTop-t.clientHeight<30&&!ep&&eh(!0)},[ep]),eM=(0,n.useCallback)(()=>{er(!0),ec(!0),eg(!0);try{localStorage.setItem(L,JSON.stringify({version:P,acceptedAt:new Date().toISOString()}))}catch(e){}en(!1)},[]),eJ=(0,n.useCallback)(e=>{if(e&&(O()&&!ed||"register"===o&&!eu))return void eF();er(e)},[ed,eu,o,eF]),e$=(0,n.useCallback)(()=>{ev(N()),ek(""),eS(""),eT(!1),eB(null),eL(e=>e+1),eR.resetFields(),ex(!0)},[eR]),e_=(0,n.useCallback)(()=>{eB(null),eL(e=>e+1)},[]),eH=(0,n.useCallback)(async(t,r)=>{let i=(t||ew).trim(),n=r||eA;if(!i)return void e.warning("请输入用户页ID");if(!n)return void e.warning("请输入访问密码");if(!eE)return void e.warning("请先完成人机验证");ez(!0);try{let t=window.location.origin,r=await z("/api/o/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({a:i,password:n,capToken:eE})}),a=await r.json();if(200===a.status){var s={appid:i,url:"".concat(t,"/#/user/").concat(i),password:eC?n:void 0,lastConnected:Date.now()};let r=N(),a=r.findIndex(e=>e.appid===s.appid);a>=0?r[a]={...r[a],...s,lastConnected:Date.now()}:r.unshift({...s,lastConnected:Date.now()}),F(r),e.success("连接成功，正在跳转..."),ex(!1),window.location.href="".concat(t,"/#/user/").concat(i)}else e.error(a.errmessage||"连接失败，请检查ID和密码"),e_()}catch(t){e.error("网络错误，请稍后重试"),e_()}finally{ez(!1)}},[ew,eA,eC,e,eE,e_]),eD=(0,n.useCallback)(e=>{e.password?eH(e.appid,e.password):(ek(e.appid),eR.setFieldsValue({appid:e.appid}))},[eH,eR]),eU=(0,n.useCallback)((t,r)=>{r.stopPropagation(),F(N().filter(e=>e.appid!==t)),ev(N()),e.success("已删除")},[e]);(0,n.useEffect)(()=>{if(T>0){let e=setInterval(()=>{W(e=>e-1)},1e3);return()=>clearInterval(e)}},[T]);let eV=async(t,r)=>{try{J(!0);let i=await r.validateFields(["phone"]),n=await eO();if(!n)return void J(!1);let s=await z("/api/v/get".concat(t,"smsverify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:i.phone,capToken:n})}),a=await s.json();if(200===a.status){e.success("验证码已发送到手机"),W(60);return}10003===a.status?e.warning("发送太频繁，请稍后再试"):e.error(a.errmessage||"发送失败")}catch(t){e.error("请填写完整信息")}finally{J(!1)}},eG=async t=>{try{J(!0);let r=(await t.validateFields(["account"])).account,i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),n=/^1[3-9]\d{9}$/.test(r);if(!i&&!n){e.error("请输入有效的邮箱或手机号"),J(!1);return}let s=await eO();if(!s)return void J(!1);let a=await z(i?"/api/v/getresetpasswordverifyemail":"/api/v/getresetpasswordsmsverify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({[i?"email":"phone"]:r,capToken:s})}),o=await a.json();if(200===o.status){e.success(i?"验证码已发送到邮箱":"验证码已发送到手机"),W(60);return}10003===o.status?e.warning("发送太频繁，请稍后再试"):e.error(o.errmessage||"发送失败")}catch(t){e.error("请填写完整信息")}finally{J(!1)}},eY=async t=>{m(!0);try{let r="",i={};switch(o){case"login":let n=await eO();if(!n)return void m(!1);r="/api/v/login",i={account:t.account,password:t.password,remember:t.remember,capToken:n};break;case"register":r="/api/v/registerbyphone",i={phone:t.phone,password:t.password,smscode:t.smsCode,inviteCode:t.inviteCode||void 0};break;case"resetpassword":let s=t.account;/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?(r="/api/v/resetpasswordbyemail",i={email:s,password:t.password,emailcode:t.verifyCode}):(r="/api/v/resetpasswordbyphone",i={phone:s,password:t.password,smscode:t.verifyCode})}let a=await z(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),l=await a.json();200===l.status?(D(!0),U?window.location.href="/invite?code=".concat(U):window.location.href="/admin"):e.error(l.errmessage||"操作失败")}catch(t){e.error("网络请求异常")}finally{m(!1)}},eZ={login:{form:ef,title:"欢迎回来",subtitle:"登录你的账户继续使用"},register:{form:eb,title:"创建账户",subtitle:"通过手机号注册新账户"},resetpassword:{form:em,title:"重置密码",subtitle:"通过邮箱或手机号验证重置密码"}}[o];if(b&&!Z||H){let e=H?"登录成功，正在跳转...":"login"===o?"正在登录...":"register"===o?"正在注册...":"正在处理...";return(0,i.jsx)(I.Ay,{text:e})}return(0,i.jsxs)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#1b1b1f",padding:20},children:[(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.15) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.1) 0%, transparent 50%)",pointerEvents:"none"}}),(0,i.jsxs)("div",{style:{width:"100%",maxWidth:420,background:"#27272c",borderRadius:24,border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",padding:"40px 36px",position:"relative"},children:[(0,i.jsx)(j.A,{title:"访问队友分享的用户页，控制智能开关",children:(0,i.jsx)(v.Ay,{type:"text",icon:(0,i.jsx)(l.A,{}),onClick:e$,style:{position:"absolute",top:12,right:12,color:"#818cf8",borderRadius:8,background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",fontSize:12,height:28,padding:"0 10px"},children:"用户页"})}),(0,i.jsxs)("div",{style:{textAlign:"center",marginBottom:32},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:56,height:56,borderRadius:16,display:"block",margin:"0 auto",marginBottom:20,objectFit:"contain"}}),(0,i.jsx)(R,{level:3,style:{margin:0,color:"#fff"},children:eZ.title}),(0,i.jsx)(E,{type:"secondary",style:{fontSize:14},children:eZ.subtitle})]}),"resetpassword"!==o&&(0,i.jsxs)("div",{style:{display:"flex",background:"rgba(255, 255, 255, 0.03)",borderRadius:12,padding:4,marginBottom:28},children:[(0,i.jsx)(v.Ay,{type:"text",onClick:()=>f("login"),style:{flex:1,height:40,borderRadius:10,background:"login"===o?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"transparent",color:"login"===o?"#fff":"rgba(255,255,255,0.6)",border:"none",fontWeight:500},children:"登录"}),(0,i.jsx)(v.Ay,{type:"text",onClick:()=>f("register"),style:{flex:1,height:40,borderRadius:10,background:"register"===o?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"transparent",color:"register"===o?"#fff":"rgba(255,255,255,0.6)",border:"none",fontWeight:500},children:"注册"})]}),"resetpassword"===o&&(0,i.jsx)(v.Ay,{type:"text",icon:(0,i.jsx)(d.A,{}),onClick:()=>f("login"),style:{marginBottom:20,color:"rgba(255,255,255,0.6)",padding:0},children:"返回登录"}),"login"===o&&(0,i.jsxs)(x.A,{form:ef,onFinish:eY,layout:"vertical",requiredMark:!1,children:[(0,i.jsx)(x.A.Item,{name:"account",rules:[{required:!0,message:"请输入邮箱或手机号"}],children:(0,i.jsx)(w.A,{prefix:(0,i.jsx)(c.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"邮箱或手机号",size:"large",style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48}})}),(0,i.jsx)(x.A.Item,{name:"password",rules:[{required:!0,message:"请输入密码"}],children:(0,i.jsx)(w.A.Password,{prefix:(0,i.jsx)(u.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"密码",size:"large",style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48}})}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,i.jsx)(x.A.Item,{name:"remember",valuePropName:"checked",noStyle:!0,children:(0,i.jsx)(k.A,{style:{color:"rgba(255,255,255,0.6)"},children:"记住登录"})}),(0,i.jsx)(v.Ay,{type:"link",onClick:()=>f("resetpassword"),style:{padding:0,color:"#818cf8"},children:"忘记密码?"})]}),(0,i.jsxs)("div",{style:{marginBottom:24},children:[(0,i.jsx)(k.A,{checked:et,onChange:e=>eJ(e.target.checked),style:{color:"rgba(255,255,255,0.6)"},children:"我已阅读并同意"}),(0,i.jsx)(v.Ay,{type:"link",onClick:eF,style:{padding:0,color:"#818cf8"},icon:(0,i.jsx)(g.A,{}),children:"《用户服务协议》"})]}),Z&&(0,i.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(E,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,i.jsxs)(E,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[Q,"%"]})]}),(0,i.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(Q,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,i.jsx)(x.A.Item,{style:{marginBottom:0},children:(0,i.jsx)(v.Ay,{type:"primary",htmlType:"submit",block:!0,loading:b||Z,disabled:!et,style:{height:48,borderRadius:12,background:!et||b||Z?"rgba(255,255,255,0.1)":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,fontSize:15,boxShadow:!et||b||Z?"none":"0 4px 14px rgba(99, 102, 241, 0.35)"},children:Z?"验证中 ".concat(Q,"%"):b?"登录中...":"登录"})})]}),"register"===o&&(0,i.jsx)($,{form:eb,loading:b,loadingVerift:M,countdown:T,onFinish:eY,onGetSmsCode:()=>eV("register",eb),agreementChecked:et,onAgreementCheckChange:eJ,onOpenAgreement:eF,registerHasReadAgreement:eu,capVerifying:Z,capProgress:Q,initialInviteCode:r}),"resetpassword"===o&&(0,i.jsx)(_,{form:em,loading:b,loadingVerift:M,countdown:T,onFinish:eY,onGetCode:()=>eG(em),capVerifying:Z,capProgress:Q}),(0,i.jsx)("div",{style:{textAlign:"center",marginTop:28},children:(0,i.jsxs)(E,{type:"secondary",style:{fontSize:12},children:["遇到问题？",(0,i.jsx)("a",{href:"https://www.rustplus.cn",target:"_blank",rel:"noopener noreferrer",style:{color:"#818cf8",marginLeft:4},children:"联系客服"})]})})]}),(0,i.jsx)(A.A,{title:(0,i.jsxs)("span",{children:[(0,i.jsx)(g.A,{style:{marginRight:8}}),"用户服务协议"]}),open:ei,onCancel:()=>en(!1),footer:[(0,i.jsx)(v.Ay,{onClick:()=>en(!1),children:"取消"},"cancel"),(0,i.jsx)(v.Ay,{type:"primary",onClick:eM,disabled:!ep,style:{background:ep?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"rgba(255,255,255,0.1)",border:"none"},children:ep?"我已阅读并同意":"请阅读完整协议"},"confirm")],width:700,styles:{body:{maxHeight:"60vh",overflowY:"auto",padding:0,background:"#1b1b1f"},header:{background:"#27272c",borderBottom:"1px solid rgba(255,255,255,0.08)"},content:{background:"#27272c"},footer:{background:"#27272c",borderTop:"1px solid rgba(255,255,255,0.08)"}},children:eo?(0,i.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,i.jsx)(s.A,{tip:"加载中..."})}):(0,i.jsxs)("div",{onScroll:eq,style:{maxHeight:"60vh",overflowY:"auto",padding:"20px 24px"},children:[(0,i.jsx)("div",{style:{color:"rgba(255,255,255,0.85)",lineHeight:1.8,fontSize:14},children:es.split("\n").map((e,t)=>{let r=e=>e.split(/(\*\*[^*]+\*\*)/g).map((e,t)=>e.startsWith("**")&&e.endsWith("**")?(0,i.jsx)("strong",{style:{color:"#fff"},children:e.slice(2,-2)},t):e);return e.startsWith("# ")?(0,i.jsx)("h1",{style:{fontSize:20,marginTop:16,marginBottom:12,color:"#fff"},children:e.slice(2)},t):e.startsWith("## ")?(0,i.jsx)("h2",{style:{fontSize:17,marginTop:20,marginBottom:10,color:"#fff"},children:e.slice(3)},t):e.startsWith("### ")?(0,i.jsx)("h3",{style:{fontSize:15,marginTop:16,marginBottom:8,color:"#fff"},children:e.slice(4)},t):e.startsWith("---")?(0,i.jsx)("hr",{style:{border:"none",borderTop:"1px solid rgba(255,255,255,0.1)",margin:"16px 0"}},t):e.startsWith("- ")?(0,i.jsxs)("p",{style:{paddingLeft:16,margin:"4px 0"},children:["• ",r(e.slice(2))]},t):""===e.trim()?(0,i.jsx)("div",{style:{height:8}},t):(0,i.jsx)("p",{style:{margin:"4px 0"},children:r(e)},t)})}),!ep&&(0,i.jsx)("div",{style:{textAlign:"center",padding:"16px 0",color:"rgba(255,255,255,0.5)",fontSize:13},children:"↓ 请滚动阅读完整协议 ↓"})]})}),(0,i.jsxs)(A.A,{title:(0,i.jsxs)("span",{children:[(0,i.jsx)(l.A,{style:{marginRight:8}}),"访问队友的用户页"]}),open:ey,onCancel:()=>{ex(!1),eB(null)},footer:null,width:420,styles:{body:{padding:"20px 24px",background:"#1b1b1f"},header:{background:"#27272c",borderBottom:"1px solid rgba(255,255,255,0.08)"},content:{background:"#27272c"}},children:[(0,i.jsx)("div",{style:{padding:"12px 16px",background:"rgba(99, 102, 241, 0.1)",borderRadius:10,border:"1px solid rgba(99, 102, 241, 0.2)",marginBottom:20},children:(0,i.jsx)(E,{style:{color:"rgba(255,255,255,0.85)",fontSize:13,lineHeight:1.6},children:"输入队友分享给您的用户页账号和密码，即可通过网页控制队友配对的智能开关。"})}),ej.length>0&&(0,i.jsxs)("div",{style:{marginBottom:20},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8,color:"rgba(255,255,255,0.6)",fontSize:13},children:[(0,i.jsx)(p.A,{style:{marginRight:6}}),"历史记录"]}),(0,i.jsx)("div",{style:{maxHeight:120,overflowY:"auto",background:"rgba(255,255,255,0.02)",borderRadius:8,border:"1px solid rgba(255,255,255,0.06)"},children:ej.map((e,t)=>(0,i.jsxs)("div",{onClick:()=>eD(e),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",cursor:"pointer",borderBottom:t<ej.length-1?"1px solid rgba(255,255,255,0.04)":"none",transition:"background 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="rgba(99, 102, 241, 0.1)",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:[(0,i.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,i.jsx)(E,{style:{color:"#818cf8",fontSize:13,display:"block"},children:e.appid}),(0,i.jsx)(E,{type:"secondary",style:{fontSize:11},children:e.password?"点击快速连接":"需要输入密码"})]}),(0,i.jsxs)(S.A,{size:4,children:[e.password&&(0,i.jsx)(v.Ay,{type:"text",size:"small",icon:(0,i.jsx)(l.A,{}),style:{color:"#10b981"}}),(0,i.jsx)(v.Ay,{type:"text",size:"small",icon:(0,i.jsx)(h.A,{}),onClick:t=>eU(e.appid,t),style:{color:"rgba(255,255,255,0.3)"}})]})]},e.appid))})]}),(0,i.jsxs)(x.A,{form:eR,layout:"vertical",requiredMark:!1,children:[(0,i.jsx)(x.A.Item,{name:"appid",label:(0,i.jsx)(E,{type:"secondary",style:{fontSize:13},children:"用户页账号"}),style:{marginBottom:12},children:(0,i.jsx)(w.A,{placeholder:"输入用户页账号",value:ew,onChange:e=>ek(e.target.value),style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,height:44}})}),(0,i.jsx)(x.A.Item,{name:"password",label:(0,i.jsx)(E,{type:"secondary",style:{fontSize:13},children:"用户页密码"}),style:{marginBottom:12},children:(0,i.jsx)(w.A.Password,{placeholder:"输入用户页密码",value:eA,onChange:e=>eS(e.target.value),style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:10,height:44}})}),(0,i.jsx)(x.A.Item,{style:{marginBottom:16},children:(0,i.jsx)(k.A,{checked:eC,onChange:e=>eT(e.target.checked),style:{color:"rgba(255,255,255,0.6)"},children:"记住密码"})}),(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)("style",{children:"\n                            cap-widget {\n                                --cap-background: rgba(255, 255, 255, 0.03);\n                                --cap-border-color: rgba(255, 255, 255, 0.08);\n                                --cap-color: rgba(255, 255, 255, 0.85);\n                                --cap-checkbox-background: rgba(255, 255, 255, 0.05);\n                                --cap-checkbox-border: 1px solid rgba(255, 255, 255, 0.15);\n                                --cap-spinner-color: #6366f1;\n                                --cap-spinner-background-color: rgba(255, 255, 255, 0.1);\n                                --cap-widget-width: 100%;\n                                --cap-border-radius: 12px;\n                            }\n                            cap-widget::part(attribution) {\n                                display: none !important;\n                            }\n                        "}),(0,i.jsx)(q,{onSolve:eW,apiEndpoint:B},eP)]}),(0,i.jsx)(v.Ay,{type:"primary",block:!0,loading:eI,disabled:!eE,onClick:()=>eH(),style:{height:44,borderRadius:10,background:eE?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"rgba(255,255,255,0.1)",border:"none",fontWeight:500},children:"连接"})]})]})]})}let $=e=>{let{form:t,loading:r,loadingVerift:a,countdown:o,onFinish:l,onGetSmsCode:d,agreementChecked:c,onAgreementCheckChange:u,onOpenAgreement:p,registerHasReadAgreement:h,capVerifying:m,capProgress:j,initialInviteCode:A}=e,{message:S}=y.A.useApp(),[C,T]=(0,n.useState)(A||""),[I,R]=(0,n.useState)("idle"),[B,P]=(0,n.useState)(null),L=(0,n.useRef)(null),W=(0,n.useRef)(!1),O=(0,n.useCallback)(async e=>{if(!e||e.length<8){R("idle"),P(null);return}R("checking");try{var t;let r=await z("/api/v/verifyinvitecode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),i=await r.json();200===i.status&&(null==(t=i.data)?void 0:t.valid)?(R("valid"),P(i.data.inviterNickname)):(R("invalid"),P(null))}catch(e){R("invalid"),P(null)}},[]);(0,n.useEffect)(()=>{A&&!W.current&&(W.current=!0,T(A),t.setFieldsValue({inviteCode:A}),O(A))},[A,t,O]);let N=(0,n.useCallback)(e=>{if(T(e),t.setFieldsValue({inviteCode:e}),L.current&&clearTimeout(L.current),!e){R("idle"),P(null);return}L.current=setTimeout(()=>{O(e)},500)},[t,O]);(0,n.useEffect)(()=>()=>{L.current&&clearTimeout(L.current)},[]);let F={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48};return(0,i.jsxs)(x.A,{form:t,onFinish:l,layout:"vertical",requiredMark:!1,children:[(0,i.jsx)(x.A.Item,{name:"phone",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式错误"}],children:(0,i.jsx)(w.A,{prefix:(0,i.jsx)(f.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"手机号",size:"large",style:F,maxLength:11})}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,i.jsx)(x.A.Item,{name:"password",rules:[{required:!0,message:"请输入密码"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]+$/,message:"需包含字母和数字，仅支持特殊字符 !@#$%^&*()_+-=[]{};':\"\\|,.<>/?~`"},{min:8,message:"至少8位"},{max:20,message:"最多20位"}],children:(0,i.jsx)(w.A.Password,{placeholder:"设置密码",size:"large",style:F})}),(0,i.jsx)(x.A.Item,{name:"confirm",dependencies:["password"],rules:[{required:!0,message:"请确认密码"},e=>{let{getFieldValue:t}=e;return{validator:(e,r)=>r&&t("password")!==r?Promise.reject(Error("密码不一致")):Promise.resolve()}}],children:(0,i.jsx)(w.A.Password,{placeholder:"确认密码",size:"large",style:F})})]}),(0,i.jsx)(x.A.Item,{name:"smsCode",rules:[{required:!0,message:"请输入短信验证码"}],children:(0,i.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,i.jsx)(w.A,{prefix:(0,i.jsx)(b.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"短信验证码",size:"large",style:{...F,flex:1},maxLength:6}),(0,i.jsx)(v.Ay,{onClick:d,disabled:o>0||a||m,loading:a,style:{height:48,width:120,borderRadius:12,background:o>0?"rgba(255,255,255,0.03)":"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)",color:"#818cf8"},children:a&&m?"".concat(j,"%"):o?"".concat(o,"s"):"获取验证码"})]})}),(0,i.jsx)(x.A.Item,{name:"inviteCode",style:{marginBottom:12},children:(0,i.jsxs)("div",{children:[(0,i.jsx)(w.A,{prefix:(0,i.jsx)("span",{style:{color:"rgba(255,255,255,0.3)",fontSize:12},children:"邀请码"}),placeholder:"选填，有邀请码可享新用户优惠",size:"large",value:C,onChange:e=>N(e.target.value),style:{...F,borderColor:(()=>{switch(I){case"valid":return"rgba(16, 185, 129, 0.5)";case"invalid":return"rgba(239, 68, 68, 0.5)";case"checking":return"rgba(99, 102, 241, 0.5)";default:return"rgba(255,255,255,0.08)"}})()},suffix:"checking"===I?(0,i.jsx)(s.A,{size:"small"}):"valid"===I?(0,i.jsx)("span",{style:{color:"#10b981",fontSize:12},children:"✓"}):"invalid"===I?(0,i.jsx)("span",{style:{color:"#ef4444",fontSize:12},children:"✗"}):null}),"valid"===I&&B&&(0,i.jsx)("div",{style:{marginTop:6,padding:"6px 10px",background:"rgba(16, 185, 129, 0.1)",borderRadius:8,border:"1px solid rgba(16, 185, 129, 0.2)"},children:(0,i.jsxs)(E,{style:{color:"#10b981",fontSize:12},children:["您被 ",(0,i.jsx)("strong",{children:B})," 邀请，注册后可享新用户专属优惠"]})}),"invalid"===I&&C&&(0,i.jsx)("div",{style:{marginTop:4},children:(0,i.jsx)(E,{style:{color:"#ef4444",fontSize:12},children:"邀请码无效"})})]})}),m&&a&&(0,i.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(E,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,i.jsxs)(E,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[j,"%"]})]}),(0,i.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(j,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,i.jsxs)("div",{style:{marginBottom:16},children:[(0,i.jsx)(k.A,{checked:c,onChange:e=>u(e.target.checked),style:{color:"rgba(255,255,255,0.6)"},children:"我已阅读并同意"}),(0,i.jsx)(v.Ay,{type:"link",onClick:p,style:{padding:0,color:"#818cf8"},icon:(0,i.jsx)(g.A,{}),children:"《用户服务协议》"}),!h&&(0,i.jsx)(E,{type:"warning",style:{display:"block",fontSize:12,marginTop:4},children:"注册前请先阅读用户协议"})]}),(0,i.jsx)(x.A.Item,{style:{marginBottom:0},children:(0,i.jsx)(v.Ay,{type:"primary",htmlType:"submit",block:!0,loading:r,disabled:!c||!h,style:{height:48,borderRadius:12,background:c&&h&&!r?"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)":"rgba(255,255,255,0.1)",border:"none",fontWeight:500,fontSize:15,boxShadow:c&&h&&!r?"0 4px 14px rgba(99, 102, 241, 0.35)":"none"},children:r?"注册中...":"注册"})})]})},_=e=>{let{form:t,loading:r,loadingVerift:n,countdown:s,onFinish:a,onGetCode:o,capVerifying:l,capProgress:d}=e,u={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,height:48};return(0,i.jsxs)(x.A,{form:t,onFinish:a,layout:"vertical",requiredMark:!1,children:[(0,i.jsx)(x.A.Item,{name:"account",rules:[{required:!0,message:"请输入邮箱或手机号"},{validator:(e,t)=>{if(!t)return Promise.resolve();let r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),i=/^1[3-9]\d{9}$/.test(t);return r||i?Promise.resolve():Promise.reject(Error("请输入有效的邮箱或手机号"))}}],children:(0,i.jsx)(w.A,{prefix:(0,i.jsx)(c.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"注册时使用的邮箱或手机号",size:"large",style:u})}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,i.jsx)(x.A.Item,{name:"password",rules:[{required:!0,message:"请输入新密码"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~`]+$/,message:"需包含字母和数字，仅支持特殊字符 !@#$%^&*()_+-=[]{};':\"\\|,.<>/?~`"},{min:8,message:"至少8位"},{max:20,message:"最多20位"}],children:(0,i.jsx)(w.A.Password,{placeholder:"新密码",size:"large",style:u})}),(0,i.jsx)(x.A.Item,{name:"confirm",dependencies:["password"],rules:[{required:!0,message:"请确认密码"},e=>{let{getFieldValue:t}=e;return{validator:(e,r)=>r&&t("password")!==r?Promise.reject(Error("密码不一致")):Promise.resolve()}}],children:(0,i.jsx)(w.A.Password,{placeholder:"确认新密码",size:"large",style:u})})]}),(0,i.jsx)(x.A.Item,{name:"verifyCode",rules:[{required:!0,message:"请输入验证码"}],children:(0,i.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,i.jsx)(w.A,{prefix:(0,i.jsx)(b.A,{style:{color:"rgba(255,255,255,0.3)"}}),placeholder:"邮箱/短信验证码",size:"large",style:{...u,flex:1},maxLength:6}),(0,i.jsx)(v.Ay,{onClick:o,disabled:s>0||n||l,loading:n,style:{height:48,width:120,borderRadius:12,background:s>0?"rgba(255,255,255,0.03)":"rgba(99, 102, 241, 0.15)",border:"1px solid rgba(99, 102, 241, 0.3)",color:"#818cf8"},children:n&&l?"".concat(d,"%"):s?"".concat(s,"s"):"获取验证码"})]})}),l&&n&&(0,i.jsxs)("div",{style:{marginBottom:16,padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:12},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(E,{style:{color:"#a5b4fc",fontSize:13},children:"正在进行安全验证..."}),(0,i.jsxs)(E,{style:{color:"#818cf8",fontSize:13,fontWeight:600},children:[d,"%"]})]}),(0,i.jsx)("div",{style:{height:4,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(d,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:2,transition:"width 0.3s ease"}})})]}),(0,i.jsx)(x.A.Item,{style:{marginBottom:0},children:(0,i.jsx)(v.Ay,{type:"primary",htmlType:"submit",block:!0,loading:r,style:{height:48,borderRadius:12,background:r?"rgba(255,255,255,0.1)":"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,fontSize:15,boxShadow:r?"none":"0 4px 14px rgba(99, 102, 241, 0.35)"},children:r?"重置中...":"重置密码"})})]})};function H(){let{isAuthenticated:e,isLoading:t,checkAuth:r}=(0,o.A)(),[s,a]=n.useState(!1);return((0,n.useEffect)(()=>{r()},[]),(0,n.useEffect)(()=>{t||!e||s||(a(!0),window.location.href="/admin")},[t,e,s]),t||s||e)?null:((0,I.Jy)(),(0,i.jsx)(M,{}))}function D(){return(0,i.jsx)(H,{})}function U(){let[e,t]=(0,n.useState)(!0),[r,o]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{(function(){if("undefined"==typeof document)return!1;for(let e of document.cookie.split(";")){let[t,r]=e.trim().split("=");if("authToken"===t&&r&&r.length>0)return!0}return!1})()&&(window.location.href="/admin",o(!0)),t(!1)},[]),e||r)?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f"},children:(0,i.jsx)(s.A,{indicator:(0,i.jsx)(a.A,{style:{fontSize:48,color:"#6366f1"},spin:!0})})}):(0,i.jsx)(D,{})}},37783:(e,t,r)=>{"use strict";r.d(t,{Aq:()=>n,Ay:()=>s});let i="https://gateway.rustplus.cn";class n{static formatDateTime(e){let t=new Date(e),r=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"-").concat(i,"-").concat(n," ").concat(s,":").concat(a)}static async copyToClipboard(e,t){let{onSuccess:r,onError:i}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==r||r(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==r||r(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==r||r(),!0}catch(e){return null==i||i(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(i).concat(e):e.startsWith("/api/")?"".concat(i,"/api/backend").concat(e.slice(4)):"".concat(i).concat(e)}static async backendFetch(e,t){return fetch(n.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,r;let i="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===i.length)return null!=(r=null==(t=i.pop())?void 0:t.split(";").shift())?r:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let s={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},69176:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>d});var i=r(95155),n=r(12115),s=r(37783);let{backendFetch:a}=s.Aq;function o(){let e=window.location.hostname;"localhost"===e||"127.0.0.1"===e||/^(\d{1,3}\.){3}\d{1,3}$/.test(e)||/^(\[)?([0-9a-fA-F:]+)(])?$/.test(e)?(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"):(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(s.Ay.domain,";"),document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(s.Ay.domain,";"))}let l=(0,n.createContext)(void 0);function d(e){let{children:t}=e,[r,s]=(0,n.useState)({isAuthenticated:!1,isLoading:!0,userInfo:null,activationStatus:"unknown"}),d=(0,n.useCallback)(e=>{s(t=>({...t,...e}))},[]),c=(0,n.useCallback)(async()=>{try{if(d({isLoading:!0}),!document.cookie.split(";").some(e=>e.trim().startsWith("authToken=")))return void d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});let e=await a("/api/f/getstate",{method:"POST",credentials:"include"});if(403===e.status){o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}let t=await e.json();if(403===t.status){o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}if(200===t.status)return void d({isAuthenticated:!0,isLoading:!1,userInfo:t.userinfo||null,activationStatus:"active"===t.data?"active":"inactive"});o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}catch(e){o(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}},[d]),u=(0,n.useCallback)(()=>{d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})},[d]),g={...r,checkAuth:c,logout:u,setAuthState:d};return(0,i.jsx)(l.Provider,{value:g,children:t})}function c(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},83487:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>l,Jy:()=>a,bT:()=>o,ek:()=>s});var i=r(95155),n=r(12115);function s(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");e&&e.classList.remove("hidden")}}function a(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");e&&e.classList.add("hidden")}}function o(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");return null!==e&&!e.classList.contains("hidden")}return!1}function l(e){let{text:t="加载中...",subText:r}=e;return n.useEffect(()=>{a()},[]),(0,i.jsxs)("div",{className:"fullscreen-loader",children:[(0,i.jsx)("div",{className:"fullscreen-loader-bg"}),(0,i.jsxs)("div",{className:"fullscreen-loader-content",children:[(0,i.jsxs)("div",{className:"fullscreen-loader-logo-container",children:[(0,i.jsx)("img",{className:"fullscreen-loader-logo",src:"https://www.rustplus.cn/logo.png",alt:"Logo"}),(0,i.jsx)("div",{className:"fullscreen-loader-spinner"})]}),(0,i.jsx)("div",{className:"fullscreen-loader-text",children:t}),r&&(0,i.jsx)("div",{className:"fullscreen-loader-subtext",children:r})]})]})}},87584:(e,t,r)=>{Promise.resolve().then(r.bind(r,19284))}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,6060,9073,6133,5078,7854,8441,1255,7358],()=>e(e.s=87584)),_N_E=e.O()}]);