(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2388],{6350:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>eW});var i=n(95155),o=n(12115),r=n(36060),a=n(37076);n(92932);var l=n(19279),s=n(69176),d=n(43324),c=n(89543),p=n(15856),u=n(63646),h=n(785),g=n(99667),y=n(21038),x=n(44425),f=n(19782),m=n(44074),b=n(35510),j=n(92199),w=n(40469),v=n(14274),A=n(16638),S=n(65614),k=n(57544),C=n(57954),T=n(31142),z=n(4936),E=n(44241),I=n(18172),B=n(96323),R=n(33631),F=n(50329),O=n(62620),_=n(9485),P=n(49621),D=n(20063);let N=(0,o.createContext)({id:0,username:"",nickname:null,avatarImage:null,group:"",permissions:[]});function L(e){let{children:t,user:n}=e;return(0,i.jsx)(N.Provider,{value:n,children:t})}var q=n(90925),W=n(37783),J=n(94260),U=n(2995);let{Text:M,Title:V}=l.A;function H(e){var t;let{open:n,data:r,onCancel:a,onConfirm:l,loading:s=!1}=e,[d,c]=(0,o.useState)(!1),[g,y]=(0,o.useState)("");return o.useEffect(()=>{if(n&&(null==r?void 0:r.img))if(c(!1),r.img.startsWith("http://")){let e=r.img.replace("http://","https://"),t=new Image;t.onload=()=>y(e),t.onerror=()=>y(r.img),t.src=e}else y(r.img);else n&&(y(""),c(!1))},[n,null==r?void 0:r.img]),(0,i.jsxs)(p.A,{open:n,onCancel:a,maskClosable:!1,footer:null,centered:!0,width:520,closable:!1,styles:{content:{padding:0,overflow:"hidden",borderRadius:20,background:"#27272c"}},children:[(0,i.jsxs)("div",{style:{position:"relative",height:160,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",backgroundSize:"cover",backgroundPosition:"center"},children:[g&&!d&&(0,i.jsx)("img",{src:g,alt:"",onError:()=>c(!0),style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.7}}),(0,i.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(39,39,44,1))"}}),(0,i.jsx)(h.Ay,{type:"text",icon:(0,i.jsx)(O.A,{}),onClick:a,style:{position:"absolute",top:12,right:12,color:"rgba(255,255,255,0.8)",background:"rgba(0,0,0,0.3)",borderRadius:8,width:32,height:32}}),(0,i.jsx)("div",{style:{position:"absolute",bottom:-30,left:24,width:60,height:60,borderRadius:14,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",display:"flex",alignItems:"center",justifyContent:"center",border:"3px solid #27272c",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:(0,i.jsx)(J.A,{style:{fontSize:28,color:"#fff"}})})]}),(0,i.jsxs)("div",{style:{padding:"40px 24px 24px"},children:[(0,i.jsx)(V,{level:4,style:{margin:"0 0 4px",color:"#fff",fontSize:18},children:(null==r?void 0:r.name)||"未知服务器"}),(null==r?void 0:r.url)&&(0,i.jsx)(M,{type:"secondary",style:{fontSize:13},children:r.url}),(null==r?void 0:r.desc)&&(0,i.jsx)("div",{style:{marginTop:16,padding:16,background:"rgba(255,255,255,0.03)",borderRadius:12,border:"1px solid rgba(255,255,255,0.06)",maxHeight:120,overflow:"auto"},children:(0,i.jsx)(M,{type:"secondary",style:{fontSize:13,lineHeight:1.6,whiteSpace:"pre-wrap"},children:(t=r.desc)?t.replace(/\\n/g,"\n").replace(/\\t/g,"  "):""})}),(0,i.jsx)("div",{style:{marginTop:20,padding:"12px 16px",background:"rgba(16, 185, 129, 0.1)",borderRadius:10,border:"1px solid rgba(16, 185, 129, 0.2)"},children:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(U.A,{style:{color:"#10b981"}}),(0,i.jsx)(M,{style:{color:"#6ee7b7",fontSize:13},children:"确认配对此服务器到您的工具箱？"})]})}),(0,i.jsxs)("div",{style:{display:"flex",gap:12,marginTop:20},children:[(0,i.jsx)(h.Ay,{onClick:a,style:{flex:1,height:44,borderRadius:12,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:"取消"}),(0,i.jsx)(h.Ay,{type:"primary",onClick:l,loading:s,style:{flex:1,height:44,borderRadius:12,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",fontWeight:500},children:"确认配对"})]})]})]})}var G=n(3415),Y=n(86133),$=n(97416),K=n(49073),X=n(89856),Q=n(68585);function Z(e){let{open:t,data:n,onCancel:r,onConfirm:a,loading:l=!1}=e,[s]=(0,Q.A)(),d=(null==n?void 0:n.entityType)=="2"?"智能警报":"智能开关";return(0,o.useEffect)(()=>{t&&s.setFieldsValue({name:(null==n?void 0:n.name)||"",note:(null==n?void 0:n.note)||"",noteColor:(null==n?void 0:n.noteColor)||"#000000"})},[t,n,s]),(0,i.jsxs)(p.A,{title:"".concat(d,"配对确认"),open:t,onCancel:r,maskClosable:!1,footer:[(0,i.jsx)(h.Ay,{onClick:r,children:"取消"},"cancel"),(0,i.jsx)(h.Ay,{type:"primary",onClick:()=>{s.validateFields().then(e=>{"string"!=typeof e.noteColor&&(e.noteColor=e.noteColor.toHexString()),a({name:e.name,note:e.note||"",noteColor:e.noteColor,entityType:null==n?void 0:n.entityType})}).catch(()=>{G.Ay.error("请检查输入是否正确")})},loading:l,children:"配对"},"pair")],centered:!0,destroyOnHidden:!0,children:[(0,i.jsx)("div",{style:{marginBottom:16},children:(0,i.jsxs)("p",{children:["有一个",d,"正在配对，请确认"]})}),(0,i.jsx)(Y.A,{form:s,layout:"vertical",children:(0,i.jsxs)($.A,{bordered:!0,column:1,children:[(0,i.jsx)($.A.Item,{label:"".concat(d,"名称"),children:(0,i.jsx)(Y.A.Item,{name:"name",rules:[{required:!0,message:"".concat(d,"名称不能为空")},{max:24,message:"".concat(d,"名称不能超过24个字符")}],children:(0,i.jsx)(K.A,{placeholder:"请输入".concat(d,"名称"),maxLength:24})})}),(0,i.jsx)($.A.Item,{label:"".concat(d,"备注"),children:(0,i.jsx)(Y.A.Item,{name:"note",rules:[{max:100,message:"".concat(d,"备注不能超过100个字符")}],children:(0,i.jsx)(K.A,{placeholder:"请输入".concat(d,"备注（可选）"),maxLength:100})})}),(0,i.jsx)($.A.Item,{label:"备注颜色",children:(0,i.jsx)(Y.A.Item,{name:"noteColor",initialValue:"#000000",children:(0,i.jsx)(X.A,{format:"hex",defaultFormat:"hex",presets:[{label:"推荐",colors:["#000000","#FFFFFF","#FF4D4F","#13C2C2","#52C41A","#FAAD14","#2F54EB","#722ED1"]}]})})})]})})]})}function ee(e){let{open:t,data:n,onCancel:r,onConfirm:a,loading:l=!1}=e,[s]=(0,Q.A)();return(0,o.useEffect)(()=>{t&&s.setFieldsValue({name:(null==n?void 0:n.name)||"",note:(null==n?void 0:n.note)||"",noteColor:(null==n?void 0:n.noteColor)||"#000000"})},[t,n,s]),(0,i.jsxs)(p.A,{title:"存储监视器配对确认",open:t,onCancel:r,maskClosable:!1,footer:[(0,i.jsx)(h.Ay,{onClick:r,children:"取消"},"cancel"),(0,i.jsx)(h.Ay,{type:"primary",onClick:()=>{s.validateFields().then(e=>{"string"!=typeof e.noteColor&&(e.noteColor=e.noteColor.toHexString()),a({name:e.name,note:e.note||"",noteColor:e.noteColor})}).catch(()=>{G.Ay.error("请检查输入是否正确")})},loading:l,children:"配对"},"pair")],centered:!0,destroyOnHidden:!0,children:[(0,i.jsx)("div",{style:{marginBottom:16},children:(0,i.jsx)("p",{children:"有一个存储监视器正在配对，请确认"})}),(0,i.jsx)(Y.A,{form:s,layout:"vertical",children:(0,i.jsxs)($.A,{bordered:!0,column:1,children:[(0,i.jsx)($.A.Item,{label:"存储监视器名称",children:(0,i.jsx)(Y.A.Item,{name:"name",rules:[{required:!0,message:"存储监视器名称不能为空"},{max:24,message:"存储监视器名称不能超过24个字符"}],children:(0,i.jsx)(K.A,{placeholder:"请输入存储监视器名称",maxLength:24})})}),(0,i.jsx)($.A.Item,{label:"存储监视器备注",children:(0,i.jsx)(Y.A.Item,{name:"note",rules:[{max:100,message:"存储监视器备注不能超过100个字符"}],children:(0,i.jsx)(K.A,{placeholder:"请输入存储监视器备注（可选）",maxLength:100})})}),(0,i.jsx)($.A.Item,{label:"备注颜色",children:(0,i.jsx)(Y.A.Item,{name:"noteColor",initialValue:"#000000",children:(0,i.jsx)(X.A,{format:"hex",defaultFormat:"hex",presets:[{label:"推荐",colors:["#000000","#FFFFFF","#FF4D4F","#13C2C2","#52C41A","#FAAD14","#2F54EB","#722ED1"]}]})})})]})})]})}var et=n(96750);function en(e){let{disabled:t=!1}=e,{message:n}=c.A.useApp();(0,o.useEffect)(()=>{if(t)return;let e=null;return(async()=>{if(!await (0,et.C)())return n.error("无法与服务器建立连接");let t=W.Aq.getGatewayUrl("/api/f/receivenotice");(e=new q.EventSourcePolyfill(t.toString(),{headers:{Authorization:W.Aq.getCookie("authToken")||""}})).onmessage=e=>{console.log("Message:",e.data);let t=JSON.parse(e.data);console.log(t),"frm"===t.type&&("server"===t.data.type?(a(t.data),s(t.key),p(!0)):"entity"===t.data.type&&("1"==t.data.entityType||"2"==t.data.entityType?(y({name:t.data.entityName,id:t.data.entityId,entityType:t.data.entityType}),f(t.key),b(!0)):"3"==t.data.entityType&&(A({name:t.data.entityName,id:t.data.entityId}),k(t.key),T(!0))))},e.addEventListener("welcome",e=>{console.log("Welcome event:",e.data),P.B.emit("SSE_CONNECTED",{status:e.data})}),e.addEventListener("end",t=>{console.log("Stream ended:",t.data),null==e||e.close()}),e.onerror=e=>{console.error("SSE error:",e),P.B.emit("SSE_DISCONNECTED",{})}})(),()=>{e&&(e.close(),e=null)}},[t]);let[r,a]=(0,o.useState)(null),[l,s]=(0,o.useState)(""),[d,p]=(0,o.useState)(!1),[u,h]=(0,o.useState)(!1),[g,y]=(0,o.useState)(null),[x,f]=(0,o.useState)(""),[m,b]=(0,o.useState)(!1),[j,w]=(0,o.useState)(!1),[v,A]=(0,o.useState)(null),[S,k]=(0,o.useState)(""),[C,T]=(0,o.useState)(!1),[z,E]=(0,o.useState)(!1),I=async()=>{h(!0);let e=await W.Aq.backendFetch("/api/f/setserverconfig",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:l})}),t=await e.json().finally(()=>{h(!1),p(!1)});200===t.status?(n.success("配对成功"),a(null),P.B.emit("ADMIN_DATA_SERVER_UPDATE",t.data)):n.error(t.errmessage||"配对失败")},B=async(e,t,i,o)=>{w(!0);let r=await W.Aq.backendFetch("2"==o?"/api/f/addsmartalarm":"/api/f/addswitch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:x,name:e,note:t,noteColor:i})}),a=await r.json().finally(()=>{w(!1),b(!1)});200===a.status?(n.success("配对成功"),y(null),P.B.emit("ADMIN_DATA_SWITCH_UPDATE",a.data)):n.error(a.errmessage||"配对失败")},R=async(e,t,i)=>{E(!0);let o=await W.Aq.backendFetch("/api/f/addstoragemonitor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:S,name:e,note:t,noteColor:i})}),r=await o.json().finally(()=>{E(!1),T(!1)});200===r.status?(n.success("配对成功"),A(null),P.B.emit("ADMIN_DATA_STORAGE_MONITOR_UPDATE",r.data)):n.error(r.errmessage||"配对失败")};return(0,i.jsxs)(o.Fragment,{children:[r&&(0,i.jsx)(H,{open:d,data:r,onCancel:()=>p(!1),onConfirm:I,loading:u}),g&&(0,i.jsx)(Z,{open:m,data:g,onCancel:()=>b(!1),onConfirm:e=>{B(e.name,e.note,e.noteColor,e.entityType)},loading:j}),v&&(0,i.jsx)(ee,{open:C,data:v,onCancel:()=>T(!1),onConfirm:e=>{R(e.name,e.note,e.noteColor)},loading:z})]})}var ei=n(91442),eo=n(43561),er=n(45125),ea=n(81184),el=n(65982),es=n(91589),ed=n(54540),ec=n(67153),ep=n(8805),eu=n(55248),eh=n(21282),eg=n(29655),ey=n(31199);let ex="https://cap.rustplus.cn/336bfb3b1a/",ef="wx_pay_state",{Title:em,Text:eb}=l.A;function ej(e){let{open:t,onClose:n,onBalanceUpdate:a}=e,[l,s]=(0,o.useState)(null),[d,g]=(0,o.useState)(10),[y,x]=(0,o.useState)("alipay"),[f,b]=(0,o.useState)(""),[j,w]=(0,o.useState)(!1),[v,A]=(0,o.useState)(!0),[S,k]=(0,o.useState)(!1),[C,T]=(0,o.useState)(null),[z,I]=(0,o.useState)("recharge"),[B,R]=(0,o.useState)([]),[F,O]=(0,o.useState)({page:1,pageSize:10,total:0}),[_,D]=(0,o.useState)(!1),[N,L]=(0,o.useState)(""),[q,J]=(0,o.useState)(!1),{modal:U,message:M}=c.A.useApp(),[V,H]=(0,o.useState)(!1),[G,Y]=(0,o.useState)(!1),[$,X]=(0,o.useState)(0),Q=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:ex});e.addEventListener("progress",e=>{X(e.detail.progress||0)}),Q.current=e,H(!0);return}let e=document.createElement("script");e.src="/cap-widget.js",e.async=!0,e.onload=()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:ex});e.addEventListener("progress",e=>{X(e.detail.progress||0)}),Q.current=e,H(!0)}},document.head.appendChild(e)},[]);let Z=(0,o.useCallback)(async()=>{if(!V||!Q.current)return M.error("人机验证组件未加载完成，请稍后重试"),null;try{return Y(!0),X(0),(await Q.current.solve()).token}catch(e){return M.error("人机验证失败，请重试"),null}finally{Y(!1),X(0)}},[V,M]),ee=(0,o.useCallback)(async e=>{if(navigator.clipboard&&window.isSecureContext)try{return await navigator.clipboard.writeText(e),!0}catch(e){}try{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select();let n=document.execCommand("copy");return document.body.removeChild(t),n}catch(e){return!1}},[]),et=async e=>{if(await new Promise(e=>{window.WeixinJSBridge?e():(document.addEventListener("WeixinJSBridgeReady",()=>e(),{once:!0}),setTimeout(e,3e3))}),!window.WeixinJSBridge)throw Error("WeixinJSBridge not available");return new Promise(t=>{window.WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign},e=>{t(e.err_msg||"unknown")})})},en=(0,o.useCallback)(async()=>{let e=new URLSearchParams(window.location.search).get("code");if(!e)return!1;let t=sessionStorage.getItem(ef);if(!t)return window.history.replaceState({},"",window.location.pathname),!1;try{let n=JSON.parse(t);g(n.amount||10),b(n.invitationCode||""),x("wxpay"),J(!0),w(!0);let i=await W.Aq.backendFetch("/api/pay/wxpay/oauth/openid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),o=await i.json();if(window.history.replaceState({},"",window.location.pathname),200!==o.status)return M.error("获取微信授权失败，请重试"),sessionStorage.removeItem(ef),!1;let r=o.data.openid;sessionStorage.setItem("wx_openid",r),sessionStorage.removeItem(ef);let a=await Z();if(!a)return w(!1),!1;let l=await W.Aq.backendFetch("/api/pay/rcoin/wxpay/jsapi",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:n.amount,code:n.invitationCode||"",openid:r,capToken:a})}),s=await l.json();if(200!==s.status)return M.error(s.errmessage||"下单失败"),!1;let d=await et(s.data.payParams);"get_brand_wcpay_request:ok"===d?(ek(),ew()):"get_brand_wcpay_request:cancel"===d?M.info("支付已取消"):M.error("支付失败")}catch(e){console.error("微信支付回调处理失败",e),sessionStorage.removeItem(ef)}finally{J(!1),w(!1)}return!0},[M]),ej=async(e,t,n)=>{w(!0);try{let i=await Z();if(!i)return void w(!1);let o=await W.Aq.backendFetch("/api/pay/rcoin/wxpay/jsapi",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,code:t||"",openid:n,capToken:i})}),r=await o.json();if(200!==r.status)return void M.error(r.errmessage||"下单失败");let a=await et(r.data.payParams);"get_brand_wcpay_request:ok"===a?(ek(),ew()):"get_brand_wcpay_request:cancel"===a?M.info("支付已取消"):M.error("支付失败")}finally{w(!1)}};(0,o.useEffect)(()=>(t?(ew(),k(!1),T(null),en(),document.body.style.overflow="hidden",document.body.style.touchAction="none"):(document.body.style.overflow="",document.body.style.touchAction=""),()=>{document.body.style.overflow="",document.body.style.touchAction=""}),[t,en]);let ew=async()=>{A(!0);try{let[e,t]=await Promise.all([W.Aq.backendFetch("/api/pay/getrcoininfo",{method:"POST"}),W.Aq.backendFetch("/api/pay/getuserinfo",{method:"POST"})]),n=await e.json(),i=await t.json();200===n.status&&(s(n.data),null==a||a(n.data.balance),P.B.emit("RCOIN_BALANCE_UPDATED",{balance:n.data.balance})),200===i.status&&L(i.data.email)}catch(e){M.error("加载失败")}finally{A(!1)}},ev=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;D(!0);try{let t=await W.Aq.backendFetch("/api/pay/getrcoinlogs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:e,pageSize:F.pageSize})}),n=await t.json();200===n.status&&(R(n.data.logs),O(e=>({...e,page:n.data.page,total:n.data.total})))}catch(e){M.error("加载日志失败")}finally{D(!1)}},eA=async e=>{let t=sessionStorage.getItem("wx_openid");if(!t&&!new URLSearchParams(window.location.search).get("code")){sessionStorage.setItem(ef,JSON.stringify({amount:e,invitationCode:f}));let t=window.location.origin+window.location.pathname,n=await W.Aq.backendFetch("/api/pay/wxpay/oauth/url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({redirect_uri:t})}),i=await n.json();200===i.status?window.location.href=i.data.url:(M.error("获取授权链接失败"),sessionStorage.removeItem(ef));return}await ej(e,f,t)},eS=async()=>{let e=Math.floor(d);if(e<1||e>1e4)return void M.error("充值数量需在1-10000之间");w(!0);try{let{isWechat:t,isMobile:n}=(()=>{let e=W.Aq.detectDevice();return{isWechat:e.isWechat,isMobile:e.isMobile}})(),o=window.location.pathname,r=window.location.origin;if("wxpay"===y){if(n&&!t)return void U.info({title:"请在微信中打开",content:(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)("div",{style:{fontSize:14,color:"rgba(255,255,255,0.7)",marginBottom:12},children:"微信支付需要在微信中完成"}),(0,i.jsx)("div",{style:{fontSize:13,color:"rgba(255,255,255,0.5)",marginBottom:16},children:"请复制当前网址，在微信中打开后重新支付"}),(0,i.jsx)(K.A,{value:window.location.href,readOnly:!0,style:{marginBottom:8},addonAfter:(0,i.jsx)(ec.A,{style:{cursor:"pointer"},onClick:async()=>{await ee(window.location.href)?M.success("网址已复制"):M.info("请手动复制上方网址")}})})]}),okText:"复制网址",onOk:async()=>{await ee(window.location.href)?M.success("网址已复制"):M.info("请手动复制网址")}});if(t)return void await eA(e)}let a=await Z();if(!a)return void w(!1);let l="wxpay"===y?"/api/pay/a/querywxpayorderissuccess":"/api/pay/a/queryalipayorderissuccess",s={amount:e,code:f||"",capToken:a};"alipay"===y&&(s.return_url="".concat(r,"/pay-result?return_path=").concat(encodeURIComponent(o)),s.isMobile=n,n&&(s.quit_url="".concat(r).concat(o)));let d=await W.Aq.backendFetch("wxpay"===y?"/api/pay/rcoin/wxpay/native":"/api/pay/rcoin/alipay/native",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),c=await d.json();if(200!==c.status){M.error(c.errmessage||"下单失败"),w(!1);return}if(T(c.data),k(!0),w(!1),"alipay"===y){window.location.href=c.data.code_url;return}let p=c.data.out_trade_no;for(let e=0;e<120;e++){let e=await W.Aq.backendFetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({out_trade_no:p})}),t=await e.json();if(200===t.status){ek(),ew();return}await new Promise(e=>setTimeout(e,1e3))}}finally{w(!1)}},ek=()=>{U.success({icon:null,content:(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)(m.A,{style:{color:"#10b981",fontSize:"64px",marginBottom:"16px"}}),(0,i.jsx)(em,{level:4,style:{color:"#fff",margin:"0 0 8px 0"},children:"充值成功"}),(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.6)"},children:"R币已到账"}),(0,i.jsx)(h.Ay,{type:"primary",style:{marginTop:"24px",width:"100%"},onClick:()=>{p.A.destroyAll(),k(!1),T(null),ew()},children:"确定"})]}),footer:null,closable:!0,width:360,centered:!0})},eC=()=>{if(!C)return null;let[e,t]=(0,o.useState)(C.time_expire+C.advance_seconds);return(0,o.useEffect)(()=>{let e=setInterval(()=>t(e=>e<=1?0:e-1),1e3);return()=>clearInterval(e)},[]),(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)("div",{style:{display:"inline-block",padding:"16px",background:"#fff",borderRadius:"12px",boxShadow:"0 4px 24px rgba(0,0,0,0.2)"},children:"wxpay"===y?(0,i.jsx)(ei.A,{value:C.code_url,size:180,color:"#000",bgColor:"#fff"}):(0,i.jsxs)("div",{style:{padding:"20px",textAlign:"center",width:180},children:[(0,i.jsx)(m.A,{style:{fontSize:"40px",color:"#1677ff",marginBottom:"12px"}}),(0,i.jsx)("div",{style:{color:"#333",fontSize:"14px",marginBottom:"6px"},children:"订单已创建"}),(0,i.jsx)("div",{style:{color:"#666",fontSize:"12px"},children:"已跳转至支付宝付款页面"})]})}),(0,i.jsxs)("div",{style:{marginTop:"16px"},children:[(0,i.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"6px 12px",background:"rgba(99, 102, 241, 0.1)",borderRadius:"16px",marginBottom:"8px"},children:[(0,i.jsx)(ep.A,{style:{color:"#818cf8",fontSize:12}}),(0,i.jsxs)(eb,{style:{color:"#818cf8",fontSize:12},children:["有效期: ",(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(e)]})]}),(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.4)",fontSize:"12px",display:"block"},children:"wxpay"===y?"请使用微信扫码支付":"请在新窗口完成支付"})]})]})};return(0,i.jsxs)(p.A,{open:t,onCancel:n,footer:null,width:650,centered:!0,destroyOnClose:!0,closable:!1,styles:{content:{background:"#27272c",border:"1px solid rgba(255,255,255,0.1)",padding:0,maxHeight:"90vh",overflow:"hidden"},header:{display:"none"},body:{padding:0,display:"flex",flexDirection:"column",maxHeight:"90vh",overflow:"hidden"}},title:null,className:"rcoin-modal",children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 20px",borderBottom:"1px solid rgba(255,255,255,0.08)",background:"#27272c",flexShrink:0},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,i.jsx)("img",{src:"/Rmoney.ico",alt:"R币",style:{width:24,height:24,borderRadius:"50%"}}),(0,i.jsx)(eb,{strong:!0,style:{fontSize:16,color:"#fff"},children:"R币充值"})]}),(0,i.jsx)(h.Ay,{type:"text",onClick:n,style:{color:"rgba(255,255,255,0.5)",width:32,height:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:"✕"})]}),(0,i.jsx)("div",{style:{padding:"0 24px 24px",overflow:"auto",flex:1,overscrollBehavior:"contain"},onTouchMove:e=>{let t=e.currentTarget,{scrollTop:n,scrollHeight:i,clientHeight:o}=t;(n<=0&&e.touches[0].clientY>t._lastTouchY||n+o>=i&&e.touches[0].clientY<t._lastTouchY)&&e.stopPropagation(),t._lastTouchY=e.touches[0].clientY},onTouchStart:e=>{e.currentTarget._lastTouchY=e.touches[0].clientY},children:v?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:(0,i.jsx)(r.A,{size:"large"})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",borderRadius:"14px",padding:"16px 20px",marginBottom:"16px",marginTop:"16px"},children:[(0,i.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,i.jsxs)("div",{children:[(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.7)",fontSize:"12px"},children:"R币余额"}),(0,i.jsxs)("div",{style:{fontSize:"28px",fontWeight:700,color:"#fff",marginTop:"2px",display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("img",{src:"/Rmoney.ico",alt:"R币",style:{width:24,height:24,borderRadius:"50%"}}),(null==l?void 0:l.balance.toFixed(2))||"0.00"]})]})}),(0,i.jsxs)("div",{style:{display:"flex",gap:"20px",marginTop:"12px",paddingTop:"12px",borderTop:"1px solid rgba(255,255,255,0.15)"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.6)",fontSize:"11px"},children:"累计充值"}),(0,i.jsx)("div",{style:{color:"#fff",fontWeight:600,fontSize:13},children:(null==l?void 0:l.totalPurchased.toFixed(2))||"0.00"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.6)",fontSize:"11px"},children:"累计消费"}),(0,i.jsx)("div",{style:{color:"#fff",fontWeight:600,fontSize:13},children:(null==l?void 0:l.totalUsed.toFixed(2))||"0.00"})]})]})]}),(0,i.jsx)(ed.A,{activeKey:z,onChange:e=>{I(e),"logs"===e&&0===B.length&&ev()},items:[{key:"recharge",label:(0,i.jsxs)("span",{children:[(0,i.jsx)(eg.A,{style:{marginRight:6}}),"充值"]}),children:(0,i.jsx)(()=>(0,i.jsx)("div",{children:S?(0,i.jsx)(eC,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",display:"block",marginBottom:"6px"},children:"充值账号"}),(0,i.jsx)(K.A,{disabled:!0,value:N,style:{background:"rgba(255,255,255,0.03)",height:"40px"}})]}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",display:"block",marginBottom:"8px"},children:"充值数量"}),(0,i.jsx)("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",marginBottom:"10px"},children:[10,50,100,200,500,1e3].map(e=>(0,i.jsx)(eo.A,{onClick:()=>g(e),style:{cursor:"pointer",padding:"6px 12px",borderRadius:"6px",background:d===e?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)",border:d===e?"1px solid #6366f1":"1px solid rgba(255,255,255,0.1)",color:d===e?"#818cf8":"rgba(255,255,255,0.7)",fontSize:13},children:e},e))}),(0,i.jsx)(er.A,{min:1,max:1e4,value:d,onChange:e=>g(Math.floor(e||1)),precision:0,style:{width:"100%",height:"40px"},addonAfter:"R币"}),(0,i.jsxs)("div",{style:{marginTop:"6px",display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.4)",fontSize:"12px"},children:"支付金额"}),(0,i.jsxs)(eb,{style:{color:"#f87171",fontWeight:600},children:["\xa5",Math.floor(d),".00"]})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",display:"block",marginBottom:"8px"},children:"支付方式"}),(0,i.jsxs)(ea.A,{gutter:8,children:[(0,i.jsx)(el.A,{span:12,children:(0,i.jsx)("div",{onClick:()=>x("alipay"),style:{padding:"12px",background:"alipay"===y?"rgba(22, 119, 255, 0.1)":"rgba(255,255,255,0.03)",border:"alipay"===y?"1px solid rgba(22, 119, 255, 0.4)":"1px solid rgba(255,255,255,0.08)",borderRadius:"10px",cursor:"pointer",transition:"all 0.2s"},children:(0,i.jsxs)(u.A,{children:[(0,i.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:"#1677ff",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(eu.A,{style:{color:"#fff",fontSize:"18px"}})}),(0,i.jsx)("div",{style:{color:"#fff",fontWeight:500,fontSize:13},children:"支付宝"})]})})}),(0,i.jsx)(el.A,{span:12,children:(0,i.jsx)("div",{onClick:()=>x("wxpay"),style:{padding:"12px",background:"wxpay"===y?"rgba(82, 196, 26, 0.1)":"rgba(255,255,255,0.03)",border:"wxpay"===y?"1px solid rgba(82, 196, 26, 0.4)":"1px solid rgba(255,255,255,0.08)",borderRadius:"10px",cursor:"pointer",transition:"all 0.2s"},children:(0,i.jsxs)(u.A,{children:[(0,i.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:"#52c41a",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(eh.A,{style:{color:"#fff",fontSize:"18px"}})}),(0,i.jsx)("div",{style:{color:"#fff",fontWeight:500,fontSize:13},children:"微信支付"})]})})})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",display:"block",marginBottom:"6px"},children:"邀请码（可选）"}),(0,i.jsx)(K.A,{value:f,onChange:e=>b(e.target.value),placeholder:"输入邀请码可享优惠",style:{height:"40px"}})]}),G&&(0,i.jsxs)("div",{style:{marginBottom:"12px",padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:"10px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[(0,i.jsx)(eb,{style:{color:"#a5b4fc",fontSize:"13px"},children:"正在进行安全验证..."}),(0,i.jsxs)(eb,{style:{color:"#818cf8",fontSize:"13px",fontWeight:600},children:[$,"%"]})]}),(0,i.jsx)("div",{style:{height:"4px",background:"rgba(255,255,255,0.1)",borderRadius:"2px",overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat($,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:"2px",transition:"width 0.3s ease"}})})]}),(0,i.jsx)(h.Ay,{type:"primary",size:"large",block:!0,onClick:eS,loading:j,disabled:G,icon:"alipay"===y?(0,i.jsx)(eu.A,{}):(0,i.jsx)(eh.A,{}),style:{height:"46px",fontSize:"15px",fontWeight:600,borderRadius:"12px",background:j||G?"rgba(255,255,255,0.1)":"alipay"===y?"linear-gradient(135deg, #1677ff 0%, #0958d9 100%)":"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",boxShadow:j||G?"none":"alipay"===y?"0 4px 16px rgba(22, 119, 255, 0.3)":"0 4px 16px rgba(82, 196, 26, 0.3)"},children:G?"验证中 ".concat($,"%"):j?"处理中...":"立即充值 \xa5".concat(Math.floor(d),".00")}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",marginTop:"14px",color:"rgba(255,255,255,0.35)",fontSize:"11px"},children:[(0,i.jsx)(E.A,{}),(0,i.jsx)("span",{children:"安全支付 \xb7 即时到账"})]})]})}),{})},{key:"logs",label:(0,i.jsxs)("span",{children:[(0,i.jsx)(ey.A,{style:{marginRight:6}}),"变动记录"]}),children:(0,i.jsx)(()=>(0,i.jsxs)("div",{style:{marginTop:8},children:[_?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:40},children:(0,i.jsx)(r.A,{})}):0===B.length?(0,i.jsx)("div",{style:{textAlign:"center",padding:40,color:"rgba(255,255,255,0.4)"},children:"暂无记录"}):(0,i.jsx)("div",{children:B.map(e=>{var t;let n={recharge:{text:"充值",color:"#52c41a"},exchange:{text:"兑换",color:"#f59e0b"},consume:{text:"消费",color:"#ff4d4f"},refund:{text:"退款",color:"#1677ff"},gift:{text:"赠送",color:"#722ed1"},system_add:{text:"系统增加",color:"#13c2c2"},system_deduct:{text:"系统扣除",color:"#fa8c16"},other:{text:"其他",color:"#8c8c8c"}}[t=e.changeType]||{text:t,color:"#8c8c8c"};return(0,i.jsxs)("div",{style:{padding:"12px 14px",background:"rgba(255,255,255,0.03)",borderRadius:10,marginBottom:8,border:"1px solid rgba(255,255,255,0.06)"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(eo.A,{color:n.color,style:{margin:0,fontSize:11},children:n.text}),(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.5)",fontSize:11},children:W.Aq.formatDateTime(e.createdAt)})]}),(0,i.jsxs)(eb,{style:{color:e.changeAmount>=0?"#52c41a":"#ff4d4f",fontWeight:600,fontSize:15},children:[e.changeAmount>=0?"+":"",e.changeAmount.toFixed(2)]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(eb,{style:{color:"rgba(255,255,255,0.7)",fontSize:13},children:e.reason}),(0,i.jsxs)(eb,{style:{color:"rgba(255,255,255,0.4)",fontSize:11,whiteSpace:"nowrap",marginLeft:12},children:[e.balanceBefore.toFixed(2)," → ",(0,i.jsx)("span",{style:{color:"#a78bfa"},children:e.balanceAfter.toFixed(2)})]})]})]},e.id)})}),F.total>F.pageSize&&(0,i.jsx)("div",{style:{marginTop:"12px",textAlign:"center"},children:(0,i.jsx)(es.A,{current:F.page,total:F.total,pageSize:F.pageSize,onChange:e=>ev(e),size:"small",showSizeChanger:!1})})]}),{})}]})]})})]})}var ew=n(23608),ev=n(19374),eA=n(87480),eS=n(56922);let{Text:ek}=l.A,eC="https://cap.rustplus.cn/336bfb3b1a/";function eT(e){let{open:t,onCancel:n}=e,{message:r}=c.A.useApp(),[a,l]=(0,o.useState)(null),[s,d]=(0,o.useState)(!1),[g,y]=(0,o.useState)(0),[x,f]=(0,o.useState)(null),[m,b]=(0,o.useState)(null),[j,w]=(0,o.useState)(""),[v,A]=(0,o.useState)(0),[S]=Y.A.useForm(),[k,C]=(0,o.useState)(!1),T=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(window.Cap){T.current=new window.Cap({apiEndpoint:eC}),C(!0);return}let e=document.createElement("script");return e.src="/cap-widget.js",e.async=!0,e.onload=()=>{window.Cap&&(T.current=new window.Cap({apiEndpoint:eC}),C(!0))},document.head.appendChild(e),()=>{}},[]);let z=(0,o.useCallback)(async()=>{if(!k||!T.current)return r.error("人机验证组件未加载完成，请稍后重试"),null;try{return(await T.current.solve()).token}catch(e){return r.error("人机验证失败，请重试"),null}},[k,r]),I=(0,o.useCallback)(async()=>{try{let e=await W.Aq.backendFetch("/api/f/getaccountbindinfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json();200===t.status&&l(t.data)}catch(e){console.error("获取绑定信息失败:",e)}},[]);(0,o.useEffect)(()=>{t&&(I(),B())},[t,I]),(0,o.useEffect)(()=>{if(v>0){let e=setTimeout(()=>A(v-1),1e3);return()=>clearTimeout(e)}},[v]);let B=()=>{y(0),f(null),b(null),w(""),A(0),S.resetFields()},R=async()=>{if(!(v>0)){d(!0);try{let e=await W.Aq.backendFetch("phone"===x?"/api/f/getoldphoneverify":"/api/f/getoldemailverify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json();200===t.status?(r.success("验证码已发送"),A(60)):r.error(t.errmessage||"发送失败")}catch(e){r.error("发送失败")}finally{d(!1)}}},F=async()=>{let e=S.getFieldValue("oldCode");if(!e||6!==e.length)return void r.error("请输入6位验证码");d(!0);try{let t=await W.Aq.backendFetch("phone"===x?"/api/f/verifyoldphone":"/api/f/verifyoldemail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),n=await t.json();200===n.status?(w(n.token),y(1),A(0),S.resetFields(),r.success("验证成功")):r.error(n.errmessage||"验证失败")}catch(e){r.error("验证失败")}finally{d(!1)}},O=async()=>{if(v>0)return;let e="phone"===x?S.getFieldValue("newPhone"):S.getFieldValue("newEmail");if(!e)return void r.error("phone"===x?"请输入新手机号":"请输入新邮箱");d(!0);try{let t=await z();if(!t)return void d(!1);let n="phone"===x?{phone:e}:{email:e};n.capToken=t,j&&(n.token=j);let i=await W.Aq.backendFetch("phone"===x?"/api/f/getnewphoneverify":"/api/f/getnewemailverify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),o=await i.json();200===o.status?(r.success("验证码已发送"),A(60)):r.error(o.errmessage||"发送失败")}catch(e){r.error("发送失败")}finally{d(!1)}},_=async()=>{let e=S.getFieldValue("newCode"),t="phone"===x?S.getFieldValue("newPhone"):S.getFieldValue("newEmail");if(!e||6!==e.length)return void r.error("请输入6位验证码");d(!0);try{let n=null;if("phone"===x&&!(n=await z()))return void d(!1);let i={code:e};"phone"===x?(i.phone=t,i.capToken=n):i.email=t,j&&(i.token=j);let o=await W.Aq.backendFetch("phone"===x?"/api/f/bindphone":"/api/f/bindemail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),a=await o.json();200===a.status?(r.success("bind"===m?"绑定成功":"换绑成功"),I(),B()):r.error(a.errmessage||"操作失败")}catch(e){r.error("操作失败")}finally{d(!1)}},P=async()=>{let e=S.getFieldValue("oldCode");if(!e||6!==e.length)return void r.error("请输入6位验证码");d(!0);try{let t=await W.Aq.backendFetch("/api/f/unbindemail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),n=await t.json();200===n.status?(r.success("解绑成功"),I(),B()):r.error(n.errmessage||"解绑失败")}catch(e){r.error("解绑失败")}finally{d(!1)}},D=(e,t)=>{f(e),b(t),y(+("bind"===t)),w(""),A(0),S.resetFields()};return(0,i.jsxs)(p.A,{title:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(E.A,{}),(0,i.jsx)("span",{children:"账户安全设置"})]}),open:t,onCancel:()=>{B(),n()},footer:null,width:480,destroyOnClose:!0,children:[x&&"unbind"!==m&&"bind"!==m&&(0,i.jsx)(ev.A,{current:g,size:"small",style:{marginBottom:24},items:[{title:"验证原".concat("phone"===x?"手机":"邮箱")},{title:"绑定新".concat("phone"===x?"手机":"邮箱")}]}),x?"unbind"===m||"change"===m&&0===g?(0,i.jsxs)("div",{children:[(0,i.jsx)(ew.A,{message:"请验证当前".concat("phone"===x?"手机号":"邮箱"),description:"验证码将发送到 ".concat("phone"===x?null==a?void 0:a.phoneNumber:null==a?void 0:a.email),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,i.jsx)(Y.A,{form:S,layout:"vertical",children:(0,i.jsx)(Y.A.Item,{label:"验证码",name:"oldCode",rules:[{required:!0,message:"请输入验证码"}],children:(0,i.jsxs)(u.A.Compact,{style:{width:"100%"},children:[(0,i.jsx)(K.A,{placeholder:"请输入6位验证码",maxLength:6,style:{flex:1}}),(0,i.jsx)(h.Ay,{onClick:R,disabled:v>0,loading:s,children:v>0?"".concat(v,"s"):"获取验证码"})]})})}),(0,i.jsxs)(u.A,{style:{width:"100%",justifyContent:"flex-end"},children:[(0,i.jsx)(h.Ay,{onClick:B,children:"取消"}),"unbind"===m?(0,i.jsx)(h.Ay,{type:"primary",danger:!0,onClick:P,loading:s,children:"确认解绑"}):(0,i.jsx)(h.Ay,{type:"primary",onClick:F,loading:s,children:"下一步"})]})]}):(0,i.jsxs)("div",{children:[(0,i.jsx)(ew.A,{message:"bind"===m?"绑定新".concat("phone"===x?"手机号":"邮箱"):"换绑新".concat("phone"===x?"手机号":"邮箱"),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,i.jsxs)(Y.A,{form:S,layout:"vertical",children:["phone"===x?(0,i.jsx)(Y.A.Item,{label:"新手机号",name:"newPhone",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式错误"}],children:(0,i.jsx)(K.A,{placeholder:"请输入新手机号",maxLength:11})}):(0,i.jsx)(Y.A.Item,{label:"新邮箱",name:"newEmail",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"邮箱格式错误"}],children:(0,i.jsx)(K.A,{placeholder:"请输入新邮箱"})}),(0,i.jsx)(Y.A.Item,{label:"验证码",name:"newCode",rules:[{required:!0,message:"请输入验证码"}],children:(0,i.jsxs)(u.A.Compact,{style:{width:"100%"},children:[(0,i.jsx)(K.A,{placeholder:"请输入6位验证码",maxLength:6,style:{flex:1}}),(0,i.jsx)(h.Ay,{onClick:O,disabled:v>0,loading:s,children:v>0?"".concat(v,"s"):"获取验证码"})]})})]}),(0,i.jsxs)(u.A,{style:{width:"100%",justifyContent:"flex-end"},children:[(0,i.jsx)(h.Ay,{onClick:B,children:"取消"}),(0,i.jsxs)(h.Ay,{type:"primary",onClick:_,loading:s,children:["确认","bind"===m?"绑定":"换绑"]})]})]}):(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:24},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px",background:"rgba(255,255,255,0.02)",borderRadius:12,marginBottom:12},children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(eA.A,{style:{fontSize:20,color:"#818cf8"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ek,{strong:!0,style:{display:"block"},children:"手机号"}),(0,i.jsx)(ek,{type:"secondary",style:{fontSize:13},children:(null==a?void 0:a.hasPhone)?a.phoneNumber:"未绑定"})]})]}),(0,i.jsx)(h.Ay,{type:(null==a?void 0:a.hasPhone)?"default":"primary",onClick:()=>D("phone",(null==a?void 0:a.hasPhone)?"change":"bind"),children:(null==a?void 0:a.hasPhone)?"换绑":"绑定"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px",background:"rgba(255,255,255,0.02)",borderRadius:12},children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(eS.A,{style:{fontSize:20,color:"#818cf8"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ek,{strong:!0,style:{display:"block"},children:"邮箱"}),(0,i.jsx)(ek,{type:"secondary",style:{fontSize:13},children:(null==a?void 0:a.hasEmail)?a.email:"未绑定"})]})]}),(0,i.jsxs)(u.A,{children:[(null==a?void 0:a.hasEmail)&&(null==a?void 0:a.hasPhone)&&(0,i.jsx)(h.Ay,{danger:!0,onClick:()=>D("email","unbind"),children:"解绑"}),(0,i.jsx)(h.Ay,{type:(null==a?void 0:a.hasEmail)?"default":"primary",onClick:()=>D("email",(null==a?void 0:a.hasEmail)?"change":"bind"),children:(null==a?void 0:a.hasEmail)?"换绑":"绑定"})]})]})]}),(null==a?void 0:a.lastPhoneChangeAt)&&(0,i.jsxs)(ek,{type:"secondary",style:{fontSize:12,display:"block"},children:["上次换绑手机号: ",new Date(a.lastPhoneChangeAt).toLocaleDateString()]}),(null==a?void 0:a.lastEmailChangeAt)&&(0,i.jsxs)(ek,{type:"secondary",style:{fontSize:12,display:"block"},children:["上次换绑邮箱: ",new Date(a.lastEmailChangeAt).toLocaleDateString()]})]})]})}var ez=n(50886);let{Header:eE,Sider:eI,Content:eB}=d.A,{Text:eR}=l.A;function eF(e){var t;let{children:n,isExpired:N=!1}=e,q=(0,D.useRouter)(),J=(0,D.usePathname)(),U=(0,D.useSearchParams)(),{message:M}=c.A.useApp(),{userInfo:V,logout:H}=(0,s.A)(),[G,Y]=(0,o.useState)(!1),$=(0,ez.I)(),[K,X]=(0,o.useState)(!1),[Q,Z]=(0,o.useState)(""),[ee,et]=(0,o.useState)(!1),[ei,eo]=(0,o.useState)(!1),[er,ea]=(0,o.useState)(!1),[el,es]=(0,o.useState)(!1),[ed,ec]=(0,o.useState)("loading"),[ep,eu]=(0,o.useState)(""),[eh,eg]=(0,o.useState)(null),[ey,ex]=(0,o.useState)(null),[ef,em]=(0,o.useState)(!1),[eb,ew]=(0,o.useState)(!0),[ev,eA]=(0,o.useState)(!1),[eS,ek]=(0,o.useState)(!1),[eC,eF]=(0,o.useState)(!1),[eO,e_]=(0,o.useState)(null),[eP,eD]=(0,o.useState)(!1),[eN,eL]=(0,o.useState)(!1),[eq,eW]=(0,o.useState)(!1),[eJ,eU]=(0,o.useState)(!1),[eM,eV]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=()=>eo(!0),t=()=>eo(!1);return P.B.on("SSE_CONNECTED",e),P.B.on("SSE_DISCONNECTED",t),()=>{P.B.off("SSE_CONNECTED",e),P.B.off("SSE_DISCONNECTED",t)}},[]),(0,o.useEffect)(()=>{let e=()=>{eW("true"===document.documentElement.getAttribute("data-rust-tool-application"))};e();let t=()=>e();window.addEventListener("rust-tool-app-ready",t);let n=setTimeout(e,5e3);return()=>{window.removeEventListener("rust-tool-app-ready",t),clearTimeout(n)}},[]),(0,o.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("code"),t=sessionStorage.getItem("wx_pay_state");e&&t&&eD(!0)},[]),(0,o.useEffect)(()=>{let e=()=>eD(!0);return P.B.on("OPEN_RCOIN_MODAL",e),()=>{P.B.off("OPEN_RCOIN_MODAL",e)}},[]),(0,o.useEffect)(()=>{let e=e=>{e_(e.balance)};return P.B.on("RCOIN_BALANCE_UPDATED",e),()=>{P.B.off("RCOIN_BALANCE_UPDATED",e)}},[]),(0,o.useEffect)(()=>{let e=e=>{if(e.steamProfile&&eg(e.steamProfile),e.steamBan&&ex(e.steamBan),e.rustToken){let t=eQ(e.rustToken);if(t){let e=Math.floor(Date.now()/1e3);Z(new Date(1e3*t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),e>=t&&et(!0)}}ew(!1)};return P.B.on("HOMEPAGE_DATA_LOADED",e),()=>{P.B.off("HOMEPAGE_DATA_LOADED",e)}},[]),(0,o.useEffect)(()=>{(async()=>{try{let e=await W.Aq.backendFetch("/api/pay/getrcoininfo",{method:"POST"}),t=await e.json();200===t.status&&e_(t.data.balance)}catch(e){console.error("获取 R币余额失败:",e)}})()},[]),(0,o.useEffect)(()=>{var e;let t=null==(e=U.get("rusttoken"))?void 0:e.replace(/ /g,"+");t&&eH(t)},[U]);let eH=async e=>{es(!0),ec("loading"),eu("");let t=new Promise(e=>{setTimeout(()=>e({timeout:!0}),1e4)}),n=(async()=>(await W.Aq.backendFetch("/api/f/saverusttoken",{method:"POST",body:JSON.stringify({token:e}),headers:{"Content-Type":"application/json"}})).json())();try{let e=await Promise.race([n,t]);if("timeout"in e){ec("timeout"),eu("请求超时，请重新获取凭证");return}200===e.status?(ec("success"),setTimeout(()=>{es(!1),q.replace("/admin")},1500)):(ec("error"),eu(e.errmessage||"凭证更新失败"))}catch(e){ec("error"),eu("网络错误，请重试")}},eG=async()=>{try{eA(!0);let e=await W.Aq.backendFetch("/api/f/clearuserdata",{method:"POST"}),t=await e.json();if(200!==t.status)return void M.error(t.errmessage||"清空数据失败");let n=await W.Aq.backendFetch("/api/f/saverusttoken",{method:"POST",body:JSON.stringify({token:""}),headers:{"Content-Type":"application/json"}}),i=await n.json();200===i.status?(M.success("账号已更换，正在跳转..."),ek(!1),em(!1),window.location.href="/admin"):M.error(i.errmessage||"操作失败")}catch(e){M.error("操作失败")}finally{eA(!1)}},eY=async()=>{$&&X(!1);let e=$?null:window.open("about:blank","_blank");try{eF(!0);let t=await W.Aq.backendFetch("/api/f/getuserpagetoken",{method:"POST"}),n=await t.json();if(200===n.status){let t=window.location.origin,i="".concat(t,"/#/user/").concat(n.data.appid,"?autoLogin=1&token=").concat(n.data.token);$?window.location.href=i:e&&(e.location.href=i)}else 10001===n.status?(e&&e.close(),p.A.confirm({title:"未设置用户页",content:"您还没有设置用户页路径，是否现在去设置？",okText:"去设置",cancelText:"取消",onOk:()=>{q.push("/admin/userpage")}})):10002===n.status?(e&&e.close(),p.A.confirm({title:"未设置用户页密码",content:"您还没有设置用户页密码，是否现在去设置？",okText:"去设置",cancelText:"取消",onOk:()=>{q.push("/admin/userpage")}})):(e&&e.close(),M.error(n.errmessage||"获取用户页信息失败"))}catch(t){e&&e.close(),M.error("网络错误，请稍后重试")}finally{eF(!1)}},e$=null==J?void 0:J.startsWith("/admin/help/"),eK=["/admin/pay/products"],eX=eK.some(e=>null==J?void 0:J.startsWith(e));(0,o.useEffect)(()=>{N&&!eX?ea(!0):ea(!1)},[N,eX,J]),(0,o.useEffect)(()=>{N&&!eX&&q.replace("/admin/pay/products")},[N,eX,q]),(0,o.useEffect)(()=>{if(!N||eX)return;let e=()=>{er||ea(!0)},t=e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation())};return document.addEventListener("click",e,!0),document.addEventListener("keydown",t,!0),()=>{document.removeEventListener("click",e,!0),document.removeEventListener("keydown",t,!0)}},[N,eX,er]);let eQ=e=>{try{let t=e.split(".")[0],n=atob(t);return JSON.parse(n).exp||null}catch(e){return null}},eZ=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(eh&&!e)return void ew(!1);try{ew(!0);let e=await W.Aq.backendFetch("/api/f/gethomepageinfo",{method:"POST"}),t=await e.json();if(200===t.status){if(t.data.rustToken){let e=eQ(t.data.rustToken);if(e){let t=Math.floor(Date.now()/1e3),n=new Date(1e3*e);Z(n.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),t>=e&&et(!0)}try{let e=await W.Aq.backendFetch("/api/f/getsteaminfo",{method:"POST"}),t=await e.json();200===t.status&&(t.data.steamProfile&&eg(t.data.steamProfile),t.data.steamBan&&ex(t.data.steamBan))}catch(e){console.error("获取 Steam 信息失败:",e)}}try{let e=await W.Aq.backendFetch("/api/pay/getrcoininfo",{method:"POST"}),t=await e.json();200===t.status&&e_(t.data.balance)}catch(e){console.error("获取 R币余额失败:",e)}}}catch(e){console.error("检查凭证状态失败:",e)}finally{ew(!1)}};(0,o.useEffect)(()=>{$||X(!1)},[$]),(0,o.useEffect)(()=>{eJ&&(((null==J?void 0:J.replace(/\/$/,""))||"")!==((null==eM?void 0:eM.replace(/\/$/,""))||"")&&eM||(eU(!1),eV(null)))},[J,eJ,eM]),(0,o.useEffect)(()=>{if(!eJ)return;let e=setTimeout(()=>{eU(!1),eV(null)},5e3);return()=>clearTimeout(e)},[eJ]),(0,o.useEffect)(()=>{if(eh)return void ew(!1);"/admin"!==J&&eZ(!0)},[J]);let e0=[{key:"/admin",icon:(0,i.jsx)(w.A,{}),label:"控制台"},{key:"setup",icon:(0,i.jsx)(v.A,{}),label:"基础设置",children:[{key:"/admin/device",label:"设备配对"},{key:"/admin/activation",label:"激活管理"}]},{key:"logic",icon:(0,i.jsx)(A.A,{}),label:"自动化逻辑",children:[{key:"/admin/eventlogic",label:"事件逻辑"},{key:"/admin/commandlogic",label:"指令逻辑"},{key:"/admin/callgroup",label:"呼叫组"}]},{key:"enter-userpage",icon:(0,i.jsx)(S.A,{}),label:eC?"正在打开...":"进入用户页",disabled:eC||e$},...eq?[{key:"info-window",icon:(0,i.jsx)(k.A,{}),label:"信息窗口"}]:[],{key:"/admin/otherfunctions",icon:(0,i.jsx)(C.A,{}),label:"更多功能"}],e1=[{key:"/admin/pay/products",icon:(0,i.jsx)(T.A,{}),label:"兑换中心",className:"recharge-menu-wrapper"},{key:"https://www.rustplus.cn/docs/qy.html",icon:(0,i.jsx)(z.A,{}),label:"帮助文档"}],e2=async()=>{try{let e=window.__TAURI__;if(!e)return void M.error("Tauri API 未加载");let{WebviewWindow:t}=e.webviewWindow,{availWidth:n}=window.screen,i="".concat(window.location.origin,"/info-window");new t("info-window",{url:i,title:"信息窗口",width:320,height:400,x:n-320-20,y:20,resizable:!0,decorations:!1,alwaysOnTop:!0,transparent:!1,skipTaskbar:!0,focus:!0}).once("tauri://error",e=>{console.error("创建信息窗口失败:",e),M.error("创建信息窗口失败")})}catch(e){console.error("打开信息窗口失败:",e),M.error("打开信息窗口失败，请确保在客户端中运行")}},e5=e=>{if(e$&&!e.startsWith("http")&&"enter-userpage"!==e&&"info-window"!==e)return void M.warning("请先完成当前引导步骤");if(N&&!e.startsWith("http")&&!eK.some(t=>e.startsWith(t)))return void ea(!0);if("info-window"===e)return N?void ea(!0):(e2(),void($&&X(!1)));if("enter-userpage"===e)return N?void ea(!0):e$?void M.warning("请先完成引导设置"):void eY();if(e.startsWith("http"))window.open(e,"_blank");else{if(e===J){$&&X(!1);return}eU(!0),eV(e),q.push(e)}$&&X(!1)},e6=async()=>{let e=window.location.hostname;"localhost"===e||"127.0.0.1"===e||/^(\d{1,3}\.){3}\d{1,3}$/.test(e)||/^(\[)?([0-9a-fA-F:]+)(])?$/.test(e)?(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"):(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(W.Ay.domain,";"),document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(W.Ay.domain,";")),H(),M.success("已退出登录"),q.push("/login")},e4=[{key:"account",icon:(0,i.jsx)(E.A,{}),label:"账户安全",onClick:()=>eL(!0)},{key:"logout",icon:(0,i.jsx)(I.A,{}),label:"退出登录",onClick:e6}],e8=()=>[J||"/admin"],e3=()=>(null==J?void 0:J.includes("/admin/device"))||(null==J?void 0:J.includes("/admin/activation"))||(null==J?void 0:J.includes("/admin/userpage"))?["setup"]:(null==J?void 0:J.includes("/admin/eventlogic"))||(null==J?void 0:J.includes("/admin/commandlogic"))||(null==J?void 0:J.includes("/admin/callgroup"))?["logic"]:[];return(0,i.jsxs)(o.Fragment,{children:[(0,i.jsx)(en,{disabled:N}),(0,i.jsx)(ej,{open:eP,onClose:()=>eD(!1),onBalanceUpdate:e=>e_(e)}),(0,i.jsx)(eT,{open:eN,onCancel:()=>eL(!1)}),el?(0,i.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"#1b1b1f",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:24,zIndex:99999},children:[(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.1) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.08) 0%, transparent 50%)",pointerEvents:"none"}}),(0,i.jsxs)("div",{style:{position:"relative",width:100,height:100,zIndex:1},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:80,height:80,borderRadius:20,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",objectFit:"contain",boxShadow:"0 8px 32px rgba(99, 102, 241, 0.3)"}}),"loading"===ed&&(0,i.jsx)(r.A,{indicator:(0,i.jsx)(a.A,{style:{fontSize:100,color:"rgba(99, 102, 241, 0.6)"},spin:!0})})]}),(0,i.jsxs)(u.A,{direction:"vertical",align:"center",size:16,style:{zIndex:1},children:["loading"===ed&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.A.Title,{level:3,style:{margin:0,color:"#fff"},children:"正在获取凭证..."}),(0,i.jsx)("div",{style:{marginTop:12,padding:"16px 32px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(249, 115, 22, 0.15) 100%)",borderRadius:12,border:"2px solid rgba(239, 68, 68, 0.4)"},children:(0,i.jsx)(eR,{style:{fontSize:18,fontWeight:600,color:"#f87171"},children:"⚠️ 请勿刷新浏览器"})}),(0,i.jsx)(eR,{type:"secondary",style:{fontSize:14},children:"正在保存您的凭证，请稍候..."})]}),"success"===ed&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(m.A,{style:{fontSize:24,color:"#10b981"}}),(0,i.jsx)(l.A.Title,{level:3,style:{margin:0,color:"#10b981"},children:"凭证获取成功！"})]}),(0,i.jsx)(eR,{type:"secondary",style:{fontSize:14},children:"正在跳转..."})]}),"error"===ed&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(b.A,{style:{fontSize:20,color:"#ef4444"}}),(0,i.jsx)(l.A.Title,{level:4,style:{margin:0,color:"#ef4444"},children:"凭证获取失败"})]}),(0,i.jsx)(eR,{type:"secondary",style:{fontSize:14},children:ep}),(0,i.jsx)(h.Ay,{type:"primary",onClick:()=>{es(!1),q.replace("/admin")},style:{marginTop:16,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none",borderRadius:10},children:"返回控制台"})]}),"timeout"===ed&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(b.A,{style:{fontSize:24,color:"#f59e0b"}}),(0,i.jsx)(l.A.Title,{level:3,style:{margin:0,color:"#f59e0b"},children:"请求超时"})]}),(0,i.jsx)(eR,{type:"secondary",style:{fontSize:14,textAlign:"center"},children:"凭证获取超时，请重新登录 Steam 获取凭证"}),(0,i.jsxs)(u.A,{direction:"vertical",size:12,style:{marginTop:8},children:[(0,i.jsx)(h.Ay,{type:"primary",size:"large",icon:(0,i.jsx)(j.A,{}),onClick:()=>{window.location.href="https://companion-rust.facepunch.com/login"},style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none",borderRadius:10,height:48,paddingLeft:24,paddingRight:24},children:"重新获取凭证"}),(0,i.jsx)(h.Ay,{type:"text",onClick:()=>{es(!1),q.replace("/admin")},style:{color:"rgba(255,255,255,0.5)"},children:"返回控制台"})]})]})]})]}):null,ei||N||"undefined"!=typeof document&&document.getElementById("initial-loader")?null:(0,i.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"#1b1b1f",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:24,zIndex:9999},children:[(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.1) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.08) 0%, transparent 50%)",pointerEvents:"none"}}),(0,i.jsxs)("div",{style:{position:"relative",width:100,height:100,zIndex:1},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:80,height:80,borderRadius:20,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",objectFit:"contain",boxShadow:"0 8px 32px rgba(99, 102, 241, 0.3)"}}),(0,i.jsx)(r.A,{indicator:(0,i.jsx)(a.A,{style:{fontSize:100,color:"rgba(99, 102, 241, 0.6)"},spin:!0})})]}),(0,i.jsxs)(u.A,{direction:"vertical",align:"center",size:8,style:{zIndex:1},children:[(0,i.jsx)(l.A.Title,{level:4,style:{margin:0,color:"#fff"},children:"正在连接中转服务器..."}),(0,i.jsx)(eR,{type:"secondary",style:{fontSize:14},children:"请稍候，正在建立与服务器的连接"})]})]}),eJ?(0,i.jsxs)("div",{style:{position:"fixed",top:0,left:$?0:G?72:240,right:0,bottom:0,background:"rgba(27, 27, 31, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:16,zIndex:1e3,backdropFilter:"blur(4px)"},children:[(0,i.jsx)(r.A,{indicator:(0,i.jsx)(a.A,{style:{fontSize:36,color:"#818cf8"},spin:!0})}),(0,i.jsx)(eR,{style:{color:"rgba(255,255,255,0.6)",fontSize:14},children:"加载中..."})]}):null,(0,i.jsx)(L,{user:V||{},children:(0,i.jsxs)(d.A,{style:{minHeight:"100vh",background:"#1b1b1f"},children:[(0,i.jsxs)(eI,{collapsible:!0,collapsed:!!$||G,onCollapse:Y,trigger:null,width:240,collapsedWidth:72*!$,style:{background:"linear-gradient(180deg, #1b1b1f 0%, #27272c 100%)",borderRight:"1px solid rgba(255, 255, 255, 0.06)",position:"fixed",height:"100vh",left:0,top:0,zIndex:100,display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,i.jsxs)("div",{style:{height:64,display:"flex",alignItems:"center",justifyContent:G?"center":"flex-start",padding:G?"0":"0 20px",borderBottom:"1px solid rgba(255, 255, 255, 0.06)"},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:36,height:36,borderRadius:10,flexShrink:0,objectFit:"contain"}}),!G&&(0,i.jsx)(eR,{strong:!0,style:{marginLeft:12,fontSize:16,color:"#fff",whiteSpace:"nowrap"},children:"Rust 工具箱"})]}),(0,i.jsx)("div",{style:{flex:1,overflow:"auto",padding:"12px 8px"},children:(0,i.jsx)(g.A,{mode:"inline",selectedKeys:e8(),defaultOpenKeys:e3(),items:e0,onClick:e=>e5(e.key),style:{background:"transparent",border:"none"}})}),(0,i.jsx)("div",{style:{padding:"12px 8px",borderTop:"1px solid rgba(255, 255, 255, 0.06)"},children:(0,i.jsx)(g.A,{mode:"inline",selectable:!1,items:e1,onClick:e=>e5(e.key),style:{background:"transparent",border:"none"}})})]}),(0,i.jsxs)(d.A,{style:{marginLeft:$?0:G?72:240,transition:"margin-left 0.2s cubic-bezier(0.4, 0, 0.2, 1)",background:"#1b1b1f"},children:[(0,i.jsxs)(eE,{style:{background:"rgba(27, 27, 31, 0.8)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",borderBottom:"1px solid rgba(255, 255, 255, 0.06)",padding:"0 24px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:99,height:64},children:[(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",gap:16},children:(0,i.jsx)(h.Ay,{type:"text",icon:$||G?(0,i.jsx)(B.A,{}):(0,i.jsx)(R.A,{}),onClick:()=>$?X(!0):Y(!G),style:{fontSize:18,width:40,height:40,borderRadius:10,color:"rgba(255, 255, 255, 0.7)"}})}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,i.jsxs)("div",{onClick:()=>eD(!0),style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",padding:"6px 12px",borderRadius:10,background:"linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%)",border:"1px solid rgba(99, 102, 241, 0.25)",transition:"all 0.2s"},children:[(0,i.jsx)("img",{src:"/Rmoney.ico",alt:"R币",style:{width:20,height:20,borderRadius:"50%",objectFit:"cover"}}),(0,i.jsx)(eR,{style:{color:"#a78bfa",fontWeight:600,fontSize:14},children:null!==eO?eO.toFixed(2):"--"})]}),(0,i.jsx)("div",{onClick:()=>em(!0),style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",padding:"6px 12px",borderRadius:12,transition:"all 0.2s",background:"rgba(255, 255, 255, 0.03)"},children:eb?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.A,{size:"small"}),!$&&(0,i.jsx)(eR,{style:{color:"rgba(255, 255, 255, 0.5)"},children:"加载中..."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y.A,{src:null==eh?void 0:eh.avatarfull,icon:(0,i.jsx)(F.A,{}),size:32,style:{background:(null==eh?void 0:eh.avatarfull)?void 0:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)"}}),!$&&(0,i.jsx)(eR,{style:{color:"rgba(255, 255, 255, 0.85)"},children:(null==eh?void 0:eh.personaname)||"未绑定"})]})}),(0,i.jsx)(x.A,{menu:{items:e4},trigger:["click"],placement:"bottomRight",children:(0,i.jsx)(h.Ay,{type:"text",icon:(0,i.jsx)(F.A,{}),style:{color:"rgba(255, 255, 255, 0.5)",width:36,height:36,borderRadius:10}})})]})]}),(0,i.jsx)(eB,{style:{padding:$?16:24,minHeight:"calc(100vh - 64px)",background:"#1b1b1f"},children:(0,i.jsx)("div",{style:{maxWidth:1400,margin:"0 auto"},children:n})})]})]})}),(0,i.jsx)(f.A,{placement:"left",open:K,onClose:()=>X(!1),width:280,closable:!1,styles:{body:{padding:0},header:{display:"none"}},style:{background:"#1b1b1f"},children:(0,i.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(180deg, #1b1b1f 0%, #27272c 100%)"},children:[(0,i.jsxs)("div",{style:{height:64,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 20px",borderBottom:"1px solid rgba(255, 255, 255, 0.06)"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:36,height:36,borderRadius:10,flexShrink:0,objectFit:"contain"}}),(0,i.jsx)(eR,{strong:!0,style:{marginLeft:12,fontSize:16,color:"#fff"},children:"Rust 工具箱"})]}),(0,i.jsx)(h.Ay,{type:"text",icon:(0,i.jsx)(O.A,{}),onClick:()=>X(!1),style:{color:"rgba(255, 255, 255, 0.7)"}})]}),(0,i.jsx)("div",{style:{flex:1,overflow:"auto",padding:"12px 8px"},children:(0,i.jsx)(g.A,{mode:"inline",selectedKeys:e8(),defaultOpenKeys:e3(),items:e0,onClick:e=>e5(e.key),style:{background:"transparent",border:"none"}})}),(0,i.jsx)("div",{style:{padding:"12px 8px",borderTop:"1px solid rgba(255, 255, 255, 0.06)"},children:(0,i.jsx)(g.A,{mode:"inline",selectable:!1,items:e1,onClick:e=>e5(e.key),style:{background:"transparent",border:"none"}})})]})}),(0,i.jsx)(p.A,{open:ee,onCancel:()=>et(!1),centered:!0,width:520,styles:{content:{background:"#2d2d33",borderRadius:20,border:"1px solid rgba(239, 68, 68, 0.3)"}},footer:null,children:(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)("div",{style:{width:64,height:64,borderRadius:16,background:"rgba(239, 68, 68, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},children:(0,i.jsx)(_.A,{style:{fontSize:32,color:"#ef4444"}})}),(0,i.jsx)(l.A.Title,{level:4,style:{color:"#fff",marginBottom:8},children:"Rust 凭证已过期"}),(0,i.jsxs)(eR,{type:"secondary",style:{display:"block",marginBottom:16},children:["您的凭证已于 ",(0,i.jsx)(eR,{style:{color:"#ef4444"},children:Q})," 过期"]}),(0,i.jsxs)("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)",borderRadius:12,padding:"16px",marginBottom:20,textAlign:"left"},children:[(0,i.jsx)(eR,{strong:!0,style:{color:"#ef4444",display:"block",marginBottom:8},children:"⚠️ 凭证过期将导致以下功能无法使用："}),(0,i.jsxs)("ul",{style:{margin:0,paddingLeft:20,color:"rgba(255,255,255,0.7)"},children:[(0,i.jsx)("li",{children:"无法配对服务器"}),(0,i.jsx)("li",{children:"无法配对智能开关和智能警报"}),(0,i.jsx)("li",{children:"队友死亡位置推送无法正常工作"})]})]}),(0,i.jsxs)(u.A,{direction:"vertical",size:12,style:{width:"100%"},children:[(0,i.jsx)(h.Ay,{type:"primary",size:"large",icon:(0,i.jsx)(j.A,{}),onClick:()=>window.open("https://www.rustplus.cn/docs/pdsteam.html","_blank"),style:{width:"100%",height:48,borderRadius:12,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:"查看获取凭证教程"}),(0,i.jsxs)("div",{style:{padding:"12px 16px",background:"rgba(99, 102, 241, 0.1)",borderRadius:10,border:"1px solid rgba(99, 102, 241, 0.2)"},children:[(0,i.jsxs)(eR,{type:"secondary",style:{fontSize:13},children:["已安装 ",(0,i.jsx)(eR,{style:{color:"#818cf8"},children:"Rust凭证获取助手"}),"？"]}),(0,i.jsx)(h.Ay,{type:"link",size:"small",onClick:()=>window.open("https://companion-rust.facepunch.com/login","_blank"),style:{padding:"0 4px",color:"#818cf8"},children:"点击直接前往获取凭证 →"})]}),(0,i.jsx)(h.Ay,{type:"text",size:"large",onClick:()=>et(!1),style:{width:"100%",height:44,borderRadius:12,color:"rgba(255,255,255,0.5)"},children:"稍后再说"}),(0,i.jsx)(eR,{type:"secondary",style:{fontSize:12},children:"获取新凭证后会自动跳转回来，无需重新配对服务器"})]})]})}),(0,i.jsx)(p.A,{open:er,closable:!1,maskClosable:!1,keyboard:!1,footer:null,centered:!0,width:480,styles:{mask:{background:"rgba(0, 0, 0, 0.85)"},content:{background:"linear-gradient(180deg, #27272c 0%, #1f1f23 100%)",borderRadius:20,border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",padding:0},body:{padding:0}},children:(0,i.jsxs)("div",{style:{padding:"40px 32px",textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:80,height:80,borderRadius:20,background:"linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(249, 115, 22, 0.2) 100%)",display:"inline-flex",alignItems:"center",justifyContent:"center",marginBottom:24,border:"1px solid rgba(239, 68, 68, 0.3)"},children:(0,i.jsx)(_.A,{style:{fontSize:40,color:"#ef4444"}})}),(0,i.jsx)(l.A.Title,{level:3,style:{color:"#fff",marginBottom:12},children:"账号激活已过期"}),(0,i.jsx)(eR,{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:15,display:"block",marginBottom:24},children:"您的账号激活期限已结束，请前往兑换中心续费后继续使用"}),(0,i.jsx)("div",{style:{padding:"16px 20px",background:"rgba(239, 68, 68, 0.1)",borderRadius:14,border:"1px solid rgba(239, 68, 68, 0.2)",marginBottom:24},children:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(b.A,{style:{color:"#ef4444"}}),(0,i.jsx)(eR,{style:{color:"#ef4444"},children:"当前页面功能已被限制，请先续费"})]})}),(0,i.jsx)(h.Ay,{type:"primary",size:"large",icon:(0,i.jsx)(T.A,{}),block:!0,onClick:()=>{ea(!1),q.push("/admin/pay/products")},style:{height:52,borderRadius:14,background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,fontSize:16,boxShadow:"0 4px 14px rgba(99, 102, 241, 0.35)"},children:"前往兑换中心"}),(0,i.jsx)("div",{style:{marginTop:16},children:(0,i.jsxs)(eR,{type:"secondary",style:{fontSize:13},children:["遇到问题？",(0,i.jsx)("a",{href:"https://www.rustplus.cn",target:"_blank",rel:"noopener noreferrer",style:{color:"#818cf8",marginLeft:4},children:"联系客服"})]})})]})}),(0,i.jsx)(p.A,{title:null,open:ef,onCancel:()=>em(!1),footer:null,centered:!0,width:400,children:(0,i.jsx)("div",{style:{padding:"8px 0"},children:eh?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:20},children:[(0,i.jsx)(y.A,{src:eh.avatarfull,icon:(0,i.jsx)(F.A,{}),size:72,style:{border:"3px solid rgba(99, 102, 241, 0.3)"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eR,{strong:!0,style:{fontSize:18,display:"block"},children:eh.personaname}),eh.realname&&(0,i.jsx)(eR,{type:"secondary",style:{fontSize:13,display:"block"},children:eh.realname})]})]}),(0,i.jsx)("div",{style:{padding:14,borderRadius:10,background:"rgba(99, 102, 241, 0.08)",border:"1px solid rgba(99, 102, 241, 0.15)",marginBottom:16},children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(eR,{type:"secondary",style:{fontSize:12,display:"block"},children:"SteamID"}),(0,i.jsx)(eR,{style:{fontSize:14,fontFamily:"monospace"},children:eh.steamid})]}),(0,i.jsx)(h.Ay,{type:"text",size:"small",onClick:async()=>{await W.Aq.copyToClipboard(eh.steamid||""),M.success("已复制 SteamID")},style:{color:"#818cf8"},children:"复制"})]})}),ey&&(0,i.jsxs)("div",{style:{padding:14,borderRadius:10,background:ey.VACBanned||ey.NumberOfGameBans||ey.CommunityBanned?"rgba(239, 68, 68, 0.1)":"rgba(16, 185, 129, 0.1)",border:ey.VACBanned||ey.NumberOfGameBans||ey.CommunityBanned?"1px solid rgba(239, 68, 68, 0.2)":"1px solid rgba(16, 185, 129, 0.2)",marginBottom:16},children:[(0,i.jsx)(eR,{strong:!0,style:{display:"block",marginBottom:8,color:ey.VACBanned||ey.NumberOfGameBans||ey.CommunityBanned?"#f87171":"#6ee7b7"},children:ey.VACBanned||ey.NumberOfGameBans||ey.CommunityBanned?"⚠️ 存在封禁记录":"✓ 账号状态良好"}),(0,i.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,i.jsxs)("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:ey.VACBanned?"rgba(239, 68, 68, 0.2)":"rgba(16, 185, 129, 0.2)",color:ey.VACBanned?"#f87171":"#6ee7b7"},children:["VAC: ",ey.NumberOfVACBans||0]}),(0,i.jsxs)("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:ey.NumberOfGameBans?"rgba(239, 68, 68, 0.2)":"rgba(16, 185, 129, 0.2)",color:ey.NumberOfGameBans?"#f87171":"#6ee7b7"},children:["游戏封禁: ",ey.NumberOfGameBans||0]}),(0,i.jsxs)("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:ey.CommunityBanned?"rgba(239, 68, 68, 0.2)":"rgba(16, 185, 129, 0.2)",color:ey.CommunityBanned?"#f87171":"#6ee7b7"},children:["社区: ",ey.CommunityBanned?"封禁":"正常"]})]}),(null!=(t=ey.DaysSinceLastBan)?t:0)>0&&(0,i.jsxs)(eR,{type:"secondary",style:{fontSize:11,display:"block",marginTop:6},children:["距上次封禁 ",ey.DaysSinceLastBan," 天"]})]}),(0,i.jsxs)("div",{style:{padding:14,borderRadius:10,background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.06)",marginBottom:16},children:[(0,i.jsx)(eR,{strong:!0,style:{fontSize:13,display:"block",marginBottom:10,color:"rgba(255,255,255,0.85)"},children:"账号信息"}),eh.timecreated&&(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(eR,{type:"secondary",style:{fontSize:13},children:"注册时间"}),(0,i.jsx)(eR,{style:{fontSize:13},children:new Date(1e3*eh.timecreated).toLocaleDateString("zh-CN")})]}),eh.loccountrycode&&(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(eR,{type:"secondary",style:{fontSize:13},children:"地区"}),(0,i.jsx)(eR,{style:{fontSize:13},children:eh.loccountrycode})]}),eh.timecreated&&(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)(eR,{type:"secondary",style:{fontSize:13},children:"账号年龄"}),(0,i.jsxs)(eR,{style:{fontSize:13},children:[Math.floor((Date.now()/1e3-eh.timecreated)/31536e3)," 年"]})]})]}),(0,i.jsxs)(u.A,{direction:"vertical",style:{width:"100%"},size:12,children:[(0,i.jsx)(h.Ay,{type:"primary",block:!0,onClick:()=>window.open(eh.profileurl,"_blank"),style:{height:40,borderRadius:10,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:"查看 Steam 主页"}),(0,i.jsx)(h.Ay,{block:!0,type:"default",onClick:()=>ek(!0),style:{height:40,borderRadius:10,boxShadow:"none",color:"#ef4444",borderColor:"#ef4444"},children:"更换 Steam 账号"})]})]}):(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)(y.A,{icon:(0,i.jsx)(F.A,{}),size:72,style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",marginBottom:16}}),(0,i.jsx)(eR,{strong:!0,style:{display:"block",fontSize:16,marginBottom:8},children:"未绑定 Steam 账号"}),(0,i.jsx)(eR,{type:"secondary",style:{display:"block",marginBottom:20},children:"请先获取 Rust 凭证以绑定 Steam 账号"}),(0,i.jsx)(h.Ay,{type:"primary",onClick:()=>window.open("https://www.rustplus.cn/docs/pdsteam.html","_blank"),style:{height:40,borderRadius:10,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:"查看绑定教程"})]})})}),(0,i.jsx)(p.A,{title:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(_.A,{style:{color:"#ff4d4f",fontSize:20}}),(0,i.jsx)("span",{children:"确认更换 Steam 账号"})]}),open:eS,onCancel:()=>ek(!1),footer:[(0,i.jsx)(h.Ay,{onClick:()=>ek(!1),style:{borderRadius:6},children:"取消"},"cancel"),(0,i.jsx)(h.Ay,{type:"primary",loading:ev,onClick:eG,style:{borderRadius:6,boxShadow:"none",background:"#ef4444",borderColor:"#ef4444"},children:"确认更换"},"confirm")],centered:!0,width:400,children:(0,i.jsxs)("div",{style:{padding:"16px 0"},children:[(0,i.jsxs)("div",{style:{padding:16,borderRadius:8,background:"rgba(255, 77, 79, 0.1)",border:"1px solid rgba(255, 77, 79, 0.2)",marginBottom:16},children:[(0,i.jsx)(eR,{strong:!0,style:{color:"#ff4d4f",display:"block",marginBottom:8},children:"⚠️ 警告：此操作不可逆"}),(0,i.jsx)(eR,{type:"secondary",style:{fontSize:13},children:"更换账号将会清空以下所有数据："}),(0,i.jsxs)("ul",{style:{margin:"8px 0 0 0",paddingLeft:20,color:"rgba(255,255,255,0.65)",fontSize:13},children:[(0,i.jsx)("li",{children:"已配对的服务器信息"}),(0,i.jsx)("li",{children:"所有开关设备配置"}),(0,i.jsx)("li",{children:"事件逻辑和指令逻辑"}),(0,i.jsx)("li",{children:"呼叫组配置"}),(0,i.jsx)("li",{children:"用户页设置"})]})]}),(0,i.jsx)(eR,{style:{display:"block",color:"rgba(255,255,255,0.85)"},children:"确定要更换 Steam 账号吗？"})]})})]})}var eO=n(56418),e_=n(67641);let{Text:eP,Title:eD}=l.A;function eN(e){let{error:t,title:n="出错了",code:o,onRetry:r,showHomeButton:a=!0}=e,l="string"==typeof t?t:t.message,s=o?"".concat(n," (代码: ").concat(o,")"):n;return(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh",padding:24},children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:20,maxWidth:400,textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:72,height:72,borderRadius:18,background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(eO.A,{style:{fontSize:36,color:"#ef4444"}})}),(0,i.jsx)(eD,{level:4,style:{margin:0,color:"#fff"},children:s}),(0,i.jsx)(eP,{style:{color:"rgba(255, 255, 255, 0.6)"},children:l}),"object"==typeof t&&t.stack&&(0,i.jsx)("div",{style:{padding:"12px 16px",background:"rgba(255, 255, 255, 0.03)",borderRadius:12,border:"1px solid rgba(255, 255, 255, 0.06)",width:"100%"},children:(0,i.jsx)(eP,{type:"secondary",style:{fontSize:12,fontFamily:"monospace"},children:t.stack})}),(0,i.jsxs)(u.A,{size:12,style:{marginTop:8},children:[(0,i.jsx)(h.Ay,{type:"primary",icon:(0,i.jsx)(e_.A,{}),onClick:()=>{r?r():window.location.reload()},style:{height:44,paddingInline:24,borderRadius:12,background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none"},children:"重试"}),a&&(0,i.jsx)(h.Ay,{icon:(0,i.jsx)(w.A,{}),onClick:()=>{window.location.href="/"},style:{height:44,paddingInline:24,borderRadius:12,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:"返回首页"})]})]})})}function eL(e){let{children:t}=e,{isAuthenticated:n,isLoading:d,activationStatus:c,checkAuth:p}=(0,s.A)(),[u,h]=o.useState(!1);return((0,o.useEffect)(()=>{p()},[]),(0,o.useEffect)(()=>{d||n||u||(h(!0),window.location.href="/login")},[d,n,u]),d||u||!n)?(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f"},children:[(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.1) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.08) 0%, transparent 50%)",pointerEvents:"none"}}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:20,position:"relative",zIndex:1},children:[(0,i.jsxs)("div",{style:{position:"relative",width:100,height:100},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:80,height:80,borderRadius:20,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",objectFit:"contain",boxShadow:"0 8px 32px rgba(99, 102, 241, 0.3)"}}),(0,i.jsx)(r.A,{indicator:(0,i.jsx)(a.A,{style:{fontSize:100,color:"rgba(99, 102, 241, 0.6)"},spin:!0})})]}),(0,i.jsx)(l.A.Text,{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:15,marginTop:8},children:u?"正在跳转...":n||d?"验证中...":"正在跳转..."})]})]}):"inactive"===c?(0,i.jsx)(eF,{isExpired:!0,children:t}):"unknown"===c?(0,i.jsx)(eN,{error:"数据加载失败，请检查网络连接或稍后重试。",title:"数据加载失败"}):(0,i.jsx)(eF,{children:t})}function eq(e){let{children:t}=e;return(0,i.jsx)(eL,{children:t})}function eW(e){let{children:t}=e,[n,l]=(0,o.useState)(!0),[s,d]=(0,o.useState)(!1);return((0,o.useEffect)(()=>{document.cookie.includes("authToken=")?d(!0):window.location.href="/login",l(!1)},[]),n||!s)?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f"},children:(0,i.jsx)(r.A,{indicator:(0,i.jsx)(a.A,{style:{fontSize:48,color:"#6366f1"},spin:!0})})}):(0,i.jsx)(eq,{children:t})}},31834:(e,t,n)=>{Promise.resolve().then(n.bind(n,6350))},37783:(e,t,n)=>{"use strict";n.d(t,{Aq:()=>o,Ay:()=>r});let i=n(70636).env.NEXT_PUBLIC_GATEWAY_URL||"https://gateway.rustplus.cn";class o{static formatDateTime(e){let t=new Date(e),n=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),r=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(n,"-").concat(i,"-").concat(o," ").concat(r,":").concat(a)}static async copyToClipboard(e,t){let{onSuccess:n,onError:i}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==n||n(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==n||n(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==n||n(),!0}catch(e){return null==i||i(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")?"".concat(i).concat(e):e.startsWith("/api/")?"".concat(i,"/api/backend").concat(e.slice(4)):"".concat(i).concat(e)}static async backendFetch(e,t){return fetch(o.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,n;let i="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===i.length)return null!=(n=null==(t=i.pop())?void 0:t.split(";").shift())?n:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let r={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},49621:(e,t,n)=>{"use strict";n.d(t,{B:()=>o});class i{emit(e,t){var n;null==(n=this.listeners[e])||n.forEach(e=>e(t))}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){var n;this.listeners[e]=null==(n=this.listeners[e])?void 0:n.filter(e=>e!==t)}constructor(){this.listeners={}}}let o=new i},50886:(e,t,n)=>{"use strict";n.d(t,{I:()=>o});var i=n(12115);let o=()=>{let[e,t]=(0,i.useState)(()=>window.innerWidth<768);return(0,i.useEffect)(()=>{let e=()=>{t(window.innerWidth<768)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}},69176:(e,t,n)=>{"use strict";n.d(t,{A:()=>c,O:()=>d});var i=n(95155),o=n(12115),r=n(37783);let{backendFetch:a}=r.Aq;function l(){let e=window.location.hostname;"localhost"===e||"127.0.0.1"===e||/^(\d{1,3}\.){3}\d{1,3}$/.test(e)||/^(\[)?([0-9a-fA-F:]+)(])?$/.test(e)?(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"):(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(r.Ay.domain,";"),document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(r.Ay.domain,";"))}let s=(0,o.createContext)(void 0);function d(e){let{children:t}=e,[n,r]=(0,o.useState)({isAuthenticated:!1,isLoading:!0,userInfo:null,activationStatus:"unknown"}),d=(0,o.useCallback)(e=>{r(t=>({...t,...e}))},[]),c=(0,o.useCallback)(async()=>{try{d({isLoading:!0});let e=await a("/api/f/getstate",{method:"POST",credentials:"include"});if(403===e.status){l(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}let t=await e.json();if(403===t.status){l(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}if(200===t.status)return void d({isAuthenticated:!0,isLoading:!1,userInfo:t.userinfo||null,activationStatus:"active"===t.data?"active":"inactive"});l(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}catch(e){console.error("Auth check failed:",e),l(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}},[d]),p=(0,o.useCallback)(()=>{d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})},[d]),u={...n,checkAuth:c,logout:p,setAuthState:d};return(0,i.jsx)(s.Provider,{value:u,children:t})}function c(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},96750:(e,t,n)=>{"use strict";async function i(){return window.location.origin}n.d(t,{C:()=>i})}},e=>{e.O(0,[1721,9326,6083,785,6240,9279,2245,9543,6060,5445,9073,4540,6133,2718,8272,4425,5702,5125,6861,1386,8607,9856,2502,748,6980,3884,8441,1255,7358],()=>e(e.s=31834)),_N_E=e.O()}]);