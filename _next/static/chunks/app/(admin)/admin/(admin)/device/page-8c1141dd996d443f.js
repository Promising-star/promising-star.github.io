(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9785],{37783:(e,t,r)=>{"use strict";r.d(t,{Aq:()=>a,Ay:()=>s});let n="https://gateway.rustplus.cn";class a{static formatDateTime(e){let t=new Date(e),r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"-").concat(n,"-").concat(a," ").concat(s,":").concat(o)}static async copyToClipboard(e,t){let{onSuccess:r,onError:n}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==r||r(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==r||r(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==r||r(),!0}catch(e){return null==n||n(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(n).concat(e):e.startsWith("/api/")?"".concat(n,"/api/backend").concat(e.slice(4)):"".concat(n).concat(e)}static async backendFetch(e,t){return fetch(a.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,r;let n="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===n.length)return null!=(r=null==(t=n.pop())?void 0:t.split(";").shift())?r:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let s={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},43076:(e,t,r)=>{Promise.resolve().then(r.bind(r,46702))},46702:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>_});var n=r(95155);r(92932);var a=r(12115),s=r(19279),o=r(89543),i=r(63646),l=r(785),c=r(84549),d=r(44187),h=r(19588),u=r(39578),p=r(54540),m=r(46172),y=r(88795),g=r(74452),x=r(96347),A=r(82854),f=r(37783),b=r(86133),j=r(15856),w=r(49073),C=r(89856);function S(e){let{open:t,data:r,onCancel:s,onConfirm:o,loading:i=!1}=e,[c]=b.A.useForm();(0,a.useEffect)(()=>{t&&r&&c.setFieldsValue({name:r.name,note:r.note||"",noteColor:r.noteColor||"#000000"})},[r,t,c]);let d=async()=>{try{let e=await c.validateFields();"string"!=typeof e.noteColor&&(e.noteColor=e.noteColor.toHexString()),o({id:r.id,name:e.name,note:e.note,noteColor:e.noteColor})}catch(e){console.error("Validation failed:",e)}};return(0,n.jsx)(j.A,{title:"编辑开关",open:t,onOk:d,onCancel:s,confirmLoading:i,destroyOnHidden:!0,footer:[(0,n.jsx)(l.Ay,{onClick:s,children:"取消"},"back"),(0,n.jsx)(l.Ay,{type:"primary",loading:i,onClick:d,children:"确认"},"submit")],children:(0,n.jsxs)(b.A,{form:c,layout:"vertical",initialValues:{name:r.name,note:r.note||"",noteColor:r.noteColor||"#000000"},children:[(0,n.jsx)(b.A.Item,{label:"名称",name:"name",rules:[{required:!0,message:"请输入开关名称"},{min:1,message:"名称至少 1 个字符"},{max:20,message:"名称最多 20 个字符"}],children:(0,n.jsx)(w.A,{placeholder:"例如: 开关门",disabled:i,maxLength:20,showCount:!0})}),(0,n.jsx)(b.A.Item,{label:"备注",name:"note",rules:[{max:100,message:"备注最多 100 个字符"}],children:(0,n.jsx)(w.A.TextArea,{placeholder:"可选备注信息",disabled:i,maxLength:100,showCount:!0})}),(0,n.jsx)(b.A.Item,{label:"备注颜色",name:"noteColor",children:(0,n.jsx)(C.A,{format:"hex",defaultFormat:"hex",disabled:i,presets:[{label:"推荐",colors:["#000000","#FFFFFF","#FF4D4F","#13C2C2","#52C41A","#FAAD14","#2F54EB","#722ED1"]}]})})]})})}var k=r(49621),T=r(80420);let O=f.Aq.backendFetch,{Text:v}=s.A;function _(){let{message:e}=o.A.useApp(),[t,r]=(0,a.useState)([]),[s,b]=(0,a.useState)([]),[j,w]=(0,a.useState)([]),[C,_]=(0,a.useState)(!0),[D,E]=(0,a.useState)(!1),[F,M]=(0,a.useState)(null),[P,I]=(0,a.useState)(!1),[N,B]=(0,a.useState)("switch");(0,a.useEffect)(()=>{R();let e=()=>R();return k.B.on("ADMIN_DATA_SWITCH_UPDATE",e),k.B.on("ADMIN_DATA_STORAGE_MONITOR_UPDATE",e),()=>{k.B.off("ADMIN_DATA_SWITCH_UPDATE",e),k.B.off("ADMIN_DATA_STORAGE_MONITOR_UPDATE",e)}},[]);let W=async n=>{I(!0);let a="alarm"===N,o="monitor"===N,i="/api/f/setswitchbyid",l="switchid";a?(i="/api/f/setsmartalarmbyid",l="alarmid"):o&&(i="/api/f/setstoragemonitorbyid",l="monitorid");let c=await f.Aq.backendFetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({[l]:n.id,name:n.name,note:n.note,noteColor:n.noteColor})}),d=await c.json().finally(()=>{I(!1),E(!1)});200===d.status?(e.success("修改成功"),a?b(s.map(e=>e.id===n.id?{...n}:e)):o?w(j.map(e=>e.id===n.id?{...n}:e)):r(t.map(e=>e.id===n.id?{...n}:e)),M(null)):e.error(d.errmessage||"修改失败")},R=async()=>{try{_(!0);let e=await O("/api/f/getinfo",{method:"POST"}),t=await e.json();200===t.status&&(r(t.data.switches||[]),b(t.data.smartAlarms||[]),w(t.data.storageMonitors||[]))}catch(t){e.error("获取数据失败")}finally{_(!1)}},U=async n=>{try{let a=await O("/api/f/delswitchbyid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({switchid:n})}),s=await a.json();200===s.status?(e.success("删除成功"),r(t.filter(e=>e.id!==n))):e.error(s.errmessage||"删除失败")}catch(t){e.error("删除失败")}},z=async t=>{try{let r=await O("/api/f/delsmartalarmbyid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({alarmid:t})}),n=await r.json();200===n.status?(e.success("删除成功"),b(s.filter(e=>e.id!==t))):e.error(n.errmessage||"删除失败")}catch(t){e.error("删除失败")}},H=async t=>{try{let r=await O("/api/f/delstoragemonitorbyid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({monitorid:t})}),n=await r.json();200===n.status?(e.success("删除成功"),w(j.filter(e=>e.id!==t))):e.error(n.errmessage||"删除失败")}catch(t){e.error("删除失败")}},L=e=>[{title:"名称",dataIndex:"name",key:"name",render:e=>(0,n.jsx)(v,{strong:!0,children:e})},{title:"备注",dataIndex:"note",key:"note",render:(e,t)=>(0,n.jsx)(v,{style:{color:t.noteColor||"inherit"},children:e||"-"})},{title:"操作",key:"action",width:120,render:(t,r)=>(0,n.jsxs)(i.A,{children:[(0,n.jsx)(l.Ay,{type:"text",size:"small",icon:(0,n.jsx)(m.A,{}),onClick:()=>{M(r),E(!0)},style:{color:"#818cf8"}}),(0,n.jsx)(c.A,{title:"确认删除",description:"确定要删除这个".concat("switch"===e?"开关":"alarm"===e?"警报":"存储监视器","吗？"),onConfirm:()=>"alarm"===e?z(r.id):"monitor"===e?H(r.id):U(r.id),okText:"确定",cancelText:"取消",children:(0,n.jsx)(l.Ay,{type:"text",size:"small",icon:(0,n.jsx)(y.A,{}),danger:!0})})]})}],q=[{key:"switch",label:(0,n.jsxs)(i.A,{children:[(0,n.jsx)(g.A,{}),(0,n.jsx)("span",{children:"智能开关"}),(0,n.jsx)("span",{style:{background:"rgba(99, 102, 241, 0.15)",color:"#818cf8",padding:"2px 8px",borderRadius:10,fontSize:12},children:t.length})]}),children:t.length>0?(0,n.jsx)(d.A,{columns:L("switch"),dataSource:t,rowKey:"id",pagination:!1,style:{background:"transparent"}}):(0,n.jsx)(h.A,{description:"暂无智能开关",style:{padding:"40px 0"}})},{key:"alarm",label:(0,n.jsxs)(i.A,{children:[(0,n.jsx)(x.A,{}),(0,n.jsx)("span",{children:"智能警报"}),(0,n.jsx)("span",{style:{background:"rgba(99, 102, 241, 0.15)",color:"#818cf8",padding:"2px 8px",borderRadius:10,fontSize:12},children:s.length})]}),children:s.length>0?(0,n.jsx)(d.A,{columns:L("alarm"),dataSource:s,rowKey:"id",pagination:!1,style:{background:"transparent"}}):(0,n.jsx)(h.A,{description:"暂无智能警报",style:{padding:"40px 0"}})},{key:"monitor",label:(0,n.jsxs)(i.A,{children:[(0,n.jsx)(A.A,{}),(0,n.jsx)("span",{children:"存储监视器"}),(0,n.jsx)("span",{style:{background:"rgba(99, 102, 241, 0.15)",color:"#818cf8",padding:"2px 8px",borderRadius:10,fontSize:12},children:j.length})]}),children:j.length>0?(0,n.jsx)(d.A,{columns:L("monitor"),dataSource:j,rowKey:"id",pagination:!1,style:{background:"transparent"}}):(0,n.jsx)(h.A,{description:"暂无存储监视器",style:{padding:"40px 0"}})}];return(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)(u.A,{title:(0,n.jsxs)(i.A,{children:[(0,n.jsx)(g.A,{}),(0,n.jsx)("span",{children:"配对设备"})]}),extra:(0,n.jsx)(T.A,{href:"https://www.rustplus.cn/docs/pdgame.html",children:"配对教程"}),loading:C,style:{background:"#27272c",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)"},children:(0,n.jsx)(p.A,{activeKey:N,onChange:e=>B(e),items:q})}),F&&(0,n.jsx)(S,{open:D,data:F,onCancel:()=>E(!1),onConfirm:W,loading:P})]})}},49621:(e,t,r)=>{"use strict";r.d(t,{B:()=>a});class n{emit(e,t){var r;null==(r=this.listeners[e])||r.forEach(e=>e(t))}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){var r;this.listeners[e]=null==(r=this.listeners[e])?void 0:r.filter(e=>e!==t)}constructor(){this.listeners={}}}let a=new n},80420:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(95155),a=r(52619),s=r.n(a),o=r(75442),i=r(63646);r(12115);let l=e=>{let{href:t,children:r,iconSize:a=4,target:l="_blank",underline:c=!1,showIcon:d=!0}=e;return(0,n.jsx)(s(),{href:t,target:l,style:{color:"#818cf8",textDecoration:c?"underline":"none",transition:"color 0.2s"},onMouseEnter:e=>{e.currentTarget.style.color="#a5b4fc"},onMouseLeave:e=>{e.currentTarget.style.color="#818cf8"},children:d?(0,n.jsxs)(i.A,{size:a,children:[(0,n.jsx)(o.A,{}),r]}):r})}}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,6060,5445,4540,9578,9073,6133,2718,8272,2587,4425,5078,4187,5125,5702,8824,7954,1373,8441,1255,7358],()=>e(e.s=43076)),_N_E=e.O()}]);