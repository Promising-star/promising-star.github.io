(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7956],{34465:(e,t,i)=>{Promise.resolve().then(i.bind(i,66163))},37783:(e,t,i)=>{"use strict";i.d(t,{Aq:()=>n,Ay:()=>a});let r=i(70636).env.NEXT_PUBLIC_GATEWAY_URL||"https://gateway.rustplus.cn";class n{static formatDateTime(e){let t=new Date(e),i=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return"".concat(i,"-").concat(r,"-").concat(n," ").concat(a,":").concat(l)}static async copyToClipboard(e,t){let{onSuccess:i,onError:r}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==i||i(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==i||i(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==i||i(),!0}catch(e){return null==r||r(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")?"".concat(r).concat(e):e.startsWith("/api/")?"".concat(r,"/api/backend").concat(e.slice(4)):"".concat(r).concat(e)}static async backendFetch(e,t){return fetch(n.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,i;let r="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===r.length)return null!=(i=null==(t=r.pop())?void 0:t.split(";").shift())?i:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let a={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},49621:(e,t,i)=>{"use strict";i.d(t,{B:()=>n});class r{emit(e,t){var i;null==(i=this.listeners[e])||i.forEach(e=>e(t))}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){var i;this.listeners[e]=null==(i=this.listeners[e])?void 0:i.filter(e=>e!==t)}constructor(){this.listeners={}}}let n=new r},66163:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var r=i(95155),n=i(12115),a=i(19279),l=i(89543),o=i(785),s=i(15856),c=i(36060),d=i(15702),g=i(43561),h=i(45125),p=i(81184),x=i(65982),y=i(19588),f=i(44187),b=i(44074),u=i(66968),m=i(97170),j=i(43990),A=i(2995),S=i(29655),v=i(26555),w=i(31199),k=i(37783),R=i(49621),z=i(20063);let{Title:_,Text:C}=a.A,P={purchase:{label:"购买获得",color:"green"},consume:{label:"消费使用",color:"red"},gift:{label:"赠送",color:"purple"},exchange:{label:"兑换获得",color:"blue"},free_daily:{label:"每日免费",color:"cyan"},system_add:{label:"系统增加",color:"green"},system_deduct:{label:"系统扣除",color:"red"},refund:{label:"退还",color:"orange"},other:{label:"其他",color:"default"}};function T(){let e=(0,z.useSearchParams)(),[t,i]=(0,n.useState)([]),[a,T]=(0,n.useState)(!0),[O,B]=(0,n.useState)(null),[E,I]=(0,n.useState)(null),[W,N]=(0,n.useState)(null),[F,D]=(0,n.useState)(1),[M,L]=(0,n.useState)(!1),[U,q]=(0,n.useState)(e.get("tab")||"toolbox"),[G,H]=(0,n.useState)("exchange"),[J,Y]=(0,n.useState)([]),[K,X]=(0,n.useState)(!1),[Q,V]=(0,n.useState)({page:1,pageSize:10,total:0}),{message:Z,modal:$}=l.A.useApp();(0,n.useEffect)(()=>{ee()},[]),(0,n.useEffect)(()=>{let e=e=>{B(t=>t?{...t,balance:e.balance}:null)};return R.B.on("RCOIN_BALANCE_UPDATED",e),()=>{R.B.off("RCOIN_BALANCE_UPDATED",e)}},[]);let ee=async()=>{try{let[e,t,r]=await Promise.all([k.Aq.backendFetch("/api/pay/getgoodslist",{method:"POST"}),k.Aq.backendFetch("/api/pay/getrcoininfo",{method:"POST"}),k.Aq.backendFetch("/api/pay/rcoin/exchange/config",{method:"POST"})]),n=await e.json(),a=await t.json(),l=await r.json();200===n.status&&i(n.data.map(e=>({goods_id:e.goods_id,name:e.name,description:e.description,features:e.features,originalPrice:e.originalPrice/100,price:e.price/100,tag:e.tag,isMain:e.isMain}))),200===a.status&&B(a.data),200===l.status&&(N(l.data),D(l.data.min))}catch(e){Z.error("加载失败")}finally{T(!1)}},et=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;X(!0);try{let i=await k.Aq.backendFetch("/api/pay/getscorelogs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:e,pageSize:t})}),r=await i.json();200===r.status&&(Y(r.data.logs),V({page:r.data.page,pageSize:r.data.pageSize,total:r.data.total}))}catch(e){Z.error("获取积分记录失败")}finally{X(!1)}};(0,n.useEffect)(()=>{"score"===U&&"logs"===G&&0===J.length&&et()},[U,G]);let ei=async()=>{if(!O||!W)return;if(O.balance<F)return void $.confirm({title:"R币余额不足",content:"兑换需要 ".concat(F," R币，当前余额 ").concat(O.balance.toFixed(2)," R币"),okText:"去充值",cancelText:"取消",onOk:()=>R.B.emit("OPEN_RCOIN_MODAL",{}),centered:!0});let e=F*W.rate;$.confirm({title:"确认兑换",content:(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:["消耗：",(0,r.jsxs)("span",{style:{color:"#f87171",fontWeight:600},children:[F," R币"]})]}),(0,r.jsxs)("p",{children:["获得：",(0,r.jsxs)("span",{style:{color:"#10b981",fontWeight:600},children:[e," 积分"]})]})]}),okText:"确认兑换",cancelText:"取消",centered:!0,onOk:async()=>{L(!0);try{let e=await k.Aq.backendFetch("/api/pay/rcoin/exchange/score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:F})}),t=await e.json();200===t.status?(B(e=>e?{...e,balance:t.data.rcoin_balance}:null),R.B.emit("RCOIN_BALANCE_UPDATED",{balance:t.data.rcoin_balance}),Z.success("兑换成功，获得 ".concat(t.data.score_gained," 积分"))):Z.error(t.errmessage||"兑换失败")}catch(e){Z.error("兑换失败")}finally{L(!1)}}})},er=async e=>{if(!O||O.balance<e.price)return void $.confirm({title:"R币余额不足",content:"兑换需要 ".concat(e.price.toFixed(2)," R币，当前余额 ").concat((null==O?void 0:O.balance.toFixed(2))||"0.00"," R币"),okText:"去充值",cancelText:"取消",onOk:()=>R.B.emit("OPEN_RCOIN_MODAL",{}),centered:!0});$.confirm({title:"确认兑换",content:(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:["商品：",e.name]}),(0,r.jsxs)("p",{children:["价格：",(0,r.jsxs)("span",{style:{color:"#f87171",fontWeight:600},children:[e.price.toFixed(2)," R币"]})]})]}),okText:"确认兑换",cancelText:"取消",centered:!0,onOk:async()=>{I(e.goods_id);try{let t=await k.Aq.backendFetch("/api/pay/rcoin/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({goods_id:e.goods_id})}),i=await t.json();200===i.status?(B(e=>e?{...e,balance:i.data.balance_after}:null),R.B.emit("RCOIN_BALANCE_UPDATED",{balance:i.data.balance_after}),en(e.name)):Z.error(i.errmessage||"兑换失败")}catch(e){Z.error("兑换失败")}finally{I(null)}}})},en=e=>{$.success({icon:null,content:(0,r.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,r.jsx)(b.A,{style:{color:"#10b981",fontSize:"56px",marginBottom:"16px"}}),(0,r.jsx)(_,{level:4,style:{color:"#fff",margin:"0 0 8px 0"},children:"兑换成功"}),(0,r.jsxs)(C,{style:{color:"rgba(255,255,255,0.6)"},children:["「",e,"」已到账"]}),(0,r.jsx)(o.Ay,{type:"primary",style:{marginTop:"20px",width:"100%"},onClick:()=>{s.A.destroyAll(),window.location.href="/admin"},children:"返回控制台"})]}),footer:null,closable:!0,width:340,centered:!0})},ea=t.find(e=>"toolbox"===e.goods_id),el=t.filter(e=>e.goods_id.startsWith("callscore:"));return a?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:(0,r.jsx)(c.A,{size:"large"})}):(0,r.jsxs)("div",{style:{maxWidth:800,margin:"0 auto"},children:[(0,r.jsxs)("div",{style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",borderRadius:16,padding:"20px 24px",marginBottom:24,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(C,{style:{color:"rgba(255,255,255,0.7)",fontSize:13},children:"R币余额"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,marginTop:4},children:[(0,r.jsx)("img",{src:"/Rmoney.ico",alt:"R币",style:{width:28,height:28,borderRadius:"50%"}}),(0,r.jsx)("span",{style:{fontSize:32,fontWeight:700,color:"#fff"},children:(null==O?void 0:O.balance.toFixed(2))||"0.00"})]})]}),(0,r.jsx)(o.Ay,{type:"primary",icon:(0,r.jsx)(u.A,{}),onClick:()=>R.B.emit("OPEN_RCOIN_MODAL",{}),style:{background:"rgba(255,255,255,0.2)",border:"none",height:40,borderRadius:10},children:"充值"})]}),(0,r.jsx)(d.A,{value:U,onChange:q,block:!0,options:[{label:(0,r.jsxs)("span",{children:[(0,r.jsx)(m.A,{style:{marginRight:6}}),"工具箱"]}),value:"toolbox"},{label:(0,r.jsxs)("span",{children:[(0,r.jsx)(j.A,{style:{marginRight:6}}),"积分"]}),value:"score"}],style:{marginBottom:24}}),"toolbox"===U&&ea&&(0,r.jsxs)("div",{style:{background:"linear-gradient(145deg, #1e1e24 0%, #27272c 100%)",borderRadius:16,overflow:"hidden",border:"1px solid rgba(99, 102, 241, 0.3)",position:"relative"},children:[(0,r.jsx)("div",{style:{height:4,background:"linear-gradient(90deg, #6366f1, #a855f7, #ec4899, #6366f1)",backgroundSize:"200% 100%"}}),(0,r.jsxs)("div",{style:{padding:"20px 16px",position:"relative"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:12,marginBottom:16},children:[(0,r.jsx)("div",{style:{width:44,height:44,borderRadius:10,overflow:"hidden",flexShrink:0,boxShadow:"0 4px 16px rgba(99, 102, 241, 0.3)"},children:(0,r.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Rust工具箱",style:{width:"100%",height:"100%",objectFit:"cover"}})}),(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",marginBottom:4},children:[(0,r.jsx)(_,{level:4,style:{margin:0,color:"#fff",fontSize:18},children:ea.name}),(0,r.jsx)(g.A,{color:"purple",style:{margin:0,fontSize:11},children:"限时特惠"})]}),(0,r.jsx)(C,{style:{color:"rgba(255,255,255,0.5)",fontSize:13,display:"block",lineHeight:1.4},children:ea.description})]})]}),ea.features&&ea.features.length>0&&(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:8,padding:14,background:"rgba(255,255,255,0.02)",borderRadius:10,border:"1px solid rgba(255,255,255,0.05)",marginBottom:16},children:ea.features.map((e,t)=>(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,r.jsx)(A.A,{style:{color:"#10b981",fontSize:14,flexShrink:0}}),(0,r.jsx)(C,{style:{color:"rgba(255,255,255,0.85)",fontSize:13},children:e})]},t))}),(0,r.jsxs)("div",{style:{padding:16,background:"linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%)",borderRadius:12,border:"1px solid rgba(99, 102, 241, 0.2)"},children:[(0,r.jsxs)("div",{style:{marginBottom:12},children:[(0,r.jsx)(C,{style:{color:"rgba(255,255,255,0.5)",fontSize:12,display:"block",marginBottom:4},children:"限时优惠价"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[ea.originalPrice&&ea.originalPrice!==ea.price&&(0,r.jsxs)(C,{delete:!0,style:{color:"rgba(255,255,255,0.35)",fontSize:16},children:[ea.originalPrice.toFixed(2)," R币"]}),(0,r.jsx)("span",{style:{color:"#f87171",fontWeight:700,fontSize:28},children:ea.price.toFixed(2)}),(0,r.jsx)("span",{style:{color:"rgba(255,255,255,0.5)",fontSize:14,marginLeft:4},children:"R币"}),(0,r.jsxs)(g.A,{color:"red",style:{margin:0,fontSize:11,marginLeft:8},children:["省 ",((ea.originalPrice||0)-ea.price).toFixed(2)," R币"]})]})]}),(0,r.jsx)(o.Ay,{type:"primary",size:"large",icon:(0,r.jsx)(S.A,{}),loading:E===ea.goods_id,onClick:()=>er(ea),block:!0,style:{height:46,fontSize:15,fontWeight:600,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none",borderRadius:10,boxShadow:"0 4px 16px rgba(99, 102, 241, 0.3)"},children:"立即兑换"})]})]})]}),"score"===U&&(0,r.jsxs)("div",{children:[(0,r.jsx)(d.A,{value:G,onChange:H,block:!0,size:"small",options:[{label:(0,r.jsxs)("span",{children:[(0,r.jsx)(v.A,{style:{marginRight:4}}),"兑换积分"]}),value:"exchange"},{label:(0,r.jsxs)("span",{children:[(0,r.jsx)(w.A,{style:{marginRight:4}}),"变动记录"]}),value:"logs"}],style:{marginBottom:16}}),"exchange"===G&&(0,r.jsxs)(r.Fragment,{children:[W&&(0,r.jsxs)("div",{style:{background:"#27272c",border:"1px solid rgba(245, 158, 11, 0.2)",borderRadius:14,padding:24,marginBottom:20},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[(0,r.jsx)(v.A,{style:{color:"#f59e0b",fontSize:18}}),(0,r.jsx)(C,{style:{color:"#fff",fontWeight:600,fontSize:15},children:"自定义兑换"}),(0,r.jsxs)(g.A,{color:"gold",style:{margin:0},children:["1 R币 = ",W.rate," 积分"]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[(0,r.jsxs)("div",{style:{flex:1,minWidth:200},children:[(0,r.jsx)(h.A,{min:W.min,max:Math.min(W.max,(null==O?void 0:O.balance)||0),value:F,onChange:e=>D(e||W.min),precision:0,style:{width:"100%",height:44},addonAfter:"R币"}),(0,r.jsx)("div",{style:{display:"flex",gap:6,marginTop:8,flexWrap:"wrap"},children:[1,5,10,50].filter(e=>e<=((null==O?void 0:O.balance)||0)&&e<=W.max).map(e=>(0,r.jsx)(g.A,{onClick:()=>D(e),style:{cursor:"pointer",padding:"2px 10px",borderRadius:6,background:F===e?"rgba(245, 158, 11, 0.2)":"rgba(255,255,255,0.05)",border:F===e?"1px solid #f59e0b":"1px solid rgba(255,255,255,0.1)",color:F===e?"#f59e0b":"rgba(255,255,255,0.6)",fontSize:12},children:e},e))})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,r.jsxs)("div",{style:{textAlign:"center"},children:[(0,r.jsx)(C,{style:{color:"rgba(255,255,255,0.5)",fontSize:12},children:"获得"}),(0,r.jsx)("div",{style:{fontSize:28,fontWeight:700,color:"#10b981"},children:F*W.rate}),(0,r.jsx)(C,{style:{color:"rgba(255,255,255,0.5)",fontSize:12},children:"积分"})]}),(0,r.jsx)(o.Ay,{type:"primary",onClick:ei,loading:M,disabled:!O||O.balance<F,style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",height:44},children:"兑换"})]})]})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:12},children:[(0,r.jsx)(j.A,{style:{color:"#10b981",fontSize:16}}),(0,r.jsx)(C,{style:{color:"rgba(255,255,255,0.7)",fontWeight:500},children:"积分套餐"})]}),(0,r.jsx)(p.A,{gutter:[12,12],children:el.map(e=>(0,r.jsx)(x.A,{xs:12,sm:8,children:(0,r.jsxs)("div",{style:{background:"#27272c",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,padding:16,textAlign:"center",cursor:"pointer",transition:"all 0.2s",position:"relative",overflow:"hidden"},onClick:()=>er(e),children:[e.tag&&(0,r.jsx)(g.A,{color:"超值"===e.tag?"red":"orange",style:{position:"absolute",top:8,right:8,margin:0,fontSize:10},children:e.tag}),(0,r.jsx)("div",{style:{fontSize:28,fontWeight:700,color:"#10b981",marginBottom:4},children:e.name.replace("积分\xd7","")}),(0,r.jsx)(C,{style:{color:"rgba(255,255,255,0.5)",fontSize:12,display:"block",marginBottom:12},children:"积分"}),(0,r.jsxs)("div",{children:[e.originalPrice&&e.originalPrice!==e.price&&(0,r.jsx)(C,{delete:!0,style:{color:"rgba(255,255,255,0.35)",fontSize:12,marginRight:6},children:e.originalPrice.toFixed(0)}),(0,r.jsx)("span",{style:{color:"#f87171",fontWeight:600,fontSize:18},children:e.price.toFixed(0)}),(0,r.jsx)("span",{style:{color:"rgba(255,255,255,0.5)",fontSize:11,marginLeft:4},children:"R币"})]})]})},e.goods_id))})]}),"logs"===G&&(0,r.jsx)("div",{style:{background:"#27272c",border:"1px solid rgba(255,255,255,0.08)",borderRadius:12,overflow:"hidden"},children:K?(0,r.jsx)("div",{style:{padding:40,textAlign:"center"},children:(0,r.jsx)(c.A,{})}):0===J.length?(0,r.jsx)(y.A,{image:y.A.PRESENTED_IMAGE_SIMPLE,description:(0,r.jsx)(C,{style:{color:"rgba(255,255,255,0.4)"},children:"暂无积分变动记录"}),style:{padding:"40px 0"}}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.A,{dataSource:J,rowKey:"id",pagination:!1,size:"small",style:{background:"transparent"},columns:[{title:"类型",dataIndex:"changeType",key:"changeType",width:100,render:e=>{let t=P[e]||{label:e,color:"default"};return(0,r.jsx)(g.A,{color:t.color,style:{margin:0},children:t.label})}},{title:"变动",dataIndex:"changeAmount",key:"changeAmount",width:80,render:e=>(0,r.jsxs)("span",{style:{color:e>=0?"#10b981":"#f87171",fontWeight:600},children:[e>=0?"+":"",e]})},{title:"余额",dataIndex:"balanceAfter",key:"balanceAfter",width:80,render:e=>(0,r.jsx)("span",{style:{color:"rgba(255,255,255,0.7)"},children:e})},{title:"原因",dataIndex:"reason",key:"reason",ellipsis:!0,render:e=>(0,r.jsx)("span",{style:{color:"rgba(255,255,255,0.6)",fontSize:13},children:e})},{title:"时间",dataIndex:"createdAt",key:"createdAt",width:150,render:e=>(0,r.jsx)("span",{style:{color:"rgba(255,255,255,0.4)",fontSize:12},children:new Date(e).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})}]}),Q.total>Q.pageSize&&(0,r.jsx)("div",{style:{padding:"12px 16px",borderTop:"1px solid rgba(255,255,255,0.05)",textAlign:"center"},children:(0,r.jsx)(o.Ay,{type:"link",onClick:()=>et(Q.page+1,Q.pageSize),disabled:Q.page*Q.pageSize>=Q.total,style:{color:"#818cf8"},children:"加载更多"})})]})})]})]})}}},e=>{e.O(0,[1721,9326,6083,785,6240,9279,2245,9543,6060,5445,2718,8272,2587,4425,5702,5078,4187,5125,6048,8441,1255,7358],()=>e(e.s=34465)),_N_E=e.O()}]);