(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{37783:(e,t,i)=>{"use strict";i.d(t,{Aq:()=>n,Ay:()=>a});let r="http://localhost:44667";class n{static formatDateTime(e){let t=new Date(e),i=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return"".concat(i,"-").concat(r,"-").concat(n," ").concat(a,":").concat(s)}static async copyToClipboard(e,t){let{onSuccess:i,onError:r}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==i||i(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==i||i(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==i||i(),!0}catch(e){return null==r||r(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(r).concat(e):e.startsWith("/api/")?"".concat(r,"/api/backend").concat(e.slice(4)):"".concat(r).concat(e)}static async backendFetch(e,t){return fetch(n.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,i;let r="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===r.length)return null!=(i=null==(t=r.pop())?void 0:t.split(";").shift())?i:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let a={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},49621:(e,t,i)=>{"use strict";i.d(t,{B:()=>n});class r{emit(e,t){var i;null==(i=this.listeners[e])||i.forEach(e=>e(t))}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){var i;this.listeners[e]=null==(i=this.listeners[e])?void 0:i.filter(e=>e!==t)}constructor(){this.listeners={}}}let n=new r},81788:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var r=i(95155),n=i(12115),a=i(19279),s=i(89543),o=i(785),l=i(15856),c=i(36060),d=i(43561),p=i(44074),x=i(66968),g=i(69522),h=i(2995),u=i(29655),y=i(37783),f=i(49621);let{Title:b,Text:m}=a.A;function j(){var e;let[t,i]=(0,n.useState)(!1),[a,j]=(0,n.useState)(!0),[v,A]=(0,n.useState)(null),[S,w]=(0,n.useState)(null),[k,R]=(0,n.useState)(""),[C,T]=(0,n.useState)(null),{modal:B,message:O}=s.A.useApp();(0,n.useEffect)(()=>{(async()=>{try{let[e,t,i]=await Promise.all([y.Aq.backendFetch("/api/pay/getuserinfo",{method:"POST"}),y.Aq.backendFetch("/api/pay/newuser/getinfo",{method:"POST"}),y.Aq.backendFetch("/api/pay/getrcoininfo",{method:"POST"})]),r=await e.json(),n=await t.json(),a=await i.json();if(200!==r.status)return void T("无法获取用户信息，您可能未登录");if(R(r.data.email||r.data.phone||"未知"),200!==n.status)return void T(n.errmessage||"获取商品信息失败");if(!n.data.canBuy)return void T(n.data.reason||"您不符合购买条件");A(n.data),200===a.status&&w(a.data)}catch(e){console.error("Load data error:",e),T("加载失败，请稍后重试")}finally{j(!1)}})()},[]),(0,n.useEffect)(()=>{let e=e=>{w(t=>t?{...t,balance:e.balance}:{balance:e.balance})};return f.B.on("RCOIN_BALANCE_UPDATED",e),()=>{f.B.off("RCOIN_BALANCE_UPDATED",e)}},[]);let P=async()=>{if(!v||!S)return;let e=v.goods.price/100;if(S.balance<e)return void B.confirm({title:"R币余额不足",content:"购买需要 ".concat(e.toFixed(2)," R币，当前余额 ").concat(S.balance.toFixed(2)," R币"),okText:"去充值",cancelText:"取消",onOk:()=>f.B.emit("OPEN_RCOIN_MODAL",{}),centered:!0});B.confirm({title:"确认购买",content:(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:["商品：",v.goods.name]}),(0,r.jsxs)("p",{children:["价格：",(0,r.jsxs)("span",{style:{color:"#10b981",fontWeight:600},children:[e.toFixed(2)," R币"]})]}),(0,r.jsxs)("p",{style:{color:"rgba(255,255,255,0.5)",fontSize:12},children:["原价 ",(v.goods.originalPrice/100).toFixed(2)," R币，立省 ",(v.goods.discount/100).toFixed(2)," R币"]})]}),okText:"确认购买",cancelText:"取消",centered:!0,onOk:async()=>{i(!0);try{let e=await y.Aq.backendFetch("/api/pay/newuser/rcoin/purchase",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status?(w(e=>e?{...e,balance:t.data.balance_after}:null),f.B.emit("RCOIN_BALANCE_UPDATED",{balance:t.data.balance_after}),z()):O.error(t.errmessage||"购买失败")}catch(e){console.error("Purchase error:",e),O.error("购买失败，请重试")}finally{i(!1)}}})},z=()=>{B.success({icon:null,content:(0,r.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,r.jsx)(p.A,{style:{color:"#10b981",fontSize:"64px",marginBottom:"16px"}}),(0,r.jsx)(b,{level:4,style:{color:"#fff",margin:"0 0 8px 0"},children:"购买成功"}),(0,r.jsx)(m,{style:{color:"rgba(255,255,255,0.6)"},children:"工具箱已激活，感谢您的购买"}),(0,r.jsx)(o.Ay,{type:"primary",style:{marginTop:"24px",width:"100%"},onClick:()=>{l.A.destroyAll(),window.location.href="/admin"},children:"返回控制台"})]}),footer:null,closable:!0,width:360,centered:!0})};if(a)return(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"60vh",gap:"16px"},children:[(0,r.jsx)(c.A,{size:"large"}),(0,r.jsx)(m,{style:{color:"rgba(255,255,255,0.5)"},children:"加载中..."})]});if(C||!v)return(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",color:"rgba(255, 255, 255, 0.85)"},children:(0,r.jsxs)("div",{style:{textAlign:"center"},children:[(0,r.jsx)("h2",{children:C||"无法购买"}),(0,r.jsx)("a",{href:"/admin/pay/products",style:{color:"#10b981"},children:"返回商品列表"})]})});let E=v.goods,_=E.price/100,F=E.originalPrice/100,I=E.discount/100;return(0,r.jsx)("div",{style:{position:"relative"},children:(0,r.jsxs)("div",{style:{position:"relative",zIndex:1,maxWidth:"720px",margin:"0 auto"},children:[(0,r.jsxs)("div",{style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",borderRadius:16,padding:"16px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(m,{style:{color:"rgba(255,255,255,0.7)",fontSize:12},children:"R币余额"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:2},children:[(0,r.jsx)("img",{src:"/Rmoney.ico",alt:"R币",style:{width:24,height:24,borderRadius:"50%"}}),(0,r.jsx)("span",{style:{fontSize:26,fontWeight:700,color:"#fff"},children:(null==S?void 0:S.balance.toFixed(2))||"0.00"})]})]}),(0,r.jsx)(o.Ay,{type:"primary",icon:(0,r.jsx)(x.A,{}),onClick:()=>f.B.emit("OPEN_RCOIN_MODAL",{}),style:{background:"rgba(255,255,255,0.2)",border:"none",height:36,borderRadius:8},children:"充值"})]}),(0,r.jsxs)("div",{style:{background:"linear-gradient(145deg, #1a2e1a 0%, #1b1b1f 100%)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:"20px",overflow:"hidden"},children:[(0,r.jsx)("div",{style:{height:"3px",background:"linear-gradient(90deg, #10b981, #34d399, #10b981)"}}),(0,r.jsxs)("div",{style:{padding:"28px"},children:[(0,r.jsxs)("div",{style:{textAlign:"center",marginBottom:"24px"},children:[(0,r.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"6px 16px",background:"rgba(16, 185, 129, 0.15)",borderRadius:"20px",marginBottom:"12px"},children:[(0,r.jsx)(g.A,{style:{color:"#10b981"}}),(0,r.jsx)(m,{style:{color:"#10b981",fontWeight:600},children:"新用户专享优惠"})]}),(0,r.jsx)(b,{level:4,style:{margin:0,color:"#fff"},children:"确认订单"})]}),(0,r.jsxs)("div",{style:{background:"rgba(16, 185, 129, 0.05)",border:"1px solid rgba(16, 185, 129, 0.15)",borderRadius:"14px",padding:"20px",marginBottom:"24px"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"16px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(m,{style:{color:"rgba(255,255,255,0.5)",fontSize:"13px"},children:"商品名称"}),(0,r.jsx)("div",{style:{color:"#fff",fontWeight:600,fontSize:"16px",marginTop:"4px"},children:E.name})]}),(0,r.jsxs)("div",{style:{textAlign:"right"},children:[(0,r.jsx)(m,{style:{color:"rgba(255,255,255,0.5)",fontSize:"13px"},children:"支付金额"}),(0,r.jsxs)("div",{style:{marginTop:"4px"},children:[(0,r.jsxs)(m,{delete:!0,style:{color:"rgba(255,255,255,0.35)",marginRight:"8px"},children:[F.toFixed(2)," R币"]}),(0,r.jsx)("span",{style:{color:"#10b981",fontWeight:700,fontSize:"24px"},children:_.toFixed(2)}),(0,r.jsx)("span",{style:{color:"rgba(255,255,255,0.5)",fontSize:14,marginLeft:4},children:"R币"})]}),(0,r.jsxs)(d.A,{color:"green",style:{marginTop:"4px"},children:["立省 ",I.toFixed(2)," R币"]})]})]}),(null==(e=E.features)?void 0:e.length)>0&&(0,r.jsxs)("div",{style:{paddingTop:"12px",borderTop:"1px solid rgba(16, 185, 129, 0.1)"},children:[(0,r.jsx)(m,{style:{color:"rgba(255,255,255,0.4)",fontSize:"12px",display:"block",marginBottom:"10px"},children:"包含功能"}),(0,r.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:E.features.map((e,t)=>(0,r.jsxs)(d.A,{style:{background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.2)",color:"#6ee7b7",borderRadius:"6px"},children:[(0,r.jsx)(h.A,{style:{marginRight:"4px"}}),e]},t))})]})]}),(0,r.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,r.jsx)(m,{style:{color:"rgba(255,255,255,0.5)",fontSize:"13px",display:"block",marginBottom:"8px"},children:"充值账号"}),(0,r.jsx)("div",{style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:8,padding:"12px 16px",color:"rgba(255,255,255,0.85)"},children:k})]}),(0,r.jsx)(o.Ay,{type:"primary",size:"large",block:!0,onClick:P,loading:t,icon:(0,r.jsx)(u.A,{}),disabled:!S||S.balance<_,style:{height:"52px",fontSize:"16px",fontWeight:600,borderRadius:"14px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",boxShadow:"0 4px 16px rgba(16, 185, 129, 0.3)"},children:t?"处理中...":"立即兑换 ".concat(_.toFixed(2)," R币")}),S&&S.balance<_&&(0,r.jsx)("div",{style:{textAlign:"center",marginTop:12},children:(0,r.jsxs)(m,{style:{color:"#f87171",fontSize:13},children:["R币余额不足，还需 ",(_-S.balance).toFixed(2)," R币"]})}),(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginTop:"20px",color:"rgba(255,255,255,0.35)",fontSize:"12px"},children:(0,r.jsx)("span",{children:"即时到账 \xb7 如有问题请联系客服"})})]})]})]})})}function v(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"60vh",gap:"16px"},children:[(0,r.jsx)(c.A,{size:"large"}),(0,r.jsx)(m,{style:{color:"rgba(255,255,255,0.5)"},children:"加载中..."})]}),children:(0,r.jsx)(j,{})})}},95371:(e,t,i)=>{Promise.resolve().then(i.bind(i,81788))}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,6060,7907,8441,1255,7358],()=>e(e.s=95371)),_N_E=e.O()}]);