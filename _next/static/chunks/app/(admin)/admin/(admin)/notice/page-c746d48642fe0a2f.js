(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2271],{14728:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var i=r(95155),n=r(88661),a=r.n(n),s=r(12115),o=r(19279),d=r(89543),l=r(43561),c=r(63646),p=r(98946),h=r(36627),g=r(39578),u=r(36060),x=r(19588),m=r(15856),f=r(785),y=r(69522),b=r(96347),j=r(15760),w=r(75442),S=r(8805),A=r(37783),v=r(49621);let{Text:C}=o.A;function k(){let{message:e}=d.A.useApp(),[t,r]=(0,s.useState)(!0),[n,o]=(0,s.useState)([]),[k,N]=(0,s.useState)(0),[T,R]=(0,s.useState)(1),[E,z]=(0,s.useState)(null),[W,O]=(0,s.useState)(null),[M,P]=(0,s.useState)(!1),B=(0,s.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;r(!0);try{let r=await A.Aq.backendFetch("/api/notice/getlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:t,pageSize:20})}),i=await r.json();200===i.status?(o(i.data.list),N(i.data.total),R(t)):e.error(i.errmessage||"获取通知失败")}catch(t){e.error("网络错误")}finally{r(!1)}},[e]);(0,s.useEffect)(()=>{B()},[B]);let D=async e=>{if(O(e),P(!0),!e.isRead)try{let t=await A.Aq.backendFetch("/api/notice/markread",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({noticeType:e.type,noticeId:e.id})}),r=await t.json();200===r.status&&(o(t=>t.map(t=>t.id===e.id&&t.type===e.type?{...t,isRead:!0}:t)),O(e=>e?{...e,isRead:!0}:null),v.B.emit("NOTICE_READ"))}catch(e){console.error("标记已读失败:",e)}},I=async t=>{if(!t.rewardClaimed&&(t.rewardRcoin||t.rewardScore)){z(t.id);try{let r=await A.Aq.backendFetch("/api/notice/claimreward",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({noticeType:t.type,noticeId:t.id})}),i=await r.json();if(200===i.status){let r=i.data.rewards.map(e=>"".concat(e.amount," ").concat("rcoin"===e.type?"R币":"积分")).join(" + ");e.success("领取成功！获得 ".concat(r)),o(e=>e.map(e=>e.id===t.id&&e.type===t.type?{...e,rewardClaimed:!0,isRead:!0}:e)),O(e=>e?{...e,rewardClaimed:!0,isRead:!0}:null)}else e.error(i.errmessage||"领取失败")}catch(t){e.error("网络错误")}finally{z(null)}}},_=e=>e.rewardRcoin&&e.rewardRcoin>0||e.rewardScore&&e.rewardScore>0;return(0,i.jsxs)("div",{style:{padding:"0 0 24px 0"},className:"jsx-dd8150b6150782f1",children:[(0,i.jsx)(a(),{id:"dd8150b6150782f1",children:".notice-item:hover{transform:translatey(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15)}.notice-modal .ant-modal-content{background:#1f1f23;border-radius:16px}.notice-modal .ant-modal-header{background:transparent;border-bottom:1px solid rgba(255,255,255,.08)}.notice-modal .ant-modal-body{padding:24px}.notice-content{color:rgba(255,255,255,.85);line-height:1.8}.notice-content h1,.notice-content h2,.notice-content h3{color:#fff;margin-top:16px;margin-bottom:8px}.notice-content p{margin-bottom:12px}.notice-content code{background:rgba(255,255,255,.1);padding:2px 6px;border-radius:4px}.notice-content pre{background:rgba(0,0,0,.3);padding:12px;border-radius:8px;overflow-x:auto}.notice-content a{color:#6366f1}.notice-content ul,.notice-content ol{padding-left:20px}"}),(0,i.jsx)(g.A,{title:(0,i.jsxs)(c.A,{children:[(0,i.jsx)(b.A,{style:{color:"#6366f1"}}),(0,i.jsx)("span",{className:"jsx-dd8150b6150782f1",children:"站内通知"})]}),style:{background:"#27272c",borderRadius:16,border:"1px solid rgba(255,255,255,0.08)"},styles:{header:{borderBottom:"1px solid rgba(255,255,255,0.08)"},body:{padding:"16px 24px"}},children:t?(0,i.jsx)("div",{style:{textAlign:"center",padding:48},className:"jsx-dd8150b6150782f1",children:(0,i.jsx)(u.A,{size:"large"})}):0===n.length?(0,i.jsx)(x.A,{description:"暂无通知",image:x.A.PRESENTED_IMAGE_SIMPLE,style:{padding:48}}):(0,i.jsx)(p.A,{dataSource:n,renderItem:e=>(0,i.jsx)(p.A.Item,{onClick:()=>D(e),style:{background:e.isRead?"rgba(255,255,255,0.02)":"rgba(99, 102, 241, 0.08)",borderRadius:12,marginBottom:12,padding:"16px 20px",cursor:"pointer",border:e.isRead?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(99, 102, 241, 0.3)",transition:"all 0.2s ease"},className:"notice-item",children:(0,i.jsxs)("div",{style:{width:"100%"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsxs)(c.A,{children:[!e.isRead&&(0,i.jsx)(h.A,{status:"processing"}),(0,i.jsx)(C,{strong:!0,style:{fontSize:15},children:e.title}),_(e)&&!e.rewardClaimed&&(0,i.jsx)(l.A,{color:"orange",style:{marginLeft:4},children:"有奖励"})]}),(0,i.jsx)(C,{type:"secondary",style:{fontSize:12},children:new Date(e.createdAt).toLocaleDateString("zh-CN")})]}),(0,i.jsxs)(C,{type:"secondary",style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:13},children:[e.content.replace(/[#*`\[\]]/g,"").substring(0,80),"..."]})]})},"".concat(e.type,"-").concat(e.id)),pagination:k>20&&{current:T,total:k,pageSize:20,onChange:B,showTotal:e=>"共 ".concat(e," 条"),style:{marginTop:16}}})}),(0,i.jsx)(m.A,{title:null==W?void 0:W.title,open:M,onCancel:()=>P(!1),footer:null,width:600,className:"notice-modal",centered:!0,children:W&&(0,i.jsxs)("div",{className:"jsx-dd8150b6150782f1",children:[(0,i.jsx)("div",{style:{maxHeight:"50vh",overflowY:"auto",marginBottom:20,paddingRight:8},className:"jsx-dd8150b6150782f1 notice-content",children:(e=>{let t=e=>e.split(/(\*\*[^*]+\*\*)/g).map((e,t)=>e.startsWith("**")&&e.endsWith("**")?(0,i.jsx)("strong",{style:{color:"#fff"},children:e.slice(2,-2)},t):e);return e.split("\n").map((e,r)=>{if(e.startsWith("# "))return(0,i.jsx)("h1",{style:{fontSize:20,marginTop:16,marginBottom:12,color:"#fff"},children:e.slice(2)},r);if(e.startsWith("## "))return(0,i.jsx)("h2",{style:{fontSize:17,marginTop:20,marginBottom:10,color:"#fff"},children:e.slice(3)},r);if(e.startsWith("### "))return(0,i.jsx)("h3",{style:{fontSize:15,marginTop:16,marginBottom:8,color:"#fff"},children:e.slice(4)},r);if(e.startsWith("---"))return(0,i.jsx)("hr",{style:{border:"none",borderTop:"1px solid rgba(255,255,255,0.1)",margin:"16px 0"}},r);if(e.startsWith("- "))return(0,i.jsxs)("p",{style:{paddingLeft:16,margin:"4px 0"},children:["• ",t(e.slice(2))]},r);let n=e.match(/^(\d+)\.\s/);return n?(0,i.jsxs)("p",{style:{paddingLeft:16,margin:"4px 0"},children:[n[1],". ",t(e.slice(n[0].length))]},r):""===e.trim()?(0,i.jsx)("div",{style:{height:8}},r):(0,i.jsx)("p",{style:{margin:"4px 0"},children:t(e)},r)})})(W.content)}),(0,i.jsxs)("div",{style:{borderTop:"1px solid rgba(255,255,255,0.08)",paddingTop:16,display:"flex",flexDirection:"column",gap:12},className:"jsx-dd8150b6150782f1",children:[_(W)&&(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(99, 102, 241, 0.1)",padding:"12px 16px",borderRadius:8},className:"jsx-dd8150b6150782f1",children:[(0,i.jsxs)(c.A,{children:[(0,i.jsx)(y.A,{style:{color:"#f59e0b",fontSize:18}}),(0,i.jsx)("span",{className:"jsx-dd8150b6150782f1",children:"附件："}),(e=>{let t=[];return e.rewardRcoin&&e.rewardRcoin>0&&t.push((0,i.jsxs)(l.A,{color:"gold",icon:(0,i.jsx)(y.A,{}),children:["R币 +",e.rewardRcoin]},"rcoin")),e.rewardScore&&e.rewardScore>0&&t.push((0,i.jsxs)(l.A,{color:"blue",icon:(0,i.jsx)(y.A,{}),children:["积分 +",e.rewardScore]},"score")),t.length>0?(0,i.jsx)(c.A,{size:4,children:t}):null})(W)]}),(0,i.jsx)(f.Ay,{type:W.rewardClaimed?"default":"primary",icon:W.rewardClaimed?(0,i.jsx)(j.A,{}):(0,i.jsx)(y.A,{}),disabled:W.rewardClaimed,loading:E===W.id,onClick:()=>I(W),style:W.rewardClaimed?{}:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:W.rewardClaimed?"已领取":"领取奖励"})]}),W.link&&(0,i.jsx)(f.Ay,{type:"default",icon:(0,i.jsx)(w.A,{}),onClick:()=>{var e;(e=W.link).startsWith("http")?window.open(e,"_blank"):window.location.href=e},block:!0,children:"查看详情"}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",color:"rgba(255,255,255,0.45)",fontSize:12},className:"jsx-dd8150b6150782f1",children:[(0,i.jsx)("span",{className:"jsx-dd8150b6150782f1",children:new Date(W.createdAt).toLocaleString("zh-CN")}),(0,i.jsxs)(c.A,{size:4,children:[(0,i.jsx)(S.A,{}),(0,i.jsx)("span",{className:"jsx-dd8150b6150782f1",children:(e=>{let t=new Date().getTime(),r=new Date(e).getTime()-t;if(r<=0)return"即将删除";let i=Math.floor(r/864e5),n=Math.floor(r%864e5/36e5),a=Math.floor(r%36e5/6e4);return i>0?"".concat(i,"天后自动删除"):n>0?"".concat(n,"小时后自动删除"):a>0?"".concat(a,"分钟后自动删除"):"即将删除"})(W.expireAt)})]})]})]})]})})]})}},37783:(e,t,r)=>{"use strict";r.d(t,{Aq:()=>n,Ay:()=>a});let i="https://gateway.rustplus.cn";class n{static formatDateTime(e){let t=new Date(e),r=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"-").concat(i,"-").concat(n," ").concat(a,":").concat(s)}static async copyToClipboard(e,t){let{onSuccess:r,onError:i}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==r||r(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==r||r(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==r||r(),!0}catch(e){return null==i||i(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(i).concat(e):e.startsWith("/api/")?"".concat(i,"/api/backend").concat(e.slice(4)):"".concat(i).concat(e)}static async backendFetch(e,t){return fetch(n.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,r;let i="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===i.length)return null!=(r=null==(t=i.pop())?void 0:t.split(";").shift())?r:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let a={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},49621:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});class i{emit(e,t){var r;null==(r=this.listeners[e])||r.forEach(e=>e(t))}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){var r;this.listeners[e]=null==(r=this.listeners[e])?void 0:r.filter(e=>e!==t)}constructor(){this.listeners={}}}let n=new i},76934:(e,t,r)=>{Promise.resolve().then(r.bind(r,14728))}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,6060,3621,3919,4540,9578,8260,1589,3581,8946,1183,8441,1255,7358],()=>e(e.s=76934)),_N_E=e.O()}]);