(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7148],{37783:(e,t,r)=>{"use strict";r.d(t,{Aq:()=>i,Ay:()=>n});let s=r(95704).env.NEXT_PUBLIC_GATEWAY_URL||"https://gateway.rustplus.cn";class i{static formatDateTime(e){let t=new Date(e),r=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return"".concat(r,"-").concat(s,"-").concat(i," ").concat(n,":").concat(a)}static async copyToClipboard(e,t){let{onSuccess:r,onError:s}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==r||r(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==r||r(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==r||r(),!0}catch(e){return null==s||s(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(s).concat(e):e.startsWith("/api/")?"".concat(s,"/api/backend").concat(e.slice(4)):"".concat(s).concat(e)}static async backendFetch(e,t){return fetch(i.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,r;let s="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===s.length)return null!=(r=null==(t=s.pop())?void 0:t.split(";").shift())?r:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let n={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},50978:(e,t,r)=>{Promise.resolve().then(r.bind(r,82607))},82607:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>B});var s=r(95155);r(92932);var i=r(12115),n=r(19279),a=r(49073),l=r(89543),o=r(39327),d=r(43561),c=r(36060),y=r(69887),p=r(785),h=r(15856),g=r(15702),u=r(39286),x=r(20058),b=r(88795),j=r(74722),m=r(26555),f=r(67153),v=r(56418),w=r(20063),S=r(37783);let{Text:k}=n.A,{TextArea:A}=a.A,C=S.Aq.backendFetch,R=[{key:"GlobalMessageSwitch",label:"全局信息开关",description:"控制是否向游戏服务器发送任何消息。关闭后，所有通知、报时、事件提醒、指令等消息都不会发送到游戏内聊天中。(指令控制偏好除外)",isGlobal:!0},{key:"DeathNotice",label:"死亡通知",description:"在您的角色死亡时，向您注册的邮箱发送一封提示邮件，方便您及时了解角色状态。"}];function B(){let{message:e,modal:t}=l.A.useApp(),[r,n]=(0,i.useState)({GlobalMessageSwitch:null,DeathNotice:null}),[B,T]=(0,i.useState)(!0),[z,E]=(0,i.useState)(null),[P,D]=(0,i.useState)(null),[M,O]=(0,i.useState)(!1),[G,N]=(0,i.useState)(!1),_=(0,w.useRouter)();(0,i.useEffect)(()=>{U()},[]);let U=async()=>{try{T(!0),E(null);let e=await C("/api/f/getpreference",{method:"POST"}),t=await e.json();if(200===t.status){let e=e=>void 0===e||""===e||"false"!==e;n({GlobalMessageSwitch:e(t.data.GlobalMessageSwitch),DeathNotice:e(t.data.DeathNotice)})}else throw Error(t.errmessage||"Failed to fetch preference")}catch(r){let t=r instanceof Error?r.message:"Unknown error occurred";E(t),e.error("获取设置失败: ".concat(t))}finally{T(!1)}},W=async(t,r)=>{try{D(t);let s=await C("/api/f/setpreference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t,value:String(r)})}),i=await s.json();200===i.status?(n(e=>({...e,[t]:r})),e.success("设置已更新")):e.error(i.errmessage||"更新失败")}catch(r){let t=r instanceof Error?r.message:"Unknown error occurred";e.error("更新设置失败: ".concat(t)),U()}finally{D(null)}},I=async()=>{try{O(!0);let t=await C("/api/f/clearuserdata",{method:"POST"}),r=await t.json();200===r.status?(e.success("数据已清空"),N(!1),_.push("/admin")):e.error(r.errmessage||"清空数据失败")}catch(r){let t=r instanceof Error?r.message:"Unknown error occurred";e.error("清空数据失败: ".concat(t))}finally{O(!1)}},[F,L]=(0,i.useState)(!1),[q,Y]=(0,i.useState)("encrypt"),[H,J]=(0,i.useState)(""),[X,K]=(0,i.useState)(""),[Q,V]=(0,i.useState)(""),[Z,$]=(0,i.useState)(!1),ee=async()=>{if(!H.trim())return void e.warning("请输入要处理的文本");try{$(!0),V("");let t="encrypt"===q?"/api/encrypt":"/api/decrypt",r=await fetch("https://xy.rustplus.cn".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:H,...X.trim()?{key:X.trim()}:{}})}),s=await r.json();200===s.status?(V(s.result),e.success("encrypt"===q?"加密成功":"解密成功")):10001===s.status?e.error("参数异常，请检查输入"):10002===s.status?e.error("encrypt"===q?"加密失败":"解密失败，密钥可能不匹配"):429===s.status?e.error("请求过于频繁，请稍后重试"):e.error("操作失败")}catch(t){e.error("网络错误，请稍后重试")}finally{$(!1)}},et=async()=>{Q&&(await S.Aq.copyToClipboard(Q),e.success("已复制到剪贴板"))};return(0,s.jsxs)(i.Fragment,{children:[(0,s.jsx)("div",{style:{padding:24},children:(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16,maxWidth:640},children:[(0,s.jsxs)("div",{style:{padding:16,borderRadius:8,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.06)"},children:[(0,s.jsxs)("div",{style:{marginBottom:12},children:[(0,s.jsx)(k,{strong:!0,style:{fontSize:16},children:"事件通知设置"}),(0,s.jsx)("div",{style:{marginTop:4},children:(0,s.jsx)(k,{type:"secondary",style:{fontSize:12},children:"控制各类游戏事件的通知开关，关闭后将不再收到对应类型的通知。"})})]}),z&&(0,s.jsx)("div",{style:{marginBottom:12},children:(0,s.jsxs)(k,{type:"danger",children:["错误: ",z]})}),R.map((e,t)=>{var n;return(0,s.jsxs)(i.Fragment,{children:[t>0&&(0,s.jsx)(o.A,{style:{margin:"12px 0"}}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:16,...e.isGlobal?{padding:12,background:"rgba(255, 77, 79, 0.1)",borderRadius:8,border:"1px solid rgba(255, 77, 79, 0.3)"}:{}},children:[(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsxs)(k,{strong:!0,style:e.isGlobal?{color:"#ff4d4f"}:void 0,children:[e.label,e.isGlobal&&(0,s.jsx)(d.A,{color:"red",style:{marginLeft:8},children:"重要"})]}),(0,s.jsx)("div",{style:{marginTop:4},children:(0,s.jsx)(k,{type:"secondary",style:{fontSize:12},children:e.description})})]}),(0,s.jsx)("div",{children:B||null===r[e.key]?(0,s.jsx)(c.A,{size:"small"}):(0,s.jsx)(y.A,{checked:null==(n=r[e.key])||n,onChange:t=>W(e.key,t),disabled:null!==P,loading:P===e.key})})]})]},e.key)}),P&&(0,s.jsx)("div",{style:{marginTop:12},children:(0,s.jsx)(k,{type:"secondary",style:{fontSize:12},children:"正在保存设置..."})})]}),(0,s.jsxs)("div",{style:{padding:16,borderRadius:8,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.06)"},children:[(0,s.jsxs)("div",{style:{marginBottom:8},children:[(0,s.jsx)(k,{strong:!0,children:"星曰加密工具"}),(0,s.jsx)("div",{style:{marginTop:4},children:(0,s.jsx)(k,{type:"secondary",style:{fontSize:12},children:"用于在游戏中加密聊天，让队友之间的交流更加私密"})})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,s.jsx)(p.Ay,{type:"primary",icon:(0,s.jsx)(x.A,{}),onClick:()=>L(!0),children:"打开加密工具"}),(0,s.jsx)(p.Ay,{onClick:()=>{window.open("https://www.rustplus.cn/docs/xy.html","_blank")},children:"查看说明文档"})]})]}),(0,s.jsxs)("div",{style:{padding:16,borderRadius:8,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255, 77, 79, 0.2)"},children:[(0,s.jsxs)("div",{style:{marginBottom:12},children:[(0,s.jsx)(k,{strong:!0,style:{color:"#ff4d4f"},children:"数据管理"}),(0,s.jsx)("div",{style:{marginTop:4},children:(0,s.jsxs)(k,{type:"secondary",style:{fontSize:12},children:["清空您的所有数据，包括服务器配置、开关、智能报警、指令逻辑、事件逻辑等。",(0,s.jsx)("br",{}),(0,s.jsx)(k,{type:"warning",style:{fontSize:12},children:"保留项：呼叫组、Rust凭证、用户偏好设置"})]})})]}),(0,s.jsx)(p.Ay,{danger:!0,type:"primary",icon:(0,s.jsx)(b.A,{}),onClick:()=>N(!0),style:{borderRadius:8,height:36,boxShadow:"none"},children:"清空数据"})]})]})}),(0,s.jsx)(h.A,{title:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,s.jsx)(x.A,{style:{color:"#6366f1",fontSize:18}}),(0,s.jsx)("span",{children:"星曰加密工具"})]}),open:F,onCancel:()=>{L(!1),J(""),K(""),V("")},footer:null,centered:!0,width:520,children:(0,s.jsxs)("div",{style:{padding:"8px 0"},children:[(0,s.jsx)("div",{style:{marginBottom:16},children:(0,s.jsx)(g.A,{value:q,onChange:e=>{Y(e),V("")},options:[{label:(0,s.jsxs)("span",{children:[(0,s.jsx)(x.A,{})," 加密"]}),value:"encrypt"},{label:(0,s.jsxs)("span",{children:[(0,s.jsx)(j.A,{})," 解密"]}),value:"decrypt"}],block:!0,style:{marginBottom:8}})}),(0,s.jsxs)("div",{style:{marginBottom:12},children:[(0,s.jsx)(k,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:"encrypt"===q?"要加密的文本":"要解密的星曰密文"}),(0,s.jsx)(A,{value:H,onChange:e=>J(e.target.value),placeholder:"encrypt"===q?"输入要加密的内容...":"输入星曰密文...",autoSize:{minRows:3,maxRows:6},maxLength:9999,showCount:!0,style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:8}})]}),(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)(k,{type:"secondary",style:{fontSize:12,display:"block",marginBottom:4},children:'密钥（选填，不填则使用默认密钥"星标"）'}),(0,s.jsx)(a.A,{value:X,onChange:e=>K(e.target.value),placeholder:"输入自定义密钥...",style:{background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:8}})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:16},children:[(0,s.jsx)(p.Ay,{type:"primary",icon:"encrypt"===q?(0,s.jsx)(x.A,{}):(0,s.jsx)(j.A,{}),onClick:ee,loading:Z,style:{flex:1,height:40,borderRadius:8,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:"encrypt"===q?"加密":"解密"}),Q&&(0,s.jsx)(u.A,{title:"将结果作为输入",children:(0,s.jsx)(p.Ay,{icon:(0,s.jsx)(m.A,{}),onClick:()=>{Q&&(J(Q),V(""))},style:{height:40,borderRadius:8}})})]}),Q&&(0,s.jsxs)("div",{style:{padding:12,borderRadius:8,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.2)"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,s.jsx)(k,{type:"secondary",style:{fontSize:12},children:"encrypt"===q?"加密结果":"解密结果"}),(0,s.jsx)(p.Ay,{type:"link",size:"small",icon:(0,s.jsx)(f.A,{}),onClick:et,style:{padding:0,height:"auto",color:"#10b981"},children:"复制"})]}),(0,s.jsx)("div",{style:{padding:10,borderRadius:6,background:"rgba(0,0,0,0.2)",wordBreak:"break-all",maxHeight:150,overflowY:"auto"},children:(0,s.jsx)(k,{style:{color:"#6ee7b7"},children:Q})})]}),(0,s.jsx)("div",{style:{marginTop:16,padding:10,borderRadius:6,background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.15)"},children:(0,s.jsx)(k,{type:"secondary",style:{fontSize:12},children:"\uD83D\uDCA1 提示：解密时需要使用与加密时相同的密钥，否则无法正确解密。"})})]})}),(0,s.jsx)(h.A,{title:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,s.jsx)(v.A,{style:{color:"#ff4d4f",fontSize:20}}),(0,s.jsx)("span",{children:"确认清空数据"})]}),open:G,onCancel:()=>N(!1),footer:[(0,s.jsx)(p.Ay,{onClick:()=>N(!1),style:{borderRadius:6,boxShadow:"none"},children:"取消"},"cancel"),(0,s.jsx)(p.Ay,{danger:!0,type:"primary",loading:M,onClick:I,style:{borderRadius:6,boxShadow:"none"},children:"确认清空"},"confirm")],centered:!0,width:420,children:(0,s.jsxs)("div",{style:{padding:"16px 0"},children:[(0,s.jsx)("div",{style:{padding:16,borderRadius:8,background:"rgba(255, 77, 79, 0.1)",border:"1px solid rgba(255, 77, 79, 0.2)",marginBottom:16},children:(0,s.jsx)(k,{strong:!0,style:{color:"#ff4d4f"},children:"⚠️ 此操作不可恢复！"})}),(0,s.jsx)(k,{style:{display:"block",marginBottom:12},children:"此操作将清空以下数据："}),(0,s.jsxs)("ul",{style:{paddingLeft:20,margin:"8px 0",color:"rgba(255,255,255,0.85)"},children:[(0,s.jsx)("li",{children:"服务器配置"}),(0,s.jsx)("li",{children:"所有配对设备"}),(0,s.jsx)("li",{children:"指令逻辑"}),(0,s.jsx)("li",{children:"事件逻辑"}),(0,s.jsx)("li",{children:"智能报警设置"})]}),(0,s.jsx)("div",{style:{padding:12,borderRadius:8,background:"rgba(250, 173, 20, 0.1)",border:"1px solid rgba(250, 173, 20, 0.2)",marginTop:16},children:(0,s.jsx)(k,{style:{color:"#faad14"},children:"保留项：呼叫组、Rust凭证、偏好设置、用户页设置"})})]})})]})}}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,6060,9073,5702,8473,8441,1255,7358],()=>e(e.s=50978)),_N_E=e.O()}]);