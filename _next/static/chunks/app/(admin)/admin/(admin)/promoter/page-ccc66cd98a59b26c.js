(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9369],{3899:(e,t,n)=>{Promise.resolve().then(n.bind(n,67310))},37783:(e,t,n)=>{"use strict";n.d(t,{Aq:()=>r,Ay:()=>a});let i=n(95704).env.NEXT_PUBLIC_GATEWAY_URL||"https://gateway.rustplus.cn";class r{static formatDateTime(e){let t=new Date(e),n=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return"".concat(n,"-").concat(i,"-").concat(r," ").concat(a,":").concat(l)}static async copyToClipboard(e,t){let{onSuccess:n,onError:i}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==n||n(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==n||n(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==n||n(),!0}catch(e){return null==i||i(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(i).concat(e):e.startsWith("/api/")?"".concat(i,"/api/backend").concat(e.slice(4)):"".concat(i).concat(e)}static async backendFetch(e,t){return fetch(r.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,n;let i="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===i.length)return null!=(n=null==(t=i.pop())?void 0:t.split(";").shift())?n:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let a={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},67310:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>_});var i=n(95155);n(92932);var r=n(12115),a=n(19279),l=n(89543),s=n(39578),o=n(19588),c=n(63646),d=n(43561),u=n(36060),h=n(54540),p=n(97416),y=n(785),x=n(31744),j=n(44187),m=n(15856),A=n(91442),g=n(49073),w=n(45125),v=n(35782),k=n(2995),f=n(32051),S=n(46172),C=n(67153),b=n(45400),I=n(93652),T=n(94229),P=n(20276),O=n(67641),E=n(79),z=n(69522);let{backendFetch:L}=n(37783).Aq,{Text:N,Title:M}=a.A,U="https://cap.rustplus.cn/336bfb3b1a/";function _(){let{message:e,modal:t}=l.A.useApp(),[n,a]=(0,r.useState)(!0),[M,_]=(0,r.useState)(null),[D,W]=(0,r.useState)([]),[F,B]=(0,r.useState)([]),[J,K]=(0,r.useState)([]),[q,G]=(0,r.useState)(0),[R,Y]=(0,r.useState)("info"),[H,X]=(0,r.useState)(!1),[Q,V]=(0,r.useState)(!1),[Z,$]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(""),[en,ei]=(0,r.useState)(!1),[er,ea]=(0,r.useState)(!1),[el,es]=(0,r.useState)(0),[eo,ec]=(0,r.useState)(!1),[ed,eu]=(0,r.useState)(!1),[eh,ep]=(0,r.useState)(""),[ey,ex]=(0,r.useState)(null),[ej,em]=(0,r.useState)(!1),[eA,eg]=(0,r.useState)(!1),[ew,ev]=(0,r.useState)(!1),[ek,ef]=(0,r.useState)(0),[eS,eC]=(0,r.useState)(!1),eb=r.useRef(null);(0,r.useEffect)(()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:U});e.addEventListener("progress",e=>{ef(e.detail.progress||0)}),eb.current=e,ev(!0);return}let e=document.createElement("script");e.src="/cap-widget.js",e.async=!0,e.onload=()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:U});e.addEventListener("progress",e=>{ef(e.detail.progress||0)}),eb.current=e,ev(!0)}},document.head.appendChild(e)},[]);let eI=(0,r.useCallback)(async()=>{if(!ew||!eb.current)return e.error("人机验证组件未加载完成"),null;try{return eC(!0),ef(0),(await eb.current.solve()).token}catch(t){return e.error("人机验证失败"),null}finally{eC(!1),ef(0)}},[ew,e]),eT=(0,r.useCallback)(async()=>{try{a(!0);let e=await L("/api/promoter/getinfo",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status?_(t.data):_(null)}catch(t){e.error("获取信息失败")}finally{a(!1)}},[e]),eP=(0,r.useCallback)(async()=>{try{let e=await L("/api/promoter/getinvitees",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status&&W(t.data.list||[])}catch(t){e.error("获取邀请列表失败")}},[e]),eO=(0,r.useCallback)(async()=>{if((null==M?void 0:M.level)==="one")try{let e=await L("/api/promoter/getsubordinates",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status&&B(t.data.list||[])}catch(t){e.error("获取下属列表失败")}},[null==M?void 0:M.level,e]),eE=(0,r.useCallback)(async()=>{try{let e=await L("/api/promoter/getbonusrecords",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:1,pageSize:50})}),t=await e.json();200===t.status&&(K(t.data.list||[]),G(t.data.total||0))}catch(t){e.error("获取奖金记录失败")}},[e]);(0,r.useEffect)(()=>{eT()},[eT]),(0,r.useEffect)(()=>{(null==M?void 0:M.level)&&(eP(),eE(),"one"===M.level&&eO())},[null==M?void 0:M.level,eP,eO,eE]);let ez=async()=>{X(!0);try{let t=await L("/api/promoter/generatecode",{method:"POST",headers:{"Content-Type":"application/json"}}),n=await t.json();200===n.status?(e.success("邀请码生成成功"),eT()):e.error(n.errmessage||"生成失败")}catch(t){e.error("生成失败")}finally{X(!1)}},eL=async()=>{if(!ee.trim())return void e.warning("请输入昵称");ei(!0);try{let t=await L("/api/promoter/setnickname",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:ee.trim()})}),n=await t.json();200===n.status?(e.success("昵称修改成功"),$(!1),eT()):e.error(n.errmessage||"修改失败")}catch(t){e.error("修改失败")}finally{ei(!1)}},eN=async()=>{ec(!0);try{let t=await L("/api/promoter/settwoshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:el})}),n=await t.json();200===n.status?(e.success("分成金额设置成功"),ea(!1),eT()):e.error(n.errmessage||"设置失败")}catch(t){e.error("设置失败")}finally{ec(!1)}},eM=async()=>{if(!eh.trim())return void e.warning("请输入手机号或邮箱");let t=await eI();if(t){em(!0),ex(null);try{let n=await L("/api/promoter/searchuser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:eh.trim(),capToken:t})}),i=await n.json();200===i.status?ex(i.data):e.error(i.errmessage||"搜索失败")}catch(t){e.error("搜索失败")}finally{em(!1)}}},eU=async()=>{ey&&t.confirm({title:"确认设置",content:'确定要将用户 "'.concat(ey.nickname,'" 设置为您的二级宣发人员吗？此操作不可撤销。'),onOk:async()=>{eg(!0);try{let t=await L("/api/promoter/settwo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:ey.id})}),n=await t.json();200===n.status?(e.success("设置成功，已向该用户发送邀请通知"),eu(!1),ex(null),ep(""),eO()):e.error(n.errmessage||"设置失败")}catch(t){e.error("设置失败")}finally{eg(!1)}}})},e_=async()=>{t.confirm({title:"确认晋升",content:"确定要申请晋升为一级宣发人员吗？",onOk:async()=>{try{let t=await L("/api/promoter/upgrade",{method:"POST",headers:{"Content-Type":"application/json"}}),n=await t.json();200===n.status?(e.success("晋升成功！"),eT()):e.error(n.errmessage||"晋升失败")}catch(t){e.error("晋升失败")}}})},eD=e=>e?new Date(e).toLocaleString("zh-CN"):"-";if(!n&&(!M||!M.level))return(0,i.jsx)(s.A,{children:(0,i.jsx)(o.A,{description:(0,i.jsxs)(c.A,{direction:"vertical",align:"center",children:[(0,i.jsx)(N,{children:"您还不是宣发人员"}),(0,i.jsx)(N,{type:"secondary",children:"请联系管理员开通宣发权限"})]})})});let eW=[{title:"用户ID",dataIndex:"id",key:"id",width:80},{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"注册时间",dataIndex:"createdAt",key:"createdAt",render:eD},{title:"购买状态",dataIndex:"hasPurchased",key:"hasPurchased",render:e=>e?(0,i.jsx)(d.A,{color:"success",icon:(0,i.jsx)(k.A,{}),children:"已购买"}):(0,i.jsx)(d.A,{color:"default",icon:(0,i.jsx)(f.A,{}),children:"未购买"})},{title:"购买时间",dataIndex:"purchasedAt",key:"purchasedAt",render:e=>e?eD(e):"-"}],eF=[{title:"用户ID",dataIndex:"id",key:"id",width:80},{title:"昵称",dataIndex:"nickname",key:"nickname"},{title:"成为二级时间",dataIndex:"promotedAt",key:"promotedAt",render:eD},{title:"邀请人数",dataIndex:"inviteCount",key:"inviteCount"},{title:"成交人数",dataIndex:"purchaseCount",key:"purchaseCount"}],eB=(null==M?void 0:M.inviteCode)?"".concat(window.location.origin,"/invite?code=").concat(M.inviteCode):"";return(0,i.jsxs)(u.A,{spinning:n,children:[(0,i.jsx)(h.A,{activeKey:R,onChange:Y,items:[{key:"info",label:"个人信息",children:(0,i.jsxs)(c.A,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,i.jsx)(s.A,{title:"宣发信息",children:(0,i.jsxs)(p.A,{column:{xs:1,sm:2},bordered:!0,size:"small",children:[(0,i.jsx)(p.A.Item,{label:"当前等级",children:(0,i.jsx)(d.A,{color:(null==M?void 0:M.level)==="one"?"gold":"blue",children:(null==M?void 0:M.level)==="one"?"一级宣发":"二级宣发"})}),(0,i.jsx)(p.A.Item,{label:"昵称",children:(0,i.jsxs)(c.A,{children:[(0,i.jsx)(N,{children:null==M?void 0:M.nickname}),(0,i.jsx)(y.Ay,{type:"link",size:"small",icon:(0,i.jsx)(S.A,{}),onClick:()=>{et((null==M?void 0:M.nickname)||""),$(!0)},children:"修改"})]})}),(0,i.jsx)(p.A.Item,{label:"成为当前等级时间",children:eD((null==M?void 0:M.promotedAt)||"")}),(0,i.jsx)(p.A.Item,{label:"奖金余额",children:(0,i.jsxs)(N,{strong:!0,style:{color:"#f5222d"},children:["\xa5",(((null==M?void 0:M.bonusBalance)||0)/100).toFixed(2)]})}),(null==M?void 0:M.level)==="one"&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.A.Item,{label:"二级分成金额",children:(0,i.jsxs)(c.A,{children:[(0,i.jsxs)(N,{children:["\xa5",(((null==M?void 0:M.twoShareAmount)||0)/100).toFixed(2),"/单"]}),(0,i.jsx)(y.Ay,{type:"link",size:"small",icon:(0,i.jsx)(S.A,{}),onClick:()=>{es((null==M?void 0:M.twoShareAmount)||0),ea(!0)},children:"设置"})]})}),(0,i.jsx)(p.A.Item,{label:"团队业绩",children:(0,i.jsxs)(N,{strong:!0,children:[(null==M?void 0:M.teamPerformance)||0," 人"]})})]})]})}),(0,i.jsx)(s.A,{title:"邀请码",children:(null==M?void 0:M.inviteCode)?(0,i.jsxs)(c.A,{direction:"vertical",style:{width:"100%"},children:[(0,i.jsx)(c.A,{children:(0,i.jsxs)(N,{copyable:{text:M.inviteCode},children:["邀请码: ",(0,i.jsx)(N,{strong:!0,code:!0,children:M.inviteCode})]})}),(0,i.jsxs)(c.A,{wrap:!0,children:[(0,i.jsx)(y.Ay,{icon:(0,i.jsx)(C.A,{}),onClick:()=>{if(!(null==M?void 0:M.inviteCode))return;let t="".concat(window.location.origin,"/invite?code=").concat(M.inviteCode);navigator.clipboard.writeText(t),e.success("邀请链接已复制")},children:"复制邀请链接"}),(0,i.jsx)(y.Ay,{icon:(0,i.jsx)(b.A,{}),onClick:()=>V(!0),children:"查看二维码"})]})]}):(0,i.jsxs)(c.A,{direction:"vertical",children:[(0,i.jsx)(N,{type:"secondary",children:"您还没有邀请码"}),(0,i.jsx)(y.Ay,{type:"primary",icon:(0,i.jsx)(I.A,{}),loading:H,onClick:ez,children:"生成邀请码"})]})}),(null==M?void 0:M.level)==="two"&&(0,i.jsx)(s.A,{title:"晋升为一级",children:M.upgradeProgress&&(0,i.jsxs)(c.A,{direction:"vertical",style:{width:"100%"},children:[(0,i.jsx)(x.A,{title:"当前进度",value:M.upgradeProgress.current,suffix:"/ ".concat(M.upgradeProgress.required)}),(0,i.jsxs)(N,{type:"secondary",children:["剩余 ",M.upgradeProgress.daysLeft," 天完成目标"]}),M.canUpgrade&&(0,i.jsx)(y.Ay,{type:"primary",icon:(0,i.jsx)(T.A,{}),onClick:e_,children:"申请晋升"})]})}),(null==M?void 0:M.level)==="one"&&(0,i.jsx)(s.A,{title:"邀请二级宣发",children:(0,i.jsx)(y.Ay,{type:"primary",icon:(0,i.jsx)(P.A,{}),onClick:()=>eu(!0),children:"搜索用户并设置为二级"})})]})},{key:"invitees",label:(0,i.jsxs)(c.A,{children:[(0,i.jsx)(I.A,{}),"邀请列表",(0,i.jsx)(d.A,{children:D.length})]}),children:(0,i.jsx)(s.A,{title:"我邀请的用户",extra:(0,i.jsx)(y.Ay,{icon:(0,i.jsx)(O.A,{}),onClick:eP,children:"刷新"}),children:(0,i.jsx)(j.A,{dataSource:D,columns:eW,rowKey:"id",pagination:{pageSize:10}})})},...(null==M?void 0:M.level)==="one"?[{key:"subordinates",label:(0,i.jsxs)(c.A,{children:[(0,i.jsx)(E.A,{}),"下属二级",(0,i.jsx)(d.A,{children:F.length})]}),children:(0,i.jsx)(s.A,{title:"我的下属二级宣发",extra:(0,i.jsx)(y.Ay,{icon:(0,i.jsx)(O.A,{}),onClick:eO,children:"刷新"}),children:(0,i.jsx)(j.A,{dataSource:F,columns:eF,rowKey:"id",pagination:{pageSize:10}})})}]:[],{key:"bonus",label:(0,i.jsxs)(c.A,{children:[(0,i.jsx)(z.A,{}),"奖金记录",(0,i.jsx)(d.A,{children:q})]}),children:(0,i.jsx)(s.A,{title:"奖金变动记录",extra:(0,i.jsx)(y.Ay,{icon:(0,i.jsx)(O.A,{}),onClick:eE,children:"刷新"}),children:(0,i.jsx)(j.A,{dataSource:J,columns:[{title:"金额",dataIndex:"amount",key:"amount",render:e=>(0,i.jsxs)(N,{style:{color:e>0?"#52c41a":"#f5222d"},children:[e>0?"+":"",(e/100).toFixed(2)]})},{title:"类型",dataIndex:"typeLabel",key:"typeLabel"},{title:"来源用户",dataIndex:"sourceUserNickname",key:"sourceUserNickname",render:e=>e||"-"},{title:"时间",dataIndex:"createdAt",key:"createdAt",render:eD}],rowKey:"id",pagination:{pageSize:10}})})}]}),(0,i.jsx)(m.A,{title:"邀请二维码",open:Q,onCancel:()=>V(!1),footer:null,centered:!0,children:(0,i.jsxs)("div",{style:{textAlign:"center",padding:20},children:[eB&&(0,i.jsx)(A.A,{value:eB,size:200}),(0,i.jsx)("div",{style:{marginTop:16},children:(0,i.jsx)(N,{type:"secondary",children:"扫描二维码注册"})})]})}),(0,i.jsx)(m.A,{title:"修改昵称",open:Z,onCancel:()=>$(!1),onOk:eL,confirmLoading:en,children:(0,i.jsx)(g.A,{placeholder:"请输入新昵称",value:ee,onChange:e=>et(e.target.value),maxLength:20})}),(0,i.jsx)(m.A,{title:"设置二级分成金额",open:er,onCancel:()=>ea(!1),onOk:eN,confirmLoading:eo,children:(0,i.jsxs)(c.A,{direction:"vertical",style:{width:"100%"},children:[(0,i.jsx)(N,{type:"secondary",children:"设置您的下属二级宣发人员每单可获得的分成金额（分）"}),(0,i.jsx)(w.A,{style:{width:"100%"},min:0,max:1500,value:el,onChange:e=>es(e||0),addonAfter:"分"}),(0,i.jsxs)(N,{type:"secondary",children:["当前设置: \xa5",(el/100).toFixed(2),"/单"]})]})}),(0,i.jsx)(m.A,{title:"搜索用户",open:ed,onCancel:()=>{eu(!1),ex(null),ep("")},footer:null,width:500,children:(0,i.jsxs)(c.A,{direction:"vertical",style:{width:"100%"},size:"middle",children:[eS&&(0,i.jsxs)("div",{style:{textAlign:"center",padding:"12px 0"},children:[(0,i.jsx)(N,{type:"secondary",children:"正在进行人机验证..."}),(0,i.jsx)(v.A,{percent:Math.round(100*ek),size:"small"})]}),(0,i.jsx)(g.A.Search,{placeholder:"输入手机号或邮箱搜索",value:eh,onChange:e=>ep(e.target.value),onSearch:eM,loading:ej||eS,enterButton:"搜索"}),ey&&(0,i.jsxs)(s.A,{size:"small",children:[(0,i.jsxs)(p.A,{column:1,size:"small",children:[(0,i.jsx)(p.A.Item,{label:"用户ID",children:ey.id}),(0,i.jsx)(p.A.Item,{label:"昵称",children:ey.nickname}),(0,i.jsx)(p.A.Item,{label:"当前等级",children:"one"===ey.group?(0,i.jsx)(d.A,{color:"gold",children:"一级宣发"}):"two"===ey.group?(0,i.jsx)(d.A,{color:"blue",children:"二级宣发"}):(0,i.jsx)(d.A,{children:"普通用户"})})]}),"one"!==ey.group&&"two"!==ey.group&&(0,i.jsx)(y.Ay,{type:"primary",block:!0,style:{marginTop:12},loading:eA,onClick:eU,children:"设置为我的二级宣发"}),("one"===ey.group||"two"===ey.group)&&(0,i.jsx)(N,{type:"warning",style:{display:"block",marginTop:12},children:"该用户已是宣发人员，无法重复设置"})]})]})})]})}}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,6060,5445,4540,9578,9073,2718,8272,2587,4425,5078,4187,5125,5904,6458,943,8441,1255,7358],()=>e(e.s=3899)),_N_E=e.O()}]);