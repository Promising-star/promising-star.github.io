(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7529],{6201:(e,t,a)=>{"use strict";a.d(t,{A:()=>u});var r=a(95155),n=a(12115),i=a(3415),l=a(15856),s=a(36060),o=a(35078),d=a(98946),c=a(43561),m=a(37783),h=a(50886);let p=m.Aq.backendFetch,u=e=>{let{open:t,onConfirm:a,onCancel:m,defaultValue:u=[],maxSelect:g=1/0}=e,[y,x]=(0,n.useState)(!0),[j,A]=(0,n.useState)([]),[v,f]=(0,n.useState)(u),I=(0,h.I)();(0,n.useEffect)(()=>{t&&(S(),f(u))},[t]);let S=async()=>{try{x(!0);let e=await p("/api/f/getswitchlist",{method:"POST"}),t=await e.json();if(200===t.status)A(t.data.list);else throw Error("获取开关列表失败")}catch(e){i.Ay.error("获取开关列表失败"),console.error(e)}finally{x(!1)}};return(0,r.jsx)(l.A,{title:"选择开关",open:t,onOk:()=>{let e=j.filter(e=>v.includes(e.id));a(v,e)},onCancel:m,width:I?"90vw":500,centered:!0,okText:"确认",cancelText:"取消",children:(0,r.jsx)("div",{className:"switch-selector",children:y?(0,r.jsx)(s.A,{tip:"加载中..."}):(0,r.jsxs)(r.Fragment,{children:[g<1/0&&(0,r.jsxs)("div",{style:{marginBottom:16,color:"#666"},children:["已选择 ",v.length,"/",g," 个"]}),(0,r.jsx)(o.A.Group,{value:v,onChange:e=>{if(e.length>g)return void i.Ay.warning("最多只能选择 ".concat(g," 个选项"));f(e)},style:{width:"100%"},children:(0,r.jsx)(d.A,{dataSource:j,renderItem:e=>{let t;return(0,r.jsx)(d.A.Item,{children:(0,r.jsx)(o.A,{value:e.id,disabled:(t=e.id,v.length>=g&&!v.includes(t)),children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r.jsx)("span",{style:{marginRight:8},children:e.name}),e.note&&(0,r.jsx)(c.A,{color:e.noteColor,children:e.note})]})})})}})})]})})})}},26351:(e,t,a)=>{Promise.resolve().then(a.bind(a,97937))},37783:(e,t,a)=>{"use strict";a.d(t,{Aq:()=>n,Ay:()=>i});let r=a(70636).env.NEXT_PUBLIC_GATEWAY_URL||"https://gateway.rustplus.cn";class n{static formatDateTime(e){let t=new Date(e),a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(n," ").concat(i,":").concat(l)}static async copyToClipboard(e,t){let{onSuccess:a,onError:r}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==a||a(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==a||a(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==a||a(),!0}catch(e){return null==r||r(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")?"".concat(r).concat(e):e.startsWith("/api/")?"".concat(r,"/api/backend").concat(e.slice(4)):"".concat(r).concat(e)}static async backendFetch(e,t){return fetch(n.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,a;let r="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===r.length)return null!=(a=null==(t=r.pop())?void 0:t.split(";").shift())?a:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let i={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},50886:(e,t,a)=>{"use strict";a.d(t,{I:()=>n});var r=a(12115);let n=()=>{let[e,t]=(0,r.useState)(()=>window.innerWidth<768);return(0,r.useEffect)(()=>{let e=()=>{t(window.innerWidth<768)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}},74984:(e,t,a)=>{"use strict";a.d(t,{Y:()=>l});var r=a(12115);let n=[9,12,15],i=()=>{let e=Math.floor((window.innerWidth-280)/320);return e<=2?9:3===e?12:15},l=e=>{let t="pageSize_"+e,[a,l]=(0,r.useState)(()=>{let e=localStorage.getItem(t);if(e){let t=parseInt(e,10);if(n.includes(t))return t}return i()}),[s,o]=(0,r.useState)(()=>null!==localStorage.getItem(t));return(0,r.useEffect)(()=>{if(s)return;let e=()=>{l(i())};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[s]),{pageSize:a,setPageSize:(0,r.useCallback)(e=>{n.includes(e)&&(l(e),o(!0),localStorage.setItem(t,e.toString()))},[t]),isCustom:s,resetToAdaptive:(0,r.useCallback)(()=>{localStorage.removeItem(t),o(!1),l(i())},[t]),pageSizeOptions:n}}},97937:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>tm});var r=a(95155),n=a(12115),i=a(89543),l=a(86133),s=a(785),o=a(36060),d=a(19588),c=a(43561),m=a(69887),h=a(84549),p=a(91589),u=a(59103),g=a(66968),y=a(48601),x=a(49960),j=a(67242),A=a(95873),v=a(46172),f=a(88795),I=a(74984),S=a(37783),T=a(6201),b=a(3415),E=a(15856),w=a(35078),k=a(98946);let C=S.Aq.backendFetch,N=e=>{let{open:t,onConfirm:a,onCancel:i,defaultValue:l=[],maxSelect:s=1/0}=e,[d,m]=(0,n.useState)(!0),[h,p]=(0,n.useState)([]),[u,g]=(0,n.useState)(l);(0,n.useEffect)(()=>{t&&(y(),g(l))},[t]);let y=async()=>{try{m(!0);let e=await C("/api/f/getsmartalarmlist",{method:"POST"}),t=await e.json();if(200===t.status)p(t.data.list);else throw Error("获取警报列表失败")}catch(e){b.Ay.error("获取警报列表失败"),console.error(e)}finally{m(!1)}};return(0,r.jsx)(E.A,{title:"选择警报",open:t,onOk:()=>a(u),onCancel:i,width:"30vw",centered:!0,okText:"确认",cancelText:"取消",children:(0,r.jsx)("div",{className:"switch-selector",children:d?(0,r.jsx)(o.A,{tip:"加载中..."}):(0,r.jsxs)(r.Fragment,{children:[s<1/0&&(0,r.jsxs)("div",{style:{marginBottom:16,color:"#666"},children:["已选择 ",u.length,"/",s," 个"]}),(0,r.jsx)(w.A.Group,{value:u,onChange:e=>{if(e.length>s)return void b.Ay.warning("最多只能选择 ".concat(s," 个选项"));g(e)},style:{width:"100%"},children:(0,r.jsx)(k.A,{dataSource:h,renderItem:e=>{let t;return(0,r.jsx)(k.A.Item,{children:(0,r.jsx)(w.A,{value:e.id,disabled:(t=e.id,u.length>=s&&!u.includes(t)),children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r.jsx)("span",{style:{marginRight:8},children:e.name}),e.note&&(0,r.jsx)(c.A,{color:e.noteColor,children:e.note})]})})})}})})]})})})};var M=a(50886);let O=S.Aq.backendFetch,_=e=>{if(!e||0===e.length)return 0;let t=0;for(let a of e)a.includes("@")?t+=.5:t+=3;return Math.round(100*t)/100},P=e=>{let{open:t,onConfirm:a,onCancel:l,defaultValue:s=[],maxSelect:d=1/0}=e,{message:m}=i.A.useApp(),[h,u]=(0,n.useState)(!0),[g,y]=(0,n.useState)([]),[x,j]=(0,n.useState)(s),A=(0,M.I)(),[v,f]=(0,n.useState)({current:1,pageSize:10,total:0});(0,n.useEffect)(()=>{t&&(I(),j(s))},[t,v.current,v.pageSize]);let I=async()=>{try{u(!0);let e=await O("/api/f/getcallgrouplist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:v.current,pageSize:v.pageSize})}),t=await e.json();if(200===t.status)y(t.data.list),f(e=>({...e,total:t.data.total,current:t.data.currentPage,pageSize:t.data.pageSize}));else throw Error("获取呼叫组列表失败")}catch(e){m.error("获取呼叫组列表失败"),console.error(e)}finally{u(!1)}};return(0,r.jsx)(E.A,{title:"选择呼叫组",open:t,onOk:()=>{let e=g.filter(e=>x.includes(e.id));a(x,e)},onCancel:l,width:A?"90vw":500,centered:!0,okText:"确认",cancelText:"取消",children:(0,r.jsx)("div",{className:"callgroup-selector",children:h?(0,r.jsx)(o.A,{tip:"加载中..."}):(0,r.jsxs)(r.Fragment,{children:[d<1/0&&(0,r.jsxs)("div",{style:{marginBottom:16,color:"#666"},children:["已选择 ",x.length,"/",d," 个"]}),(0,r.jsx)(w.A.Group,{value:x,onChange:e=>{if(e.length>d)return void m.warning("最多只能选择 ".concat(d," 个选项"));j(e)},style:{width:"100%"},children:(0,r.jsx)(k.A,{dataSource:g,renderItem:e=>{let t,a=_(e.value);return(0,r.jsx)(k.A.Item,{children:(0,r.jsx)(w.A,{value:e.id,disabled:(t=e.id,x.length>=d&&!x.includes(t)),children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r.jsxs)("span",{style:{marginRight:8},children:[e.name,(0,r.jsxs)("span",{style:{color:"#999",marginLeft:4},children:["(",a,"积分)"]})]}),e.note&&(0,r.jsx)(c.A,{color:e.noteColor||"blue",children:e.note})]})})})}})}),(0,r.jsx)("div",{style:{marginTop:16,textAlign:"right"},children:(0,r.jsx)(p.A,{current:v.current,pageSize:v.pageSize,total:v.total,onChange:(e,t)=>{f(a=>({...a,current:e,pageSize:t}))},showSizeChanger:!0,pageSizeOptions:["10","20","30","50"],showTotal:e=>"共 ".concat(e," 条")})})]})})})};var R=a(19279),L=a(49073),F=a(45125),z=a(23608),G=a(39327),D=a(44425),B=a(26555),H=a(87480),W=a(57544),V=a(15702),Y=a(39578),q=a(63646),U=a(32587);let{Text:K}=R.A,J=Array.from({length:24},(e,t)=>({label:"".concat(t,"点"),value:t})),Q=Array.from({length:60},(e,t)=>({label:"".concat(t,"分"),value:t}));[0,15,30,45].map(e=>({label:"".concat(e,"分"),value:e}));let $=[{label:"周一",value:1},{label:"周二",value:2},{label:"周三",value:3},{label:"周四",value:4},{label:"周五",value:5},{label:"周六",value:6},{label:"周日",value:7}],X={hourMode:"every",hours:[],minuteMode:"fixed",minutes:[0]};function Z(e){let{value:t,onChange:a,timeType:i="real"}=e,l=(null==t?void 0:t.mode)==="advanced"?"advanced":"simple",s="simple"===l&&(null==t?void 0:t.timestr)||"",o="advanced"===l?t.advanced:X,d=(0,n.useMemo)(()=>{if(!t)return"";if("simple"===l){let e=t.timestr;return e?"每天 ".concat(e," 触发"):""}let e=t.advanced,a=[];if(e.weekdays&&e.weekdays.length>0&&e.weekdays.length<7){let t=["","周一","周二","周三","周四","周五","周六","周日"],r=[...e.weekdays].sort((e,t)=>e-t);5===r.length&&"1,2,3,4,5"===r.join(",")?a.push("工作日"):2===r.length&&"6,7"===r.join(",")?a.push("周末"):a.push(r.map(e=>t[e]).join("、"))}else a.push("每天");switch(e.hourMode){case"every":a.push("每小时");break;case"fixed":1===e.hours.length?a.push("".concat(e.hours[0],"点")):e.hours.length>0&&a.push("".concat(e.hours.sort((e,t)=>e-t).join("、"),"点"));break;case"range":var r,n;a.push("".concat(null!=(r=e.hourStart)?r:0,"-").concat(null!=(n=e.hourEnd)?n:23,"点"));break;case"interval":a.push("每".concat(e.hourInterval||1,"小时"))}switch(e.minuteMode){case"every":a.push("每分钟");break;case"fixed":1===e.minutes.length&&0===e.minutes[0]?a.push("整点"):e.minutes.length>0&&a.push("".concat(e.minutes.sort((e,t)=>e-t).join("、"),"分"));break;case"interval":a.push("每".concat(e.minuteInterval||15,"分钟"))}return a.join(" ")+" 触发"},[t,l]);return(0,r.jsxs)("div",{children:[(0,r.jsx)(V.A,{value:l,onChange:e=>{"simple"===e?null==a||a({mode:"simple",timestr:s||"10:00"}):null==a||a({mode:"advanced",advanced:o})},options:[{label:"简单模式",value:"simple"},{label:"高级模式",value:"advanced"}],style:{marginBottom:16}}),"simple"===l?(0,r.jsx)(ee,{value:s,onChange:e=>{null==a||a({mode:"simple",timestr:e})},timeType:i}):(0,r.jsx)(et,{config:o,onChange:e=>{let t={...o,...e};null==a||a({mode:"advanced",advanced:t})},timeType:i}),d&&(0,r.jsx)(z.A,{type:"info",message:"预览: ".concat(d),style:{marginTop:16}})]})}function ee(e){let{value:t,onChange:a,timeType:i}=e,[l,s]=(0,n.useMemo)(()=>{if(!t)return[10,0];let e=t.split(":");return[parseInt(e[0])||10,parseInt(e[1])||0]},[t]);return(0,r.jsx)(Y.A,{size:"small",title:"real"===i?"现实时间":"游戏时间",children:(0,r.jsxs)(q.A,{children:[(0,r.jsx)(F.A,{min:0,max:23,value:l,onChange:e=>{a("".concat(null!=e?e:0,":").concat(s.toString().padStart(2,"0")))},addonAfter:"时",style:{width:100}}),(0,r.jsx)(F.A,{min:0,max:59,value:s,onChange:e=>{a("".concat(l,":").concat((null!=e?e:0).toString().padStart(2,"0")))},addonAfter:"分",style:{width:100}})]})})}function et(e){var t,a,n,i;let{config:l,onChange:s,timeType:o}=e,d=e=>{switch(e){case"all":s({weekdays:[1,2,3,4,5,6,7]});break;case"workday":s({weekdays:[1,2,3,4,5]});break;case"weekend":s({weekdays:[6,7]});break;case"clear":s({weekdays:[]})}};return(0,r.jsxs)(q.A,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,r.jsx)(Y.A,{size:"small",title:"小时设置",children:(0,r.jsx)(U.Ay.Group,{value:l.hourMode,onChange:e=>{var t,a,r;let n=e.target.value,i={hourMode:n};"fixed"===n&&0===l.hours.length&&(i.hours=[10]),"range"===n&&(i.hourStart=null!=(t=l.hourStart)?t:8,i.hourEnd=null!=(a=l.hourEnd)?a:18),"interval"===n&&(i.hourInterval=null!=(r=l.hourInterval)?r:2),s(i)},children:(0,r.jsxs)(q.A,{direction:"vertical",children:[(0,r.jsx)(U.Ay,{value:"every",children:"每小时"}),(0,r.jsx)(U.Ay,{value:"fixed",children:(0,r.jsxs)(q.A,{children:["指定小时","fixed"===l.hourMode&&(0,r.jsx)(u.A,{mode:"multiple",style:{minWidth:200},placeholder:"选择小时",value:l.hours,onChange:e=>s({hours:e}),options:J,maxTagCount:5,onClick:e=>e.stopPropagation()})]})}),(0,r.jsx)(U.Ay,{value:"range",children:(0,r.jsxs)(q.A,{children:["小时范围","range"===l.hourMode&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.A,{min:0,max:23,value:null!=(t=l.hourStart)?t:8,onChange:e=>s({hourStart:null!=e?e:0}),style:{width:70},onClick:e=>e.stopPropagation()}),(0,r.jsx)(K,{children:"到"}),(0,r.jsx)(F.A,{min:0,max:23,value:null!=(a=l.hourEnd)?a:18,onChange:e=>s({hourEnd:null!=e?e:23}),style:{width:70},onClick:e=>e.stopPropagation()}),(0,r.jsx)(K,{children:"点"})]})]})}),(0,r.jsx)(U.Ay,{value:"interval",children:(0,r.jsxs)(q.A,{children:["每隔","interval"===l.hourMode&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.A,{min:1,max:12,value:null!=(n=l.hourInterval)?n:2,onChange:e=>s({hourInterval:null!=e?e:1}),style:{width:70},onClick:e=>e.stopPropagation()}),(0,r.jsx)(K,{children:"小时"})]})]})})]})})}),(0,r.jsx)(Y.A,{size:"small",title:"分钟设置",children:(0,r.jsx)(U.Ay.Group,{value:l.minuteMode,onChange:e=>{let t=e.target.value,a={minuteMode:t};if("fixed"===t&&0===l.minutes.length&&(a.minutes=[0]),"interval"===t){var r;a.minuteInterval=null!=(r=l.minuteInterval)?r:15}s(a)},children:(0,r.jsxs)(q.A,{direction:"vertical",children:[(0,r.jsx)(U.Ay,{value:"fixed",children:(0,r.jsxs)(q.A,{children:["指定分钟","fixed"===l.minuteMode&&(0,r.jsx)(u.A,{mode:"multiple",style:{minWidth:200},placeholder:"选择分钟",value:l.minutes,onChange:e=>s({minutes:e}),options:Q,maxTagCount:5,onClick:e=>e.stopPropagation()})]})}),(0,r.jsx)(U.Ay,{value:"every",children:"每分钟"}),(0,r.jsx)(U.Ay,{value:"interval",children:(0,r.jsxs)(q.A,{children:["每隔","interval"===l.minuteMode&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.A,{min:1,max:30,value:null!=(i=l.minuteInterval)?i:15,onChange:e=>s({minuteInterval:null!=e?e:15}),style:{width:70},onClick:e=>e.stopPropagation()}),(0,r.jsx)(K,{children:"分钟"})]})]})})]})})}),"real"===o&&(0,r.jsx)(Y.A,{size:"small",title:"星期限制（可选）",children:(0,r.jsxs)(q.A,{direction:"vertical",style:{width:"100%"},children:[(0,r.jsx)(w.A.Group,{options:$,value:l.weekdays||[],onChange:e=>s({weekdays:e})}),(0,r.jsxs)(q.A,{children:[(0,r.jsx)(K,{type:"secondary",children:"快捷选择:"}),(0,r.jsx)("a",{onClick:()=>d("all"),children:"全选"}),(0,r.jsx)("a",{onClick:()=>d("workday"),children:"工作日"}),(0,r.jsx)("a",{onClick:()=>d("weekend"),children:"周末"}),(0,r.jsx)("a",{onClick:()=>d("clear"),children:"清空"})]}),(0,r.jsx)(K,{type:"secondary",children:"不选择则表示每天都触发"})]})})]})}var ea=a(8805),er=a(76448),en=a(43990),ei=a(91255),el=a(82353),es=a(79),eo=a(52492),ed=a(82854),ec=a(79630),em=a(52965),eh=a(20276);let{Text:ep}=R.A,eu=[{value:1,name:"现实时间",description:"当现实世界到达指定时间时触发",keywords:["时间","定时","现实"]},{value:2,name:"游戏时间",description:"当游戏内时间到达指定时间时触发",keywords:["时间","游戏","白天","黑夜"]},{value:3,name:"警报通电",description:"当指定警报设备通电时触发",keywords:["警报","通电"]},{value:4,name:"警报断电",description:"当指定警报设备断电时触发",keywords:["警报","断电"]},{value:5,name:"开关被破坏",description:"当指定开关被破坏时触发",keywords:["开关","破坏"]},{value:6,name:"开关被开启",description:"当指定开关被开启时触发",keywords:["开关","开启"]},{value:7,name:"开关被关闭",description:"当指定开关被关闭时触发",keywords:["开关","关闭"]},{value:8,name:"玩家上线(全服)",description:"当指定玩家上线时触发（检测全服）",keywords:["玩家","上线"]},{value:9,name:"玩家下线(全服)",description:"当指定玩家下线时触发（检测全服）",keywords:["玩家","下线"]},{value:10,name:"货船进入地图",description:"当货船进入地图时触发",keywords:["货船","进入"]},{value:11,name:"货船停靠港口",description:"当货船停靠港口时触发",keywords:["货船","停靠"]},{value:12,name:"货船离开地图",description:"当货船离开地图时触发",keywords:["货船","离开"]},{value:13,name:"武装直升机进入",description:"当武装直升机进入地图时触发",keywords:["直升机","武装","进入"]},{value:14,name:"武装直升机被击落",description:"当武装直升机被击落时触发",keywords:["直升机","武装","击落"]},{value:15,name:"武装直升机离开",description:"当武装直升机离开地图时触发",keywords:["直升机","武装","离开"]},{value:16,name:"军用直升机进入",description:"当军用运输直升机进入地图时触发",keywords:["直升机","军用","CH47"]},{value:17,name:"重装科学家-小石油",description:"当军用直升机在小石油平台触发重装科学家时触发",keywords:["直升机","小石油","重装"]},{value:18,name:"重装科学家-大石油",description:"当军用直升机在大石油平台触发重装科学家时触发",keywords:["直升机","大石油","重装"]},{value:19,name:"流浪商人出现",description:"当流浪商人出现在地图上时触发",keywords:["商人","流浪","出现"]},{value:20,name:"流浪商人停留",description:"当流浪商人停留时触发",keywords:["商人","流浪","停留"]},{value:21,name:"流浪商人离开",description:"当流浪商人离开地图时触发",keywords:["商人","流浪","离开"]},{value:22,name:"新售货机出现",description:"当新的自动售货机出现时触发",keywords:["售货机","自动","出现"]},{value:23,name:"小石油箱子解锁",description:"当小石油平台的箱子解锁时触发",keywords:["石油","小石油","箱子"]},{value:24,name:"大石油箱子解锁",description:"当大石油平台的箱子解锁时触发",keywords:["石油","大石油","箱子"]},{value:25,name:"队友上线",description:"当队友上线时触发",keywords:["队友","上线"]},{value:26,name:"队友下线",description:"当队友下线时触发",keywords:["队友","下线"]},{value:27,name:"队友死亡",description:"当队友死亡时触发",keywords:["队友","死亡"]},{value:28,name:"队友重生",description:"当队友重生时触发",keywords:["队友","重生"]},{value:35,name:"队友挂机",description:"当队友在指定时间内未移动时触发",keywords:["队友","挂机"]},{value:29,name:"货船航行中",description:"货船正在航行时持续触发",keywords:["货船","航行","持续"]},{value:30,name:"武装直升机巡逻中",description:"武装直升机正在巡逻时持续触发",keywords:["直升机","巡逻","持续"]},{value:31,name:"军用直升机飞行中",description:"军用直升机正在飞行时持续触发",keywords:["直升机","飞行","持续"]},{value:32,name:"军用直升机在石油平台",description:"军用直升机在石油平台时持续触发",keywords:["直升机","石油","持续"]},{value:33,name:"流浪商人移动中",description:"流浪商人正在移动时持续触发",keywords:["商人","移动","持续"]},{value:34,name:"流浪商人停留中",description:"流浪商人正在停留时持续触发",keywords:["商人","停留","持续"]},{value:36,name:"物品数量高于阈值",description:"当存储监视器中指定物品数量高于设定值时触发",keywords:["存储","监视器","物品","阈值","数量"]},{value:37,name:"物品数量变化",description:"当存储监视器中指定物品数量发生变化时触发",keywords:["存储","监视器","物品","变化"]},{value:38,name:"指定物品清空",description:"当存储监视器中指定物品数量变为0时触发",keywords:["存储","监视器","物品","清空"]},{value:39,name:"容器完全清空",description:"当存储监视器检测到容器内所有物品被清空时触发",keywords:["存储","监视器","容器","清空"]},{value:40,name:"容器已满",description:"当存储监视器检测到容器格子数已满时触发",keywords:["存储","监视器","容器","已满"]},{value:41,name:"监视器离线",description:"当存储监视器离线或被破坏时触发",keywords:["存储","监视器","离线","破坏"]},{value:42,name:"工具柜维护时间",description:"当工具柜剩余维护时间小于/大于指定值时触发",keywords:["工具柜","维护","时间","TC"]}],eg=[{key:"basic",label:"基础触发",icon:(0,r.jsx)(ea.A,{}),events:eu.filter(e=>[1,2,3,4,5,6,7,8,9].includes(e.value))},{key:"cargo",label:"货船事件",icon:(0,r.jsx)(er.A,{}),events:eu.filter(e=>[10,11,12].includes(e.value))},{key:"heli",label:"直升机事件",icon:(0,r.jsx)(en.A,{}),events:eu.filter(e=>[13,14,15,16,17,18].includes(e.value))},{key:"vendor",label:"商人/售货机",icon:(0,r.jsx)(ei.A,{}),events:eu.filter(e=>[19,20,21,22].includes(e.value))},{key:"oil",label:"石油平台",icon:(0,r.jsx)(el.A,{}),events:eu.filter(e=>[23,24].includes(e.value))},{key:"teammate",label:"队友事件",icon:(0,r.jsx)(es.A,{}),events:eu.filter(e=>[25,26,27,28,35].includes(e.value))},{key:"continuous",label:"持续播报",icon:(0,r.jsx)(eo.A,{}),events:eu.filter(e=>[29,30,31,32,33,34].includes(e.value))},{key:"storage",label:"存储监视器",icon:(0,r.jsx)(ed.A,{}),events:eu.filter(e=>[36,37,38,39,40,41,42].includes(e.value))}],ey=e=>{let{value:t,onChange:a}=e,[i,l]=(0,n.useState)(!1),[s,o]=(0,n.useState)(""),[m,h]=(0,n.useState)(null),p=(0,M.I)(),u=(0,n.useMemo)(()=>{var e;return(null==(e=eu.find(e=>e.value===t))?void 0:e.name)||""},[t]),g=(0,n.useMemo)(()=>{if(!s.trim())return null;let e=s.toLowerCase().trim();return eu.filter(t=>t.name.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.keywords.some(t=>t.toLowerCase().includes(e)))},[s]),y=eg.find(e=>e.key===m),x=g||(null==y?void 0:y.events)||[],j=e=>{null==a||a(e),l(!1),o(""),h(null)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.A,{placeholder:"请选择触发类型",readOnly:!0,value:u,onClick:()=>l(!0),style:{cursor:"pointer"},suffix:(0,r.jsx)(eh.A,{style:{color:"#999"}})}),(0,r.jsxs)(E.A,{title:p&&m&&!s?null==y?void 0:y.label:"选择事件类型",open:i,onCancel:()=>{l(!1),o(""),h(null)},footer:null,width:p?"100%":680,style:p?{top:0,margin:0,maxWidth:"100vw"}:void 0,styles:p?{body:{padding:"12px"}}:void 0,destroyOnClose:!0,children:[(0,r.jsx)(L.A,{placeholder:"搜索事件类型...",prefix:(0,r.jsx)(eh.A,{}),value:s,onChange:e=>o(e.target.value),allowClear:!0,style:{marginBottom:12},autoFocus:!p}),p?s?(0,r.jsxs)("div",{children:[(0,r.jsxs)(ep,{type:"secondary",style:{marginBottom:8,display:"block",fontSize:12},children:["找到 ",(null==g?void 0:g.length)||0," 个结果"]}),g&&0===g.length?(0,r.jsx)(d.A,{description:"没有找到匹配的事件类型",image:d.A.PRESENTED_IMAGE_SIMPLE}):null==g?void 0:g.map(e=>(0,r.jsxs)("div",{onClick:()=>j(e.value),className:"event-type-item ".concat(t===e.value?"selected":""),style:{padding:"12px",marginBottom:6,borderRadius:6,cursor:"pointer",border:t===e.value?"1px solid rgba(22, 119, 255, 0.4)":"1px solid transparent"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)(ep,{style:{color:t===e.value?"#1677ff":"inherit",fontWeight:t===e.value?500:400,fontSize:15},children:e.name}),t===e.value&&(0,r.jsx)(c.A,{color:"processing",style:{margin:0},children:"已选择"})]}),(0,r.jsx)(ep,{type:"secondary",style:{fontSize:13},children:e.description})]},e.value))]}):m?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{onClick:()=>h(null),style:{display:"flex",alignItems:"center",gap:8,padding:"8px 0",marginBottom:12,cursor:"pointer",color:"#1677ff"},children:[(0,r.jsx)(em.A,{})," ",(0,r.jsx)("span",{children:"返回分类"})]}),(0,r.jsx)("div",{children:x.map(e=>(0,r.jsxs)("div",{onClick:()=>j(e.value),className:"event-type-item ".concat(t===e.value?"selected":""),style:{padding:"12px",marginBottom:6,borderRadius:6,cursor:"pointer",border:t===e.value?"1px solid rgba(22, 119, 255, 0.4)":"1px solid transparent"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)(ep,{style:{color:t===e.value?"#1677ff":"inherit",fontWeight:t===e.value?500:400,fontSize:15},children:e.name}),t===e.value&&(0,r.jsx)(c.A,{color:"processing",style:{margin:0},children:"已选择"})]}),(0,r.jsx)(ep,{type:"secondary",style:{fontSize:13},children:e.description})]},e.value))})]}):(0,r.jsx)("div",{children:eg.map(e=>(0,r.jsxs)("div",{onClick:()=>h(e.key),className:"event-category-item",style:{padding:"14px 16px",marginBottom:8,borderRadius:8,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,r.jsx)("span",{style:{fontSize:18},children:e.icon}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontSize:15,fontWeight:500},children:e.label}),(0,r.jsxs)(ep,{type:"secondary",style:{fontSize:12},children:[e.events.length," 个事件"]})]})]}),(0,r.jsx)(ec.A,{style:{color:"rgba(255,255,255,0.3)"}})]},e.key))}):(0,r.jsxs)("div",{style:{display:"flex",gap:12,minHeight:380},children:[(0,r.jsx)("div",{style:{width:140,flexShrink:0,borderRight:"1px solid rgba(255,255,255,0.1)",paddingRight:12},children:eg.map(e=>(0,r.jsxs)("div",{onClick:()=>{h(e.key),o("")},className:"event-category-item ".concat(m!==e.key||s?"":"active"),style:{padding:"10px 12px",marginBottom:4,borderRadius:6,cursor:"pointer",display:"flex",alignItems:"center",gap:8,fontWeight:m!==e.key||s?400:500},children:[e.icon,(0,r.jsx)("span",{style:{fontSize:13},children:e.label.replace("事件","").replace("触发","")})]},e.key))}),(0,r.jsxs)("div",{style:{flex:1,overflow:"auto"},children:[s&&(0,r.jsxs)(ep,{type:"secondary",style:{marginBottom:8,display:"block",fontSize:12},children:["找到 ",(null==g?void 0:g.length)||0," 个结果"]}),m||s?0===x.length?(0,r.jsx)(d.A,{description:"没有找到匹配的事件类型",image:d.A.PRESENTED_IMAGE_SIMPLE}):x.map(e=>(0,r.jsxs)("div",{onClick:()=>j(e.value),className:"event-type-item ".concat(t===e.value?"selected":""),style:{padding:"10px 12px",marginBottom:6,borderRadius:6,cursor:"pointer",border:t===e.value?"1px solid rgba(22, 119, 255, 0.4)":"1px solid transparent"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)(ep,{style:{color:t===e.value?"#1677ff":"inherit",fontWeight:t===e.value?500:400,fontSize:14},children:e.name}),t===e.value&&(0,r.jsx)(c.A,{color:"processing",style:{margin:0},children:"已选择"})]}),(0,r.jsx)(ep,{type:"secondary",style:{fontSize:12},children:e.description})]},e.value)):(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"rgba(255,255,255,0.4)"},children:"请选择左侧分类"})]})]})]})]})},{Option:ex}=u.A,{Text:ej}=R.A;var eA=function(e){return e[e.REAL_TIME=1]="REAL_TIME",e[e.PLAY_TIME=2]="PLAY_TIME",e[e.ALARM_POWER_ON=3]="ALARM_POWER_ON",e[e.ALARM_POWER_OFF=4]="ALARM_POWER_OFF",e[e.SWITCH_DESTROYED=5]="SWITCH_DESTROYED",e[e.SWITCH_TURNED_ON=6]="SWITCH_TURNED_ON",e[e.SWITCH_TURNED_OFF=7]="SWITCH_TURNED_OFF",e[e.PLAYER_ONLINE=8]="PLAYER_ONLINE",e[e.PLAYER_OFFLINE=9]="PLAYER_OFFLINE",e[e.CARGO_SHIP_ENTER=10]="CARGO_SHIP_ENTER",e[e.CARGO_SHIP_DOCKED=11]="CARGO_SHIP_DOCKED",e[e.CARGO_SHIP_LEFT=12]="CARGO_SHIP_LEFT",e[e.PATROL_HELI_ENTER=13]="PATROL_HELI_ENTER",e[e.PATROL_HELI_DOWN=14]="PATROL_HELI_DOWN",e[e.PATROL_HELI_LEFT=15]="PATROL_HELI_LEFT",e[e.CH47_ENTER=16]="CH47_ENTER",e[e.CH47_OIL_RIG_SMALL=17]="CH47_OIL_RIG_SMALL",e[e.CH47_OIL_RIG_LARGE=18]="CH47_OIL_RIG_LARGE",e[e.VENDOR_APPEAR=19]="VENDOR_APPEAR",e[e.VENDOR_HALT=20]="VENDOR_HALT",e[e.VENDOR_LEFT=21]="VENDOR_LEFT",e[e.VENDING_NEW=22]="VENDING_NEW",e[e.OIL_CRATE_SMALL=23]="OIL_CRATE_SMALL",e[e.OIL_CRATE_LARGE=24]="OIL_CRATE_LARGE",e[e.TEAMMATE_ONLINE=25]="TEAMMATE_ONLINE",e[e.TEAMMATE_OFFLINE=26]="TEAMMATE_OFFLINE",e[e.TEAMMATE_DEATH=27]="TEAMMATE_DEATH",e[e.TEAMMATE_RESPAWN=28]="TEAMMATE_RESPAWN",e[e.CARGO_SHIP_MOVING=29]="CARGO_SHIP_MOVING",e[e.PATROL_HELI_PATROLLING=30]="PATROL_HELI_PATROLLING",e[e.CH47_FLYING=31]="CH47_FLYING",e[e.CH47_AT_OIL_RIG=32]="CH47_AT_OIL_RIG",e[e.VENDOR_MOVING=33]="VENDOR_MOVING",e[e.VENDOR_STAYING=34]="VENDOR_STAYING",e[e.TEAMMATE_AFK=35]="TEAMMATE_AFK",e[e.STORAGE_ITEM_ABOVE_THRESHOLD=36]="STORAGE_ITEM_ABOVE_THRESHOLD",e[e.STORAGE_ITEM_CHANGED=37]="STORAGE_ITEM_CHANGED",e[e.STORAGE_ITEM_EMPTY=38]="STORAGE_ITEM_EMPTY",e[e.STORAGE_CONTAINER_EMPTY=39]="STORAGE_CONTAINER_EMPTY",e[e.STORAGE_CONTAINER_FULL=40]="STORAGE_CONTAINER_FULL",e[e.STORAGE_MONITOR_OFFLINE=41]="STORAGE_MONITOR_OFFLINE",e[e.TC_UPKEEP_TIME=42]="TC_UPKEEP_TIME",e}({}),ev=function(e){return e[e.SWITCH=1]="SWITCH",e[e.CALL=2]="CALL",e[e.MESSAGE=3]="MESSAGE",e}({});let ef={1:{name:"现实时间",description:"当现实世界到达指定时间时触发\n检测间隔 5秒",variables:[{key:"time",label:"游戏时间",example:"10:00"},{key:"daynight",label:"白天/黑夜",example:"白天"},{key:"event",label:"下一事件",example:"日落"},{key:"until",label:"距离下一事件",example:"15分钟"}],hasTriggerParam:!0},2:{name:"游戏时间",description:"当游戏内时间到达指定时间时触发\n检测间隔 5秒",variables:[{key:"time",label:"游戏时间",example:"10:00"},{key:"daynight",label:"白天/黑夜",example:"白天"},{key:"event",label:"下一事件",example:"日落"},{key:"until",label:"距离下一事件",example:"15分钟"}],hasTriggerParam:!0},3:{name:"警报通电",description:"当指定警报设备通电时触发\n实时检测",variables:[],hasTriggerParam:!0},4:{name:"警报断电",description:"当指定警报设备断电时触发\n实时检测",variables:[],hasTriggerParam:!0},5:{name:"开关被破坏",description:"当指定开关被破坏时触发\n检测间隔 5秒",variables:[],hasTriggerParam:!0},6:{name:"开关被开启",description:"当指定开关被开启时触发\n实时检测",variables:[],hasTriggerParam:!0},7:{name:"开关被关闭",description:"当指定开关被关闭时触发\n实时检测",variables:[],hasTriggerParam:!0},8:{name:"玩家上线(全服)",description:"当指定玩家上线时触发（检测全服）\n约1分钟延迟，部分服务器可能无法使用",variables:[{key:"name",label:"玩家名",example:"PlayerName"}],hasTriggerParam:!0},9:{name:"玩家下线(全服)",description:"当指定玩家下线时触发（检测全服）\n约1分钟延迟，部分服务器可能无法使用",variables:[{key:"name",label:"玩家名",example:"PlayerName"}],hasTriggerParam:!0},10:{name:"货船进入地图",description:"当货船进入地图时触发",variables:[{key:"pos",label:"位置",example:"D5"}]},11:{name:"货船停靠港口",description:"当货船停靠港口时触发",variables:[{key:"pos",label:"位置",example:"G8"},{key:"harbor",label:"港口",example:"港口 G8"}]},12:{name:"货船离开地图",description:"当货船离开地图时触发",variables:[{key:"pos",label:"最后位置",example:"A3"}]},13:{name:"武装直升机进入",description:"当武装直升机进入地图时触发",variables:[{key:"pos",label:"位置",example:"E6"}]},14:{name:"武装直升机被击落",description:"当武装直升机被击落时触发",variables:[{key:"pos",label:"坠落位置",example:"F7"}]},15:{name:"武装直升机离开",description:"当武装直升机离开地图时触发",variables:[{key:"pos",label:"最后位置",example:"H2"}]},16:{name:"军用直升机进入",description:"当军用运输直升机进入地图时触发",variables:[{key:"pos",label:"位置",example:"C4"}]},17:{name:"重装科学家-小石油",description:"当军用直升机在小石油平台触发重装科学家时触发",variables:[{key:"pos",label:"小石油位置",example:"B2"}]},18:{name:"重装科学家-大石油",description:"当军用直升机在大石油平台触发重装科学家时触发",variables:[{key:"pos",label:"大石油位置",example:"J9"}]},19:{name:"流浪商人出现",description:"当流浪商人出现在地图上时触发",variables:[{key:"pos",label:"位置",example:"D7"}]},20:{name:"流浪商人停留",description:"当流浪商人停留时触发",variables:[{key:"pos",label:"停留位置",example:"E5"}]},21:{name:"流浪商人离开",description:"当流浪商人离开地图时触发",variables:[{key:"pos",label:"最后位置",example:"F3"}]},22:{name:"新售货机出现",description:"当新的自动售货机出现时触发",variables:[{key:"pos",label:"位置",example:"G6"},{key:"name",label:"店名",example:"武器商店"},{key:"items",label:"商品列表",example:"AK47x1=废料 x100"}]},23:{name:"小石油箱子解锁",description:"当小石油平台的箱子解锁时触发",variables:[{key:"pos",label:"小石油位置",example:"B2"}]},24:{name:"大石油箱子解锁",description:"当大石油平台的箱子解锁时触发",variables:[{key:"pos",label:"大石油位置",example:"J9"}]},25:{name:"队友上线",description:"当队友上线时触发",variables:[{key:"name",label:"队友名",example:"PlayerName"},{key:"pos",label:"位置",example:"E5"}],hasTriggerParam:!0,triggerParamLabel:"指定队友(可选)",triggerParamPlaceholder:"留空则匹配所有队友",triggerParamRequired:!1},26:{name:"队友下线",description:"当队友下线时触发",variables:[{key:"name",label:"队友名",example:"PlayerName"},{key:"pos",label:"最后位置",example:"F6"}],hasTriggerParam:!0,triggerParamLabel:"指定队友(可选)",triggerParamPlaceholder:"留空则匹配所有队友",triggerParamRequired:!1},27:{name:"队友死亡",description:"当队友死亡时触发",variables:[{key:"name",label:"队友名",example:"PlayerName"},{key:"pos",label:"死亡位置",example:"G7"}],hasTriggerParam:!0,triggerParamLabel:"指定队友(可选)",triggerParamPlaceholder:"留空则匹配所有队友",triggerParamRequired:!1},28:{name:"队友重生",description:"当队友重生时触发",variables:[{key:"name",label:"队友名",example:"PlayerName"},{key:"pos",label:"重生位置",example:"H8"}],hasTriggerParam:!0,triggerParamLabel:"指定队友(可选)",triggerParamPlaceholder:"留空则匹配所有队友",triggerParamRequired:!1},29:{name:"货船航行中",description:"货船正在航行时持续触发（每2分钟检测一次）\n需要至少2分钟冷却时间",variables:[{key:"pos",label:"当前位置",example:"D5"}]},30:{name:"武装直升机巡逻中",description:"武装直升机正在巡逻时持续触发（每2分钟检测一次）\n需要至少2分钟冷却时间",variables:[{key:"pos",label:"当前位置",example:"E6"}]},31:{name:"军用直升机飞行中",description:"军用直升机正在飞行时持续触发（每2分钟检测一次）\n需要至少2分钟冷却时间",variables:[{key:"pos",label:"当前位置",example:"C4"}]},32:{name:"军用直升机在石油平台",description:"军用直升机在石油平台时持续触发（每2分钟检测一次）\n需要至少2分钟冷却时间",variables:[{key:"pos",label:"石油平台位置",example:"B2"},{key:"type",label:"石油平台类型",example:"小石油/大石油"}]},33:{name:"流浪商人移动中",description:"流浪商人正在移动时持续触发（每2分钟检测一次）\n需要至少2分钟冷却时间",variables:[{key:"pos",label:"当前位置",example:"D7"}]},34:{name:"流浪商人停留中",description:"流浪商人正在停留时持续触发（每2分钟检测一次）\n需要至少2分钟冷却时间",variables:[{key:"pos",label:"停留位置",example:"E5"}]},35:{name:"队友挂机",description:"当队友在指定时间内未移动时触发\n检测间隔 5秒\n支持开始挂机/结束挂机两种触发条件",variables:[{key:"name",label:"队友名",example:"PlayerName"},{key:"pos",label:"位置",example:"E5"},{key:"duration",label:"挂机时长",example:"5分钟"}],hasTriggerParam:!0},36:{name:"物品数量高于阈值",description:"当存储监视器中指定物品数量高于设定值时触发\n实时检测",variables:[{key:"itemName",label:"物品名称",example:"硫磺"},{key:"currentQuantity",label:"当前数量",example:"1500"}],hasTriggerParam:!0},37:{name:"物品数量变化",description:"当存储监视器中指定物品数量发生变化时触发\n实时检测",variables:[{key:"itemName",label:"物品名称",example:"硫磺"},{key:"prevQuantity",label:"变化前数量",example:"1000"},{key:"currentQuantity",label:"当前数量",example:"1500"},{key:"change",label:"变化量",example:"+500"}],hasTriggerParam:!0},38:{name:"指定物品清空",description:"当存储监视器中指定物品数量变为0时触发\n实时检测",variables:[{key:"itemName",label:"物品名称",example:"硫磺"}],hasTriggerParam:!0},39:{name:"容器完全清空",description:"当存储监视器检测到容器内所有物品被清空时触发\n实时检测",variables:[],hasTriggerParam:!0},40:{name:"容器已满",description:"当存储监视器检测到容器格子数已满时触发\n实时检测",variables:[{key:"usedSlots",label:"已用格子",example:"48"},{key:"capacity",label:"容器容量",example:"48"}],hasTriggerParam:!0},41:{name:"监视器离线",description:"当存储监视器离线或被破坏时触发\n每30秒检查一次",variables:[],hasTriggerParam:!0},42:{name:"工具柜维护时间",description:"当工具柜剩余维护时间小于/大于指定值时触发\n检测间隔 5秒\n需要至少2分钟冷却时间",variables:[{key:"upkeepTime",label:"剩余维护时间",example:"1天2时30分"}],hasTriggerParam:!0}},eI=Object.fromEntries(Object.entries(ef).map(e=>{let[t,a]=e;return[t,a.name]})),eS=Object.fromEntries(Object.entries(ef).map(e=>{let[t,a]=e;return[t,a.description]})),eT=[29,30,31,32,33,34,42];function eb(e){var t;let{open:a,currentRecord:n,onOk:i,onCancel:o,confirmLoading:d,form:m,onSwitchSelect:h,onAlarmSelect:p,onTriggerSwitchSelect:y,onCallGroupSelect:x,onPlayerSelect:j,onStorageMonitorSelect:A,onItemSelect:v,validateTime:I,actions:S,onActionsChange:T}=e,b=l.A.useWatch("triggerType",m),w=l.A.useWatch("alarmId",m),k=l.A.useWatch("triggerSwitchId",m),C=l.A.useWatch("playerName",m),N=l.A.useWatch("playerBmId",m),M=l.A.useWatch("storageMonitorId",m),O=l.A.useWatch("storageMonitorName",m),_=l.A.useWatch("itemId",m),P=l.A.useWatch("itemName",m),R=S.filter(e=>1===e.typeId).length,V=S.filter(e=>2===e.typeId).length,Y=S.filter(e=>3===e.typeId).length,q=b?ef[b]:null,U=[{key:"switch",icon:(0,r.jsx)(B.A,{}),label:"开关操作",disabled:R>=5},{key:"call",icon:(0,r.jsx)(H.A,{}),label:"呼叫组",disabled:V>=1},{key:"message",icon:(0,r.jsx)(W.A,{}),label:"发送游戏信息",disabled:Y>=1}],K=e=>{T(S.filter((t,a)=>a!==e))},J=(e,t)=>{let a=[...S],r=a[e];3===r.typeId&&(a[e]={...r,message:t},T(a))},Q=(e,t)=>{let a=[...S],r=a[e];if(2===r.typeId){let n=(e=>{if(!e)return e;let t=e;for(let e of["加群","加我","QQ群","微信群","代练","代肝","出售","购买"]){let a="*".repeat(e.length),r=RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");t=t.replace(r,a)}return t})(t);a[e]={...r,customMessage:n},T(a)}};return(0,r.jsx)(E.A,{title:n?"编辑事件逻辑":"新建事件逻辑",open:a,onOk:i,onCancel:o,confirmLoading:d,width:600,destroyOnClose:!0,children:(0,r.jsxs)(l.A,{form:m,layout:"vertical",children:[(0,r.jsx)(l.A.Item,{name:"note",label:"事件名",children:(0,r.jsx)(L.A,{placeholder:"未命名",maxLength:100})}),(0,r.jsx)(l.A.Item,{name:"triggerType",label:"触发类型",rules:[{required:!0,message:"请选择触发类型"}],children:(0,r.jsx)(ey,{})}),b&&(0,r.jsx)(z.A,{type:"info",message:eS[b],style:{marginBottom:16}}),(()=>{if(!b)return null;switch(b){case 1:return(0,r.jsx)(l.A.Item,{name:"timeConfig",label:"触发时间配置",rules:[{required:!0,message:"请配置触发时间"}],children:(0,r.jsx)(Z,{timeType:"real"})});case 2:return(0,r.jsx)(l.A.Item,{name:"timeConfig",label:"游戏时间配置",rules:[{required:!0,message:"请配置触发时间"}],children:(0,r.jsx)(Z,{timeType:"game"})});case 3:case 4:return(0,r.jsxs)(l.A.Item,{label:"监测警报",required:!0,validateStatus:w?"":"error",help:w?"":"请选择警报",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择警报",readOnly:!0,style:{marginRight:8},value:w||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:p,children:"选择警报"})]}),(0,r.jsx)(l.A.Item,{name:"alarmId",hidden:!0,children:(0,r.jsx)(L.A,{})})]});case 5:case 6:case 7:return(0,r.jsxs)(l.A.Item,{label:"监测开关",required:!0,validateStatus:k?"":"error",help:k?"":"请选择开关",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择开关",readOnly:!0,style:{marginRight:8},value:k||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:y,children:"选择开关"})]}),(0,r.jsx)(l.A.Item,{name:"triggerSwitchId",hidden:!0,children:(0,r.jsx)(L.A,{})})]});case 8:case 9:return(0,r.jsxs)(l.A.Item,{label:"监测玩家",required:!0,validateStatus:N?"":"error",help:N?"":"请选择玩家",children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择玩家",readOnly:!0,style:{flex:1},value:N?C||"玩家 ".concat(N):""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:j,children:"选择玩家"})]}),(0,r.jsx)(l.A.Item,{name:"playerBmId",hidden:!0,children:(0,r.jsx)(L.A,{})}),(0,r.jsx)(l.A.Item,{name:"playerName",hidden:!0,children:(0,r.jsx)(L.A,{})})]});case 25:case 26:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.A.Item,{name:"teammateName",label:(null==q?void 0:q.triggerParamLabel)||"指定队友(可选)",children:(0,r.jsx)(L.A,{placeholder:(null==q?void 0:q.triggerParamPlaceholder)||"留空则匹配所有队友"})}),(0,r.jsxs)(l.A.Item,{label:"人数条件(可选)",children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[(0,r.jsx)("span",{children:"当队伍人数"}),(0,r.jsx)(l.A.Item,{name:"countOperation",noStyle:!0,children:(0,r.jsxs)(u.A,{style:{width:100},placeholder:"选择",allowClear:!0,children:[(0,r.jsx)(ex,{value:"increase",children:"增加后"}),(0,r.jsx)(ex,{value:"decrease",children:"减少后"}),(0,r.jsx)(ex,{value:"any",children:"无限制"})]})}),(0,r.jsx)(l.A.Item,{name:"countComparison",noStyle:!0,children:(0,r.jsxs)(u.A,{style:{width:80},placeholder:"选择",allowClear:!0,children:[(0,r.jsx)(ex,{value:"eq",children:"等于"}),(0,r.jsx)(ex,{value:"lt",children:"小于"}),(0,r.jsx)(ex,{value:"gt",children:"大于"})]})}),(0,r.jsx)(l.A.Item,{name:"countValue",noStyle:!0,children:(0,r.jsx)(F.A,{min:0,placeholder:"人数",style:{width:80}})}),(0,r.jsx)("span",{children:"时触发"})]}),(0,r.jsx)(ej,{type:"secondary",style:{fontSize:12},children:"示例：队伍人数 增加后 等于 1 → 第一个人上线时触发"})]})]});case 27:case 28:return(0,r.jsx)(l.A.Item,{name:"teammateName",label:(null==q?void 0:q.triggerParamLabel)||"指定队友(可选)",children:(0,r.jsx)(L.A,{placeholder:(null==q?void 0:q.triggerParamPlaceholder)||"留空则匹配所有队友"})});case 35:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.A.Item,{name:"teammateName",label:"指定队友(可选)",children:(0,r.jsx)(L.A,{placeholder:"留空则匹配所有队友"})}),(0,r.jsx)(l.A.Item,{name:"afkDuration",label:"挂机时长(秒)",rules:[{required:!0,message:"请输入挂机时长"},{type:"number",min:10,message:"挂机时长最少10秒"}],children:(0,r.jsx)(F.A,{min:10,max:86400,placeholder:"最少10秒",style:{width:"100%"}})}),(0,r.jsx)(l.A.Item,{name:"afkTriggerCondition",label:"触发条件",initialValue:"start",children:(0,r.jsxs)(u.A,{children:[(0,r.jsx)(ex,{value:"start",children:"开始挂机时触发"}),(0,r.jsx)(ex,{value:"end",children:"结束挂机时触发"})]})}),(0,r.jsxs)(ej,{type:"secondary",style:{fontSize:12},children:["开始挂机：当队友达到指定挂机时长时触发",(0,r.jsx)("br",{}),"结束挂机：当队友从挂机状态恢复移动时触发"]})]});case 36:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.A.Item,{label:"存储监视器",required:!0,validateStatus:M?"":"error",help:M?"":"请选择存储监视器",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择存储监视器",readOnly:!0,style:{marginRight:8},value:O||M||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:A,children:"选择"})]}),(0,r.jsx)(l.A.Item,{name:"storageMonitorId",hidden:!0,children:(0,r.jsx)(L.A,{})}),(0,r.jsx)(l.A.Item,{name:"storageMonitorName",hidden:!0,children:(0,r.jsx)(L.A,{})})]}),(0,r.jsxs)(l.A.Item,{label:"监测物品",required:!0,validateStatus:_?"":"error",help:_?"":"请选择物品",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择物品",readOnly:!0,style:{marginRight:8},value:P||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:v,children:"选择"})]}),(0,r.jsx)(l.A.Item,{name:"itemId",hidden:!0,children:(0,r.jsx)(F.A,{})}),(0,r.jsx)(l.A.Item,{name:"itemName",hidden:!0,children:(0,r.jsx)(L.A,{})})]}),(0,r.jsx)(l.A.Item,{name:"threshold",label:"阈值",rules:[{required:!0,message:"请输入阈值"}],children:(0,r.jsx)(F.A,{min:0,placeholder:"当物品数量高于此值时触发",style:{width:"100%"}})})]});case 37:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.A.Item,{label:"存储监视器",required:!0,validateStatus:M?"":"error",help:M?"":"请选择存储监视器",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择存储监视器",readOnly:!0,style:{marginRight:8},value:O||M||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:A,children:"选择"})]}),(0,r.jsx)(l.A.Item,{name:"storageMonitorId",hidden:!0,children:(0,r.jsx)(L.A,{})}),(0,r.jsx)(l.A.Item,{name:"storageMonitorName",hidden:!0,children:(0,r.jsx)(L.A,{})})]}),(0,r.jsxs)(l.A.Item,{label:"监测物品",required:!0,validateStatus:_?"":"error",help:_?"":"请选择物品",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择物品",readOnly:!0,style:{marginRight:8},value:P||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:v,children:"选择"})]}),(0,r.jsx)(l.A.Item,{name:"itemId",hidden:!0,children:(0,r.jsx)(F.A,{})}),(0,r.jsx)(l.A.Item,{name:"itemName",hidden:!0,children:(0,r.jsx)(L.A,{})})]}),(0,r.jsx)(l.A.Item,{name:"changeType",label:"变化类型",rules:[{required:!0,message:"请选择变化类型"}],children:(0,r.jsxs)(u.A,{placeholder:"选择变化类型",children:[(0,r.jsx)(ex,{value:"increase",children:"数量增加"}),(0,r.jsx)(ex,{value:"decrease",children:"数量减少"}),(0,r.jsx)(ex,{value:"both",children:"任意变化"})]})})]});case 38:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.A.Item,{label:"存储监视器",required:!0,validateStatus:M?"":"error",help:M?"":"请选择存储监视器",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择存储监视器",readOnly:!0,style:{marginRight:8},value:O||M||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:A,children:"选择"})]}),(0,r.jsx)(l.A.Item,{name:"storageMonitorId",hidden:!0,children:(0,r.jsx)(L.A,{})}),(0,r.jsx)(l.A.Item,{name:"storageMonitorName",hidden:!0,children:(0,r.jsx)(L.A,{})})]}),(0,r.jsxs)(l.A.Item,{label:"监测物品",required:!0,validateStatus:_?"":"error",help:_?"":"请选择物品",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择物品",readOnly:!0,style:{marginRight:8},value:P||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:v,children:"选择"})]}),(0,r.jsx)(l.A.Item,{name:"itemId",hidden:!0,children:(0,r.jsx)(F.A,{})}),(0,r.jsx)(l.A.Item,{name:"itemName",hidden:!0,children:(0,r.jsx)(L.A,{})})]}),(0,r.jsx)(ej,{type:"secondary",style:{fontSize:12},children:"当指定物品数量从大于0变为0时触发"})]});case 39:case 40:case 41:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.A.Item,{label:"存储监视器",required:!0,validateStatus:M?"":"error",help:M?"":"请选择存储监视器",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择存储监视器",readOnly:!0,style:{marginRight:8},value:O||M||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:A,children:"选择"})]}),(0,r.jsx)(l.A.Item,{name:"storageMonitorId",hidden:!0,children:(0,r.jsx)(L.A,{})}),(0,r.jsx)(l.A.Item,{name:"storageMonitorName",hidden:!0,children:(0,r.jsx)(L.A,{})})]}),(0,r.jsxs)(ej,{type:"secondary",style:{fontSize:12},children:[39===b&&"当容器内所有物品被清空时触发",40===b&&"当容器格子数达到上限时触发",41===b&&"当存储监视器离线或被破坏时触发"]})]});case 42:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.A.Item,{label:"工具柜",required:!0,validateStatus:M?"":"error",help:M?"":"请选择工具柜",children:[(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(L.A,{placeholder:"点击右侧按钮选择工具柜",readOnly:!0,style:{marginRight:8},value:O||M||""}),(0,r.jsx)(s.Ay,{type:"primary",onClick:A,children:"选择"})]}),(0,r.jsx)(l.A.Item,{name:"storageMonitorId",hidden:!0,children:(0,r.jsx)(L.A,{})}),(0,r.jsx)(l.A.Item,{name:"storageMonitorName",hidden:!0,children:(0,r.jsx)(L.A,{})})]}),(0,r.jsx)(l.A.Item,{name:"comparison",label:"条件",rules:[{required:!0,message:"请选择条件"}],children:(0,r.jsxs)(u.A,{placeholder:"选择条件",children:[(0,r.jsx)(ex,{value:"lt",children:"维护时间小于"}),(0,r.jsx)(ex,{value:"gt",children:"维护时间大于"})]})}),(0,r.jsx)(l.A.Item,{name:"thresholdMinutes",label:"阈值(分钟)",rules:[{required:!0,message:"请输入阈值"}],children:(0,r.jsx)(F.A,{min:1,placeholder:"分钟数",style:{width:"100%"}})}),(0,r.jsx)(ej,{type:"secondary",style:{fontSize:12},children:"此事件会持续触发，需要设置至少2分钟的冷却时间"})]});default:return null}})(),(null==q||null==(t=q.variables)?void 0:t.length)?(0,r.jsx)(z.A,{type:"info",style:{marginBottom:16},message:"可用变量",description:(0,r.jsxs)("div",{children:[q.variables.map(e=>(0,r.jsxs)("div",{style:{marginBottom:4},children:[(0,r.jsx)(c.A,{color:"blue",children:"{".concat(e.key,"}")}),(0,r.jsx)(ej,{type:"secondary",children:e.label}),(0,r.jsxs)(ej,{type:"secondary",style:{marginLeft:8},children:["示例: ",e.example]})]},e.key)),(0,r.jsx)("div",{style:{marginTop:8},children:(0,r.jsxs)(ej,{type:"secondary",children:['在"发送游戏信息"动作中使用变量，例如：',(0,r.jsxs)("code",{children:["队友 ","{name}"," 在 ","{pos}"," 死亡了"]})]})})]})}):null,(0,r.jsx)(G.A,{children:"执行动作"}),(0,r.jsx)("div",{style:{marginBottom:16},children:S.map((e,t)=>{var a,n;return 1===e.typeId?(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8,gap:8},children:[(0,r.jsx)(B.A,{style:{color:"#1890ff"}}),(0,r.jsx)(L.A,{placeholder:"点击选择开关",readOnly:!0,style:{flex:1},value:e.switchName||e.switchId||"",onClick:()=>h(t)}),(0,r.jsxs)(u.A,{value:e.target,onChange:e=>((e,t)=>{let a=[...S],r=a[e];1===r.typeId&&(a[e]={...r,target:t},T(a))})(t,e),style:{width:100},children:[(0,r.jsx)(ex,{value:"on",children:"开启"}),(0,r.jsx)(ex,{value:"off",children:"关闭"}),(0,r.jsx)(ex,{value:"toggle",children:"切换"})]}),(0,r.jsx)(s.Ay,{type:"text",danger:!0,icon:(0,r.jsx)(f.A,{}),onClick:()=>K(t)})]},t):2===e.typeId?(0,r.jsxs)("div",{style:{marginBottom:8},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,r.jsx)(H.A,{style:{color:"#52c41a"}}),(0,r.jsx)(L.A,{placeholder:"点击选择呼叫组",readOnly:!0,style:{flex:1},value:e.callGroupName||e.callGroupId||"",onClick:()=>x(t)}),(0,r.jsx)(s.Ay,{type:"text",danger:!0,icon:(0,r.jsx)(f.A,{}),onClick:()=>K(t)})]}),(0,r.jsxs)("div",{style:{marginLeft:22},children:[(0,r.jsx)(L.A,{placeholder:"自定义呼叫邮件内容（可选，留空使用默认内容）",maxLength:50,showCount:!0,value:e.customMessage||"",onChange:e=>Q(t,e.target.value),style:{marginBottom:4}}),(null==q||null==(a=q.variables)?void 0:a.length)?(0,r.jsxs)("div",{children:[(0,r.jsx)(ej,{type:"secondary",style:{marginRight:8,fontSize:12},children:"插入变量:"}),q.variables.map(e=>(0,r.jsx)(c.A,{color:"green",style:{cursor:"pointer",fontSize:12},onClick:()=>((e,t)=>{let a=S[e];2===a.typeId&&Q(e,(a.customMessage||"")+"{".concat(t,"}"))})(t,e.key),children:"{".concat(e.key,"}")},e.key))]}):null]})]},t):3===e.typeId?(0,r.jsxs)("div",{style:{marginBottom:8},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[(0,r.jsx)(W.A,{style:{color:"#faad14"}}),(0,r.jsx)(ej,{children:"发送游戏信息"}),(0,r.jsx)(s.Ay,{type:"text",danger:!0,icon:(0,r.jsx)(f.A,{}),onClick:()=>K(t),style:{marginLeft:"auto"}})]}),(0,r.jsx)(L.A.TextArea,{placeholder:"输入消息内容（最多50字符）",maxLength:50,showCount:!0,value:e.message,onChange:e=>J(t,e.target.value),rows:2}),(null==q||null==(n=q.variables)?void 0:n.length)?(0,r.jsxs)("div",{style:{marginTop:4},children:[(0,r.jsx)(ej,{type:"secondary",style:{marginRight:8},children:"插入变量:"}),q.variables.map(e=>(0,r.jsx)(c.A,{color:"blue",style:{cursor:"pointer"},onClick:()=>((e,t)=>{let a=S[e];3===a.typeId&&J(e,a.message+"{".concat(t,"}"))})(t,e.key),children:"{".concat(e.key,"}")},e.key))]}):null]},t):null})}),(0,r.jsx)(D.A,{menu:{items:U,onClick:e=>{let{key:t}=e;"switch"===t&&R<5?T([...S,{typeId:1,switchId:"",target:"on"}]):"call"===t&&V<1?T([...S,{typeId:2,callGroupId:""}]):"message"===t&&Y<1&&T([...S,{typeId:3,message:""}])}},placement:"bottomLeft",children:(0,r.jsx)(s.Ay,{icon:(0,r.jsx)(g.A,{}),block:!0,children:"添加动作"})}),(0,r.jsx)(G.A,{children:"高级设置"}),(0,r.jsx)(l.A.Item,{name:"triggerDelay",label:"触发延迟（秒）",initialValue:0,children:(0,r.jsx)(F.A,{min:0,max:60,style:{width:"100%"}})}),(0,r.jsx)(l.A.Item,{name:"triggerCooldown",label:"触发冷却（秒）",initialValue:b&&eT.includes(b)?120:0,rules:[{validator:(e,t)=>b&&eT.includes(b)&&t<120?Promise.reject("持续播报事件的冷却时间不能少于".concat(120,"秒")):Promise.resolve()}],extra:b&&eT.includes(b)?(0,r.jsxs)(ej,{type:"warning",children:["持续播报事件需要至少",120,"秒冷却时间"]}):void 0,children:(0,r.jsx)(F.A,{min:b&&eT.includes(b)?120:0,max:86400,style:{width:"100%"}})})]})})}var eE=a(15760),ew=a(67153);let ek=S.Aq.backendFetch,{TextArea:eC}=L.A,{Text:eN}=R.A,eM={1:"现实时间",2:"游戏时间",3:"警报通电",4:"警报断电",5:"开关被破坏",6:"开关被开启",7:"开关被关闭",8:"玩家上线(全服)",9:"玩家下线(全服)",10:"货船进入地图",11:"货船停靠港口",12:"货船离开地图",13:"武装直升机进入",14:"武装直升机被击落",15:"武装直升机离开",16:"军用直升机进入",17:"重装科学家-小石油",18:"重装科学家-大石油",19:"流浪商人出现",20:"流浪商人停留",21:"流浪商人离开",22:"新售货机出现",23:"小石油箱子解锁",24:"大石油箱子解锁",25:"队友上线",26:"队友下线",27:"队友死亡",28:"队友重生",29:"货船航行中",30:"武装直升机巡逻中",31:"军用直升机飞行中",32:"军用直升机在石油平台",33:"流浪商人移动中",34:"流浪商人停留中",35:"队友挂机",36:"物品数量高于阈值",37:"物品数量变化",38:"指定物品清空",39:"容器完全清空",40:"容器已满",41:"监视器离线",42:"工具柜维护时间"},eO=e=>{let{open:t,onCancel:a,onSuccess:c}=e,{message:m}=i.A.useApp(),[h]=l.A.useForm(),[u,g]=(0,n.useState)(!1),[x,j]=(0,n.useState)(!1),[A,v]=(0,n.useState)([]),[f,I]=(0,n.useState)(null),[S,T]=(0,n.useState)(!1),[b,k]=(0,n.useState)(1),[C]=(0,n.useState)(10),[N,M]=(0,n.useState)(0),[O,_]=(0,n.useState)([]),P=async e=>{j(!0);try{let t=await ek("/api/f/geteventlogiclist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:e,pageSize:C})}),a=await t.json();200===a.status?(_(a.data.list||[]),M(a.data.total||0)):m.error(a.errmessage||"获取数据失败")}catch(e){m.error("获取数据失败")}finally{j(!1)}};(0,n.useEffect)(()=>{t&&(h.resetFields(),v([]),I(null),T(!1),k(1),P(1))},[t]);let R=(e,t)=>{t?v([...A,e]):v(A.filter(t=>t!==e))},F=async()=>{try{let e=await h.validateFields();if(0===A.length)return void m.error("请至少选择一条事件逻辑");g(!0);let t=await ek("/api/f/shareeventlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,description:e.description||"",logicIds:A})}),a=await t.json();200===a.status?(I(a.data.shareKey),m.success("分享成功！"),null==c||c()):m.error(a.errmessage||"分享失败")}catch(e){m.error("分享失败，请检查输入")}finally{g(!1)}},z=async()=>{if(f)try{await navigator.clipboard.writeText(f),T(!0),m.success("密钥已复制到剪贴板"),setTimeout(()=>T(!1),2e3)}catch(e){m.error("复制失败，请手动复制")}},D=()=>{h.resetFields(),v([]),I(null),T(!1),a()};return(0,r.jsx)(E.A,{title:(0,r.jsxs)(q.A,{children:[(0,r.jsx)(y.A,{}),f?"分享成功":"分享事件逻辑"]}),open:t,onCancel:D,footer:f?(0,r.jsx)(s.Ay,{type:"primary",onClick:D,children:"完成"}):(0,r.jsxs)(q.A,{children:[(0,r.jsx)(s.Ay,{onClick:D,children:"取消"}),(0,r.jsx)(s.Ay,{type:"primary",onClick:F,loading:u,disabled:0===A.length,children:"确认分享"})]}),width:560,destroyOnClose:!0,styles:{header:{background:"#27272c",borderBottom:"1px solid rgba(255, 255, 255, 0.08)"},body:{background:"#27272c"},footer:{background:"#27272c",borderTop:"1px solid rgba(255, 255, 255, 0.08)"},content:{background:"#27272c",borderRadius:12}},children:f?(0,r.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,r.jsx)("div",{style:{marginBottom:16},children:(0,r.jsx)(eE.A,{style:{fontSize:48,color:"#52c41a"}})}),(0,r.jsx)("div",{style:{marginBottom:16,fontSize:16,fontWeight:500,color:"#fff"},children:"分享成功！"}),(0,r.jsx)("div",{style:{marginBottom:8,color:"rgba(255, 255, 255, 0.6)"},children:"请将以下密钥分享给其他用户："}),(0,r.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"12px 16px",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[(0,r.jsx)(eN,{code:!0,style:{fontSize:14,background:"rgba(99, 102, 241, 0.2)",color:"#a5b4fc"},children:f}),(0,r.jsx)(s.Ay,{type:"text",icon:S?(0,r.jsx)(eE.A,{}):(0,r.jsx)(ew.A,{}),onClick:z,style:{color:"rgba(255, 255, 255, 0.7)"},children:S?"已复制":"复制"})]}),(0,r.jsx)("div",{style:{color:"rgba(255, 255, 255, 0.4)",fontSize:12},children:"其他用户可以通过此密钥导入您分享的事件逻辑配置"})]}):(0,r.jsxs)(l.A,{form:h,layout:"vertical",children:[(0,r.jsx)(l.A.Item,{name:"name",label:"分享名称",rules:[{required:!0,message:"请输入分享名称"},{max:50,message:"名称最多50个字符"}],children:(0,r.jsx)(L.A,{placeholder:"请输入分享名称",maxLength:50,showCount:!0})}),(0,r.jsx)(l.A.Item,{name:"description",label:"分享描述",rules:[{max:200,message:"描述最多200个字符"}],children:(0,r.jsx)(eC,{placeholder:"请输入分享描述（可选）",maxLength:200,showCount:!0,rows:3})}),(0,r.jsx)(G.A,{style:{margin:"16px 0"}}),(0,r.jsxs)("div",{style:{marginBottom:8},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,r.jsxs)("span",{style:{fontWeight:500},children:["选择要分享的事件逻辑",(0,r.jsxs)("span",{style:{color:"#999",fontWeight:"normal",marginLeft:8},children:["(已选 ",A.length," 条，共 ",N," 条)"]})]}),(0,r.jsx)(s.Ay,{type:"link",size:"small",onClick:()=>{let e=O.map(e=>e.id);e.every(e=>A.includes(e))?v(A.filter(t=>!e.includes(t))):v([...new Set([...A,...e])])},children:0!==O.length&&O.every(e=>A.includes(e.id))?"取消本页全选":"全选本页"})]}),(0,r.jsx)(o.A,{spinning:x,children:0!==O.length||x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{maxHeight:280,overflowY:"auto",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:8,padding:8,marginBottom:12},children:O.map(e=>(0,r.jsx)("div",{style:{padding:"8px 12px",borderRadius:4,marginBottom:4,background:A.includes(e.id)?"rgba(99, 102, 241, 0.15)":"rgba(255, 255, 255, 0.03)",border:A.includes(e.id)?"1px solid rgba(99, 102, 241, 0.5)":"1px solid rgba(255, 255, 255, 0.08)",cursor:"pointer",transition:"all 0.2s"},onClick:()=>R(e.id,!A.includes(e.id)),children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[(0,r.jsx)(w.A,{checked:A.includes(e.id),onClick:e=>e.stopPropagation(),onChange:t=>R(e.id,t.target.checked)}),(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("span",{style:{color:"#fff"},children:(e=>{let t=eM[e.triggerType]||"未知类型(".concat(e.triggerType,")");return"[".concat(t,"]")})(e)}),e.note&&(0,r.jsxs)("div",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:12,marginTop:4},children:["备注: ",e.note]})]})]})},e.id))}),N>C&&(0,r.jsx)("div",{style:{textAlign:"center"},children:(0,r.jsx)(p.A,{current:b,pageSize:C,total:N,onChange:e=>{k(e),P(e)},size:"small",showSizeChanger:!1,showQuickJumper:N>50})})]}):(0,r.jsx)(d.A,{description:"暂无事件逻辑",image:d.A.PRESENTED_IMAGE_SIMPLE})})]})]})})};var e_=a(54540),eP=a(9485),eR=a(97170),eL=a(99081);let eF=S.Aq.backendFetch,{Text:ez}=R.A,eG={1:"现实时间",2:"游戏时间",3:"警报通电",4:"警报断电",5:"开关被破坏",6:"开关被开启",7:"开关被关闭",8:"玩家上线(全服)",9:"玩家下线(全服)",10:"货船进入地图",11:"货船停靠港口",12:"货船离开地图",13:"武装直升机进入",14:"武装直升机被击落",15:"武装直升机离开",16:"军用直升机进入",17:"重装科学家-小石油",18:"重装科学家-大石油",19:"流浪商人出现",20:"流浪商人停留",21:"流浪商人离开",22:"新售货机出现",23:"小石油箱子解锁",24:"大石油箱子解锁",25:"队友上线",26:"队友下线",27:"队友死亡",28:"队友重生",29:"货船航行中",30:"武装直升机巡逻中",31:"军用直升机飞行中",32:"军用直升机在石油平台",33:"流浪商人移动中",34:"流浪商人停留中",35:"队友挂机",36:"物品数量高于阈值",37:"物品数量变化",38:"指定物品清空",39:"容器完全清空",40:"容器已满",41:"监视器离线",42:"工具柜维护时间"},eD={switch:"开关",alarm:"智能报警",callGroup:"呼叫组",storageMonitor:"存储监视器"},eB=[36,37,38,39,40,41,42],eH=e=>{let t=[];return e.forEach((e,a)=>{var r,n,i;let l=eG[e.triggerType]||"未知类型(".concat(e.triggerType,")"),s="[".concat(l,"] ").concat(e.note||"").trim();(null==(r=e.triggerValue)?void 0:r.alarmId)&&t.push({eventIndex:a,type:"alarm",originalId:e.triggerValue.alarmId,eventSummary:s}),(null==(n=e.triggerValue)?void 0:n.switchId)&&t.push({eventIndex:a,type:"switch",originalId:e.triggerValue.switchId,eventSummary:s}),(null==(i=e.triggerValue)?void 0:i.storageMonitorId)&&eB.includes(e.triggerType)&&t.push({eventIndex:a,type:"storageMonitor",originalId:e.triggerValue.storageMonitorId,originalName:e.triggerValue.storageMonitorName,eventSummary:s}),e.actions&&Array.isArray(e.actions)&&e.actions.forEach(e=>{1===e.typeId&&e.switchId&&t.push({eventIndex:a,type:"switch",originalId:e.switchId,eventSummary:s}),2===e.typeId&&e.callGroupId&&t.push({eventIndex:a,type:"callGroup",originalId:e.callGroupId,eventSummary:s})})}),t},eW=e=>{let{open:t,onCancel:a,onSuccess:l}=e,{message:c,modal:m}=i.A.useApp(),[h,p]=(0,n.useState)("official"),[g,y]=(0,n.useState)(""),[j,A]=(0,n.useState)("append"),[v,f]=(0,n.useState)([]),[I,S]=(0,n.useState)(!1),[T,b]=(0,n.useState)(null),[w,C]=(0,n.useState)(null),[N,M]=(0,n.useState)(!1),[O,_]=(0,n.useState)(null),[P,R]=(0,n.useState)(!1),[F,D]=(0,n.useState)(!1),[B,H]=(0,n.useState)(!1),[W,V]=(0,n.useState)(!1),[K,J]=(0,n.useState)([]),[Q,$]=(0,n.useState)(new Map),[X,Z]=(0,n.useState)(""),[ee,et]=(0,n.useState)([]),[ea,er]=(0,n.useState)([]),[en,ei]=(0,n.useState)([]),[el,es]=(0,n.useState)([]),[eo,ed]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&(p("official"),y(""),A("append"),b(null),_(null),D(!1),C(null),V(!1),J([]),$(new Map),ec())},[t]);let ec=async()=>{S(!0);try{let e=await eF("/api/f/getofficialeventpresets",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status?f(t.data.list):c.error(t.errmessage||"获取官方预设失败")}catch(e){c.error("获取官方预设失败，请检查网络连接")}finally{S(!1)}},em=async()=>{ed(!0);try{let[e,t,a,r]=await Promise.all([eF("/api/f/getswitchlist",{method:"POST",headers:{"Content-Type":"application/json"}}),eF("/api/f/getsmartalarmlist",{method:"POST",headers:{"Content-Type":"application/json"}}),eF("/api/f/getcallgrouplist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:1,pageSize:50})}),eF("/api/f/getstoragemonitorlist",{method:"POST",headers:{"Content-Type":"application/json"}})]),n=await e.json(),i=await t.json(),l=await a.json(),s=await r.json();200===n.status&&et((n.data.list||[]).map(e=>({id:e.id,name:e.name}))),200===i.status&&er((i.data.list||[]).map(e=>({id:e.id,name:e.name}))),200===l.status&&ei((l.data.list||[]).map(e=>({id:e.id,name:e.note||e.id}))),200===s.status&&es((s.data.list||[]).map(e=>({id:e.id,name:e.name||"监视器 ".concat(e.id)})))}catch(e){c.error("获取设备列表失败")}finally{ed(!1)}},ep=async e=>{if(!e||0===e.trim().length)return void c.error("请输入分享密钥");R(!0);try{let t=await eF("/api/f/previeweventshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.trim()})}),a=await t.json();200===a.status?(_(a.data),D(!0)):c.error(a.errmessage||"预览失败，请检查密钥是否正确")}catch(e){c.error("预览失败，请检查网络连接")}finally{R(!1)}},eu=async(e,t)=>{let a=eH(t.events);0===a.length?ey(e,[]):(Z(e),J(a),$(new Map),await em(),V(!0))},eg=async(e,t)=>{H(!0);try{let a=await eF("/api/f/importeventshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.trim(),mode:j,deviceMappings:t.length>0?t:void 0})}),r=await a.json();if(200===r.status){let{importedCount:e,skippedCount:t}=r.data,a="成功导入 ".concat(e," 条事件逻辑");t>0&&(a+="，跳过 ".concat(t," 条重复事件")),c.success(a),null==l||l(),ex()}else c.error(r.errmessage||"导入失败")}catch(e){c.error("导入失败，请检查网络连接")}finally{H(!1)}},ey=(e,t)=>{"overwrite"===j?m.confirm({title:"确认覆盖",content:"覆盖模式将清空您现有的所有事件逻辑配置，确定要继续吗？",okText:"确认覆盖",cancelText:"取消",okButtonProps:{danger:!0},onOk:()=>eg(e,t)}):eg(e,t)},ex=()=>{p("official"),y(""),A("append"),b(null),_(null),D(!1),C(null),V(!1),J([]),$(new Map),a()},ej=async e=>{b(e),M(!0);try{let t=await eF("/api/f/previeweventshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.id})}),a=await t.json();200===a.status?C(a.data):c.error(a.errmessage||"预览失败")}catch(e){c.error("预览失败，请检查网络连接")}finally{M(!1)}},eA=e=>{let t="".concat(e.eventIndex,":").concat(e.type,":").concat(e.originalId);return Q.get(t)||""},ev=()=>K.every(e=>""!==eA(e)),ef=()=>{let e=K.map(e=>({eventIndex:e.eventIndex,type:e.type,originalId:e.originalId,mappedId:eA(e)})).filter(e=>""!==e.mappedId);V(!1),ey(X,e)},eI=e=>{if(!e)return null;let t=eH(e.events),a=t.length>0;return(0,r.jsxs)("div",{style:{marginTop:16},children:[(0,r.jsx)(G.A,{style:{margin:"16px 0"}}),(0,r.jsxs)("div",{style:{marginBottom:12},children:[(0,r.jsx)(ez,{strong:!0,style:{fontSize:16},children:e.name}),e.description&&(0,r.jsx)("div",{children:(0,r.jsx)(ez,{type:"secondary",style:{fontSize:13},children:e.description})}),(0,r.jsx)("div",{children:(0,r.jsxs)(ez,{type:"secondary",style:{fontSize:12},children:["包含 ",e.eventCount," 条事件 \xb7 来自 ",e.creatorName]})})]}),a&&(0,r.jsx)(z.A,{type:"info",showIcon:!0,icon:(0,r.jsx)(eP.A,{}),message:(0,r.jsxs)(ez,{children:["此预设包含 ",t.length," 个设备引用，导入时需要映射到您的设备"]}),style:{marginBottom:12}}),(0,r.jsx)(k.A,{size:"small",dataSource:e.events,style:{maxHeight:200,overflowY:"auto"},renderItem:(e,t)=>(0,r.jsx)(k.A.Item,{style:{padding:"6px 12px"},children:(0,r.jsx)(ez,{children:(e=>{let t=eG[e.triggerType]||"未知类型(".concat(e.triggerType,")");return"[".concat(t,"] ").concat(e.note||"").trim()})(e)})},t)}),(0,r.jsxs)("div",{style:{marginTop:16},children:[(0,r.jsx)(ez,{strong:!0,style:{display:"block",marginBottom:8},children:"导入模式："}),(0,r.jsx)(U.Ay.Group,{value:j,onChange:e=>A(e.target.value),children:(0,r.jsxs)(q.A,{direction:"vertical",children:[(0,r.jsxs)(U.Ay,{value:"append",children:["追加模式",(0,r.jsx)(ez,{type:"secondary",style:{fontSize:12,marginLeft:8},children:"保留现有配置，跳过重复事件"})]}),(0,r.jsxs)(U.Ay,{value:"overwrite",children:["覆盖模式",(0,r.jsx)(ez,{type:"danger",style:{fontSize:12,marginLeft:8},children:"清空现有配置，导入新配置"})]})]})})]})]})},eS=[{key:"official",label:(0,r.jsxs)("span",{children:[(0,r.jsx)(eR.A,{style:{marginRight:4}}),"官方预设"]}),children:(0,r.jsxs)("div",{children:[I?(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,r.jsx)(o.A,{tip:"加载中..."})}):0===v.length?(0,r.jsx)(d.A,{description:"暂无官方预设",image:d.A.PRESENTED_IMAGE_SIMPLE}):(0,r.jsx)(k.A,{dataSource:v,renderItem:e=>(0,r.jsx)(Y.A,{size:"small",style:{marginBottom:8,cursor:"pointer",border:(null==T?void 0:T.id)===e.id?"2px solid var(--ant-color-primary)":"1px solid var(--ant-color-border)"},styles:{body:{padding:"12px 16px"}},onClick:()=>ej(e),children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,r.jsxs)("div",{style:{flex:1,marginRight:16},children:[(0,r.jsxs)("div",{style:{marginBottom:4},children:[(0,r.jsx)(eR.A,{style:{marginRight:6,color:"#faad14"}}),(0,r.jsx)(ez,{strong:!0,children:e.name})]}),e.description&&(0,r.jsx)("div",{children:(0,r.jsx)(ez,{type:"secondary",style:{fontSize:13},children:e.description})}),(0,r.jsx)("div",{children:(0,r.jsxs)(ez,{type:"secondary",style:{fontSize:12},children:["包含 ",e.eventCount," 条事件 \xb7 ",e.creatorName]})})]}),(0,r.jsx)(s.Ay,{type:"text",size:"small",icon:(0,r.jsx)(eL.A,{}),onClick:t=>{t.stopPropagation(),ej(e)},children:"预览"})]})},e.id)}),N&&(0,r.jsx)("div",{style:{textAlign:"center",padding:"20px 0"},children:(0,r.jsx)(o.A,{tip:"加载预览..."})}),T&&w&&!N&&(0,r.jsxs)(r.Fragment,{children:[eI(w),(0,r.jsx)("div",{style:{marginTop:16,textAlign:"right"},children:(0,r.jsx)(s.Ay,{type:"primary",icon:(0,r.jsx)(x.A,{}),loading:B,onClick:()=>eu(T.id,w),children:"导入选中预设"})})]})]})},{key:"key",label:(0,r.jsxs)("span",{children:[(0,r.jsx)(eh.A,{style:{marginRight:4}}),"密钥导入"]}),children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)(ez,{strong:!0,style:{display:"block",marginBottom:8},children:"输入分享密钥："}),(0,r.jsxs)(q.A.Compact,{style:{width:"100%"},children:[(0,r.jsx)(L.A,{placeholder:"请输入32位分享密钥",value:g,onChange:e=>{y(e.target.value),D(!1),_(null)},maxLength:32,style:{flex:1}}),(0,r.jsx)(s.Ay,{type:"primary",icon:(0,r.jsx)(eL.A,{}),loading:P,onClick:()=>ep(g),children:"预览"})]})]}),F&&O&&(0,r.jsxs)(r.Fragment,{children:[eI(O),(0,r.jsx)("div",{style:{marginTop:16,textAlign:"right"},children:(0,r.jsx)(s.Ay,{type:"primary",icon:(0,r.jsx)(x.A,{}),loading:B,onClick:()=>eu(g,O),children:"确认导入"})})]})]})}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E.A,{title:(0,r.jsxs)(q.A,{children:[(0,r.jsx)(x.A,{}),"导入事件逻辑"]}),open:t,onCancel:ex,footer:null,width:600,destroyOnClose:!0,children:(0,r.jsx)(e_.A,{activeKey:h,onChange:e=>{p(e),D(!1),_(null),b(null)},items:eS})}),(()=>{let e=(()=>{let e=[],t=new Set(K.map(e=>e.type));return t.has("switch")&&0===ee.length&&e.push("switch"),t.has("alarm")&&0===ea.length&&e.push("alarm"),t.has("callGroup")&&0===en.length&&e.push("callGroup"),t.has("storageMonitor")&&0===el.length&&e.push("storageMonitor"),e})();return(0,r.jsx)(E.A,{title:"配置设备映射",open:W,onCancel:()=>V(!1),width:650,footer:[(0,r.jsx)(s.Ay,{onClick:()=>V(!1),children:"取消"},"cancel"),(0,r.jsx)(s.Ay,{type:"primary",disabled:!ev()||e.length>0,loading:B,onClick:ef,children:"确认导入"},"confirm")],children:eo?(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,r.jsx)(o.A,{tip:"加载设备列表..."})}):(0,r.jsxs)(r.Fragment,{children:[e.length>0&&(0,r.jsx)(z.A,{type:"error",showIcon:!0,message:"缺少必要设备",description:"请先配对以下设备：".concat(e.map(e=>eD[e]).join("、")),style:{marginBottom:16}}),(0,r.jsx)(ez,{type:"secondary",style:{display:"block",marginBottom:16,fontSize:13},children:"预设中的设备ID与您的设备不同，请为每条事件选择对应的设备："}),(0,r.jsx)(k.A,{size:"small",dataSource:K,style:{maxHeight:400,overflowY:"auto"},renderItem:(e,t)=>{let a=(e=>{switch(e){case"switch":return ee.map(e=>({value:e.id,label:e.name}));case"alarm":return ea.map(e=>({value:e.id,label:e.name}));case"callGroup":return en.map(e=>({value:e.id,label:e.name}));case"storageMonitor":return el.map(e=>({value:e.id,label:e.name}));default:return[]}})(e.type),n=a.length>0,i=e.originalName||e.originalId;return(0,r.jsx)(k.A.Item,{children:(0,r.jsxs)("div",{style:{width:"100%"},children:[(0,r.jsx)("div",{style:{marginBottom:8},children:(0,r.jsx)(ez,{children:e.eventSummary})}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsxs)(ez,{type:"secondary",style:{fontSize:12,whiteSpace:"nowrap"},children:[eD[e.type],":"]}),(0,r.jsx)(ez,{code:!0,style:{fontSize:11},children:i}),(0,r.jsx)(ez,{type:"secondary",style:{fontSize:12},children:"→"}),(0,r.jsx)(u.A,{placeholder:n?"选择设备":"无可用设备",style:{flex:1,minWidth:150},size:"small",value:eA(e)||void 0,onChange:t=>((e,t)=>{let a="".concat(e.eventIndex,":").concat(e.type,":").concat(e.originalId),r=new Map(Q);t?r.set(a,t):r.delete(a),$(r)})(e,t),options:a,disabled:!n,allowClear:!0,showSearch:!0,optionFilterProp:"label"})]})]})},"".concat(e.eventIndex,"-").concat(e.type,"-").concat(e.originalId,"-").concat(t))}}),!ev()&&0===e.length&&(0,r.jsx)("div",{style:{marginTop:12},children:(0,r.jsxs)(ez,{type:"warning",style:{fontSize:12},children:[(0,r.jsx)(eP.A,{style:{marginRight:4}}),"请为所有事件选择对应的设备"]})})]})})})()]})};var eV=a(39286),eY=a(44187);let eq=S.Aq.backendFetch,{Text:eU}=R.A,eK=e=>{let{open:t,onCancel:a,onSuccess:l}=e,{message:c,modal:m}=i.A.useApp(),[h,p]=(0,n.useState)(!1),[u,g]=(0,n.useState)([]),[y,x]=(0,n.useState)(null),[A,v]=(0,n.useState)(null),I=async()=>{p(!0);try{let e=await eq("/api/f/getmyeventshares",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status?g(t.data.list):c.error(t.errmessage||"获取分享列表失败")}catch(e){c.error("获取分享列表失败，请检查网络连接")}finally{p(!1)}};(0,n.useEffect)(()=>{t&&I()},[t]);let S=async e=>{try{await navigator.clipboard.writeText(e),x(e),c.success("密钥已复制到剪贴板"),setTimeout(()=>x(null),2e3)}catch(e){c.error("复制失败，请手动复制")}},T=()=>{a()},b=[{title:"分享名称",dataIndex:"name",key:"name",width:150,ellipsis:!0,render:(e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:500,color:"var(--ant-color-text)"},children:e}),t.description&&(0,r.jsx)("div",{style:{color:"var(--ant-color-text-tertiary)",fontSize:12,marginTop:2},children:t.description})]})},{title:"密钥",dataIndex:"id",key:"id",width:200,render:e=>(0,r.jsxs)(q.A,{children:[(0,r.jsx)(eU,{code:!0,style:{fontSize:12},children:e}),(0,r.jsx)(eV.A,{title:y===e?"已复制":"复制密钥",children:(0,r.jsx)(s.Ay,{type:"text",size:"small",icon:y===e?(0,r.jsx)(eE.A,{style:{color:"#52c41a"}}):(0,r.jsx)(ew.A,{}),onClick:()=>S(e)})})]})},{title:"事件数",dataIndex:"eventCount",key:"eventCount",width:80,align:"center"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150,render:e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},{title:"操作",key:"action",width:80,render:(e,t)=>(0,r.jsx)(s.Ay,{type:"link",danger:!0,size:"small",icon:(0,r.jsx)(f.A,{}),loading:A===t.id,onClick:()=>(e=>{m.confirm({title:"确认取消分享",content:(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:['确定要取消分享 "',e.name,'" 吗？']}),(0,r.jsx)("p",{style:{color:"#ff4d4f",fontSize:12},children:"取消后，其他用户将无法通过密钥导入此配置。"})]}),okText:"确认取消",cancelText:"返回",okButtonProps:{danger:!0},onOk:async()=>{v(e.id);try{let t=await eq("/api/f/unshareeventlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.id})}),a=await t.json();200===a.status?(c.success("已取消分享"),I(),null==l||l()):c.error(a.errmessage||"取消分享失败")}catch(e){c.error("取消分享失败，请检查网络连接")}finally{v(null)}}})})(t),children:"取消"})}];return(0,r.jsx)(E.A,{title:(0,r.jsxs)(q.A,{children:[(0,r.jsx)(j.A,{}),"我的事件分享"]}),open:t,onCancel:T,footer:(0,r.jsx)(s.Ay,{onClick:T,children:"关闭"}),width:800,destroyOnClose:!0,children:h?(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,r.jsx)(o.A,{tip:"加载中..."})}):0===u.length?(0,r.jsx)(d.A,{description:"暂无分享记录",image:d.A.PRESENTED_IMAGE_SIMPLE,style:{padding:"40px 0"}}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{marginBottom:12,color:"var(--ant-color-text-secondary)",fontSize:13},children:["您已创建 ",u.length,"/10 个分享"]}),(0,r.jsx)(eY.A,{columns:b,dataSource:u,rowKey:"id",pagination:!1,size:"small",scroll:{x:"max-content"}})]})})};var eJ=a(82740);let eQ=S.Aq.backendFetch,{Text:e$}=R.A,eX={1:"现实时间",2:"游戏时间",3:"警报通电",4:"警报断电",5:"开关被破坏",6:"开关被开启",7:"开关被关闭",8:"玩家上线(全服)",9:"玩家下线(全服)",10:"货船进入地图",11:"货船停靠港口",12:"货船离开地图",13:"武装直升机进入",14:"武装直升机被击落",15:"武装直升机离开",16:"军用直升机进入",17:"重装科学家-小石油",18:"重装科学家-大石油",19:"流浪商人出现",20:"流浪商人停留",21:"流浪商人离开",22:"新售货机出现",23:"小石油箱子解锁",24:"大石油箱子解锁",25:"队友上线",26:"队友下线",27:"队友死亡",28:"队友重生",29:"货船航行中",30:"武装直升机巡逻中",31:"军用直升机飞行中",32:"军用直升机在石油平台",33:"流浪商人移动中",34:"流浪商人停留中",35:"队友挂机",36:"物品数量高于阈值",37:"物品数量变化",38:"指定物品清空",39:"容器完全清空",40:"容器已满",41:"监视器离线",42:"工具柜维护时间"},eZ={switch:"开关",alarm:"智能报警",callGroup:"呼叫组",storageMonitor:"存储监视器"},e0=[36,37,38,39,40,41,42],e1=e=>{let{onImportSuccess:t}=e,{message:a,modal:l}=i.A.useApp(),[c,m]=(0,n.useState)(!1),[h,p]=(0,n.useState)([]),[g,y]=(0,n.useState)(null),[j,A]=(0,n.useState)(!1),[v,f]=(0,n.useState)(null),[I,S]=(0,n.useState)("append"),[T,b]=(0,n.useState)(!1),[w,k]=(0,n.useState)(!1),[C,N]=(0,n.useState)([]),[M,O]=(0,n.useState)(new Map),[_,P]=(0,n.useState)([]),[R,L]=(0,n.useState)([]),[F,G]=(0,n.useState)([]),[D,B]=(0,n.useState)([]),[H,W]=(0,n.useState)(!1),V=async()=>{m(!0);try{let e=await eQ("/api/f/getofficialeventpresets",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status?p(t.data.list):a.error(t.errmessage||"获取官方预设失败")}catch(e){a.error("获取官方预设失败，请检查网络连接")}finally{m(!1)}},K=async()=>{W(!0);try{let[e,t,a,r]=await Promise.all([eQ("/api/f/getswitchlist",{method:"POST",headers:{"Content-Type":"application/json"}}),eQ("/api/f/getsmartalarmlist",{method:"POST",headers:{"Content-Type":"application/json"}}),eQ("/api/f/getcallgrouplist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:1,pageSize:50})}),eQ("/api/f/getstoragemonitorlist",{method:"POST",headers:{"Content-Type":"application/json"}})]),[n,i,l,s]=await Promise.all([e.json(),t.json(),a.json(),r.json()]);200===n.status&&P((n.data.list||[]).map(e=>({id:e.id,name:e.name}))),200===i.status&&L((i.data.list||[]).map(e=>({id:e.id,name:e.name}))),200===l.status&&G((l.data.list||[]).map(e=>({id:e.id,name:e.note||e.id}))),200===s.status&&B((s.data.list||[]).map(e=>({id:e.id,name:e.name||"监视器 ".concat(e.id)})))}catch(e){a.error("获取设备列表失败")}finally{W(!1)}},J=async e=>{try{let t=await eQ("/api/f/previeweventshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.id})}),r=await t.json();if(200===r.status){let e=(e=>{let t=[];return e.forEach((e,a)=>{var r,n,i;let l=eX[e.triggerType]||"未知类型(".concat(e.triggerType,")"),s="[".concat(l,"] ").concat(e.note||"").trim();(null==(r=e.triggerValue)?void 0:r.alarmId)&&t.push({eventIndex:a,type:"alarm",originalId:e.triggerValue.alarmId,eventSummary:s}),(null==(n=e.triggerValue)?void 0:n.switchId)&&t.push({eventIndex:a,type:"switch",originalId:e.triggerValue.switchId,eventSummary:s}),(null==(i=e.triggerValue)?void 0:i.storageMonitorId)&&e0.includes(e.triggerType)&&t.push({eventIndex:a,type:"storageMonitor",originalId:e.triggerValue.storageMonitorId,originalName:e.triggerValue.storageMonitorName,eventSummary:s}),e.actions&&Array.isArray(e.actions)&&e.actions.forEach(e=>{1===e.typeId&&e.switchId&&t.push({eventIndex:a,type:"switch",originalId:e.switchId,eventSummary:s}),2===e.typeId&&e.callGroupId&&t.push({eventIndex:a,type:"callGroup",originalId:e.callGroupId,eventSummary:s})})}),t})(r.data.events);e.length>0?(N(e),O(new Map),await K(),A(!1),k(!0)):$([])}else a.error(r.errmessage||"获取预设详情失败")}catch(e){a.error("获取预设详情失败")}};(0,n.useEffect)(()=>{V()},[]);let Q=async()=>{v&&("overwrite"===I?l.confirm({title:"确认覆盖",content:"覆盖模式将清空您现有的所有事件逻辑配置，确定要继续吗？",okText:"确认覆盖",cancelText:"取消",okButtonProps:{danger:!0},onOk:()=>J(v)}):J(v))},$=async e=>{if(v){b(!0),y(v.id);try{let r=await eQ("/api/f/importeventshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:v.id,mode:I,deviceMappings:e.length>0?e:void 0})}),n=await r.json();if(200===n.status){let{importedCount:e,skippedCount:r}=n.data,i="成功导入 ".concat(e," 条事件");r>0&&(i+="，跳过 ".concat(r," 条重复事件")),a.success(i),A(!1),k(!1),null==t||t()}else a.error(n.errmessage||"导入失败")}catch(e){a.error("导入失败，请检查网络连接")}finally{b(!1),y(null)}}},X=e=>M.get("".concat(e.eventIndex,":").concat(e.type,":").concat(e.originalId))||"",Z=()=>C.every(e=>""!==X(e)),ee=[{key:"official-event-presets",label:(0,r.jsxs)("span",{children:[(0,r.jsx)(eR.A,{style:{marginRight:8,color:"#faad14"}}),"官方预设",h.length>0&&(0,r.jsxs)("span",{style:{marginLeft:8,color:"var(--ant-color-text-tertiary)",fontSize:12},children:["(",h.length," 个)"]})]}),children:c?(0,r.jsx)("div",{style:{textAlign:"center",padding:"20px 0"},children:(0,r.jsx)(o.A,{tip:"加载中..."})}):0===h.length?(0,r.jsx)(d.A,{description:"暂无官方预设",image:d.A.PRESENTED_IMAGE_SIMPLE}):(0,r.jsx)("div",{children:h.map(e=>(0,r.jsx)(Y.A,{size:"small",style:{marginBottom:8},styles:{body:{padding:"12px 16px"}},children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,r.jsxs)("div",{style:{flex:1,marginRight:16},children:[(0,r.jsx)("div",{style:{marginBottom:4},children:(0,r.jsx)(e$,{strong:!0,children:e.name})}),e.description&&(0,r.jsx)("div",{children:(0,r.jsx)(e$,{type:"secondary",style:{fontSize:13},children:e.description})}),(0,r.jsx)("div",{children:(0,r.jsxs)(e$,{type:"secondary",style:{fontSize:12},children:["包含 ",e.eventCount," 条事件 \xb7 ",e.creatorName]})})]}),(0,r.jsx)(s.Ay,{type:"primary",size:"small",icon:(0,r.jsx)(x.A,{}),loading:g===e.id,onClick:()=>{f(e),S("append"),A(!0)},children:"导入"})]})},e.id))})}],et=(()=>{let e=[],t=new Set(C.map(e=>e.type));return t.has("switch")&&0===_.length&&e.push("switch"),t.has("alarm")&&0===R.length&&e.push("alarm"),t.has("callGroup")&&0===F.length&&e.push("callGroup"),t.has("storageMonitor")&&0===D.length&&e.push("storageMonitor"),e})();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eJ.A,{items:ee,style:{marginBottom:16},defaultActiveKey:[]}),(0,r.jsx)(E.A,{title:"导入预设",open:j,onOk:Q,onCancel:()=>A(!1),confirmLoading:T,okText:"确认导入",cancelText:"取消",children:v&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("div",{style:{marginBottom:4},children:(0,r.jsx)(e$,{strong:!0,children:v.name})}),v.description&&(0,r.jsx)("div",{children:(0,r.jsx)(e$,{type:"secondary",style:{fontSize:13},children:v.description})}),(0,r.jsx)("div",{style:{marginTop:4},children:(0,r.jsxs)(e$,{type:"secondary",style:{fontSize:12},children:["包含 ",v.eventCount," 条事件"]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(e$,{strong:!0,style:{display:"block",marginBottom:8},children:"导入模式："}),(0,r.jsx)(U.Ay.Group,{value:I,onChange:e=>S(e.target.value),children:(0,r.jsxs)(q.A,{direction:"vertical",children:[(0,r.jsxs)(U.Ay,{value:"append",children:["追加模式",(0,r.jsx)(e$,{type:"secondary",style:{fontSize:12,marginLeft:8},children:"保留现有配置，跳过重复事件"})]}),(0,r.jsxs)(U.Ay,{value:"overwrite",children:["覆盖模式",(0,r.jsx)(e$,{type:"danger",style:{fontSize:12,marginLeft:8},children:"清空现有配置，导入新配置"})]})]})})]})]})}),(0,r.jsx)(E.A,{title:"配置设备映射",open:w,onCancel:()=>k(!1),width:650,footer:[(0,r.jsx)(s.Ay,{onClick:()=>k(!1),children:"取消"},"cancel"),(0,r.jsx)(s.Ay,{type:"primary",disabled:!Z()||et.length>0,loading:T,onClick:()=>{let e=C.map(e=>({eventIndex:e.eventIndex,type:e.type,originalId:e.originalId,mappedId:X(e)})).filter(e=>""!==e.mappedId);k(!1),$(e)},children:"确认导入"},"confirm")],children:H?(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,r.jsx)(o.A,{tip:"加载设备列表..."})}):(0,r.jsxs)(r.Fragment,{children:[et.length>0&&(0,r.jsx)(z.A,{type:"error",showIcon:!0,message:"缺少必要设备",description:"请先配对以下设备：".concat(et.map(e=>eZ[e]).join("、")),style:{marginBottom:16}}),(0,r.jsx)(e$,{type:"secondary",style:{display:"block",marginBottom:16,fontSize:13},children:"预设中的设备ID与您的设备不同，请为每条事件选择对应的设备："}),(0,r.jsx)("div",{style:{maxHeight:400,overflowY:"auto"},children:C.map((e,t)=>{let a=(e=>{switch(e){case"switch":return _.map(e=>({value:e.id,label:e.name}));case"alarm":return R.map(e=>({value:e.id,label:e.name}));case"callGroup":return F.map(e=>({value:e.id,label:e.name}));case"storageMonitor":return D.map(e=>({value:e.id,label:e.name}));default:return[]}})(e.type),n=e.originalName||e.originalId;return(0,r.jsxs)("div",{style:{padding:12,marginBottom:8},children:[(0,r.jsx)("div",{style:{marginBottom:8},children:(0,r.jsx)(e$,{children:e.eventSummary})}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsxs)(e$,{type:"secondary",style:{fontSize:12,whiteSpace:"nowrap"},children:[eZ[e.type],":"]}),(0,r.jsx)(e$,{code:!0,style:{fontSize:11},children:n}),(0,r.jsx)(e$,{type:"secondary",style:{fontSize:12},children:"→"}),(0,r.jsx)(u.A,{placeholder:a.length>0?"选择设备":"无可用设备",style:{flex:1,minWidth:150},size:"small",value:X(e)||void 0,onChange:t=>((e,t)=>{let a="".concat(e.eventIndex,":").concat(e.type,":").concat(e.originalId),r=new Map(M);t?r.set(a,t):r.delete(a),O(r)})(e,t),options:a,disabled:0===a.length,allowClear:!0,showSearch:!0,optionFilterProp:"label"})]})]},"".concat(e.eventIndex,"-").concat(e.type,"-").concat(e.originalId,"-").concat(t))})}),!Z()&&0===et.length&&(0,r.jsx)("div",{style:{marginTop:12},children:(0,r.jsxs)(e$,{type:"warning",style:{fontSize:12},children:[(0,r.jsx)(eP.A,{style:{marginRight:4}}),"请为所有事件选择对应的设备"]})})]})})]})};var e2=a(50329),e5=a(44074);let e3=S.Aq.backendFetch,{Text:e4}=R.A,e8=e=>{let{open:t,onConfirm:a,onCancel:i,defaultValue:l=""}=e,[s,c]=(0,n.useState)(!0),[m,h]=(0,n.useState)([]),[p,u]=(0,n.useState)(null),[g,y]=(0,n.useState)(""),[x,j]=(0,n.useState)(null);(0,n.useEffect)(()=>{t&&(A(),y(""),u(null),j(null))},[t]);let A=async()=>{try{c(!0),j(null);let e=await e3("/api/f/getbmplayers",{method:"POST"}),t=await e.json();if(200===t.status){if(h(t.data.players||[]),l){let e=(t.data.players||[]).find(e=>e.id===l);e&&u(e)}}else j(t.errmessage||"获取玩家列表失败")}catch(e){j("网络错误，请稍后重试"),console.error(e)}finally{c(!1)}},v=(0,n.useMemo)(()=>{let e=m;if(g.trim()){let t=g.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.id.includes(t)||e.steamId&&e.steamId.includes(t))}return e},[m,g]);return(0,r.jsxs)(E.A,{title:"选择玩家",open:t,onOk:()=>{a(p)},onCancel:i,width:500,centered:!0,okText:"确认",cancelText:"取消",okButtonProps:{disabled:!p},zIndex:1100,children:[(0,r.jsx)("div",{style:{marginBottom:16},children:(0,r.jsx)(L.A,{placeholder:"搜索玩家名称",prefix:(0,r.jsx)(eh.A,{}),value:g,onChange:e=>y(e.target.value),allowClear:!0})}),s?(0,r.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,r.jsx)(o.A,{tip:"正在获取在线玩家列表..."})}):x?(0,r.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,r.jsx)(d.A,{description:(0,r.jsx)("span",{style:{color:"#ff4d4f"},children:x})})}):0===v.length?(0,r.jsx)(d.A,{description:g?"没有找到匹配的玩家":"当前服务器没有在线玩家"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{marginBottom:8,color:"#888"},children:["共 ",m.length," 名在线玩家",g&&" (显示 ".concat(v.length," 个结果)")]}),(0,r.jsx)(k.A,{style:{maxHeight:400,overflow:"auto",border:"1px solid #303030",borderRadius:8},dataSource:v,renderItem:e=>{let t=(null==p?void 0:p.id)===e.id;return(0,r.jsx)(k.A.Item,{onClick:()=>{u(e)},style:{cursor:"pointer",backgroundColor:t?"#177ddc":"transparent",borderLeft:t?"3px solid #1890ff":"3px solid transparent",padding:"12px 16px",transition:"all 0.2s"},onMouseEnter:e=>{t||(e.currentTarget.style.backgroundColor="rgba(255,255,255,0.08)")},onMouseLeave:e=>{t||(e.currentTarget.style.backgroundColor="transparent")},children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[(0,r.jsx)(e2.A,{style:{marginRight:12,fontSize:18,color:t?"#fff":"#1890ff"}}),(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("div",{style:{fontWeight:500,color:t?"#fff":void 0},children:e.name}),(0,r.jsx)(eV.A,{title:"仅用于区分同名玩家，不是 SteamID",children:(0,r.jsxs)(e4,{style:{fontSize:12,color:t?"rgba(255,255,255,0.7)":void 0},type:t?void 0:"secondary",children:["ID: ",e.id]})})]}),t&&(0,r.jsx)(e5.A,{style:{color:"#fff",fontSize:18}})]})})}})]})]})},e6=S.Aq.backendFetch,e7=e=>{let{open:t,onConfirm:a,onCancel:i,defaultValue:l="",filterType:s="all",title:m}=e,[h,p]=(0,n.useState)(!0),[u,g]=(0,n.useState)([]),[y,x]=(0,n.useState)(l);(0,n.useEffect)(()=>{t&&(j(),x(l))},[t,l]);let j=async()=>{try{p(!0);let e=await e6("/api/f/getstoragemonitorlist",{method:"POST"}),t=await e.json();if(200===t.status){let e=t.data.list||[];"toolCupboard"===s&&(e=e.filter(e=>"toolCupboard"===e.storageType||29===e.capacity)),g(e)}else throw Error("获取存储监视器列表失败")}catch(e){b.Ay.error("获取存储监视器列表失败"),console.error(e)}finally{p(!1)}};return(0,r.jsx)(E.A,{title:m||("toolCupboard"===s?"选择工具柜":"选择存储监视器"),open:t,onOk:()=>{let e=u.find(e=>e.id===y);e?a(e.id,e.name||"监视器 ".concat(e.id)):b.Ay.warning("toolCupboard"===s?"请选择一个工具柜":"请选择一个存储监视器")},onCancel:i,width:400,centered:!0,okText:"确认",cancelText:"取消",zIndex:1100,children:(0,r.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:h?(0,r.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,r.jsx)(o.A,{tip:"加载中..."})}):0===u.length?(0,r.jsx)(d.A,{description:"toolCupboard"===s?"暂无工具柜，请先配对工具柜的存储监视器":"暂无存储监视器，请先配对"}):(0,r.jsx)(k.A,{dataSource:u,renderItem:e=>(0,r.jsx)(k.A.Item,{onClick:()=>{x(e.id)},style:{cursor:"pointer",padding:"12px 16px",borderRadius:8,marginBottom:8,background:y===e.id?"rgba(22, 119, 255, 0.1)":"transparent",border:y===e.id?"1px solid rgba(22, 119, 255, 0.4)":"1px solid transparent"},children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,width:"100%"},children:[(0,r.jsx)(ed.A,{style:{fontSize:20,color:y===e.id?"#1677ff":"#666"}}),(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("div",{style:{fontWeight:y===e.id?500:400},children:e.name||"监视器 ".concat(e.id)}),e.note&&(0,r.jsx)(c.A,{color:e.noteColor||"default",style:{marginTop:4},children:e.note})]}),y===e.id&&(0,r.jsx)(c.A,{color:"processing",children:"已选择"})]})})})})})};var e9=a(21038),te=a(26934);let tt=S.Aq.backendFetch,ta=e=>{let{shortname:t}=e,[a,i]=(0,n.useState)(!1);if(!t||a)return(0,r.jsx)(e9.A,{size:36,icon:(0,r.jsx)(te.A,{}),style:{background:"rgba(99, 102, 241, 0.1)",color:"#818cf8"}});let l="https://www.rustplus.cn/item/images/".concat(t,".png");return(0,r.jsx)("img",{src:l,alt:t,width:36,height:36,style:{borderRadius:4,background:"rgba(99, 102, 241, 0.1)",objectFit:"contain"},loading:"lazy",onError:()=>i(!0)})},tr=e=>{let{open:t,onConfirm:a,onCancel:i,defaultValue:l}=e,[s,c]=(0,n.useState)(!1),[m,h]=(0,n.useState)([]),[p,u]=(0,n.useState)(l),[g,y]=(0,n.useState)(""),[x,j]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&(u(l),y(""),j(!1))},[t,l]);let A=async()=>{try{c(!0);let e=await tt("/api/f/getitemslist",{method:"POST"}),t=await e.json();if(200===t.status)h(t.data.items||[]);else throw Error("获取物品列表失败")}catch(e){b.Ay.error("获取物品列表失败"),console.error(e)}finally{c(!1)}},v=async()=>{if(!g.trim())return void b.Ay.warning("请输入搜索关键词");0===m.length&&await A(),j(!0)},f=(0,n.useMemo)(()=>{if(!x||!g.trim())return[];let e=g.toLowerCase().trim();return m.filter(t=>{var a,r,n;return(null==(a=t.displayname)?void 0:a.toLowerCase().includes(e))||(null==(r=t.name)?void 0:r.toLowerCase().includes(e))||(null==(n=t.shortname)?void 0:n.toLowerCase().includes(e))})},[m,g,x]);return(0,r.jsxs)(E.A,{title:"选择物品",open:t,onOk:()=>{let e=m.find(e=>e.itemId===p);e?a(e.itemId,e.displayname||e.name):b.Ay.warning("请选择一个物品")},onCancel:i,width:500,centered:!0,okText:"确认",cancelText:"取消",zIndex:1100,children:[(0,r.jsx)(L.A.Search,{placeholder:"输入物品名称搜索...",value:g,onChange:e=>y(e.target.value),onSearch:v,onKeyPress:e=>{"Enter"===e.key&&v()},enterButton:"搜索",allowClear:!0,style:{marginBottom:12},loading:s}),(0,r.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:s?(0,r.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,r.jsx)(o.A,{tip:"加载中..."})}):x?0===f.length?(0,r.jsx)(d.A,{description:"没有找到匹配的物品"}):(0,r.jsx)(k.A,{dataSource:f,renderItem:e=>(0,r.jsx)(k.A.Item,{onClick:()=>{u(e.itemId)},style:{cursor:"pointer",padding:"8px 12px",borderRadius:6,marginBottom:4,background:p===e.itemId?"rgba(22, 119, 255, 0.1)":"transparent",border:p===e.itemId?"1px solid rgba(22, 119, 255, 0.4)":"1px solid transparent"},children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,width:"100%"},children:[(0,r.jsx)(ta,{shortname:e.shortname}),(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("div",{style:{fontWeight:p===e.itemId?500:400},children:e.displayname||e.name}),(0,r.jsx)("div",{style:{fontSize:12,color:"#888"},children:e.shortname})]})]})})}):(0,r.jsx)(d.A,{description:"请输入关键词搜索物品"})})]})},tn=S.Aq.backendFetch,ti=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(await tn("/api/f/geteventlogiclist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:e,pageSize:t})})).json()},tl=async e=>(await tn("/api/f/addeventlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json(),ts=async e=>(await tn("/api/f/seteventlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json(),to=async e=>(await tn("/api/f/deleventlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).json(),td=async e=>(await tn("/api/f/toggleeventlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e})})).json(),tc=async e=>(await tn("/api/f/togglealleventlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e})})).json();function tm(){var e,t;let{message:a}=i.A.useApp(),{pageSize:S,setPageSize:b,pageSizeOptions:E}=(0,I.Y)("eventlogic"),[w,k]=(0,n.useState)([]),[C,M]=(0,n.useState)(!1),[O,R]=(0,n.useState)({current:1,pageSize:S,total:0}),[L,F]=(0,n.useState)(!1),[z,G]=(0,n.useState)(!1),[D,B]=(0,n.useState)(!1),[H,W]=(0,n.useState)(!1),[V,Y]=(0,n.useState)(!1),[q,U]=(0,n.useState)(!1),[K,J]=(0,n.useState)(!1),[Q,$]=(0,n.useState)(!1),[X,Z]=(0,n.useState)(!1),[ee,et]=(0,n.useState)(!1),[ea,er]=(0,n.useState)(!1),[en,ei]=(0,n.useState)(!1),[el,es]=(0,n.useState)(null),[eo,ed]=(0,n.useState)(-1),[ec,em]=(0,n.useState)([]),[eh,ep]=(0,n.useState)(null),[eu,eg]=(0,n.useState)(!1),[ey]=l.A.useForm(),ex=async()=>{M(!0);try{let e=await ti(O.current,O.pageSize);200===e.status?(k(e.data.list),R({...O,total:e.data.total})):a.error(e.errmessage||"获取数据失败")}catch(e){a.error("请检查网络连接")}finally{M(!1)}};(0,n.useEffect)(()=>{S!==O.pageSize&&R(e=>({...e,current:1,pageSize:S}))},[S]),(0,n.useEffect)(()=>{ex()},[O.current,O.pageSize]);let ej=e=>{es(e);let t=e.triggerValue||{};em(e.actions||[]);let a=e.triggerCooldown||0,r={triggerType:e.triggerType,note:e.note||"",triggerDelay:e.triggerDelay||0,triggerCooldown:a,cooldownHours:Math.floor(a/3600),cooldownMinutes:Math.floor(a%3600/60),cooldownSeconds:a%60};switch(e.triggerType){case eA.REAL_TIME:case eA.PLAY_TIME:"advanced"===t.mode?r.timeConfig=t:t.timestr&&(r.timeConfig={mode:"simple",timestr:t.timestr});break;case eA.ALARM_POWER_ON:case eA.ALARM_POWER_OFF:r.alarmId=t.alarmId;break;case eA.SWITCH_DESTROYED:case eA.SWITCH_TURNED_ON:case eA.SWITCH_TURNED_OFF:r.triggerSwitchId=t.switchId;break;case eA.PLAYER_ONLINE:case eA.PLAYER_OFFLINE:r.playerBmId=t.bmPlayerId||"",r.playerName=t.playerName||"";break;case eA.TEAMMATE_ONLINE:case eA.TEAMMATE_OFFLINE:r.teammateName=t.teammateName,t.countCondition&&(r.countOperation=t.countCondition.operation,r.countComparison=t.countCondition.comparison,r.countValue=t.countCondition.value);break;case eA.TEAMMATE_DEATH:case eA.TEAMMATE_RESPAWN:r.teammateName=t.teammateName;break;case eA.TEAMMATE_AFK:r.teammateName=t.teammateName,r.afkDuration=t.afkDuration,r.afkTriggerCondition=t.afkTriggerCondition||"start";break;case eA.STORAGE_ITEM_ABOVE_THRESHOLD:r.storageMonitorId=t.storageMonitorId,r.storageMonitorName=t.storageMonitorName,r.itemId=t.itemId,r.itemName=t.itemName,r.threshold=t.threshold;break;case eA.STORAGE_ITEM_CHANGED:r.storageMonitorId=t.storageMonitorId,r.storageMonitorName=t.storageMonitorName,r.itemId=t.itemId,r.itemName=t.itemName,r.changeType=t.changeType;break;case eA.STORAGE_ITEM_EMPTY:r.storageMonitorId=t.storageMonitorId,r.storageMonitorName=t.storageMonitorName,r.itemId=t.itemId,r.itemName=t.itemName;break;case eA.STORAGE_CONTAINER_EMPTY:case eA.STORAGE_CONTAINER_FULL:case eA.STORAGE_MONITOR_OFFLINE:r.storageMonitorId=t.storageMonitorId,r.storageMonitorName=t.storageMonitorName;break;case eA.TC_UPKEEP_TIME:r.storageMonitorId=t.storageMonitorId,r.storageMonitorName=t.storageMonitorName,r.comparison=t.comparison,r.thresholdMinutes=t.thresholdMinutes}ey.setFieldsValue(r),F(!0)},ef=async()=>{try{ei(!0);let e=await ey.validateFields(),t={};switch(e.triggerType){case eA.REAL_TIME:case eA.PLAY_TIME:if(e.timeConfig)t=e.timeConfig;else{a.error("请配置触发时间"),ei(!1);return}break;case eA.ALARM_POWER_ON:case eA.ALARM_POWER_OFF:t={alarmId:e.alarmId};break;case eA.SWITCH_DESTROYED:case eA.SWITCH_TURNED_ON:case eA.SWITCH_TURNED_OFF:t={switchId:e.triggerSwitchId};break;case eA.PLAYER_ONLINE:case eA.PLAYER_OFFLINE:if(!e.playerBmId){a.error("请选择要监测的玩家"),ei(!1);return}t={bmPlayerId:e.playerBmId,playerName:e.playerName||""};break;case eA.TEAMMATE_ONLINE:case eA.TEAMMATE_OFFLINE:t={teammateName:e.teammateName||void 0},e.countOperation&&e.countComparison&&void 0!==e.countValue&&null!==e.countValue&&(t.countCondition={operation:e.countOperation,comparison:e.countComparison,value:e.countValue});break;case eA.TEAMMATE_DEATH:case eA.TEAMMATE_RESPAWN:t={teammateName:e.teammateName||void 0};break;case eA.TEAMMATE_AFK:if(!e.afkDuration||e.afkDuration<10){a.error("挂机时长最少10秒"),ei(!1);return}t={teammateName:e.teammateName||void 0,afkDuration:e.afkDuration,afkTriggerCondition:e.afkTriggerCondition||"start"};break;case eA.STORAGE_ITEM_ABOVE_THRESHOLD:if(!e.storageMonitorId){a.error("请选择存储监视器"),ei(!1);return}if(!e.itemId){a.error("请选择监测物品"),ei(!1);return}if(void 0===e.threshold||null===e.threshold||e.threshold<0){a.error("请设置有效的阈值"),ei(!1);return}t={storageMonitorId:e.storageMonitorId,storageMonitorName:e.storageMonitorName||"",itemId:e.itemId,itemName:e.itemName||"",threshold:e.threshold};break;case eA.STORAGE_ITEM_CHANGED:if(!e.storageMonitorId){a.error("请选择存储监视器"),ei(!1);return}if(!e.itemId){a.error("请选择监测物品"),ei(!1);return}if(!e.changeType){a.error("请选择变化类型"),ei(!1);return}t={storageMonitorId:e.storageMonitorId,storageMonitorName:e.storageMonitorName||"",itemId:e.itemId,itemName:e.itemName||"",changeType:e.changeType};break;case eA.STORAGE_ITEM_EMPTY:if(!e.storageMonitorId){a.error("请选择存储监视器"),ei(!1);return}if(!e.itemId){a.error("请选择监测物品"),ei(!1);return}t={storageMonitorId:e.storageMonitorId,storageMonitorName:e.storageMonitorName||"",itemId:e.itemId,itemName:e.itemName||""};break;case eA.STORAGE_CONTAINER_EMPTY:case eA.STORAGE_CONTAINER_FULL:case eA.STORAGE_MONITOR_OFFLINE:if(!e.storageMonitorId){a.error("请选择存储监视器"),ei(!1);return}t={storageMonitorId:e.storageMonitorId,storageMonitorName:e.storageMonitorName||""};break;case eA.TC_UPKEEP_TIME:if(!e.storageMonitorId){a.error("请选择工具柜"),ei(!1);return}if(!e.comparison){a.error("请选择条件"),ei(!1);return}if(!e.thresholdMinutes||e.thresholdMinutes<1){a.error("请输入有效的阈值"),ei(!1);return}t={storageMonitorId:e.storageMonitorId,storageMonitorName:e.storageMonitorName||"",comparison:e.comparison,thresholdMinutes:e.thresholdMinutes}}let r=ec.filter(e=>e.typeId===ev.SWITCH?!!e.switchId:e.typeId===ev.CALL?!!e.callGroupId:e.typeId===ev.MESSAGE&&!!e.message);if(0===r.length){a.error("至少需要配置一个动作"),ei(!1);return}let n=r.map(e=>{if(e.typeId===ev.SWITCH){let{switchName:t,...a}=e;return a}if(e.typeId!==ev.CALL)return e;{let{callGroupName:t,...a}=e;return a}}),i=void 0!==e.triggerCooldown&&null!==e.triggerCooldown?e.triggerCooldown:3600*(e.cooldownHours||0)+60*(e.cooldownMinutes||0)+(e.cooldownSeconds||0),l={triggerType:e.triggerType,triggerValue:JSON.stringify(t),actions:n,note:e.note||"",triggerDelay:e.triggerDelay||0,triggerCooldown:i};if(el){l.id=el.id;let e=await ts(l);200===e.status?(a.success("更新成功"),F(!1),ex()):a.error(e.errmessage||"更新失败")}else{let e=await tl(l);200===e.status?(a.success("添加成功"),F(!1),ex()):a.error(e.errmessage||"添加失败")}}catch(e){a.error("操作失败，请检查输入")}finally{ei(!1)}},eS=async e=>{try{let t=await to(e);200===t.status?(a.success("删除成功"),ex()):a.error(t.errmessage||"删除失败")}catch(e){a.error("删除失败")}},eT=async(e,t)=>{ep(e);try{let r=await td([{id:e,enabled:t}]);200===r.status?k(a=>a.map(a=>a.id===e?{...a,enabled:t}:a)):a.error(r.errmessage||"操作失败")}catch(e){a.error("操作失败")}finally{ep(null)}},eE=async e=>{eg(!0);try{let t=await tc(e);200===t.status?(a.success(e?"已全部启用":"已全部禁用"),k(t=>t.map(t=>({...t,enabled:e})))):a.error(t.errmessage||"操作失败")}catch(e){a.error("操作失败")}finally{eg(!1)}},ew=w.some(e=>!1!==e.enabled),ek=w.some(e=>!1===e.enabled);return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(e1,{onImportSuccess:ex}),(0,r.jsxs)("div",{style:{marginBottom:16,display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[(0,r.jsx)(s.Ay,{type:"primary",icon:(0,r.jsx)(g.A,{}),onClick:()=>{es(null),ey.resetFields(),ey.setFieldsValue({triggerDelay:0,triggerCooldown:0,cooldownHours:0,cooldownMinutes:0,cooldownSeconds:0}),em([]),F(!0)},children:"添加事件逻辑"}),(0,r.jsx)(s.Ay,{icon:(0,r.jsx)(y.A,{}),onClick:()=>U(!0),children:"分享配置"}),(0,r.jsx)(s.Ay,{icon:(0,r.jsx)(x.A,{}),onClick:()=>J(!0),children:"导入配置"}),(0,r.jsx)(s.Ay,{icon:(0,r.jsx)(j.A,{}),onClick:()=>$(!0),children:"我的分享"}),w.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{flex:1}}),ew&&(0,r.jsx)(s.Ay,{icon:(0,r.jsx)(A.A,{}),onClick:()=>eE(!1),loading:eu,children:"全部禁用"}),ek&&(0,r.jsx)(s.Ay,{type:"primary",icon:(0,r.jsx)(A.A,{}),onClick:()=>eE(!0),loading:eu,children:"全部启用"})]})]}),(0,r.jsx)(o.A,{spinning:C,children:0!==w.length||C?(0,r.jsx)("div",{className:"data-list",children:w.map((e,t)=>{let a=!1===e.enabled;return(0,r.jsxs)("div",{className:"data-list-item ".concat(a?"data-list-item-disabled":""),onClick:()=>ej(e),children:[(0,r.jsxs)("div",{className:"data-list-item-left",children:[(0,r.jsxs)("div",{className:"data-list-item-header",children:[(0,r.jsx)(c.A,{children:eI[e.triggerType]||"未知(".concat(e.triggerType,")")}),(0,r.jsx)("span",{className:"data-list-item-note",children:e.note||"未命名"})]}),(0,r.jsxs)("div",{className:"data-list-item-info",children:[(0,r.jsxs)("span",{className:"info-item",children:[(0,r.jsx)("span",{className:"info-label",children:"触发:"}),(0,r.jsx)("span",{className:"info-value",children:(e=>{let t=e.triggerValue||{};switch(e.triggerType){case eA.REAL_TIME:case eA.PLAY_TIME:if("advanced"===t.mode)return(e=>{var t,a,r,n,i,l;if(!e)return"-";let s=[];if(e.weekdays&&e.weekdays.length>0&&e.weekdays.length<7){let t=["","周一","周二","周三","周四","周五","周六","周日"],a=[...e.weekdays].sort((e,t)=>e-t);5===a.length&&"1,2,3,4,5"===a.join(",")?s.push("工作日"):2===a.length&&"6,7"===a.join(",")?s.push("周末"):s.push(a.map(e=>t[e]).join(""))}switch(e.hourMode){case"every":s.push("每小时");break;case"fixed":(null==(t=e.hours)?void 0:t.length)===1?s.push("".concat(e.hours[0],"点")):(null==(a=e.hours)?void 0:a.length)>0&&s.push("".concat(e.hours.slice(0,3).join(",")).concat(e.hours.length>3?"...":"","点"));break;case"range":s.push("".concat(null!=(r=e.hourStart)?r:0,"-").concat(null!=(n=e.hourEnd)?n:23,"点"));break;case"interval":s.push("每".concat(e.hourInterval||1,"h"))}switch(e.minuteMode){case"every":s.push("每分钟");break;case"fixed":(null==(i=e.minutes)?void 0:i.length)===1&&0===e.minutes[0]?s.push("整点"):(null==(l=e.minutes)?void 0:l.length)>0&&s.push("".concat(e.minutes.slice(0,3).join(",")).concat(e.minutes.length>3?"...":"","分"));break;case"interval":s.push("每".concat(e.minuteInterval||15,"min"))}return s.join(" ")||"-"})(t.advanced);return"时间: ".concat(t.timestr||"-");case eA.ALARM_POWER_ON:case eA.ALARM_POWER_OFF:return"警报ID: ".concat(t.alarmId||"-");case eA.SWITCH_DESTROYED:case eA.SWITCH_TURNED_ON:case eA.SWITCH_TURNED_OFF:return"开关ID: ".concat(t.switchId||"-");case eA.PLAYER_ONLINE:case eA.PLAYER_OFFLINE:if(t.playerName)return"玩家: ".concat(t.playerName);if(t.bmPlayerId)return"玩家ID: ".concat(t.bmPlayerId);return"-";case eA.TEAMMATE_ONLINE:case eA.TEAMMATE_OFFLINE:{let e=[];if(t.teammateName&&e.push("队友: ".concat(t.teammateName)),t.countCondition){let{operation:a,comparison:r,value:n}=t.countCondition;e.push("人数".concat({increase:"增加后",decrease:"减少后",any:""}[a]||"").concat({eq:"=",lt:"<",gt:">"}[r]||"").concat(n))}return e.length>0?e.join(" | "):"-"}case eA.TEAMMATE_AFK:{let e=[];if(t.teammateName&&e.push("队友: ".concat(t.teammateName)),t.afkDuration){let a=t.afkDuration;a>=3600?e.push("挂机".concat(Math.floor(a/3600),"小时").concat(a%3600>0?Math.floor(a%3600/60)+"分钟":"")):a>=60?e.push("挂机".concat(Math.floor(a/60),"分钟").concat(a%60>0?a%60+"秒":"")):e.push("挂机".concat(a,"秒"))}let a=t.afkTriggerCondition||"start";return e.push({start:"开始时",end:"结束时"}[a]||"开始时"),e.length>0?e.join(" | "):"-"}case eA.STORAGE_ITEM_ABOVE_THRESHOLD:{let e=t.storageMonitorName||t.storageMonitorId||"-",a=t.itemName||"-";return"".concat(e," | ").concat(a," > ").concat(t.threshold||0)}case eA.STORAGE_ITEM_CHANGED:{let e=t.storageMonitorName||t.storageMonitorId||"-",a=t.itemName||"-";return"".concat(e," | ").concat(a," ").concat({increase:"增加",decrease:"减少",both:"变化"}[t.changeType]||"变化")}case eA.STORAGE_ITEM_EMPTY:{let e=t.storageMonitorName||t.storageMonitorId||"-",a=t.itemName||"-";return"".concat(e," | ").concat(a," 清空")}case eA.STORAGE_CONTAINER_EMPTY:case eA.STORAGE_CONTAINER_FULL:case eA.STORAGE_MONITOR_OFFLINE:{let e=t.storageMonitorName||t.storageMonitorId||"-";return"监视器: ".concat(e)}case eA.TC_UPKEEP_TIME:{let e=t.storageMonitorName||t.storageMonitorId||"-",a=t.thresholdMinutes||0,r=Math.floor(a/1440),n=Math.floor(a%1440/60),i=a%60,l="";return r>0&&(l+="".concat(r,"天")),n>0&&(l+="".concat(n,"时")),(i>0||""===l)&&(l+="".concat(i,"分")),"".concat(e," | 维护时间 ").concat({lt:"<",gt:">"}[t.comparison]||"?"," ").concat(l)}default:return"-"}})(e)})]}),(0,r.jsx)("span",{className:"info-divider",children:"|"}),(0,r.jsxs)("span",{className:"info-item",children:[(0,r.jsx)("span",{className:"info-label",children:"动作:"}),(0,r.jsx)("span",{className:"info-value",children:(e=>{let t=e.actions||[],a=t.filter(e=>e.typeId===ev.SWITCH).length,r=t.filter(e=>e.typeId===ev.CALL).length,n=t.filter(e=>e.typeId===ev.MESSAGE).length,i=[];return a>0&&i.push("开关: ".concat(a,"个")),r>0&&i.push("呼叫: ".concat(r,"个")),n>0&&i.push("信息: ".concat(n,"个")),i.length>0?i.join(" | "):"无动作"})(e)})]})]})]}),(0,r.jsxs)("div",{className:"data-list-item-right",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)(m.A,{size:"small",checked:!a,loading:eh===e.id,onChange:t=>eT(e.id,t),checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,r.jsx)(s.Ay,{type:"text",size:"small",icon:(0,r.jsx)(v.A,{}),onClick:()=>ej(e),children:"编辑"}),(0,r.jsx)(h.A,{title:"确定删除此事件？",onConfirm:()=>eS(e.id),children:(0,r.jsx)(s.Ay,{type:"text",size:"small",icon:(0,r.jsx)(f.A,{}),danger:!0,children:"删除"})})]})]},e.id)})}):(0,r.jsx)(d.A,{description:"暂无数据"})}),O.total>O.pageSize&&(0,r.jsxs)("div",{className:"data-card-pagination",children:[(0,r.jsx)(p.A,{current:O.current,pageSize:O.pageSize,total:O.total,onChange:(e,t)=>R({...O,current:e,pageSize:t}),size:"small",showSizeChanger:!1,showTotal:e=>"共 ".concat(e," 条")}),(0,r.jsx)(u.A,{value:O.pageSize,onChange:e=>{b(e),R({...O,current:1,pageSize:e})},options:E.map(e=>({value:e,label:"".concat(e,"条/页")})),size:"small",style:{width:90,marginLeft:8}})]}),(0,r.jsx)(eb,{open:L,currentRecord:el,onOk:ef,onCancel:()=>{F(!1)},confirmLoading:en,form:ey,onSwitchSelect:e=>{ed(e),G(!0)},onAlarmSelect:()=>B(!0),onTriggerSwitchSelect:()=>W(!0),onCallGroupSelect:e=>{ed(e),Y(!0)},onPlayerSelect:()=>{Z(!0)},onStorageMonitorSelect:()=>{et(!0)},onItemSelect:()=>{er(!0)},validateTime:(e,t)=>/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(t)?Promise.resolve():Promise.reject(Error('请输入有效的24小时制时间，如"10:10"')),actions:ec,onActionsChange:em}),z&&(0,r.jsx)(T.A,{open:z,onConfirm:(e,t)=>{if(eo>=0&&e.length>0){let a=[...ec],r=t[0],n=a[eo];n.typeId===ev.SWITCH&&(a[eo]={...n,switchId:e[0],switchName:(null==r?void 0:r.name)||""},em(a))}G(!1),ed(-1)},defaultValue:eo>=0&&(null==(e=ec[eo])?void 0:e.typeId)===ev.SWITCH?[ec[eo].switchId].filter(Boolean):[],onCancel:()=>{G(!1),ed(-1)},maxSelect:1}),D&&(0,r.jsx)(N,{open:D,onConfirm:e=>{e.length>0&&ey.setFieldsValue({alarmId:e[0]}),B(!1)},defaultValue:ey.getFieldValue("alarmId")?[ey.getFieldValue("alarmId")]:[],onCancel:()=>B(!1),maxSelect:1}),H&&(0,r.jsx)(T.A,{open:H,onConfirm:(e,t)=>{e.length>0&&ey.setFieldsValue({triggerSwitchId:e[0]}),W(!1)},defaultValue:ey.getFieldValue("triggerSwitchId")?[ey.getFieldValue("triggerSwitchId")]:[],onCancel:()=>W(!1),maxSelect:1}),V&&(0,r.jsx)(P,{open:V,onConfirm:(e,t)=>{if(eo>=0&&e.length>0){let a=[...ec],r=t[0],n=a[eo];if(n.typeId===ev.CALL){let t=_(null==r?void 0:r.value),i=(null==r?void 0:r.note)||(null==r?void 0:r.name)||"已选择呼叫组";a[eo]={...n,callGroupId:e[0],callGroupName:"".concat(i,"(").concat(t,"积分)")},em(a)}}Y(!1),ed(-1)},defaultValue:eo>=0&&(null==(t=ec[eo])?void 0:t.typeId)===ev.CALL?[ec[eo].callGroupId].filter(Boolean):[],onCancel:()=>{Y(!1),ed(-1)},maxSelect:1}),(0,r.jsx)(eO,{open:q,onCancel:()=>U(!1),onSuccess:()=>{},eventLogics:w}),(0,r.jsx)(eW,{open:K,onCancel:()=>J(!1),onSuccess:ex}),(0,r.jsx)(eK,{open:Q,onCancel:()=>$(!1)}),(0,r.jsx)(e8,{open:X,onConfirm:e=>{e&&ey.setFieldsValue({playerBmId:e.id,playerName:e.name}),Z(!1)},onCancel:()=>Z(!1),defaultValue:ey.getFieldValue("playerName")||""}),(0,r.jsx)(e7,{open:ee,onConfirm:(e,t)=>{ey.setFieldsValue({storageMonitorId:e,storageMonitorName:t}),et(!1)},onCancel:()=>et(!1),defaultValue:ey.getFieldValue("storageMonitorId")||"",filterType:ey.getFieldValue("triggerType")===eA.TC_UPKEEP_TIME?"toolCupboard":"all"}),(0,r.jsx)(tr,{open:ea,onConfirm:(e,t)=>{ey.setFieldsValue({itemId:e,itemName:t}),er(!1)},onCancel:()=>er(!1),defaultValue:ey.getFieldValue("itemId")})]})}}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,5445,9073,6060,4540,9578,6133,2718,8272,2587,4425,5702,5078,4187,5125,6861,1386,5634,7212,8441,1255,7358],()=>e(e.s=26351)),_N_E=e.O()}]);