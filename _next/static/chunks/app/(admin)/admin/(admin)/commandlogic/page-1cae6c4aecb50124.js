(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7830],{6201:(e,t,a)=>{"use strict";a.d(t,{A:()=>u});var n=a(95155),s=a(12115),r=a(3415),i=a(15856),l=a(36060),c=a(35078),o=a(98946),d=a(43561),m=a(37783),h=a(50886);let p=m.Aq.backendFetch,u=e=>{let{open:t,onConfirm:a,onCancel:m,defaultValue:u=[],maxSelect:y=1/0}=e,[x,g]=(0,s.useState)(!0),[j,f]=(0,s.useState)([]),[A,v]=(0,s.useState)(u),S=(0,h.I)();(0,s.useEffect)(()=>{t&&(w(),v(u))},[t]);let w=async()=>{try{g(!0);let e=await p("/api/f/getswitchlist",{method:"POST"}),t=await e.json();if(200===t.status)f(t.data.list);else throw Error("获取开关列表失败")}catch(e){r.Ay.error("获取开关列表失败"),console.error(e)}finally{g(!1)}};return(0,n.jsx)(i.A,{title:"选择开关",open:t,onOk:()=>{let e=j.filter(e=>A.includes(e.id));a(A,e)},onCancel:m,width:S?"90vw":500,centered:!0,okText:"确认",cancelText:"取消",children:(0,n.jsx)("div",{className:"switch-selector",children:x?(0,n.jsx)(l.A,{tip:"加载中..."}):(0,n.jsxs)(n.Fragment,{children:[y<1/0&&(0,n.jsxs)("div",{style:{marginBottom:16,color:"#666"},children:["已选择 ",A.length,"/",y," 个"]}),(0,n.jsx)(c.A.Group,{value:A,onChange:e=>{if(e.length>y)return void r.Ay.warning("最多只能选择 ".concat(y," 个选项"));v(e)},style:{width:"100%"},children:(0,n.jsx)(o.A,{dataSource:j,renderItem:e=>{let t;return(0,n.jsx)(o.A.Item,{children:(0,n.jsx)(c.A,{value:e.id,disabled:(t=e.id,A.length>=y&&!A.includes(t)),children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)("span",{style:{marginRight:8},children:e.name}),e.note&&(0,n.jsx)(d.A,{color:e.noteColor,children:e.note})]})})})}})})]})})})}},37783:(e,t,a)=>{"use strict";a.d(t,{Aq:()=>s,Ay:()=>r});let n="http://localhost:44667";class s{static formatDateTime(e){let t=new Date(e),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),r=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return"".concat(a,"-").concat(n,"-").concat(s," ").concat(r,":").concat(i)}static async copyToClipboard(e,t){let{onSuccess:a,onError:n}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==a||a(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==a||a(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==a||a(),!0}catch(e){return null==n||n(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(n).concat(e):e.startsWith("/api/")?"".concat(n,"/api/backend").concat(e.slice(4)):"".concat(n).concat(e)}static async backendFetch(e,t){return fetch(s.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,a;let n="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===n.length)return null!=(a=null==(t=n.pop())?void 0:t.split(";").shift())?a:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let r={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},45790:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ef});var n=a(95155),s=a(12115),r=a(89543),i=a(86133),l=a(785),c=a(36060),o=a(19588),d=a(43561),m=a(69887),h=a(84549),p=a(91589),u=a(59103),y=a(66968),x=a(48601),g=a(49960),j=a(67242),f=a(95873),A=a(46172),v=a(88795),S=a(37783),w=a(6201),I=a(15856),b=a(49073);let{Option:C}=u.A;function k(e){let{open:t,currentRecord:a,onOk:r,onCancel:c,confirmLoading:o,form:d,onSwitchSelect:m,validateSwitchIds:h}=e,p=i.A.useWatch("typeId",d);return(0,n.jsx)(I.A,{title:a?"编辑指令逻辑":"添加指令逻辑",open:t,onOk:r,confirmLoading:o,onCancel:c,width:700,children:(0,n.jsxs)(i.A,{form:d,layout:"vertical",children:[(0,n.jsx)(i.A.Item,{name:"note",label:"逻辑名",children:(0,n.jsx)(b.A,{placeholder:"未命名",maxLength:100})}),(0,n.jsx)(i.A.Item,{name:"typeId",label:"逻辑类型",rules:[{required:!0,message:"请选择逻辑类型"}],children:(0,n.jsxs)(u.A,{disabled:!!a,children:[(0,n.jsx)(C,{value:1,children:"指令控制开关"}),(0,n.jsx)(C,{value:2,children:"指令翻译"}),(0,n.jsx)(C,{value:3,children:"指令AI问答"}),(0,n.jsx)(C,{value:4,children:"更改队长"}),(0,n.jsx)(C,{value:5,children:"查看服务器信息"}),(0,n.jsx)(C,{value:6,children:"指令控制全局信息开关"}),(0,n.jsx)(C,{value:7,children:"获取队伍信息"}),(0,n.jsx)(C,{value:8,children:"查询货船"}),(0,n.jsx)(C,{value:9,children:"查询武装直升机"}),(0,n.jsx)(C,{value:10,children:"查询军用直升机"}),(0,n.jsx)(C,{value:11,children:"查询流浪商人"}),(0,n.jsx)(C,{value:12,children:"查询售货机"})]})}),1===p&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(i.A.Item,{name:"switchid",label:"目标开关",rules:[{required:!0,message:"请选择开关名称"},{validator:h}],children:(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsx)(b.A,{placeholder:"点击右侧按钮选择开关",readOnly:!0,style:{marginRight:8},value:d.getFieldValue("switchid")?"已选择开关数量: "+d.getFieldValue("switchid").split(",").length:""}),(0,n.jsx)(l.Ay,{type:"primary",onClick:m,children:"选择开关"})]})}),(0,n.jsx)(i.A.Item,{name:"target",label:"目标状态",rules:[{required:!0,message:"请选择目标状态"}],children:(0,n.jsxs)(u.A,{children:[(0,n.jsx)(C,{value:"on",children:"开启"}),(0,n.jsx)(C,{value:"off",children:"关闭"}),(0,n.jsx)(C,{value:"change",children:"切换"})]})}),(0,n.jsx)(i.A.Item,{name:"commandtext",label:"触发指令(允许任意文本)",rules:[{required:!0,message:"请输入触发指令"}],children:(0,n.jsx)(b.A,{placeholder:"例如: .打开开关 1"})}),(0,n.jsx)(i.A.Item,{name:"canuseplayer",label:"允许使用的玩家(逗号分隔，留空表示所有玩家，您永远有权限使用此指令)",children:(0,n.jsx)(b.A,{placeholder:"例如: 玩家名称1,玩家名称2"})})]}),2===p&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(i.A.Item,{name:"commandtext",label:'触发指令(将翻译指令后的文本,使用方法例如".翻译 hello")',rules:[{required:!0,message:"请输入触发指令"}],children:(0,n.jsx)(b.A,{placeholder:"例如: .翻译"})}),(0,n.jsx)(i.A.Item,{name:"canuseplayer",label:"允许使用的玩家(逗号分隔，留空表示所有玩家，您永远有权限使用此指令)",children:(0,n.jsx)(b.A,{placeholder:"例如: 玩家名称1,玩家名称2"})})]}),3===p&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(i.A.Item,{name:"commandtext",label:'触发指令(AI将回答指令后的文本,使用方法例如".询问 你好")',rules:[{required:!0,message:"请输入触发指令"}],children:(0,n.jsx)(b.A,{placeholder:"例如: .询问"})}),(0,n.jsx)(i.A.Item,{name:"canuseplayer",label:"允许使用的玩家(逗号分隔，留空表示所有玩家，您永远有权限使用此指令)",children:(0,n.jsx)(b.A,{placeholder:"例如: 玩家名称1,玩家名称2"})})]}),4===p&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(i.A.Item,{name:"commandtext",label:"触发指令(发送此指令后将把队长转移给发送者)",rules:[{required:!0,message:"请输入触发指令"}],children:(0,n.jsx)(b.A,{placeholder:"例如: .队长"})}),(0,n.jsx)(i.A.Item,{name:"canuseplayer",label:"允许使用的玩家(逗号分隔，留空表示所有玩家，您永远有权限使用此指令)",children:(0,n.jsx)(b.A,{placeholder:"例如: 玩家名称1,玩家名称2"})})]}),5===p&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(i.A.Item,{name:"commandtext",label:"触发指令(发送此指令后将显示服务器信息)",rules:[{required:!0,message:"请输入触发指令"}],children:(0,n.jsx)(b.A,{placeholder:"例如: .服务器"})}),(0,n.jsx)(i.A.Item,{name:"canuseplayer",label:"允许使用的玩家(逗号分隔，留空表示所有玩家，您永远有权限使用此指令)",children:(0,n.jsx)(b.A,{placeholder:"例如: 玩家名称1,玩家名称2"})})]}),6===p&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(i.A.Item,{name:"target",label:"目标状态",rules:[{required:!0,message:"请选择目标状态"}],children:(0,n.jsxs)(u.A,{placeholder:"请选择目标状态",children:[(0,n.jsx)(C,{value:"on",children:"开启"}),(0,n.jsx)(C,{value:"off",children:"关闭"}),(0,n.jsx)(C,{value:"toggle",children:"切换"})]})}),(0,n.jsx)(i.A.Item,{name:"commandtext",label:"触发指令",rules:[{required:!0,message:"请输入触发指令"}],children:(0,n.jsx)(b.A,{placeholder:"例如: .开启通知"})}),(0,n.jsx)(i.A.Item,{name:"canuseplayer",label:"允许使用的玩家(逗号分隔，留空表示所有玩家，您永远有权限使用此指令)",children:(0,n.jsx)(b.A,{placeholder:"例如: 玩家名称1,玩家名称2"})})]}),7===p&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(i.A.Item,{name:"commandtext",label:"触发指令(发送此指令后将显示队伍成员信息及挂机状态)",rules:[{required:!0,message:"请输入触发指令"}],children:(0,n.jsx)(b.A,{placeholder:"例如: .队伍"})}),(0,n.jsx)(i.A.Item,{name:"canuseplayer",label:"允许使用的玩家(逗号分隔，留空表示所有玩家，您永远有权限使用此指令)",children:(0,n.jsx)(b.A,{placeholder:"例如: 玩家名称1,玩家名称2"})})]}),(8===p||9===p||10===p||11===p)&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(i.A.Item,{name:"commandtext",label:"触发指令(发送此指令后将显示对应地图事件信息)",rules:[{required:!0,message:"请输入触发指令"}],children:(0,n.jsx)(b.A,{placeholder:8===p?"例如: .货船":9===p?"例如: .直升机":10===p?"例如: .军用":"例如: .商人"})}),(0,n.jsx)(i.A.Item,{name:"canuseplayer",label:"允许使用的玩家(逗号分隔，留空表示所有玩家，您永远有权限使用此指令)",children:(0,n.jsx)(b.A,{placeholder:"例如: 玩家名称1,玩家名称2"})})]}),12===p&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(i.A.Item,{name:"commandtext",label:'触发指令前缀(在指令后输入物品名搜索，如".vend level 3")',rules:[{required:!0,message:"请输入触发指令"}],children:(0,n.jsx)(b.A,{placeholder:"例如: .vend"})}),(0,n.jsx)(i.A.Item,{name:"canuseplayer",label:"允许使用的玩家(逗号分隔，留空表示所有玩家，您永远有权限使用此指令)",children:(0,n.jsx)(b.A,{placeholder:"例如: 玩家名称1,玩家名称2"})})]})]})})}var T=a(19279),z=a(39578),O=a(82740),P=a(32587),E=a(63646),F=a(23608),N=a(97170),B=a(9485);let M=S.Aq.backendFetch,{Text:L}=T.A,G={1:"指令控制开关",2:"指令翻译",3:"指令AI问答",4:"更改队长",5:"查看服务器信息",6:"指令控制偏好",7:"获取队伍信息",8:"查询货船",9:"查询武装直升机",10:"查询军用直升机",11:"查询流浪商人",12:"查询售货机"},q={switch:"开关",alarm:"智能报警",callGroup:"呼叫组"},J=e=>{let{onImportSuccess:t}=e,{message:a,modal:i}=r.A.useApp(),[d,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)([]),[y,x]=(0,s.useState)(null),[j,f]=(0,s.useState)(!1),[A,v]=(0,s.useState)(null),[S,w]=(0,s.useState)("append"),[b,C]=(0,s.useState)(!1),[k,T]=(0,s.useState)(!1),[J,R]=(0,s.useState)([]),[W,V]=(0,s.useState)(new Map),[_,D]=(0,s.useState)(null),[K,Y]=(0,s.useState)([]),[H,U]=(0,s.useState)([]),[Q,X]=(0,s.useState)([]),[Z,$]=(0,s.useState)(!1),ee=async()=>{m(!0);try{let e=await M("/api/f/getofficialpresets",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status?p(t.data.list):a.error(t.errmessage||"获取官方预设失败")}catch(e){a.error("获取官方预设失败，请检查网络连接")}finally{m(!1)}},et=async()=>{$(!0);try{let[e,t,a]=await Promise.all([M("/api/f/getswitchlist",{method:"POST",headers:{"Content-Type":"application/json"}}),M("/api/f/getsmartalarmlist",{method:"POST",headers:{"Content-Type":"application/json"}}),M("/api/f/getcallgrouplist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:1,pageSize:50})})]),[n,s,r]=await Promise.all([e.json(),t.json(),a.json()]);200===n.status&&Y((n.data.list||[]).map(e=>({id:e.id,name:e.name}))),200===s.status&&U((s.data.list||[]).map(e=>({id:e.id,name:e.name}))),200===r.status&&X((r.data.list||[]).map(e=>({id:e.id,name:e.note||e.id})))}catch(e){a.error("获取设备列表失败")}finally{$(!1)}},ea=async e=>{try{let t=await M("/api/f/previewshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.id})}),n=await t.json();if(200===n.status){D(n.data);let e=(e=>{let t=[];return e.forEach((e,a)=>{var n,s,r,i,l;let c=G[e.typeId]||"未知类型(".concat(e.typeId,")"),o=e.commandtext||(null==(n=e.value)?void 0:n.commandtext)||"",d="[".concat(c,"] ").concat(o);1===e.typeId&&(null==(s=e.value)?void 0:s.switchid)&&t.push({commandIndex:a,type:"switch",originalId:e.value.switchid,commandSummary:d}),(null==(r=e.triggerValue)?void 0:r.alarmId)&&t.push({commandIndex:a,type:"alarm",originalId:e.triggerValue.alarmId,commandSummary:d}),(null==(i=e.triggerValue)?void 0:i.switchId)&&t.push({commandIndex:a,type:"switch",originalId:e.triggerValue.switchId,commandSummary:d}),e.switchActions&&Array.isArray(e.switchActions)&&e.switchActions.forEach(e=>{e.switchId&&t.push({commandIndex:a,type:"switch",originalId:e.switchId,commandSummary:d})}),(null==(l=e.callAction)?void 0:l.callGroupId)&&t.push({commandIndex:a,type:"callGroup",originalId:e.callAction.callGroupId,commandSummary:d})}),t})(n.data.commands);e.length>0?(R(e),V(new Map),await et(),f(!1),T(!0)):es([])}else a.error(n.errmessage||"获取预设详情失败")}catch(e){a.error("获取预设详情失败")}};(0,s.useEffect)(()=>{ee()},[]);let en=async()=>{A&&("overwrite"===S?i.confirm({title:"确认覆盖",content:"覆盖模式将清空您现有的所有指令逻辑配置，确定要继续吗？",okText:"确认覆盖",cancelText:"取消",okButtonProps:{danger:!0},onOk:()=>ea(A)}):ea(A))},es=async e=>{if(A){C(!0),x(A.id);try{let n=await M("/api/f/importshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:A.id,mode:S,deviceMappings:e.length>0?e:void 0})}),s=await n.json();if(200===s.status){let{importedCount:e,skippedCount:n}=s.data,r="成功导入 ".concat(e," 条指令");n>0&&(r+="，跳过 ".concat(n," 条重复指令")),a.success(r),f(!1),T(!1),null==t||t()}else a.error(s.errmessage||"导入失败")}catch(e){a.error("导入失败，请检查网络连接")}finally{C(!1),x(null)}}},er=e=>W.get("".concat(e.commandIndex,":").concat(e.type,":").concat(e.originalId))||"",ei=()=>J.every(e=>""!==er(e)),el=[{key:"official-presets",label:(0,n.jsxs)("span",{children:[(0,n.jsx)(N.A,{style:{marginRight:8,color:"#faad14"}}),"官方预设",h.length>0&&(0,n.jsxs)("span",{style:{marginLeft:8,color:"var(--ant-color-text-tertiary)",fontSize:12},children:["(",h.length," 个)"]})]}),children:d?(0,n.jsx)("div",{style:{textAlign:"center",padding:"20px 0"},children:(0,n.jsx)(c.A,{tip:"加载中..."})}):0===h.length?(0,n.jsx)(o.A,{description:"暂无官方预设",image:o.A.PRESENTED_IMAGE_SIMPLE}):(0,n.jsx)("div",{children:h.map(e=>(0,n.jsx)(z.A,{size:"small",style:{marginBottom:8},styles:{body:{padding:"12px 16px"}},children:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,n.jsxs)("div",{style:{flex:1,marginRight:16},children:[(0,n.jsx)("div",{style:{marginBottom:4},children:(0,n.jsx)(L,{strong:!0,children:e.name})}),e.description&&(0,n.jsx)("div",{children:(0,n.jsx)(L,{type:"secondary",style:{fontSize:13},children:e.description})}),(0,n.jsx)("div",{children:(0,n.jsxs)(L,{type:"secondary",style:{fontSize:12},children:["包含 ",e.commandCount," 条指令 \xb7 ",e.creatorName]})})]}),(0,n.jsx)(l.Ay,{type:"primary",size:"small",icon:(0,n.jsx)(g.A,{}),loading:y===e.id,onClick:()=>{v(e),w("append"),f(!0)},children:"导入"})]})},e.id))})}],ec=(()=>{let e=[],t=new Set(J.map(e=>e.type));return t.has("switch")&&0===K.length&&e.push("switch"),t.has("alarm")&&0===H.length&&e.push("alarm"),t.has("callGroup")&&0===Q.length&&e.push("callGroup"),e})();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O.A,{items:el,style:{marginBottom:16},defaultActiveKey:[]}),(0,n.jsx)(I.A,{title:"导入预设",open:j,onOk:en,onCancel:()=>f(!1),confirmLoading:b,okText:"确认导入",cancelText:"取消",children:A&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{marginBottom:16},children:[(0,n.jsx)("div",{style:{marginBottom:4},children:(0,n.jsx)(L,{strong:!0,children:A.name})}),A.description&&(0,n.jsx)("div",{children:(0,n.jsx)(L,{type:"secondary",style:{fontSize:13},children:A.description})}),(0,n.jsx)("div",{style:{marginTop:4},children:(0,n.jsxs)(L,{type:"secondary",style:{fontSize:12},children:["包含 ",A.commandCount," 条指令"]})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(L,{strong:!0,style:{display:"block",marginBottom:8},children:"导入模式："}),(0,n.jsx)(P.Ay.Group,{value:S,onChange:e=>w(e.target.value),children:(0,n.jsxs)(E.A,{direction:"vertical",children:[(0,n.jsxs)(P.Ay,{value:"append",children:["追加模式",(0,n.jsx)(L,{type:"secondary",style:{fontSize:12,marginLeft:8},children:"保留现有配置，跳过重复指令"})]}),(0,n.jsxs)(P.Ay,{value:"overwrite",children:["覆盖模式",(0,n.jsx)(L,{type:"danger",style:{fontSize:12,marginLeft:8},children:"清空现有配置，导入新配置"})]})]})})]})]})}),(0,n.jsx)(I.A,{title:"配置设备映射",open:k,onCancel:()=>T(!1),width:650,footer:[(0,n.jsx)(l.Ay,{onClick:()=>T(!1),children:"取消"},"cancel"),(0,n.jsx)(l.Ay,{type:"primary",disabled:!ei()||ec.length>0,loading:b,onClick:()=>{let e=J.map(e=>({commandIndex:e.commandIndex,type:e.type,originalId:e.originalId,mappedId:er(e)})).filter(e=>""!==e.mappedId);T(!1),es(e)},children:"确认导入"},"confirm")],children:Z?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,n.jsx)(c.A,{tip:"加载设备列表..."})}):(0,n.jsxs)(n.Fragment,{children:[ec.length>0&&(0,n.jsx)(F.A,{type:"error",showIcon:!0,message:"缺少必要设备",description:"请先配对以下设备：".concat(ec.map(e=>q[e]).join("、")),style:{marginBottom:16}}),(0,n.jsx)(L,{type:"secondary",style:{display:"block",marginBottom:16,fontSize:13},children:"预设中的设备ID与您的设备不同，请为每条指令选择对应的设备："}),(0,n.jsx)("div",{style:{maxHeight:400,overflowY:"auto"},children:J.map((e,t)=>{let a=(e=>{switch(e){case"switch":return K.map(e=>({value:e.id,label:e.name}));case"alarm":return H.map(e=>({value:e.id,label:e.name}));case"callGroup":return Q.map(e=>({value:e.id,label:e.name}));default:return[]}})(e.type);return(0,n.jsxs)("div",{style:{padding:12,marginBottom:8},children:[(0,n.jsx)("div",{style:{marginBottom:8},children:(0,n.jsx)(L,{children:e.commandSummary})}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsxs)(L,{type:"secondary",style:{fontSize:12,whiteSpace:"nowrap"},children:[q[e.type],":"]}),(0,n.jsx)(L,{code:!0,style:{fontSize:11},children:e.originalId}),(0,n.jsx)(L,{type:"secondary",style:{fontSize:12},children:"→"}),(0,n.jsx)(u.A,{placeholder:a.length>0?"选择设备":"无可用设备",style:{flex:1,minWidth:150},size:"small",value:er(e)||void 0,onChange:t=>((e,t)=>{let a="".concat(e.commandIndex,":").concat(e.type,":").concat(e.originalId),n=new Map(W);t?n.set(a,t):n.delete(a),V(n)})(e,t),options:a,disabled:0===a.length,allowClear:!0,showSearch:!0,optionFilterProp:"label"})]})]},"".concat(e.commandIndex,"-").concat(e.type,"-").concat(e.originalId,"-").concat(t))})}),!ei()&&0===ec.length&&(0,n.jsx)("div",{style:{marginTop:12},children:(0,n.jsxs)(L,{type:"warning",style:{fontSize:12},children:[(0,n.jsx)(B.A,{style:{marginRight:4}}),"请为所有指令选择对应的设备"]})})]})})]})};var R=a(39327),W=a(35078),V=a(15760),_=a(67153);let D=S.Aq.backendFetch,{TextArea:K}=b.A,{Text:Y}=T.A,H={1:"指令控制开关",2:"指令翻译",3:"指令AI问答",4:"更改队长",5:"查看服务器信息",6:"指令控制偏好",7:"获取队伍信息",8:"查询货船",9:"查询武装直升机",10:"查询军用直升机",11:"查询流浪商人",12:"查询售货机"},U=e=>{let{open:t,onCancel:a,onSuccess:d}=e,{message:m}=r.A.useApp(),[h]=i.A.useForm(),[u,y]=(0,s.useState)(!1),[g,j]=(0,s.useState)(!1),[f,A]=(0,s.useState)([]),[v,S]=(0,s.useState)(null),[w,C]=(0,s.useState)(!1),[k,T]=(0,s.useState)(1),[z]=(0,s.useState)(10),[O,P]=(0,s.useState)(0),[F,N]=(0,s.useState)([]),B=async e=>{j(!0);try{let t=await D("/api/f/getcommandlogiclist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:e,pageSize:z})}),a=await t.json();200===a.status?(N(a.data.list||[]),P(a.data.total||0)):m.error(a.errmessage||"获取数据失败")}catch(e){m.error("获取数据失败")}finally{j(!1)}};(0,s.useEffect)(()=>{t&&(h.resetFields(),A([]),S(null),C(!1),T(1),B(1))},[t]);let M=(e,t)=>{t?A([...f,e]):A(f.filter(t=>t!==e))},L=async()=>{try{let e=await h.validateFields();if(0===f.length)return void m.error("请至少选择一条指令逻辑");y(!0);let t=await D("/api/f/sharecommandlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,description:e.description||"",logicIds:f})}),a=await t.json();200===a.status?(S(a.data.shareKey),m.success("分享成功！"),null==d||d()):m.error(a.errmessage||"分享失败")}catch(e){m.error("分享失败，请检查输入")}finally{y(!1)}},G=async()=>{if(v)try{await navigator.clipboard.writeText(v),C(!0),m.success("密钥已复制到剪贴板"),setTimeout(()=>C(!1),2e3)}catch(e){m.error("复制失败，请手动复制")}},q=()=>{h.resetFields(),A([]),S(null),C(!1),a()};return(0,n.jsx)(I.A,{title:(0,n.jsxs)(E.A,{children:[(0,n.jsx)(x.A,{}),v?"分享成功":"分享指令逻辑"]}),open:t,onCancel:q,footer:v?(0,n.jsx)(l.Ay,{type:"primary",onClick:q,children:"完成"}):(0,n.jsxs)(E.A,{children:[(0,n.jsx)(l.Ay,{onClick:q,children:"取消"}),(0,n.jsx)(l.Ay,{type:"primary",onClick:L,loading:u,disabled:0===f.length,children:"确认分享"})]}),width:560,destroyOnClose:!0,styles:{header:{background:"#27272c",borderBottom:"1px solid rgba(255, 255, 255, 0.08)"},body:{background:"#27272c"},footer:{background:"#27272c",borderTop:"1px solid rgba(255, 255, 255, 0.08)"},content:{background:"#27272c",borderRadius:12}},children:v?(0,n.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,n.jsx)("div",{style:{marginBottom:16},children:(0,n.jsx)(V.A,{style:{fontSize:48,color:"#52c41a"}})}),(0,n.jsx)("div",{style:{marginBottom:16,fontSize:16,fontWeight:500,color:"#fff"},children:"分享成功！"}),(0,n.jsx)("div",{style:{marginBottom:8,color:"rgba(255, 255, 255, 0.6)"},children:"请将以下密钥分享给其他用户："}),(0,n.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"12px 16px",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:[(0,n.jsx)(Y,{code:!0,style:{fontSize:14,background:"rgba(99, 102, 241, 0.2)",color:"#a5b4fc"},children:v}),(0,n.jsx)(l.Ay,{type:"text",icon:w?(0,n.jsx)(V.A,{}):(0,n.jsx)(_.A,{}),onClick:G,style:{color:"rgba(255, 255, 255, 0.7)"},children:w?"已复制":"复制"})]}),(0,n.jsx)("div",{style:{color:"rgba(255, 255, 255, 0.4)",fontSize:12},children:"其他用户可以通过此密钥导入您分享的指令逻辑配置"})]}):(0,n.jsxs)(i.A,{form:h,layout:"vertical",children:[(0,n.jsx)(i.A.Item,{name:"name",label:"分享名称",rules:[{required:!0,message:"请输入分享名称"},{max:50,message:"名称最多50个字符"}],children:(0,n.jsx)(b.A,{placeholder:"请输入分享名称",maxLength:50,showCount:!0})}),(0,n.jsx)(i.A.Item,{name:"description",label:"分享描述",rules:[{max:200,message:"描述最多200个字符"}],children:(0,n.jsx)(K,{placeholder:"请输入分享描述（可选）",maxLength:200,showCount:!0,rows:3})}),(0,n.jsx)(R.A,{style:{margin:"16px 0"}}),(0,n.jsxs)("div",{style:{marginBottom:8},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,n.jsxs)("span",{style:{fontWeight:500},children:["选择要分享的指令逻辑",(0,n.jsxs)("span",{style:{color:"#999",fontWeight:"normal",marginLeft:8},children:["(已选 ",f.length," 条，共 ",O," 条)"]})]}),(0,n.jsx)(l.Ay,{type:"link",size:"small",onClick:()=>{let e=F.map(e=>e.id);e.every(e=>f.includes(e))?A(f.filter(t=>!e.includes(t))):A([...new Set([...f,...e])])},children:0!==F.length&&F.every(e=>f.includes(e.id))?"取消本页全选":"全选本页"})]}),(0,n.jsx)(c.A,{spinning:g,children:0!==F.length||g?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{maxHeight:280,overflowY:"auto",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:8,padding:8,marginBottom:12},children:F.map(e=>(0,n.jsx)("div",{style:{padding:"8px 12px",borderRadius:4,marginBottom:4,background:f.includes(e.id)?"rgba(99, 102, 241, 0.15)":"rgba(255, 255, 255, 0.03)",border:f.includes(e.id)?"1px solid rgba(99, 102, 241, 0.5)":"1px solid rgba(255, 255, 255, 0.08)",cursor:"pointer",transition:"all 0.2s"},onClick:()=>M(e.id,!f.includes(e.id)),children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[(0,n.jsx)(W.A,{checked:f.includes(e.id),onClick:e=>e.stopPropagation(),onChange:t=>M(e.id,t.target.checked)}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)("span",{style:{color:"#fff"},children:(e=>{var t;let a=H[e.typeId]||"未知类型(".concat(e.typeId,")"),n=(null==(t=e.value)?void 0:t.commandtext)||"";return"[".concat(a,"] ").concat(n)})(e)}),e.note&&(0,n.jsxs)("div",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:12,marginTop:4},children:["备注: ",e.note]})]})]})},e.id))}),O>z&&(0,n.jsx)("div",{style:{textAlign:"center"},children:(0,n.jsx)(p.A,{current:k,pageSize:z,total:O,onChange:e=>{T(e),B(e)},size:"small",showSizeChanger:!1,showQuickJumper:O>50})})]}):(0,n.jsx)(o.A,{description:"暂无指令逻辑",image:o.A.PRESENTED_IMAGE_SIMPLE})})]})]})})};var Q=a(98946),X=a(54540),Z=a(99081),$=a(20276);let ee=S.Aq.backendFetch,{Text:et}=T.A,ea={1:"指令控制开关",2:"指令翻译",3:"指令AI问答",4:"更改队长",5:"查看服务器信息",6:"指令控制偏好",7:"获取队伍信息",8:"查询货船",9:"查询武装直升机",10:"查询军用直升机",11:"查询流浪商人",12:"查询售货机"},en={switch:"开关",alarm:"智能报警",callGroup:"呼叫组"},es=e=>{let t=[];return e.forEach((e,a)=>{var n,s,r,i,l;let c=ea[e.typeId]||"未知类型(".concat(e.typeId,")"),o=e.commandtext||(null==(n=e.value)?void 0:n.commandtext)||"",d="[".concat(c,"] ").concat(o);1===e.typeId&&(null==(s=e.value)?void 0:s.switchid)&&t.push({commandIndex:a,type:"switch",originalId:e.value.switchid,commandSummary:d}),(null==(r=e.triggerValue)?void 0:r.alarmId)&&t.push({commandIndex:a,type:"alarm",originalId:e.triggerValue.alarmId,commandSummary:d}),(null==(i=e.triggerValue)?void 0:i.switchId)&&t.push({commandIndex:a,type:"switch",originalId:e.triggerValue.switchId,commandSummary:d}),e.switchActions&&Array.isArray(e.switchActions)&&e.switchActions.forEach(e=>{e.switchId&&t.push({commandIndex:a,type:"switch",originalId:e.switchId,commandSummary:d})}),(null==(l=e.callAction)?void 0:l.callGroupId)&&t.push({commandIndex:a,type:"callGroup",originalId:e.callAction.callGroupId,commandSummary:d})}),t},er=e=>{let{open:t,onCancel:a,onSuccess:i}=e,{message:d,modal:m}=r.A.useApp(),[h,p]=(0,s.useState)("official"),[y,x]=(0,s.useState)(""),[j,f]=(0,s.useState)("append"),[A,v]=(0,s.useState)([]),[S,w]=(0,s.useState)(!1),[C,k]=(0,s.useState)(null),[T,O]=(0,s.useState)(null),[M,L]=(0,s.useState)(!1),[G,q]=(0,s.useState)(null),[J,W]=(0,s.useState)(!1),[V,_]=(0,s.useState)(!1),[D,K]=(0,s.useState)(!1),[Y,H]=(0,s.useState)(!1),[U,er]=(0,s.useState)([]),[ei,el]=(0,s.useState)(new Map),[ec,eo]=(0,s.useState)(""),[ed,em]=(0,s.useState)([]),[eh,ep]=(0,s.useState)([]),[eu,ey]=(0,s.useState)([]),[ex,eg]=(0,s.useState)(!1);(0,s.useEffect)(()=>{t&&(p("official"),x(""),f("append"),k(null),q(null),_(!1),O(null),H(!1),er([]),el(new Map),ej())},[t]);let ej=async()=>{w(!0);try{let e=await ee("/api/f/getofficialpresets",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status?v(t.data.list):d.error(t.errmessage||"获取官方预设失败")}catch(e){d.error("获取官方预设失败，请检查网络连接")}finally{w(!1)}},ef=async()=>{eg(!0);try{let[e,t,a]=await Promise.all([ee("/api/f/getswitchlist",{method:"POST",headers:{"Content-Type":"application/json"}}),ee("/api/f/getsmartalarmlist",{method:"POST",headers:{"Content-Type":"application/json"}}),ee("/api/f/getcallgrouplist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:1,pageSize:50})})]),n=await e.json(),s=await t.json(),r=await a.json();200===n.status&&em((n.data.list||[]).map(e=>({id:e.id,name:e.name}))),200===s.status&&ep((s.data.list||[]).map(e=>({id:e.id,name:e.name}))),200===r.status&&ey((r.data.list||[]).map(e=>({id:e.id,name:e.note||e.id})))}catch(e){d.error("获取设备列表失败")}finally{eg(!1)}},eA=async e=>{if(!e||0===e.trim().length)return void d.error("请输入分享密钥");W(!0);try{let t=await ee("/api/f/previewshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.trim()})}),a=await t.json();200===a.status?(q(a.data),_(!0)):d.error(a.errmessage||"预览失败，请检查密钥是否正确")}catch(e){d.error("预览失败，请检查网络连接")}finally{W(!1)}},ev=async(e,t)=>{let a=es(t.commands);0===a.length?ew(e,[]):(eo(e),er(a),el(new Map),await ef(),H(!0))},eS=async(e,t)=>{K(!0);try{let a=await ee("/api/f/importshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.trim(),mode:j,deviceMappings:t.length>0?t:void 0})}),n=await a.json();if(200===n.status){let{importedCount:e,skippedCount:t}=n.data,a="成功导入 ".concat(e," 条指令");t>0&&(a+="，跳过 ".concat(t," 条重复指令")),d.success(a),null==i||i(),eI()}else d.error(n.errmessage||"导入失败")}catch(e){d.error("导入失败，请检查网络连接")}finally{K(!1)}},ew=(e,t)=>{"overwrite"===j?m.confirm({title:"确认覆盖",content:"覆盖模式将清空您现有的所有指令逻辑配置，确定要继续吗？",okText:"确认覆盖",cancelText:"取消",okButtonProps:{danger:!0},onOk:()=>eS(e,t)}):eS(e,t)},eI=()=>{p("official"),x(""),f("append"),k(null),q(null),_(!1),O(null),H(!1),er([]),el(new Map),a()},eb=async e=>{k(e),L(!0);try{let t=await ee("/api/f/previewshare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.id})}),a=await t.json();200===a.status?O(a.data):d.error(a.errmessage||"预览失败")}catch(e){d.error("预览失败，请检查网络连接")}finally{L(!1)}},eC=e=>{let t="".concat(e.commandIndex,":").concat(e.type,":").concat(e.originalId);return ei.get(t)||""},ek=()=>U.every(e=>""!==eC(e)),eT=()=>{let e=U.map(e=>({commandIndex:e.commandIndex,type:e.type,originalId:e.originalId,mappedId:eC(e)})).filter(e=>""!==e.mappedId);H(!1),ew(ec,e)},ez=e=>{if(!e)return null;let t=es(e.commands),a=t.length>0;return(0,n.jsxs)("div",{style:{marginTop:16},children:[(0,n.jsx)(R.A,{style:{margin:"16px 0"}}),(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsx)(et,{strong:!0,style:{fontSize:16},children:e.name}),e.description&&(0,n.jsx)("div",{children:(0,n.jsx)(et,{type:"secondary",style:{fontSize:13},children:e.description})}),(0,n.jsx)("div",{children:(0,n.jsxs)(et,{type:"secondary",style:{fontSize:12},children:["包含 ",e.commandCount," 条指令 \xb7 来自 ",e.creatorName]})})]}),a&&(0,n.jsx)(F.A,{type:"info",showIcon:!0,icon:(0,n.jsx)(B.A,{}),message:(0,n.jsxs)(et,{children:["此预设包含 ",t.length," 个设备引用，导入时需要映射到您的设备"]}),style:{marginBottom:12}}),(0,n.jsx)(Q.A,{size:"small",dataSource:e.commands,style:{maxHeight:200,overflowY:"auto"},renderItem:(e,t)=>(0,n.jsxs)(Q.A.Item,{style:{padding:"6px 12px"},children:[(0,n.jsx)(et,{children:(e=>{var t;let a=ea[e.typeId]||"未知类型(".concat(e.typeId,")"),n=e.commandtext||(null==(t=e.value)?void 0:t.commandtext)||"";return"[".concat(a,"] ").concat(n)})(e)}),e.note&&(0,n.jsxs)(et,{type:"secondary",style:{marginLeft:8},children:["(",e.note,")"]})]},t)}),(0,n.jsxs)("div",{style:{marginTop:16},children:[(0,n.jsx)(et,{strong:!0,style:{display:"block",marginBottom:8},children:"导入模式："}),(0,n.jsx)(P.Ay.Group,{value:j,onChange:e=>f(e.target.value),children:(0,n.jsxs)(E.A,{direction:"vertical",children:[(0,n.jsxs)(P.Ay,{value:"append",children:["追加模式",(0,n.jsx)(et,{type:"secondary",style:{fontSize:12,marginLeft:8},children:"保留现有配置，跳过重复指令"})]}),(0,n.jsxs)(P.Ay,{value:"overwrite",children:["覆盖模式",(0,n.jsx)(et,{type:"danger",style:{fontSize:12,marginLeft:8},children:"清空现有配置，导入新配置"})]})]})})]})]})},eO=[{key:"official",label:(0,n.jsxs)("span",{children:[(0,n.jsx)(N.A,{style:{marginRight:4}}),"官方预设"]}),children:(0,n.jsxs)("div",{children:[S?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,n.jsx)(c.A,{tip:"加载中..."})}):0===A.length?(0,n.jsx)(o.A,{description:"暂无官方预设",image:o.A.PRESENTED_IMAGE_SIMPLE}):(0,n.jsx)(Q.A,{dataSource:A,renderItem:e=>(0,n.jsx)(z.A,{size:"small",style:{marginBottom:8,cursor:"pointer",border:(null==C?void 0:C.id)===e.id?"2px solid var(--ant-color-primary)":"1px solid var(--ant-color-border)"},styles:{body:{padding:"12px 16px"}},onClick:()=>eb(e),children:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,n.jsxs)("div",{style:{flex:1,marginRight:16},children:[(0,n.jsxs)("div",{style:{marginBottom:4},children:[(0,n.jsx)(N.A,{style:{marginRight:6,color:"#faad14"}}),(0,n.jsx)(et,{strong:!0,children:e.name})]}),e.description&&(0,n.jsx)("div",{children:(0,n.jsx)(et,{type:"secondary",style:{fontSize:13},children:e.description})}),(0,n.jsx)("div",{children:(0,n.jsxs)(et,{type:"secondary",style:{fontSize:12},children:["包含 ",e.commandCount," 条指令 \xb7 ",e.creatorName]})})]}),(0,n.jsx)(l.Ay,{type:"text",size:"small",icon:(0,n.jsx)(Z.A,{}),onClick:t=>{t.stopPropagation(),eb(e)},children:"预览"})]})},e.id)}),M&&(0,n.jsx)("div",{style:{textAlign:"center",padding:"20px 0"},children:(0,n.jsx)(c.A,{tip:"加载预览..."})}),C&&T&&!M&&(0,n.jsxs)(n.Fragment,{children:[ez(T),(0,n.jsx)("div",{style:{marginTop:16,textAlign:"right"},children:(0,n.jsx)(l.Ay,{type:"primary",icon:(0,n.jsx)(g.A,{}),loading:D,onClick:()=>ev(C.id,T),children:"导入选中预设"})})]})]})},{key:"key",label:(0,n.jsxs)("span",{children:[(0,n.jsx)($.A,{style:{marginRight:4}}),"密钥导入"]}),children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{marginBottom:16},children:[(0,n.jsx)(et,{strong:!0,style:{display:"block",marginBottom:8},children:"输入分享密钥："}),(0,n.jsxs)(E.A.Compact,{style:{width:"100%"},children:[(0,n.jsx)(b.A,{placeholder:"请输入32位分享密钥",value:y,onChange:e=>{x(e.target.value),_(!1),q(null)},maxLength:32,style:{flex:1}}),(0,n.jsx)(l.Ay,{type:"primary",icon:(0,n.jsx)(Z.A,{}),loading:J,onClick:()=>eA(y),children:"预览"})]})]}),V&&G&&(0,n.jsxs)(n.Fragment,{children:[ez(G),(0,n.jsx)("div",{style:{marginTop:16,textAlign:"right"},children:(0,n.jsx)(l.Ay,{type:"primary",icon:(0,n.jsx)(g.A,{}),loading:D,onClick:()=>ev(y,G),children:"确认导入"})})]})]})}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.A,{title:(0,n.jsxs)(E.A,{children:[(0,n.jsx)(g.A,{}),"导入指令逻辑"]}),open:t,onCancel:eI,footer:null,width:600,destroyOnClose:!0,children:(0,n.jsx)(X.A,{activeKey:h,onChange:e=>{p(e),_(!1),q(null),k(null)},items:eO})}),(()=>{let e=(()=>{let e=[],t=new Set(U.map(e=>e.type));return t.has("switch")&&0===ed.length&&e.push("switch"),t.has("alarm")&&0===eh.length&&e.push("alarm"),t.has("callGroup")&&0===eu.length&&e.push("callGroup"),e})();return(0,n.jsx)(I.A,{title:"配置设备映射",open:Y,onCancel:()=>H(!1),width:650,footer:[(0,n.jsx)(l.Ay,{onClick:()=>H(!1),children:"取消"},"cancel"),(0,n.jsx)(l.Ay,{type:"primary",disabled:!ek()||e.length>0,loading:D,onClick:eT,children:"确认导入"},"confirm")],children:ex?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,n.jsx)(c.A,{tip:"加载设备列表..."})}):(0,n.jsxs)(n.Fragment,{children:[e.length>0&&(0,n.jsx)(F.A,{type:"error",showIcon:!0,message:"缺少必要设备",description:"请先配对以下设备：".concat(e.map(e=>en[e]).join("、")),style:{marginBottom:16}}),(0,n.jsx)(et,{type:"secondary",style:{display:"block",marginBottom:16,fontSize:13},children:"预设中的设备ID与您的设备不同，请为每条指令选择对应的设备："}),(0,n.jsx)(Q.A,{size:"small",dataSource:U,style:{maxHeight:400,overflowY:"auto"},renderItem:(e,t)=>{let a=(e=>{switch(e){case"switch":return ed.map(e=>({value:e.id,label:e.name}));case"alarm":return eh.map(e=>({value:e.id,label:e.name}));case"callGroup":return eu.map(e=>({value:e.id,label:e.name}));default:return[]}})(e.type),s=a.length>0;return(0,n.jsx)(Q.A.Item,{children:(0,n.jsxs)("div",{style:{width:"100%"},children:[(0,n.jsx)("div",{style:{marginBottom:8},children:(0,n.jsx)(et,{children:e.commandSummary})}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsxs)(et,{type:"secondary",style:{fontSize:12,whiteSpace:"nowrap"},children:[en[e.type],":"]}),(0,n.jsx)(et,{code:!0,style:{fontSize:11},children:e.originalId}),(0,n.jsx)(et,{type:"secondary",style:{fontSize:12},children:"→"}),(0,n.jsx)(u.A,{placeholder:s?"选择设备":"无可用设备",style:{flex:1,minWidth:150},size:"small",value:eC(e)||void 0,onChange:t=>((e,t)=>{let a="".concat(e.commandIndex,":").concat(e.type,":").concat(e.originalId),n=new Map(ei);t?n.set(a,t):n.delete(a),el(n)})(e,t),options:a,disabled:!s,allowClear:!0,showSearch:!0,optionFilterProp:"label"})]})]})},"".concat(e.commandIndex,"-").concat(e.type,"-").concat(e.originalId,"-").concat(t))}}),!ek()&&0===e.length&&(0,n.jsx)("div",{style:{marginTop:12},children:(0,n.jsxs)(et,{type:"warning",style:{fontSize:12},children:[(0,n.jsx)(B.A,{style:{marginRight:4}}),"请为所有指令选择对应的设备"]})})]})})})()]})};var ei=a(39286),el=a(44187);let ec=S.Aq.backendFetch,{Text:eo}=T.A,ed=e=>{let{open:t,onCancel:a,onSuccess:i}=e,{message:d,modal:m}=r.A.useApp(),[h,p]=(0,s.useState)(!1),[u,y]=(0,s.useState)([]),[x,g]=(0,s.useState)(null),[f,A]=(0,s.useState)(null),S=async()=>{p(!0);try{let e=await ec("/api/f/getmyshares",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();200===t.status?y(t.data.list):d.error(t.errmessage||"获取分享列表失败")}catch(e){d.error("获取分享列表失败，请检查网络连接")}finally{p(!1)}};(0,s.useEffect)(()=>{t&&S()},[t]);let w=async e=>{try{await navigator.clipboard.writeText(e),g(e),d.success("密钥已复制到剪贴板"),setTimeout(()=>g(null),2e3)}catch(e){d.error("复制失败，请手动复制")}},b=()=>{a()},C=[{title:"分享名称",dataIndex:"name",key:"name",width:150,ellipsis:!0,render:(e,t)=>(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:500,color:"var(--ant-color-text)"},children:e}),t.description&&(0,n.jsx)("div",{style:{color:"var(--ant-color-text-tertiary)",fontSize:12,marginTop:2},children:t.description})]})},{title:"密钥",dataIndex:"id",key:"id",width:200,render:e=>(0,n.jsxs)(E.A,{children:[(0,n.jsx)(eo,{code:!0,style:{fontSize:12},children:e}),(0,n.jsx)(ei.A,{title:x===e?"已复制":"复制密钥",children:(0,n.jsx)(l.Ay,{type:"text",size:"small",icon:x===e?(0,n.jsx)(V.A,{style:{color:"#52c41a"}}):(0,n.jsx)(_.A,{}),onClick:()=>w(e)})})]})},{title:"指令数",dataIndex:"commandCount",key:"commandCount",width:80,align:"center"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:150,render:e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},{title:"操作",key:"action",width:80,render:(e,t)=>(0,n.jsx)(l.Ay,{type:"link",danger:!0,size:"small",icon:(0,n.jsx)(v.A,{}),loading:f===t.id,onClick:()=>(e=>{m.confirm({title:"确认取消分享",content:(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:['确定要取消分享 "',e.name,'" 吗？']}),(0,n.jsx)("p",{style:{color:"#ff4d4f",fontSize:12},children:"取消后，其他用户将无法通过密钥导入此配置。"})]}),okText:"确认取消",cancelText:"返回",okButtonProps:{danger:!0},onOk:async()=>{A(e.id);try{let t=await ec("/api/f/unsharecommandlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shareKey:e.id})}),a=await t.json();200===a.status?(d.success("已取消分享"),S(),null==i||i()):d.error(a.errmessage||"取消分享失败")}catch(e){d.error("取消分享失败，请检查网络连接")}finally{A(null)}}})})(t),children:"取消"})}];return(0,n.jsx)(I.A,{title:(0,n.jsxs)(E.A,{children:[(0,n.jsx)(j.A,{}),"我的分享"]}),open:t,onCancel:b,footer:(0,n.jsx)(l.Ay,{onClick:b,children:"关闭"}),width:800,destroyOnClose:!0,children:h?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px 0"},children:(0,n.jsx)(c.A,{tip:"加载中..."})}):0===u.length?(0,n.jsx)(o.A,{description:"暂无分享记录",image:o.A.PRESENTED_IMAGE_SIMPLE,style:{padding:"40px 0"}}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{marginBottom:12,color:"var(--ant-color-text-secondary)",fontSize:13},children:["您已创建 ",u.length,"/10 个分享"]}),(0,n.jsx)(el.A,{columns:C,dataSource:u,rowKey:"id",pagination:!1,size:"small",scroll:{x:"max-content"}})]})})};var em=a(74984);let eh=S.Aq.backendFetch,ep=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(await eh("/api/f/getcommandlogiclist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:e,pageSize:t})})).json()},eu=async e=>(await eh("/api/f/addcommandlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json(),ey=async e=>(await eh("/api/f/setcommandlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json(),ex=async e=>(await eh("/api/f/delcommandlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).json(),eg=async e=>(await eh("/api/f/togglecommandlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e})})).json(),ej=async e=>(await eh("/api/f/toggleallcommandlogic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e})})).json(),ef=()=>{var e;let{message:t}=r.A.useApp(),{pageSize:a,setPageSize:S,pageSizeOptions:I}=(0,em.Y)("commandlogic"),[b,C]=(0,s.useState)([]),[T,z]=(0,s.useState)(!1),[O,P]=(0,s.useState)(!1),[E,F]=(0,s.useState)({current:1,pageSize:a,total:0}),[N,B]=(0,s.useState)(!1),[M,L]=(0,s.useState)(!1),[G,q]=(0,s.useState)(!1),[R,W]=(0,s.useState)(!1),[V,_]=(0,s.useState)(!1),[D,K]=(0,s.useState)(null),[Y,H]=(0,s.useState)(null),[Q,X]=(0,s.useState)(!1),[Z]=i.A.useForm(),$=async()=>{z(!0);try{let e=await ep(E.current,E.pageSize);200===e.status?(C(e.data.list),F({...E,total:e.data.total})):t.error(e.errmessage||"获取数据失败")}catch(e){t.error("请检查网络连接")}finally{z(!1)}};(0,s.useEffect)(()=>{a!==E.pageSize&&F(e=>({...e,current:1,pageSize:a}))},[a]),(0,s.useEffect)(()=>{$()},[E.current,E.pageSize]);let ee=e=>{K(e);let t={typeId:e.typeId,commandtext:e.value.commandtext,canuseplayer:e.value.canuseplayer,note:e.note};switch(e.typeId){case 1:Z.setFieldsValue({...t,switchid:e.value.switchid,target:e.value.target});break;case 6:Z.setFieldsValue({...t,target:e.value.target});break;default:Z.setFieldsValue(t)}B(!0)},et=async()=>{try{let e;P(!0);let a=await Z.validateFields();switch(a.typeId){case 1:e={switchid:a.switchid,target:a.target,commandtext:a.commandtext,canuseplayer:a.canuseplayer||""};break;case 2:case 3:case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 12:e={commandtext:a.commandtext,canuseplayer:a.canuseplayer||""};break;case 6:e={preferenceKey:"GlobalMessageSwitch",target:a.target,commandtext:a.commandtext,canuseplayer:a.canuseplayer||""};break;default:return void t.error("无效逻辑类型")}if(D){let n=await ey({id:D.id,typeId:a.typeId,value:JSON.stringify(e),note:a.note});200===n.status?(t.success("更新成功"),B(!1),$()):t.error(n.errmessage||"更新失败")}else{let n=await eu({typeId:a.typeId,value:JSON.stringify(e),note:a.note});200===n.status?(t.success("添加成功"),B(!1),$()):t.error(n.errmessage||"添加失败")}P(!1)}catch(e){P(!1),t.error("操作失败，请检查输入")}},ea=async e=>{try{await ex(e),t.success("删除成功"),$()}catch(e){t.error("删除失败")}},en=async(e,a)=>{H(e);try{let n=await eg([{id:e,enabled:a}]);200===n.status?C(t=>t.map(t=>t.id===e?{...t,enabled:a}:t)):t.error(n.errmessage||"操作失败")}catch(e){t.error("操作失败")}finally{H(null)}},es=async e=>{X(!0);try{let a=await ej(e);200===a.status?(t.success(e?"已全部启用":"已全部禁用"),C(t=>t.map(t=>({...t,enabled:e})))):t.error(a.errmessage||"操作失败")}catch(e){t.error("操作失败")}finally{X(!1)}},ei=b.some(e=>!1!==e.enabled),el=b.some(e=>!1===e.enabled);return(0,n.jsxs)(s.Fragment,{children:[(0,n.jsx)(J,{onImportSuccess:$}),(0,n.jsxs)("div",{style:{marginBottom:16,display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[(0,n.jsx)(l.Ay,{type:"primary",icon:(0,n.jsx)(y.A,{}),onClick:()=>{K(null),Z.resetFields(),B(!0)},children:"添加指令"}),(0,n.jsx)(l.Ay,{icon:(0,n.jsx)(x.A,{}),onClick:()=>q(!0),children:"分享配置"}),(0,n.jsx)(l.Ay,{icon:(0,n.jsx)(g.A,{}),onClick:()=>W(!0),children:"导入配置"}),(0,n.jsx)(l.Ay,{icon:(0,n.jsx)(j.A,{}),onClick:()=>_(!0),children:"我的分享"}),b.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{flex:1}}),ei&&(0,n.jsx)(l.Ay,{icon:(0,n.jsx)(f.A,{}),onClick:()=>es(!1),loading:Q,children:"全部禁用"}),el&&(0,n.jsx)(l.Ay,{type:"primary",icon:(0,n.jsx)(f.A,{}),onClick:()=>es(!0),loading:Q,children:"全部启用"})]})]}),(0,n.jsx)(c.A,{spinning:T,children:0!==b.length||T?(0,n.jsx)("div",{className:"data-list",children:b.map((e,t)=>{let a=!1===e.enabled;return(0,n.jsxs)("div",{className:"data-list-item ".concat(a?"data-list-item-disabled":""),onClick:()=>ee(e),children:[(0,n.jsxs)("div",{className:"data-list-item-left",children:[(0,n.jsxs)("div",{className:"data-list-item-header",children:[(0,n.jsx)(d.A,{children:(e=>{switch(e){case 1:return"指令控制开关";case 2:return"指令翻译";case 3:return"指令AI问答";case 4:return"更改队长";case 5:return"查看服务器信息";case 6:return"指令控制全局信息开关";case 7:return"获取队伍信息";case 8:return"查询货船";case 9:return"查询武装直升机";case 10:return"查询军用直升机";case 11:return"查询流浪商人";case 12:return"查询售货机";default:return"未知类型 (".concat(e,")")}})(e.typeId)}),(0,n.jsx)("span",{className:"data-list-item-note",children:e.note||"未命名"})]}),(0,n.jsx)("div",{className:"data-list-item-info",children:(0,n.jsx)("span",{className:"info-item",children:(0,n.jsx)("span",{className:"info-value",children:(e=>{switch(e.typeId){case 1:{let t=e.value,a=t.switchid,n="指令: ".concat(t.commandtext," | 目标开关数量: ").concat(a?a.split(",").length:0," | 目标状态: ");switch(t.target){case"on":n+="开启";break;case"off":n+="关闭";break;case"change":n+="切换";break;default:n+=t.target}return t.canuseplayer?n+=" | 允许玩家: ".concat(t.canuseplayer):n+=" | 允许所有玩家",n}case 2:case 3:{let t=e.value,a="指令: ".concat(t.commandtext," ");return t.canuseplayer?a+=" | 允许玩家: ".concat(t.canuseplayer):a+=" | 允许所有玩家",a}case 4:{let t=e.value,a="指令: ".concat(t.commandtext," | 更改队长");return t.canuseplayer?a+=" | 允许玩家: ".concat(t.canuseplayer):a+=" | 允许所有玩家",a}case 5:{let t=e.value,a="指令: ".concat(t.commandtext," | 查看服务器信息");return t.canuseplayer?a+=" | 允许玩家: ".concat(t.canuseplayer):a+=" | 允许所有玩家",a}case 6:{let t=e.value,a="";switch(t.target){case"on":a="开启";break;case"off":a="关闭";break;case"toggle":a="切换";break;default:a=t.target}let n="指令: ".concat(t.commandtext," | 目标: ").concat(a);return t.canuseplayer?n+=" | 允许玩家: ".concat(t.canuseplayer):n+=" | 允许所有玩家",n}case 7:{let t=e.value,a="指令: ".concat(t.commandtext," | 获取队伍信息");return t.canuseplayer?a+=" | 允许玩家: ".concat(t.canuseplayer):a+=" | 允许所有玩家",a}case 8:case 9:case 10:case 11:{let t=e.value,a="指令: ".concat(t.commandtext," | ").concat({8:"查询货船",9:"查询武装直升机",10:"查询军用直升机",11:"查询流浪商人"}[e.typeId]);return t.canuseplayer?a+=" | 允许玩家: ".concat(t.canuseplayer):a+=" | 允许所有玩家",a}case 12:{let t=e.value,a="指令前缀: ".concat(t.commandtext," | 查询售货机(按物品名搜索)");return t.canuseplayer?a+=" | 允许玩家: ".concat(t.canuseplayer):a+=" | 允许所有玩家",a}default:return"未知类型配置 (".concat(e.typeId,")")}})(e)})})})]}),(0,n.jsxs)("div",{className:"data-list-item-right",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)(m.A,{size:"small",checked:!a,loading:Y===e.id,onChange:t=>en(e.id,t),checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,n.jsx)(l.Ay,{type:"text",size:"small",icon:(0,n.jsx)(A.A,{}),onClick:()=>ee(e),children:"编辑"}),(0,n.jsx)(h.A,{title:"确定删除此指令？",onConfirm:()=>ea(e.id),children:(0,n.jsx)(l.Ay,{type:"text",size:"small",icon:(0,n.jsx)(v.A,{}),danger:!0,children:"删除"})})]})]},e.id)})}):(0,n.jsx)(o.A,{description:"暂无数据"})}),E.total>E.pageSize&&(0,n.jsxs)("div",{className:"data-card-pagination",children:[(0,n.jsx)(p.A,{current:E.current,pageSize:E.pageSize,total:E.total,onChange:(e,t)=>F({...E,current:e,pageSize:t}),size:"small",showSizeChanger:!1,showTotal:e=>"共 ".concat(e," 条")}),(0,n.jsx)(u.A,{value:E.pageSize,onChange:e=>{S(e),F({...E,current:1,pageSize:e})},options:I.map(e=>({value:e,label:"".concat(e,"条/页")})),size:"small",style:{width:90,marginLeft:8}})]}),(0,n.jsx)(k,{open:N,currentRecord:D,onOk:et,onCancel:()=>{B(!1)},confirmLoading:O,form:Z,onSwitchSelect:()=>L(!0),validateSwitchIds:(e,t)=>t.trim()?Promise.resolve():Promise.reject(Error("请输入至少一个开关名称"))}),M&&(0,n.jsx)(w.A,{open:M,onConfirm:e=>{Z.setFieldsValue({switchid:e.join(",")}),L(!1)},defaultValue:(null==(e=Z.getFieldValue("switchid"))?void 0:e.split(","))||[],onCancel:()=>L(!1)}),(0,n.jsx)(U,{open:G,onCancel:()=>q(!1),onSuccess:()=>{},commandLogics:b}),(0,n.jsx)(er,{open:R,onCancel:()=>W(!1),onSuccess:$}),(0,n.jsx)(ed,{open:V,onCancel:()=>_(!1)})]})}},50886:(e,t,a)=>{"use strict";a.d(t,{I:()=>s});var n=a(12115);let s=()=>{let[e,t]=(0,n.useState)(()=>window.innerWidth<768);return(0,n.useEffect)(()=>{let e=()=>{t(window.innerWidth<768)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}},54903:(e,t,a)=>{Promise.resolve().then(a.bind(a,45790))},74984:(e,t,a)=>{"use strict";a.d(t,{Y:()=>i});var n=a(12115);let s=[9,12,15],r=()=>{let e=Math.floor((window.innerWidth-280)/320);return e<=2?9:3===e?12:15},i=e=>{let t="pageSize_"+e,[a,i]=(0,n.useState)(()=>{let e=localStorage.getItem(t);if(e){let t=parseInt(e,10);if(s.includes(t))return t}return r()}),[l,c]=(0,n.useState)(()=>null!==localStorage.getItem(t));return(0,n.useEffect)(()=>{if(l)return;let e=()=>{i(r())};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[l]),{pageSize:a,setPageSize:(0,n.useCallback)(e=>{s.includes(e)&&(i(e),c(!0),localStorage.setItem(t,e.toString()))},[t]),isCustom:l,resetToAdaptive:(0,n.useCallback)(()=>{localStorage.removeItem(t),c(!1),i(r())},[t]),pageSizeOptions:s}}}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,6060,3621,3919,4540,9578,9073,8260,6133,1589,8272,2587,4425,5078,4187,8946,667,2637,8441,1255,7358],()=>e(e.s=54903)),_N_E=e.O()}]);