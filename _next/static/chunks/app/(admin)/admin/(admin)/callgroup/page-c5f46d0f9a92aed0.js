(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4262],{37783:(e,t,a)=>{"use strict";a.d(t,{Aq:()=>i,Ay:()=>n});let r="http://gateway.rustplus.cn";class i{static formatDateTime(e){let t=new Date(e),a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(i," ").concat(n,":").concat(s)}static async copyToClipboard(e,t){let{onSuccess:a,onError:r}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==a||a(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==a||a(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==a||a(),!0}catch(e){return null==r||r(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(r).concat(e):e.startsWith("/api/")?"".concat(r,"/api/backend").concat(e.slice(4)):"".concat(r).concat(e)}static async backendFetch(e,t){return fetch(i.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,a;let r="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===r.length)return null!=(a=null==(t=r.pop())?void 0:t.split(";").shift())?a:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let n={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},53163:(e,t,a)=>{Promise.resolve().then(a.bind(a,69919))},69919:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>M});var r=a(95155),i=a(12115),n=a(19279),s=a(89543),l=a(86133),o=a(785),c=a(36060),d=a(19588),p=a(39578),u=a(84549),g=a(91589),h=a(59103),m=a(15856),x=a(43561),f=a(43990),y=a(31199),j=a(26555),S=a(66968),v=a(88795),b=a(37783),w=a(49073);let{Option:A}=h.A;function z(e){let{open:t,currentRecord:a,onOk:i,onCancel:n,confirmLoading:s,form:o}=e;return(0,r.jsx)(m.A,{title:a?"编辑呼叫预设组":"添加呼叫预设组",open:t,onOk:i,onCancel:n,width:700,confirmLoading:s,okText:"确定",cancelText:"取消",children:(0,r.jsxs)(l.A,{form:o,layout:"vertical",children:[(0,r.jsx)(l.A.Item,{name:"note",label:"组名",rules:[{required:!0,message:"请输入组名"},{validator:(e,t)=>t&&""!==t.trim()?t.length>20?Promise.reject(Error("组名不能超过20个字")):Promise.resolve():Promise.reject(Error("请输入组名"))}],children:(0,r.jsx)(w.A,{placeholder:"请输入组名（不超过20字）",showCount:!0,maxLength:20})}),(0,r.jsx)(l.A.Item,{name:"value",label:"呼叫目标（每行一个，输入手机号或邮箱）",rules:[{required:!0,message:"请输入呼叫目标"},{validator:(e,t)=>{if(!t)return Promise.reject(Error("请输入呼叫目标"));let a=t.split("\n").filter(e=>""!==e.trim());if(0===a.length)return Promise.reject(Error("至少输入一个呼叫目标"));let r=/^[^\s@]+@(qq|163|126|gmail|yahoo|sina|sohu|hotmail|outlook)\.com$/i,i=/^\d{11}$/;for(let e of a){let t=e.trim();if(!i.test(t)&&!r.test(t))return Promise.reject(Error('"'.concat(t,'" 格式不正确，请输入11位手机号或常用邮箱（如qq.com, 163.com等）')))}return Promise.resolve()}}],children:(0,r.jsx)(w.A.TextArea,{rows:3,placeholder:"请输入11位手机号或常用邮箱（如qq.com, 163.com等），每行一个"})})]})})}var C=a(20063),k=a(74984);let N=b.Aq.backendFetch,{Text:P}=n.A,T=e=>{if(!e)return e;if(e.includes("@")){let[t,a]=e.split("@");return t.length<=2?"".concat(t[0],"***@").concat(a):"".concat(t[0]).concat(t[1],"***@").concat(a)}if(/^1[3-9]\d{9}$/.test(e))return"".concat(e.slice(0,3),"****").concat(e.slice(7));if(e.length>4){let t=Math.min(2,Math.floor(e.length/3));return"".concat(e.slice(0,t)).concat("*".repeat(e.length-2*t)).concat(e.slice(-t))}return e},I=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(await N("/api/f/getcallgrouplist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:e,pageSize:t})})).json()},O=async e=>(await N("/api/f/addcallgroup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json(),E=async e=>(await N("/api/f/setcallgroup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json(),q=async e=>(await N("/api/f/delcallgroup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).json();function M(){let{message:e}=s.A.useApp(),t=(0,C.useRouter)(),{pageSize:a,setPageSize:n,pageSizeOptions:w}=(0,k.Y)("callgroup"),[A,M]=(0,i.useState)([]),[W,B]=(0,i.useState)(!1),[_,F]=(0,i.useState)(null),[L,R]=(0,i.useState)({current:1,pageSize:a,total:0}),[D,J]=(0,i.useState)(!1),[U,Y]=(0,i.useState)(!1),[$,G]=(0,i.useState)(null),[H]=l.A.useForm(),[V,K]=(0,i.useState)(!1),[Q,X]=(0,i.useState)([]),[Z,ee]=(0,i.useState)(!1),[et,ea]=(0,i.useState)({page:1,pageSize:10,total:0}),er=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;ee(!0);try{let e=await N("/api/pay/getscorelogs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:t,pageSize:et.pageSize})}),a=await e.json();200===a.status&&(X(a.data.logs),ea(e=>({...e,page:a.data.page,total:a.data.total})))}catch(t){e.error("加载积分明细失败")}finally{ee(!1)}},ei=async()=>{B(!0);try{let t=await N("/api/f/getscoreinfo",{method:"POST"}),a=await t.json();if(200!==a.status)return void e.error(a.errmessage||"获取数据失败");void 0!==a.data.score&&F(a.data.score);let r=await I(L.current,L.pageSize);if(200===r.status){for(let e of r.data.list){let t=0;if(e.value)for(let r of(console.log(e.value),e.value))r.includes("@")?t+=a.data.emailScore:t+=a.data.phoneScore;e.score=t}M(r.data.list),R({...L,total:r.data.total}),console.log(r.data.list)}else e.error(r.errmessage||"获取数据失败")}catch(t){e.error("请检查网络连接")}finally{B(!1)}};(0,i.useEffect)(()=>{a!==L.pageSize&&R(e=>({...e,current:1,pageSize:a}))},[a]),(0,i.useEffect)(()=>{ei()},[L.current,L.pageSize]);let en=e=>{G(e),H.setFieldsValue({value:e.value?e.value.join("\n"):"",note:e.note}),J(!0)},es=async()=>{try{Y(!0);let t=await H.validateFields();if($){let a=await E({id:$.id,typeId:t.typeId,value:t.value.split("\n"),note:t.note});200===a.status?e.success("更新成功"):e.error(a.errmessage||"更新失败")}else{let a=await O({value:t.value.split("\n"),note:t.note});200===a.status?e.success("添加成功"):e.error(a.errmessage||"添加失败")}J(!1),ei()}catch(t){e.error("操作失败，请检查输入")}finally{Y(!1)}},el=async t=>{try{await q(t),e.success("删除成功"),ei()}catch(t){e.error("删除失败")}};return(0,r.jsxs)(i.Fragment,{children:[(0,r.jsxs)("div",{style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.15) 100%)",border:"1px solid rgba(16, 185, 129, 0.25)",borderRadius:"12px",padding:"16px 20px",marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,r.jsx)("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"rgba(16, 185, 129, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(f.A,{style:{color:"#10b981",fontSize:"20px"}})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(P,{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",display:"block"},children:"积分余额"}),(0,r.jsx)("div",{style:{fontSize:"24px",fontWeight:700,color:"#10b981"},children:null!==_?_:"--"})]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,r.jsx)(o.Ay,{icon:(0,r.jsx)(y.A,{}),onClick:()=>{K(!0),0===Q.length&&er()},style:{height:"38px",borderRadius:"10px"},children:"积分明细"}),(0,r.jsx)(o.Ay,{type:"primary",icon:(0,r.jsx)(j.A,{}),onClick:()=>t.push("/admin/pay/products?tab=score"),style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",height:"38px",borderRadius:"10px"},children:"兑换积分"})]})]}),(0,r.jsx)("div",{style:{marginBottom:16},children:(0,r.jsx)(o.Ay,{type:"primary",icon:(0,r.jsx)(S.A,{}),onClick:()=>{G(null),H.resetFields(),J(!0)},children:"添加预设组"})}),(0,r.jsx)(c.A,{spinning:W,children:0!==A.length||W?(0,r.jsx)("div",{className:"data-card-grid",children:A.map((e,t)=>{var a;return(0,r.jsxs)(p.A,{className:"data-card",size:"small",onClick:()=>en(e),children:[(0,r.jsxs)("div",{className:"data-card-header",children:[(0,r.jsx)("span",{className:"data-card-title",children:e.note||"未命名组"}),(0,r.jsxs)("span",{className:"data-card-index",children:["#",(L.current-1)*L.pageSize+t+1]})]}),(0,r.jsxs)("div",{className:"data-card-body",children:[(0,r.jsxs)("div",{className:"data-card-item",children:[(0,r.jsx)("span",{className:"item-label",children:"ID"}),(0,r.jsx)("span",{className:"item-value",children:e.id})]}),(0,r.jsxs)("div",{className:"data-card-item",children:[(0,r.jsx)("span",{className:"item-label",children:"目标"}),(0,r.jsx)("span",{className:"item-value item-value-ellipsis",children:(a=e.value)&&0!==a.length?a.map(T).join(", "):"-"})]}),(0,r.jsxs)("div",{className:"data-card-item",children:[(0,r.jsx)("span",{className:"item-label",children:"触发一次所需积分"}),(0,r.jsx)("span",{className:"item-value",children:e.score||0})]})]}),(0,r.jsxs)("div",{className:"data-card-footer",children:[(0,r.jsx)("span",{className:"data-card-footer-hint",onClick:()=>en(e),style:{cursor:"pointer"},children:"点击编辑"}),(0,r.jsx)(u.A,{title:"确定删除此预设组？",onConfirm:()=>el(e.id),children:(0,r.jsx)(o.Ay,{type:"text",size:"small",icon:(0,r.jsx)(v.A,{}),onClick:e=>e.stopPropagation(),children:"删除"})})]})]},e.id)})}):(0,r.jsx)(d.A,{description:"暂无数据"})}),L.total>L.pageSize&&(0,r.jsxs)("div",{className:"data-card-pagination",children:[(0,r.jsx)(g.A,{current:L.current,pageSize:L.pageSize,total:L.total,onChange:(e,t)=>R({...L,current:e,pageSize:t}),size:"small",showSizeChanger:!1,showTotal:e=>"共 ".concat(e," 条")}),(0,r.jsx)(h.A,{value:L.pageSize,onChange:e=>{n(e),R({...L,current:1,pageSize:e})},options:w.map(e=>({value:e,label:"".concat(e,"条/页")})),size:"small",style:{width:90,marginLeft:8}})]}),(0,r.jsx)(z,{open:D,currentRecord:$,onOk:es,onCancel:()=>{J(!1)},confirmLoading:U,form:H,onSwitchSelect:()=>{},validateSwitchIds:()=>Promise.resolve(),validateTime:()=>Promise.resolve()}),(0,r.jsxs)(m.A,{open:V,onCancel:()=>K(!1),footer:null,width:500,centered:!0,title:(0,r.jsxs)("span",{children:[(0,r.jsx)(y.A,{style:{marginRight:8}}),"积分明细"]}),styles:{content:{background:"#27272c",border:"1px solid rgba(255,255,255,0.1)"},header:{background:"#27272c",borderBottom:"1px solid rgba(255,255,255,0.08)"}},children:[Z?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:40},children:(0,r.jsx)(c.A,{})}):0===Q.length?(0,r.jsx)("div",{style:{textAlign:"center",padding:40,color:"rgba(255,255,255,0.4)"},children:"暂无记录"}):(0,r.jsx)("div",{style:{maxHeight:400,overflowY:"auto"},children:Q.map(e=>{var t;let a={exchange:{text:"兑换",color:"#52c41a"},consume:{text:"消费",color:"#ff4d4f"},refund:{text:"退款",color:"#1677ff"},gift:{text:"赠送",color:"#722ed1"},system_add:{text:"系统增加",color:"#13c2c2"},system_deduct:{text:"系统扣除",color:"#fa8c16"},call:{text:"呼叫消耗",color:"#ff4d4f"},other:{text:"其他",color:"#8c8c8c"}}[t=e.changeType]||{text:t,color:"#8c8c8c"};return(0,r.jsxs)("div",{style:{padding:"12px 14px",background:"rgba(255,255,255,0.03)",borderRadius:10,marginBottom:8,border:"1px solid rgba(255,255,255,0.06)"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsx)(x.A,{color:a.color,style:{margin:0,fontSize:11},children:a.text}),(0,r.jsx)(P,{style:{color:"rgba(255,255,255,0.5)",fontSize:11},children:b.Aq.formatDateTime(e.createdAt)})]}),(0,r.jsxs)(P,{style:{color:e.changeAmount>=0?"#52c41a":"#ff4d4f",fontWeight:600,fontSize:15},children:[e.changeAmount>=0?"+":"",e.changeAmount]})]}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(P,{style:{color:"rgba(255,255,255,0.7)",fontSize:13},children:e.reason}),(0,r.jsxs)(P,{style:{color:"rgba(255,255,255,0.4)",fontSize:11,whiteSpace:"nowrap",marginLeft:12},children:[e.balanceBefore," → ",(0,r.jsx)("span",{style:{color:"#10b981"},children:e.balanceAfter})]})]}),e.remark&&(0,r.jsx)(P,{style:{color:"rgba(255,255,255,0.4)",fontSize:11,display:"block",marginTop:6},children:e.remark})]},e.id)})}),et.total>et.pageSize&&(0,r.jsx)("div",{style:{marginTop:"12px",textAlign:"center"},children:(0,r.jsx)(g.A,{current:et.page,total:et.total,pageSize:et.pageSize,onChange:e=>er(e),size:"small",showSizeChanger:!1})})]})]})}},74984:(e,t,a)=>{"use strict";a.d(t,{Y:()=>s});var r=a(12115);let i=[9,12,15],n=()=>{let e=Math.floor((window.innerWidth-280)/320);return e<=2?9:3===e?12:15},s=e=>{let t="pageSize_"+e,[a,s]=(0,r.useState)(()=>{let e=localStorage.getItem(t);if(e){let t=parseInt(e,10);if(i.includes(t))return t}return n()}),[l,o]=(0,r.useState)(()=>null!==localStorage.getItem(t));return(0,r.useEffect)(()=>{if(l)return;let e=()=>{s(n())};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[l]),{pageSize:a,setPageSize:(0,r.useCallback)(e=>{i.includes(e)&&(s(e),o(!0),localStorage.setItem(t,e.toString()))},[t]),isCustom:l,resetToAdaptive:(0,r.useCallback)(()=>{localStorage.removeItem(t),o(!1),s(n())},[t]),pageSizeOptions:i}}}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,5445,6060,4540,9073,9578,6133,2718,8326,8441,1255,7358],()=>e(e.s=53163)),_N_E=e.O()}]);