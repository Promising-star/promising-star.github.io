(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2388],{23551:(e,t,n)=>{Promise.resolve().then(n.bind(n,53412))},37783:(e,t,n)=>{"use strict";n.d(t,{Aq:()=>r,Ay:()=>a});let i="https://gateway.rustplus.cn";class r{static formatDateTime(e){let t=new Date(e),n=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return"".concat(n,"-").concat(i,"-").concat(r," ").concat(a,":").concat(o)}static async copyToClipboard(e,t){let{onSuccess:n,onError:i}=t||{};try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),null==n||n(),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{let e=document.execCommand("copy");if(document.body.removeChild(t),e)return null==n||n(),!0}catch(e){throw document.body.removeChild(t),e}return window.prompt("复制失败，请手动复制以下文本:",e),null==n||n(),!0}catch(e){return null==i||i(e instanceof Error?e:Error(String(e))),!1}}static toBoolean(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"1"===e:!!e}static getGatewayUrl(e){return e.startsWith("/api/pay/")||e.startsWith("/api/notice/")?"".concat(i).concat(e):e.startsWith("/api/")?"".concat(i,"/api/backend").concat(e.slice(4)):"".concat(i).concat(e)}static async backendFetch(e,t){return fetch(r.getGatewayUrl(e),{credentials:"include",...t}).then(e=>403===e.status?(window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(Error("Unauthorized"))):e).catch(e=>{throw e})}static getCookie(e){var t,n;let i="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===i.length)return null!=(n=null==(t=i.pop())?void 0:t.split(";").shift())?n:""}static detectDevice(){if("undefined"==typeof navigator)return{isMobile:!1,isWechat:!1,isIOS:!1,isAndroid:!1};let e=navigator.userAgent;return{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),isWechat:/MicroMessenger/i.test(e),isIOS:/iPhone|iPad|iPod/i.test(e),isAndroid:/Android/i.test(e)}}}let a={domain:"rustplus.cn",payWebUrl:"https://pay.rustplus.cn"}},49621:(e,t,n)=>{"use strict";n.d(t,{B:()=>r});class i{emit(e,t){var n;null==(n=this.listeners[e])||n.forEach(e=>e(t))}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){var n;this.listeners[e]=null==(n=this.listeners[e])?void 0:n.filter(e=>e!==t)}constructor(){this.listeners={}}}let r=new i},50886:(e,t,n)=>{"use strict";n.d(t,{I:()=>r});var i=n(12115);let r=()=>{let[e,t]=(0,i.useState)(()=>window.innerWidth<768);return(0,i.useEffect)(()=>{let e=()=>{t(window.innerWidth<768)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}},53412:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>e$});var i=n(95155),r=n(12115),a=n(36060),o=n(37076);n(92932);var s=n(69176),l=n(43324),d=n(19279),c=n(89543),p=n(15856),u=n(63646),h=n(785),y=n(99667),g=n(36627),x=n(44425),f=n(21038),m=n(19782),b=n(43561),j=n(44074),w=n(35510),S=n(92199),A=n(40469),v=n(14274),k=n(16638),C=n(65614),T=n(57544),z=n(57954),R=n(31142),E=n(4936),B=n(50329),I=n(44241),O=n(18172),F=n(96323),_=n(33631),N=n(96347),P=n(62620),D=n(9485),L=n(49621),q=n(20063);let W=(0,r.createContext)({id:0,username:"",nickname:null,avatarImage:null,group:"",permissions:[]});function J(e){let{children:t,user:n}=e;return(0,i.jsx)(W.Provider,{value:n,children:t})}var M=n(90925),U=n(37783),G=n(94260),H=n(2995);let{Text:V,Title:Y}=d.A;function $(e){var t;let{open:n,data:a,onCancel:o,onConfirm:s,loading:l=!1}=e,[d,c]=(0,r.useState)(!1),[y,g]=(0,r.useState)("");return r.useEffect(()=>{if(n&&(null==a?void 0:a.img))if(c(!1),a.img.startsWith("http://")){let e=a.img.replace("http://","https://"),t=new Image;t.onload=()=>g(e),t.onerror=()=>g(a.img),t.src=e}else g(a.img);else n&&(g(""),c(!1))},[n,null==a?void 0:a.img]),(0,i.jsxs)(p.A,{open:n,onCancel:o,maskClosable:!1,footer:null,centered:!0,width:520,closable:!1,styles:{content:{padding:0,overflow:"hidden",borderRadius:20,background:"#27272c"}},children:[(0,i.jsxs)("div",{style:{position:"relative",height:160,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",backgroundSize:"cover",backgroundPosition:"center"},children:[y&&!d&&(0,i.jsx)("img",{src:y,alt:"",onError:()=>c(!0),style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",opacity:.7}}),(0,i.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(39,39,44,1))"}}),(0,i.jsx)(h.Ay,{type:"text",icon:(0,i.jsx)(P.A,{}),onClick:o,style:{position:"absolute",top:12,right:12,color:"rgba(255,255,255,0.8)",background:"rgba(0,0,0,0.3)",borderRadius:8,width:32,height:32}}),(0,i.jsx)("div",{style:{position:"absolute",bottom:-30,left:24,width:60,height:60,borderRadius:14,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",display:"flex",alignItems:"center",justifyContent:"center",border:"3px solid #27272c",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:(0,i.jsx)(G.A,{style:{fontSize:28,color:"#fff"}})})]}),(0,i.jsxs)("div",{style:{padding:"40px 24px 24px"},children:[(0,i.jsx)(Y,{level:4,style:{margin:"0 0 4px",color:"#fff",fontSize:18},children:(null==a?void 0:a.name)||"未知服务器"}),(null==a?void 0:a.url)&&(0,i.jsx)(V,{type:"secondary",style:{fontSize:13},children:a.url}),(null==a?void 0:a.desc)&&(0,i.jsx)("div",{style:{marginTop:16,padding:16,background:"rgba(255,255,255,0.03)",borderRadius:12,border:"1px solid rgba(255,255,255,0.06)",maxHeight:120,overflow:"auto"},children:(0,i.jsx)(V,{type:"secondary",style:{fontSize:13,lineHeight:1.6,whiteSpace:"pre-wrap"},children:(t=a.desc)?t.replace(/\\n/g,"\n").replace(/\\t/g,"  "):""})}),(0,i.jsx)("div",{style:{marginTop:20,padding:"12px 16px",background:"rgba(16, 185, 129, 0.1)",borderRadius:10,border:"1px solid rgba(16, 185, 129, 0.2)"},children:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(H.A,{style:{color:"#10b981"}}),(0,i.jsx)(V,{style:{color:"#6ee7b7",fontSize:13},children:"确认配对此服务器到您的工具箱？"})]})}),(0,i.jsxs)("div",{style:{display:"flex",gap:12,marginTop:20},children:[(0,i.jsx)(h.Ay,{onClick:o,style:{flex:1,height:44,borderRadius:12,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:"取消"}),(0,i.jsx)(h.Ay,{type:"primary",onClick:s,loading:l,style:{flex:1,height:44,borderRadius:12,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",fontWeight:500},children:"确认配对"})]})]})]})}var K=n(3415),Q=n(86133),X=n(97416),Z=n(49073),ee=n(89856),et=n(68585);function en(e){let{open:t,data:n,onCancel:a,onConfirm:o,loading:s=!1}=e,[l]=(0,et.A)(),d=(null==n?void 0:n.entityType)=="2"?"智能警报":"智能开关";return(0,r.useEffect)(()=>{t&&l.setFieldsValue({name:(null==n?void 0:n.name)||"",note:(null==n?void 0:n.note)||"",noteColor:(null==n?void 0:n.noteColor)||"#000000"})},[t,n,l]),(0,i.jsxs)(p.A,{title:"".concat(d,"配对确认"),open:t,onCancel:a,maskClosable:!1,footer:[(0,i.jsx)(h.Ay,{onClick:a,children:"取消"},"cancel"),(0,i.jsx)(h.Ay,{type:"primary",onClick:()=>{l.validateFields().then(e=>{"string"!=typeof e.noteColor&&(e.noteColor=e.noteColor.toHexString()),o({name:e.name,note:e.note||"",noteColor:e.noteColor,entityType:null==n?void 0:n.entityType})}).catch(()=>{K.Ay.error("请检查输入是否正确")})},loading:s,children:"配对"},"pair")],centered:!0,destroyOnHidden:!0,children:[(0,i.jsx)("div",{style:{marginBottom:16},children:(0,i.jsxs)("p",{children:["有一个",d,"正在配对，请确认"]})}),(0,i.jsx)(Q.A,{form:l,layout:"vertical",children:(0,i.jsxs)(X.A,{bordered:!0,column:1,children:[(0,i.jsx)(X.A.Item,{label:"".concat(d,"名称"),children:(0,i.jsx)(Q.A.Item,{name:"name",rules:[{required:!0,message:"".concat(d,"名称不能为空")},{max:24,message:"".concat(d,"名称不能超过24个字符")}],children:(0,i.jsx)(Z.A,{placeholder:"请输入".concat(d,"名称"),maxLength:24})})}),(0,i.jsx)(X.A.Item,{label:"".concat(d,"备注"),children:(0,i.jsx)(Q.A.Item,{name:"note",rules:[{max:100,message:"".concat(d,"备注不能超过100个字符")}],children:(0,i.jsx)(Z.A,{placeholder:"请输入".concat(d,"备注（可选）"),maxLength:100})})}),(0,i.jsx)(X.A.Item,{label:"备注颜色",children:(0,i.jsx)(Q.A.Item,{name:"noteColor",initialValue:"#000000",children:(0,i.jsx)(ee.A,{format:"hex",defaultFormat:"hex",presets:[{label:"推荐",colors:["#000000","#FFFFFF","#FF4D4F","#13C2C2","#52C41A","#FAAD14","#2F54EB","#722ED1"]}]})})})]})})]})}function ei(e){let{open:t,data:n,onCancel:a,onConfirm:o,loading:s=!1}=e,[l]=(0,et.A)();return(0,r.useEffect)(()=>{t&&l.setFieldsValue({name:(null==n?void 0:n.name)||"",note:(null==n?void 0:n.note)||"",noteColor:(null==n?void 0:n.noteColor)||"#000000"})},[t,n,l]),(0,i.jsxs)(p.A,{title:"存储监视器配对确认",open:t,onCancel:a,maskClosable:!1,footer:[(0,i.jsx)(h.Ay,{onClick:a,children:"取消"},"cancel"),(0,i.jsx)(h.Ay,{type:"primary",onClick:()=>{l.validateFields().then(e=>{"string"!=typeof e.noteColor&&(e.noteColor=e.noteColor.toHexString()),o({name:e.name,note:e.note||"",noteColor:e.noteColor})}).catch(()=>{K.Ay.error("请检查输入是否正确")})},loading:s,children:"配对"},"pair")],centered:!0,destroyOnHidden:!0,children:[(0,i.jsx)("div",{style:{marginBottom:16},children:(0,i.jsx)("p",{children:"有一个存储监视器正在配对，请确认"})}),(0,i.jsx)(Q.A,{form:l,layout:"vertical",children:(0,i.jsxs)(X.A,{bordered:!0,column:1,children:[(0,i.jsx)(X.A.Item,{label:"存储监视器名称",children:(0,i.jsx)(Q.A.Item,{name:"name",rules:[{required:!0,message:"存储监视器名称不能为空"},{max:24,message:"存储监视器名称不能超过24个字符"}],children:(0,i.jsx)(Z.A,{placeholder:"请输入存储监视器名称",maxLength:24})})}),(0,i.jsx)(X.A.Item,{label:"存储监视器备注",children:(0,i.jsx)(Q.A.Item,{name:"note",rules:[{max:100,message:"存储监视器备注不能超过100个字符"}],children:(0,i.jsx)(Z.A,{placeholder:"请输入存储监视器备注（可选）",maxLength:100})})}),(0,i.jsx)(X.A.Item,{label:"备注颜色",children:(0,i.jsx)(Q.A.Item,{name:"noteColor",initialValue:"#000000",children:(0,i.jsx)(ee.A,{format:"hex",defaultFormat:"hex",presets:[{label:"推荐",colors:["#000000","#FFFFFF","#FF4D4F","#13C2C2","#52C41A","#FAAD14","#2F54EB","#722ED1"]}]})})})]})})]})}var er=n(96750),ea=n(56418);function eo(e){let{disabled:t=!1}=e,{message:n}=c.A.useApp();(0,r.useEffect)(()=>{if(t)return;let e=null;return(async()=>{if(!await (0,er.C)())return n.error("无法与服务器建立连接");let t=U.Aq.getGatewayUrl("/api/f/receivenotice");(e=new M.EventSourcePolyfill(t.toString(),{headers:{Authorization:U.Aq.getCookie("authToken")||""}})).onmessage=e=>{console.log("Message:",e.data);let t=JSON.parse(e.data);console.log(t),"frm"===t.type&&("server"===t.data.type?(o(t.data),l(t.key),u(!0)):"entity"===t.data.type&&("1"==t.data.entityType||"2"==t.data.entityType?(x({name:t.data.entityName,id:t.data.entityId,entityType:t.data.entityType}),m(t.key),j(!0)):"3"==t.data.entityType&&(v({name:t.data.entityName,id:t.data.entityId}),C(t.key),z(!0))))},e.addEventListener("welcome",e=>{console.log("Welcome event:",e.data),L.B.emit("SSE_CONNECTED",{status:e.data})}),e.addEventListener("end",t=>{console.log("Stream ended:",t.data),null==e||e.close()}),e.onerror=e=>{console.error("SSE error:",e),L.B.emit("SSE_DISCONNECTED",{})}})(),()=>{e&&(e.close(),e=null)}},[t]);let[a,o]=(0,r.useState)(null),[s,l]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1),[h,y]=(0,r.useState)(!1),[g,x]=(0,r.useState)(null),[f,m]=(0,r.useState)(""),[b,j]=(0,r.useState)(!1),[w,S]=(0,r.useState)(!1),[A,v]=(0,r.useState)(null),[k,C]=(0,r.useState)(""),[T,z]=(0,r.useState)(!1),[R,E]=(0,r.useState)(!1),B=async()=>{y(!0);try{let e=await U.Aq.backendFetch("/api/f/setserverconfig",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:s})}),t=await e.json();y(!1),200===t.status?(u(!1),n.success("配对成功"),o(null),L.B.emit("ADMIN_DATA_SERVER_UPDATE",t.data)):10001===t.status?(u(!1),p.A.warning({title:"配对信息已过期",icon:(0,i.jsx)(ea.A,{}),content:"配对请求已超时，请返回游戏重新发起配对",okText:"我知道了",centered:!0})):10002===t.status||10003===t.status?(u(!1),L.B.emit("TRIGGER_RECONNECT",{type:"rust"})):n.error(t.errmessage||"配对失败")}catch(e){y(!1),u(!1),L.B.emit("TRIGGER_RECONNECT",{type:"rust"})}},I=async(e,t,i,r)=>{S(!0);let a=await U.Aq.backendFetch("2"==r?"/api/f/addsmartalarm":"/api/f/addswitch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:f,name:e,note:t,noteColor:i})}),o=await a.json().finally(()=>{S(!1),j(!1)});200===o.status?(n.success("配对成功"),x(null),L.B.emit("ADMIN_DATA_SWITCH_UPDATE",o.data)):n.error(o.errmessage||"配对失败")},O=async(e,t,i)=>{E(!0);let r=await U.Aq.backendFetch("/api/f/addstoragemonitor",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:k,name:e,note:t,noteColor:i})}),a=await r.json().finally(()=>{E(!1),z(!1)});200===a.status?(n.success("配对成功"),v(null),L.B.emit("ADMIN_DATA_STORAGE_MONITOR_UPDATE",a.data)):n.error(a.errmessage||"配对失败")};return(0,i.jsxs)(r.Fragment,{children:[a&&(0,i.jsx)($,{open:d,data:a,onCancel:()=>u(!1),onConfirm:B,loading:h}),g&&(0,i.jsx)(en,{open:b,data:g,onCancel:()=>j(!1),onConfirm:e=>{I(e.name,e.note,e.noteColor,e.entityType)},loading:w}),A&&(0,i.jsx)(ei,{open:T,data:A,onCancel:()=>z(!1),onConfirm:e=>{O(e.name,e.note,e.noteColor)},loading:R})]})}var es=n(91442),el=n(45125),ed=n(81184),ec=n(65982),ep=n(91589),eu=n(54540),eh=n(67153),ey=n(8805),eg=n(55248),ex=n(21282),ef=n(29655),em=n(31199);let eb="https://cap.rustplus.cn/336bfb3b1a/",ej="wx_pay_state",{Title:ew,Text:eS}=d.A;function eA(e){let{open:t,onClose:n,onBalanceUpdate:o}=e,[s,l]=(0,r.useState)(null),[d,y]=(0,r.useState)(10),[g,x]=(0,r.useState)("alipay"),[f,m]=(0,r.useState)(""),[w,S]=(0,r.useState)(!1),[A,v]=(0,r.useState)(!0),[k,C]=(0,r.useState)(!1),[T,z]=(0,r.useState)(null),[R,E]=(0,r.useState)("recharge"),[B,O]=(0,r.useState)([]),[F,_]=(0,r.useState)({page:1,pageSize:10,total:0}),[N,P]=(0,r.useState)(!1),[D,q]=(0,r.useState)(""),[W,J]=(0,r.useState)(!1),{modal:M,message:G}=c.A.useApp(),[H,V]=(0,r.useState)(!1),[Y,$]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(0),X=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:eb});e.addEventListener("progress",e=>{Q(e.detail.progress||0)}),X.current=e,V(!0);return}let e=document.createElement("script");e.src="/cap-widget.js",e.async=!0,e.onload=()=>{if(window.Cap){let e=new window.Cap({apiEndpoint:eb});e.addEventListener("progress",e=>{Q(e.detail.progress||0)}),X.current=e,V(!0)}},document.head.appendChild(e)},[]);let ee=(0,r.useCallback)(async()=>{if(!H||!X.current)return G.error("人机验证组件未加载完成，请稍后重试"),null;try{return $(!0),Q(0),(await X.current.solve()).token}catch(e){return G.error("人机验证失败，请重试"),null}finally{$(!1),Q(0)}},[H,G]),et=(0,r.useCallback)(async e=>{if(navigator.clipboard&&window.isSecureContext)try{return await navigator.clipboard.writeText(e),!0}catch(e){}try{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select();let n=document.execCommand("copy");return document.body.removeChild(t),n}catch(e){return!1}},[]),en=async e=>{if(await new Promise(e=>{window.WeixinJSBridge?e():(document.addEventListener("WeixinJSBridgeReady",()=>e(),{once:!0}),setTimeout(e,3e3))}),!window.WeixinJSBridge)throw Error("WeixinJSBridge not available");return new Promise(t=>{window.WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign},e=>{t(e.err_msg||"unknown")})})},ei=(0,r.useCallback)(async()=>{let e=new URLSearchParams(window.location.search).get("code");if(!e)return!1;let t=sessionStorage.getItem(ej);if(!t)return window.history.replaceState({},"",window.location.pathname),!1;try{let n=JSON.parse(t);y(n.amount||10),m(n.invitationCode||""),x("wxpay"),J(!0),S(!0);let i=await U.Aq.backendFetch("/api/pay/wxpay/oauth/openid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),r=await i.json();if(window.history.replaceState({},"",window.location.pathname),200!==r.status)return G.error("获取微信授权失败，请重试"),sessionStorage.removeItem(ej),!1;let a=r.data.openid;sessionStorage.setItem("wx_openid",a),sessionStorage.removeItem(ej);let o=await ee();if(!o)return S(!1),!1;let s=await U.Aq.backendFetch("/api/pay/rcoin/wxpay/jsapi",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:n.amount,code:n.invitationCode||"",openid:a,capToken:o})}),l=await s.json();if(200!==l.status)return G.error(l.errmessage||"下单失败"),!1;let d=await en(l.data.payParams);"get_brand_wcpay_request:ok"===d?(ek(),ea()):"get_brand_wcpay_request:cancel"===d?G.info("支付已取消"):G.error("支付失败")}catch(e){console.error("微信支付回调处理失败",e),sessionStorage.removeItem(ej)}finally{J(!1),S(!1)}return!0},[G]),er=async(e,t,n)=>{S(!0);try{let i=await ee();if(!i)return void S(!1);let r=await U.Aq.backendFetch("/api/pay/rcoin/wxpay/jsapi",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,code:t||"",openid:n,capToken:i})}),a=await r.json();if(200!==a.status)return void G.error(a.errmessage||"下单失败");let o=await en(a.data.payParams);"get_brand_wcpay_request:ok"===o?(ek(),ea()):"get_brand_wcpay_request:cancel"===o?G.info("支付已取消"):G.error("支付失败")}finally{S(!1)}};(0,r.useEffect)(()=>(t?(ea(),C(!1),z(null),ei(),document.body.style.overflow="hidden",document.body.style.touchAction="none"):(document.body.style.overflow="",document.body.style.touchAction=""),()=>{document.body.style.overflow="",document.body.style.touchAction=""}),[t,ei]);let ea=async()=>{v(!0);try{let[e,t]=await Promise.all([U.Aq.backendFetch("/api/pay/getrcoininfo",{method:"POST"}),U.Aq.backendFetch("/api/pay/getuserinfo",{method:"POST"})]),n=await e.json(),i=await t.json();200===n.status&&(l(n.data),null==o||o(n.data.balance),L.B.emit("RCOIN_BALANCE_UPDATED",{balance:n.data.balance})),200===i.status&&q(i.data.email)}catch(e){G.error("加载失败")}finally{v(!1)}},eo=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;P(!0);try{let t=await U.Aq.backendFetch("/api/pay/getrcoinlogs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:e,pageSize:F.pageSize})}),n=await t.json();200===n.status&&(O(n.data.logs),_(e=>({...e,page:n.data.page,total:n.data.total})))}catch(e){G.error("加载日志失败")}finally{P(!1)}},eA=async e=>{let t=sessionStorage.getItem("wx_openid");if(!t&&!new URLSearchParams(window.location.search).get("code")){sessionStorage.setItem(ej,JSON.stringify({amount:e,invitationCode:f}));let t=window.location.origin+window.location.pathname,n=await U.Aq.backendFetch("/api/pay/wxpay/oauth/url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({redirect_uri:t})}),i=await n.json();200===i.status?window.location.href=i.data.url:(G.error("获取授权链接失败"),sessionStorage.removeItem(ej));return}await er(e,f,t)},ev=async()=>{let e=Math.floor(d);if(e<1||e>1e4)return void G.error("充值数量需在1-10000之间");S(!0);try{let{isWechat:t,isMobile:n}=(()=>{let e=U.Aq.detectDevice();return{isWechat:e.isWechat,isMobile:e.isMobile}})(),r=window.location.pathname,a=window.location.origin;if("wxpay"===g){if(n&&!t)return void M.info({title:"请在微信中打开",content:(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)("div",{style:{fontSize:14,color:"rgba(255,255,255,0.7)",marginBottom:12},children:"微信支付需要在微信中完成"}),(0,i.jsx)("div",{style:{fontSize:13,color:"rgba(255,255,255,0.5)",marginBottom:16},children:"请复制当前网址，在微信中打开后重新支付"}),(0,i.jsx)(Z.A,{value:window.location.href,readOnly:!0,style:{marginBottom:8},addonAfter:(0,i.jsx)(eh.A,{style:{cursor:"pointer"},onClick:async()=>{await et(window.location.href)?G.success("网址已复制"):G.info("请手动复制上方网址")}})})]}),okText:"复制网址",onOk:async()=>{await et(window.location.href)?G.success("网址已复制"):G.info("请手动复制网址")}});if(t)return void await eA(e)}let o=await ee();if(!o)return void S(!1);let s="wxpay"===g?"/api/pay/a/querywxpayorderissuccess":"/api/pay/a/queryalipayorderissuccess",l={amount:e,code:f||"",capToken:o};"alipay"===g&&(l.return_url="".concat(a,"/pay-result?return_path=").concat(encodeURIComponent(r)),l.isMobile=n,n&&(l.quit_url="".concat(a).concat(r)));let d=await U.Aq.backendFetch("wxpay"===g?"/api/pay/rcoin/wxpay/native":"/api/pay/rcoin/alipay/native",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),c=await d.json();if(200!==c.status){G.error(c.errmessage||"下单失败"),S(!1);return}if(z(c.data),C(!0),S(!1),"alipay"===g){window.location.href=c.data.code_url;return}let p=c.data.out_trade_no;for(let e=0;e<120;e++){let e=await U.Aq.backendFetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({out_trade_no:p})}),t=await e.json();if(200===t.status){ek(),ea();return}await new Promise(e=>setTimeout(e,1e3))}}finally{S(!1)}},ek=()=>{M.success({icon:null,content:(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)(j.A,{style:{color:"#10b981",fontSize:"64px",marginBottom:"16px"}}),(0,i.jsx)(ew,{level:4,style:{color:"#fff",margin:"0 0 8px 0"},children:"充值成功"}),(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.6)"},children:"R币已到账"}),(0,i.jsx)(h.Ay,{type:"primary",style:{marginTop:"24px",width:"100%"},onClick:()=>{p.A.destroyAll(),C(!1),z(null),ea()},children:"确定"})]}),footer:null,closable:!0,width:360,centered:!0})},eC=()=>{if(!T)return null;let[e,t]=(0,r.useState)(T.time_expire+T.advance_seconds);return(0,r.useEffect)(()=>{let e=setInterval(()=>t(e=>e<=1?0:e-1),1e3);return()=>clearInterval(e)},[]),(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)("div",{style:{display:"inline-block",padding:"16px",background:"#fff",borderRadius:"12px",boxShadow:"0 4px 24px rgba(0,0,0,0.2)"},children:"wxpay"===g?(0,i.jsx)(es.A,{value:T.code_url,size:180,color:"#000",bgColor:"#fff"}):(0,i.jsxs)("div",{style:{padding:"20px",textAlign:"center",width:180},children:[(0,i.jsx)(j.A,{style:{fontSize:"40px",color:"#1677ff",marginBottom:"12px"}}),(0,i.jsx)("div",{style:{color:"#333",fontSize:"14px",marginBottom:"6px"},children:"订单已创建"}),(0,i.jsx)("div",{style:{color:"#666",fontSize:"12px"},children:"已跳转至支付宝付款页面"})]})}),(0,i.jsxs)("div",{style:{marginTop:"16px"},children:[(0,i.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"6px 12px",background:"rgba(99, 102, 241, 0.1)",borderRadius:"16px",marginBottom:"8px"},children:[(0,i.jsx)(ey.A,{style:{color:"#818cf8",fontSize:12}}),(0,i.jsxs)(eS,{style:{color:"#818cf8",fontSize:12},children:["有效期: ",(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(e)]})]}),(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.4)",fontSize:"12px",display:"block"},children:"wxpay"===g?"请使用微信扫码支付":"请在新窗口完成支付"})]})]})};return(0,i.jsxs)(p.A,{open:t,onCancel:n,footer:null,width:650,centered:!0,destroyOnClose:!0,closable:!1,styles:{content:{background:"#27272c",border:"1px solid rgba(255,255,255,0.1)",padding:0,maxHeight:"90vh",overflow:"hidden"},header:{display:"none"},body:{padding:0,display:"flex",flexDirection:"column",maxHeight:"90vh",overflow:"hidden"}},title:null,className:"rcoin-modal",children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 20px",borderBottom:"1px solid rgba(255,255,255,0.08)",background:"#27272c",flexShrink:0},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,i.jsx)("img",{src:"/Rmoney.ico",alt:"R币",style:{width:24,height:24,borderRadius:"50%"}}),(0,i.jsx)(eS,{strong:!0,style:{fontSize:16,color:"#fff"},children:"R币充值"})]}),(0,i.jsx)(h.Ay,{type:"text",onClick:n,style:{color:"rgba(255,255,255,0.5)",width:32,height:32,padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:"✕"})]}),(0,i.jsx)("div",{style:{padding:"0 24px 24px",overflow:"auto",flex:1,overscrollBehavior:"contain"},onTouchMove:e=>{let t=e.currentTarget,{scrollTop:n,scrollHeight:i,clientHeight:r}=t;(n<=0&&e.touches[0].clientY>t._lastTouchY||n+r>=i&&e.touches[0].clientY<t._lastTouchY)&&e.stopPropagation(),t._lastTouchY=e.touches[0].clientY},onTouchStart:e=>{e.currentTarget._lastTouchY=e.touches[0].clientY},children:A?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:(0,i.jsx)(a.A,{size:"large"})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",borderRadius:"14px",padding:"16px 20px",marginBottom:"16px",marginTop:"16px"},children:[(0,i.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,i.jsxs)("div",{children:[(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.7)",fontSize:"12px"},children:"R币余额"}),(0,i.jsxs)("div",{style:{fontSize:"28px",fontWeight:700,color:"#fff",marginTop:"2px",display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("img",{src:"/Rmoney.ico",alt:"R币",style:{width:24,height:24,borderRadius:"50%"}}),(null==s?void 0:s.balance.toFixed(2))||"0.00"]})]})}),(0,i.jsxs)("div",{style:{display:"flex",gap:"20px",marginTop:"12px",paddingTop:"12px",borderTop:"1px solid rgba(255,255,255,0.15)"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.6)",fontSize:"11px"},children:"累计充值"}),(0,i.jsx)("div",{style:{color:"#fff",fontWeight:600,fontSize:13},children:(null==s?void 0:s.totalPurchased.toFixed(2))||"0.00"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.6)",fontSize:"11px"},children:"累计消费"}),(0,i.jsx)("div",{style:{color:"#fff",fontWeight:600,fontSize:13},children:(null==s?void 0:s.totalUsed.toFixed(2))||"0.00"})]})]})]}),(0,i.jsx)(eu.A,{activeKey:R,onChange:e=>{E(e),"logs"===e&&0===B.length&&eo()},items:[{key:"recharge",label:(0,i.jsxs)("span",{children:[(0,i.jsx)(ef.A,{style:{marginRight:6}}),"充值"]}),children:(0,i.jsx)(()=>(0,i.jsx)("div",{children:k?(0,i.jsx)(eC,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",display:"block",marginBottom:"6px"},children:"充值账号"}),(0,i.jsx)(Z.A,{disabled:!0,value:D,style:{background:"rgba(255,255,255,0.03)",height:"40px"}})]}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",display:"block",marginBottom:"8px"},children:"充值数量"}),(0,i.jsx)("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",marginBottom:"10px"},children:[10,50,100,200,500,1e3].map(e=>(0,i.jsx)(b.A,{onClick:()=>y(e),style:{cursor:"pointer",padding:"6px 12px",borderRadius:"6px",background:d===e?"rgba(99, 102, 241, 0.2)":"rgba(255,255,255,0.05)",border:d===e?"1px solid #6366f1":"1px solid rgba(255,255,255,0.1)",color:d===e?"#818cf8":"rgba(255,255,255,0.7)",fontSize:13},children:e},e))}),(0,i.jsx)(el.A,{min:1,max:1e4,value:d,onChange:e=>y(Math.floor(e||1)),precision:0,style:{width:"100%",height:"40px"},addonAfter:"R币"}),(0,i.jsxs)("div",{style:{marginTop:"6px",display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.4)",fontSize:"12px"},children:"支付金额"}),(0,i.jsxs)(eS,{style:{color:"#f87171",fontWeight:600},children:["\xa5",Math.floor(d),".00"]})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",display:"block",marginBottom:"8px"},children:"支付方式"}),(0,i.jsxs)(ed.A,{gutter:8,children:[(0,i.jsx)(ec.A,{span:12,children:(0,i.jsx)("div",{onClick:()=>x("alipay"),style:{padding:"12px",background:"alipay"===g?"rgba(22, 119, 255, 0.1)":"rgba(255,255,255,0.03)",border:"alipay"===g?"1px solid rgba(22, 119, 255, 0.4)":"1px solid rgba(255,255,255,0.08)",borderRadius:"10px",cursor:"pointer",transition:"all 0.2s"},children:(0,i.jsxs)(u.A,{children:[(0,i.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:"#1677ff",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(eg.A,{style:{color:"#fff",fontSize:"18px"}})}),(0,i.jsx)("div",{style:{color:"#fff",fontWeight:500,fontSize:13},children:"支付宝"})]})})}),(0,i.jsx)(ec.A,{span:12,children:(0,i.jsx)("div",{onClick:()=>x("wxpay"),style:{padding:"12px",background:"wxpay"===g?"rgba(82, 196, 26, 0.1)":"rgba(255,255,255,0.03)",border:"wxpay"===g?"1px solid rgba(82, 196, 26, 0.4)":"1px solid rgba(255,255,255,0.08)",borderRadius:"10px",cursor:"pointer",transition:"all 0.2s"},children:(0,i.jsxs)(u.A,{children:[(0,i.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:"#52c41a",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(ex.A,{style:{color:"#fff",fontSize:"18px"}})}),(0,i.jsx)("div",{style:{color:"#fff",fontWeight:500,fontSize:13},children:"微信支付"})]})})})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",display:"block",marginBottom:"6px"},children:"邀请码（可选）"}),(0,i.jsx)(Z.A,{value:f,onChange:e=>m(e.target.value),placeholder:"输入邀请码可享优惠",style:{height:"40px"}})]}),Y&&(0,i.jsxs)("div",{style:{marginBottom:"12px",padding:"12px 14px",background:"rgba(99, 102, 241, 0.1)",border:"1px solid rgba(99, 102, 241, 0.2)",borderRadius:"10px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[(0,i.jsx)(eS,{style:{color:"#a5b4fc",fontSize:"13px"},children:"正在进行安全验证..."}),(0,i.jsxs)(eS,{style:{color:"#818cf8",fontSize:"13px",fontWeight:600},children:[K,"%"]})]}),(0,i.jsx)("div",{style:{height:"4px",background:"rgba(255,255,255,0.1)",borderRadius:"2px",overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(K,"%"),background:"linear-gradient(90deg, #6366f1 0%, #818cf8 100%)",borderRadius:"2px",transition:"width 0.3s ease"}})})]}),(0,i.jsx)(h.Ay,{type:"primary",size:"large",block:!0,onClick:ev,loading:w,disabled:Y,icon:"alipay"===g?(0,i.jsx)(eg.A,{}):(0,i.jsx)(ex.A,{}),style:{height:"46px",fontSize:"15px",fontWeight:600,borderRadius:"12px",background:w||Y?"rgba(255,255,255,0.1)":"alipay"===g?"linear-gradient(135deg, #1677ff 0%, #0958d9 100%)":"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",boxShadow:w||Y?"none":"alipay"===g?"0 4px 16px rgba(22, 119, 255, 0.3)":"0 4px 16px rgba(82, 196, 26, 0.3)"},children:Y?"验证中 ".concat(K,"%"):w?"处理中...":"立即充值 \xa5".concat(Math.floor(d),".00")}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",marginTop:"14px",color:"rgba(255,255,255,0.35)",fontSize:"11px"},children:[(0,i.jsx)(I.A,{}),(0,i.jsx)("span",{children:"安全支付 \xb7 即时到账"})]})]})}),{})},{key:"logs",label:(0,i.jsxs)("span",{children:[(0,i.jsx)(em.A,{style:{marginRight:6}}),"变动记录"]}),children:(0,i.jsx)(()=>(0,i.jsxs)("div",{style:{marginTop:8},children:[N?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:40},children:(0,i.jsx)(a.A,{})}):0===B.length?(0,i.jsx)("div",{style:{textAlign:"center",padding:40,color:"rgba(255,255,255,0.4)"},children:"暂无记录"}):(0,i.jsx)("div",{children:B.map(e=>{var t;let n={recharge:{text:"充值",color:"#52c41a"},exchange:{text:"兑换",color:"#f59e0b"},consume:{text:"消费",color:"#ff4d4f"},refund:{text:"退款",color:"#1677ff"},gift:{text:"赠送",color:"#722ed1"},system_add:{text:"系统增加",color:"#13c2c2"},system_deduct:{text:"系统扣除",color:"#fa8c16"},other:{text:"其他",color:"#8c8c8c"}}[t=e.changeType]||{text:t,color:"#8c8c8c"};return(0,i.jsxs)("div",{style:{padding:"12px 14px",background:"rgba(255,255,255,0.03)",borderRadius:10,marginBottom:8,border:"1px solid rgba(255,255,255,0.06)"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(b.A,{color:n.color,style:{margin:0,fontSize:11},children:n.text}),(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.5)",fontSize:11},children:U.Aq.formatDateTime(e.createdAt)})]}),(0,i.jsxs)(eS,{style:{color:e.changeAmount>=0?"#52c41a":"#ff4d4f",fontWeight:600,fontSize:15},children:[e.changeAmount>=0?"+":"",e.changeAmount.toFixed(2)]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(eS,{style:{color:"rgba(255,255,255,0.7)",fontSize:13},children:e.reason}),(0,i.jsxs)(eS,{style:{color:"rgba(255,255,255,0.4)",fontSize:11,whiteSpace:"nowrap",marginLeft:12},children:[e.balanceBefore.toFixed(2)," → ",(0,i.jsx)("span",{style:{color:"#a78bfa"},children:e.balanceAfter.toFixed(2)})]})]})]},e.id)})}),F.total>F.pageSize&&(0,i.jsx)("div",{style:{marginTop:"12px",textAlign:"center"},children:(0,i.jsx)(ep.A,{current:F.page,total:F.total,pageSize:F.pageSize,onChange:e=>eo(e),size:"small",showSizeChanger:!1})})]}),{})}]})]})})]})}var ev=n(23608),ek=n(19374),eC=n(87480),eT=n(56922);let{Text:ez}=d.A,eR="https://cap.rustplus.cn/336bfb3b1a/";function eE(e){let{open:t,onCancel:n}=e,{message:a}=c.A.useApp(),[o,s]=(0,r.useState)(null),[l,d]=(0,r.useState)(!1),[y,g]=(0,r.useState)(0),[x,f]=(0,r.useState)(null),[m,b]=(0,r.useState)(null),[j,w]=(0,r.useState)(""),[S,A]=(0,r.useState)(0),[v]=Q.A.useForm(),[k,C]=(0,r.useState)(!1),T=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(window.Cap){T.current=new window.Cap({apiEndpoint:eR}),C(!0);return}let e=document.createElement("script");return e.src="/cap-widget.js",e.async=!0,e.onload=()=>{window.Cap&&(T.current=new window.Cap({apiEndpoint:eR}),C(!0))},document.head.appendChild(e),()=>{}},[]);let z=(0,r.useCallback)(async()=>{if(!k||!T.current)return a.error("人机验证组件未加载完成，请稍后重试"),null;try{return(await T.current.solve()).token}catch(e){return a.error("人机验证失败，请重试"),null}},[k,a]),R=(0,r.useCallback)(async()=>{try{let e=await U.Aq.backendFetch("/api/f/getaccountbindinfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json();200===t.status&&s(t.data)}catch(e){console.error("获取绑定信息失败:",e)}},[]);(0,r.useEffect)(()=>{t&&(R(),E())},[t,R]),(0,r.useEffect)(()=>{if(S>0){let e=setTimeout(()=>A(S-1),1e3);return()=>clearTimeout(e)}},[S]);let E=()=>{g(0),f(null),b(null),w(""),A(0),v.resetFields()},B=async()=>{if(!(S>0)){d(!0);try{let e=await U.Aq.backendFetch("phone"===x?"/api/f/getoldphoneverify":"/api/f/getoldemailverify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json();200===t.status?(a.success("验证码已发送"),A(60)):a.error(t.errmessage||"发送失败")}catch(e){a.error("发送失败")}finally{d(!1)}}},O=async()=>{let e=v.getFieldValue("oldCode");if(!e||6!==e.length)return void a.error("请输入6位验证码");d(!0);try{let t=await U.Aq.backendFetch("phone"===x?"/api/f/verifyoldphone":"/api/f/verifyoldemail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),n=await t.json();200===n.status?(w(n.token),g(1),A(0),v.resetFields(),a.success("验证成功")):a.error(n.errmessage||"验证失败")}catch(e){a.error("验证失败")}finally{d(!1)}},F=async()=>{if(S>0)return;let e="phone"===x?v.getFieldValue("newPhone"):v.getFieldValue("newEmail");if(!e)return void a.error("phone"===x?"请输入新手机号":"请输入新邮箱");d(!0);try{let t=await z();if(!t)return void d(!1);let n="phone"===x?{phone:e}:{email:e};n.capToken=t,j&&(n.token=j);let i=await U.Aq.backendFetch("phone"===x?"/api/f/getnewphoneverify":"/api/f/getnewemailverify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),r=await i.json();200===r.status?(a.success("验证码已发送"),A(60)):a.error(r.errmessage||"发送失败")}catch(e){a.error("发送失败")}finally{d(!1)}},_=async()=>{let e=v.getFieldValue("newCode"),t="phone"===x?v.getFieldValue("newPhone"):v.getFieldValue("newEmail");if(!e||6!==e.length)return void a.error("请输入6位验证码");d(!0);try{let n=null;if("phone"===x&&!(n=await z()))return void d(!1);let i={code:e};"phone"===x?(i.phone=t,i.capToken=n):i.email=t,j&&(i.token=j);let r=await U.Aq.backendFetch("phone"===x?"/api/f/bindphone":"/api/f/bindemail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),o=await r.json();200===o.status?(a.success("bind"===m?"绑定成功":"换绑成功"),R(),E()):a.error(o.errmessage||"操作失败")}catch(e){a.error("操作失败")}finally{d(!1)}},N=async()=>{let e=v.getFieldValue("oldCode");if(!e||6!==e.length)return void a.error("请输入6位验证码");d(!0);try{let t=await U.Aq.backendFetch("/api/f/unbindemail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),n=await t.json();200===n.status?(a.success("解绑成功"),R(),E()):a.error(n.errmessage||"解绑失败")}catch(e){a.error("解绑失败")}finally{d(!1)}},P=(e,t)=>{f(e),b(t),g(+("bind"===t)),w(""),A(0),v.resetFields()};return(0,i.jsxs)(p.A,{title:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(I.A,{}),(0,i.jsx)("span",{children:"账户安全设置"})]}),open:t,onCancel:()=>{E(),n()},footer:null,width:480,destroyOnClose:!0,children:[x&&"unbind"!==m&&"bind"!==m&&(0,i.jsx)(ek.A,{current:y,size:"small",style:{marginBottom:24},items:[{title:"验证原".concat("phone"===x?"手机":"邮箱")},{title:"绑定新".concat("phone"===x?"手机":"邮箱")}]}),x?"unbind"===m||"change"===m&&0===y?(0,i.jsxs)("div",{children:[(0,i.jsx)(ev.A,{message:"请验证当前".concat("phone"===x?"手机号":"邮箱"),description:"验证码将发送到 ".concat("phone"===x?null==o?void 0:o.phoneNumber:null==o?void 0:o.email),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,i.jsx)(Q.A,{form:v,layout:"vertical",children:(0,i.jsx)(Q.A.Item,{label:"验证码",name:"oldCode",rules:[{required:!0,message:"请输入验证码"}],children:(0,i.jsxs)(u.A.Compact,{style:{width:"100%"},children:[(0,i.jsx)(Z.A,{placeholder:"请输入6位验证码",maxLength:6,style:{flex:1}}),(0,i.jsx)(h.Ay,{onClick:B,disabled:S>0,loading:l,children:S>0?"".concat(S,"s"):"获取验证码"})]})})}),(0,i.jsxs)(u.A,{style:{width:"100%",justifyContent:"flex-end"},children:[(0,i.jsx)(h.Ay,{onClick:E,children:"取消"}),"unbind"===m?(0,i.jsx)(h.Ay,{type:"primary",danger:!0,onClick:N,loading:l,children:"确认解绑"}):(0,i.jsx)(h.Ay,{type:"primary",onClick:O,loading:l,children:"下一步"})]})]}):(0,i.jsxs)("div",{children:[(0,i.jsx)(ev.A,{message:"bind"===m?"绑定新".concat("phone"===x?"手机号":"邮箱"):"换绑新".concat("phone"===x?"手机号":"邮箱"),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,i.jsxs)(Q.A,{form:v,layout:"vertical",children:["phone"===x?(0,i.jsx)(Q.A.Item,{label:"新手机号",name:"newPhone",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式错误"}],children:(0,i.jsx)(Z.A,{placeholder:"请输入新手机号",maxLength:11})}):(0,i.jsx)(Q.A.Item,{label:"新邮箱",name:"newEmail",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"邮箱格式错误"}],children:(0,i.jsx)(Z.A,{placeholder:"请输入新邮箱"})}),(0,i.jsx)(Q.A.Item,{label:"验证码",name:"newCode",rules:[{required:!0,message:"请输入验证码"}],children:(0,i.jsxs)(u.A.Compact,{style:{width:"100%"},children:[(0,i.jsx)(Z.A,{placeholder:"请输入6位验证码",maxLength:6,style:{flex:1}}),(0,i.jsx)(h.Ay,{onClick:F,disabled:S>0,loading:l,children:S>0?"".concat(S,"s"):"获取验证码"})]})})]}),(0,i.jsxs)(u.A,{style:{width:"100%",justifyContent:"flex-end"},children:[(0,i.jsx)(h.Ay,{onClick:E,children:"取消"}),(0,i.jsxs)(h.Ay,{type:"primary",onClick:_,loading:l,children:["确认","bind"===m?"绑定":"换绑"]})]})]}):(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:24},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px",background:"rgba(255,255,255,0.02)",borderRadius:12,marginBottom:12},children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(eC.A,{style:{fontSize:20,color:"#818cf8"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ez,{strong:!0,style:{display:"block"},children:"手机号"}),(0,i.jsx)(ez,{type:"secondary",style:{fontSize:13},children:(null==o?void 0:o.hasPhone)?o.phoneNumber:"未绑定"})]})]}),(0,i.jsx)(h.Ay,{type:(null==o?void 0:o.hasPhone)?"default":"primary",onClick:()=>P("phone",(null==o?void 0:o.hasPhone)?"change":"bind"),children:(null==o?void 0:o.hasPhone)?"换绑":"绑定"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px",background:"rgba(255,255,255,0.02)",borderRadius:12},children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(eT.A,{style:{fontSize:20,color:"#818cf8"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ez,{strong:!0,style:{display:"block"},children:"邮箱"}),(0,i.jsx)(ez,{type:"secondary",style:{fontSize:13},children:(null==o?void 0:o.hasEmail)?o.email:"未绑定"})]})]}),(0,i.jsxs)(u.A,{children:[(null==o?void 0:o.hasEmail)&&(null==o?void 0:o.hasPhone)&&(0,i.jsx)(h.Ay,{danger:!0,onClick:()=>P("email","unbind"),children:"解绑"}),(0,i.jsx)(h.Ay,{type:(null==o?void 0:o.hasEmail)?"default":"primary",onClick:()=>P("email",(null==o?void 0:o.hasEmail)?"change":"bind"),children:(null==o?void 0:o.hasEmail)?"换绑":"绑定"})]})]})]}),(null==o?void 0:o.lastPhoneChangeAt)&&(0,i.jsxs)(ez,{type:"secondary",style:{fontSize:12,display:"block"},children:["上次换绑手机号: ",new Date(o.lastPhoneChangeAt).toLocaleDateString()]}),(null==o?void 0:o.lastEmailChangeAt)&&(0,i.jsxs)(ez,{type:"secondary",style:{fontSize:12,display:"block"},children:["上次换绑邮箱: ",new Date(o.lastEmailChangeAt).toLocaleDateString()]})]})]})}var eB=n(50886),eI=n(83487),eO=n(67641),eF=n(32051);let{Text:e_}=d.A,eN=e=>new Promise(t=>setTimeout(t,e)),eP=(e,t)=>eN(Math.floor(Math.random()*(t-e+1))+e);function eD(e){let{onRepairToken:t,repairingToken:n=!1}=e,[a,s]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1),[c,y]=(0,r.useState)(0),[g,x]=(0,r.useState)(-1),[f,m]=(0,r.useState)(["wait","wait","wait","wait"]),[b,w]=(0,r.useState)(null),[S,A]=(0,r.useState)("both"),v=(0,r.useRef)(!1),k=(0,r.useRef)(null),C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"both";v.current=!1,k.current=null,y(0),x(-1),m(["process","wait","wait","wait"]),w(null),A(e),s(!0),d(!0);let t=(async()=>{try{let t=await U.Aq.backendFetch("/api/f/reconnect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e})}),n=await t.json();return k.current=n,n}catch(e){return k.current={error:!0,message:e instanceof Error?e.message:"Unknown error"},k.current}})();try{if(await eN(1e3),v.current||(y(1),m(["finish","process","wait","wait"]),await eN(5e3),v.current)||(y(2),m(["finish","finish","process","wait"]),x(0),k.current?await eN(1e3):await eP(1e3,2e3),v.current)||(x(1),k.current?await eN(1e3):await eP(1e3,4e3),v.current)||(x(2),k.current?await eN(1e3):await eP(3e3,5e3),v.current))return;let e=await t;if(v.current)return;if(x(3),e.error)m(["finish","finish","error","wait"]),w({frmSuccess:!1,rustSuccess:!1});else if(200===e.status){var n,i,r,a,o,l,c,p;let t=(null==(i=e.data)||null==(n=i.frm)?void 0:n.success)||(null==(a=e.data)||null==(r=a.frm)?void 0:r.receiver)==="already_exists",s=(null==(l=e.data)||null==(o=l.rust)?void 0:o.success)||(null==(p=e.data)||null==(c=p.rust)?void 0:c.receiver)==="already_exists";if(t&&s){if(m(["finish","finish","finish","process"]),y(3),await eP(5e3,7e3),v.current)return;m(["finish","finish","finish","finish"]),w({frmSuccess:t,rustSuccess:s})}else m(["finish","finish","finish","wait"]),w({frmSuccess:t,rustSuccess:s})}else m(["finish","finish","error","wait"]),w({frmSuccess:!1,rustSuccess:!1})}catch(e){if(v.current)return;x(3),m(["finish","finish","error","wait"]),w({frmSuccess:!1,rustSuccess:!1})}finally{d(!1)}},T=()=>{v.current=!0,s(!1),d(!1)};return(0,r.useEffect)(()=>{let e=e=>{C((null==e?void 0:e.type)||"both")};return L.B.on("TRIGGER_RECONNECT",e),()=>{L.B.off("TRIGGER_RECONNECT",e)}},[]),(0,i.jsx)(p.A,{title:"重新连接",open:a,onCancel:T,footer:b?("frm"===S?b.frmSuccess:"rust"===S?b.rustSuccess:b.frmSuccess&&b.rustSuccess)?(0,i.jsx)(h.Ay,{type:"primary",onClick:T,style:{boxShadow:"none"},children:"确定"}):"both"!==S&&"frm"!==S||b.frmSuccess?(0,i.jsxs)(u.A,{children:[(0,i.jsx)(h.Ay,{onClick:T,style:{boxShadow:"none"},children:"关闭"}),(0,i.jsx)(h.Ay,{type:"primary",icon:(0,i.jsx)(eO.A,{}),onClick:()=>C(S),style:{boxShadow:"none"},children:"重连"})]}):(0,i.jsxs)(u.A,{children:[(0,i.jsx)(h.Ay,{onClick:T,style:{boxShadow:"none"},children:"关闭"}),(0,i.jsx)(h.Ay,{type:"primary",icon:(0,i.jsx)(eO.A,{}),onClick:()=>{T(),null==t||t()},loading:n,style:{boxShadow:"none"},children:"重新配对Steam"})]}):(0,i.jsx)(h.Ay,{onClick:T,style:{boxShadow:"none"},children:"关闭弹窗"}),closable:!0,maskClosable:!1,width:420,children:(0,i.jsxs)("div",{style:{padding:"20px 0"},children:[(0,i.jsx)(ek.A,{direction:"vertical",size:"small",current:c,items:[{title:"正在请求服务器",status:f[0],icon:"process"===f[0]?(0,i.jsx)(o.A,{}):"finish"===f[0]?(0,i.jsx)(j.A,{style:{color:"#52c41a"}}):"error"===f[0]?(0,i.jsx)(eF.A,{style:{color:"#ff4d4f"}}):void 0},{title:"正在寻找对应节点",status:f[1],icon:"process"===f[1]?(0,i.jsx)(o.A,{}):"finish"===f[1]?(0,i.jsx)(j.A,{style:{color:"#52c41a"}}):"error"===f[1]?(0,i.jsx)(eF.A,{style:{color:"#ff4d4f"}}):void 0},{title:"正在处理...",status:f[2],icon:"process"===f[2]?(0,i.jsx)(o.A,{}):"finish"===f[2]?(0,i.jsx)(j.A,{style:{color:"#52c41a"}}):"error"===f[2]?(0,i.jsx)(eF.A,{style:{color:"#ff4d4f"}}):void 0,description:"process"===f[2]||"finish"===f[2]?(0,i.jsxs)("div",{style:{marginTop:8,marginLeft:4},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[0===g?(0,i.jsx)(o.A,{style:{fontSize:12}}):g>0?(0,i.jsx)(j.A,{style:{fontSize:12,color:"#52c41a"}}):(0,i.jsx)("span",{style:{width:12,height:12,display:"inline-block"}}),(0,i.jsx)(e_,{type:"secondary",style:{fontSize:12},children:"正在关闭已有连接"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[1===g?(0,i.jsx)(o.A,{style:{fontSize:12}}):g>1?(0,i.jsx)(j.A,{style:{fontSize:12,color:"#52c41a"}}):(0,i.jsx)("span",{style:{width:12,height:12,display:"inline-block"}}),(0,i.jsx)(e_,{type:"secondary",style:{fontSize:12},children:"正在重新分配节点"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[2===g?(0,i.jsx)(o.A,{style:{fontSize:12}}):g>2||"finish"===f[2]?(0,i.jsx)(j.A,{style:{fontSize:12,color:"#52c41a"}}):(0,i.jsx)("span",{style:{width:12,height:12,display:"inline-block"}}),(0,i.jsx)(e_,{type:"secondary",style:{fontSize:12},children:"正在重新连接"})]})]}):void 0},..."finish"===f[2]&&"wait"!==f[3]?[{title:"节点正在初始化...",status:f[3],icon:"process"===f[3]?(0,i.jsx)(o.A,{}):"finish"===f[3]?(0,i.jsx)(j.A,{style:{color:"#52c41a"}}):"error"===f[3]?(0,i.jsx)(eF.A,{style:{color:"#ff4d4f"}}):void 0}]:[]]}),b&&(0,i.jsxs)("div",{style:{marginTop:20},children:[(0,i.jsx)("div",{style:{padding:12,borderRadius:8,background:("frm"===S?b.frmSuccess:"rust"===S?b.rustSuccess:b.frmSuccess&&b.rustSuccess)?"rgba(82, 196, 26, 0.1)":"rgba(255, 77, 79, 0.1)",border:"1px solid ".concat(("frm"===S?b.frmSuccess:"rust"===S?b.rustSuccess:b.frmSuccess&&b.rustSuccess)?"rgba(82, 196, 26, 0.3)":"rgba(255, 77, 79, 0.3)"),marginBottom:12,textAlign:"center"},children:(0,i.jsx)(e_,{strong:!0,style:{color:("frm"===S?b.frmSuccess:"rust"===S?b.rustSuccess:b.frmSuccess&&b.rustSuccess)?"#52c41a":"#ff4d4f",fontSize:15},children:("frm"===S?b.frmSuccess:"rust"===S?b.rustSuccess:b.frmSuccess&&b.rustSuccess)?"✓ 重连成功":"✗ 重连失败"})}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[("both"===S||"frm"===S)&&(0,i.jsx)("div",{style:{flex:1,padding:10,borderRadius:8,background:b.frmSuccess?"rgba(82, 196, 26, 0.1)":"rgba(255, 77, 79, 0.1)",border:"1px solid ".concat(b.frmSuccess?"rgba(82, 196, 26, 0.3)":"rgba(255, 77, 79, 0.3)"),textAlign:"center"},children:(0,i.jsxs)(e_,{style:{color:b.frmSuccess?"#52c41a":"#ff4d4f",fontSize:13},children:[b.frmSuccess?"✓":"✗"," 配对服务"]})}),("both"===S||"rust"===S)&&(0,i.jsx)("div",{style:{flex:1,padding:10,borderRadius:8,background:b.rustSuccess?"rgba(82, 196, 26, 0.1)":"rgba(255, 77, 79, 0.1)",border:"1px solid ".concat(b.rustSuccess?"rgba(82, 196, 26, 0.3)":"rgba(255, 77, 79, 0.3)"),textAlign:"center"},children:(0,i.jsxs)(e_,{style:{color:b.rustSuccess?"#52c41a":"#ff4d4f",fontSize:13},children:[b.rustSuccess?"✓":"✗"," Rust服务"]})})]})]})]})})}let{Header:eL,Sider:eq,Content:eW}=l.A,{Text:eJ}=d.A;function eM(e){var t;let{children:n,isExpired:W=!1}=e,M=(0,q.useRouter)(),G=(0,q.usePathname)(),H=(0,q.useSearchParams)(),{message:V}=c.A.useApp(),{userInfo:Y,logout:$}=(0,s.A)(),[K,Q]=(0,r.useState)(!1),X=(0,eB.I)(),[Z,ee]=(0,r.useState)(!1),[et,en]=(0,r.useState)(""),[ei,er]=(0,r.useState)(!1),[ea,es]=(0,r.useState)(!1),[el,ed]=(0,r.useState)(!1),[ec,ep]=(0,r.useState)(!1),[eu,eh]=(0,r.useState)("loading"),[ey,eg]=(0,r.useState)(""),[ex,ef]=(0,r.useState)(null),[em,eb]=(0,r.useState)(null),[ej,ew]=(0,r.useState)(!1),[eS,ev]=(0,r.useState)(!0),[ek,eC]=(0,r.useState)(!1),[eT,ez]=(0,r.useState)(!1),[eR,eO]=(0,r.useState)(!1),[eF,e_]=(0,r.useState)(null),[eN,eP]=(0,r.useState)(!1),[eM,eU]=(0,r.useState)(!1),[eG,eH]=(0,r.useState)(!1),[eV,eY]=(0,r.useState)(!1),[e$,eK]=(0,r.useState)(null),[eQ,eX]=(0,r.useState)(0),[eZ,e0]=(0,r.useState)(!1),[e1,e2]=(0,r.useState)(!1),[e5,e6]=(0,r.useState)([]),[e4,e8]=(0,r.useState)(null),[e3,e9]=(0,r.useState)(!1),[e7,te]=(0,r.useState)(null),[tt,tn]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=()=>{es(!0),tn(!1)},t=()=>{es(!1),tn(!0)};return L.B.on("SSE_CONNECTED",e),L.B.on("SSE_DISCONNECTED",t),()=>{L.B.off("SSE_CONNECTED",e),L.B.off("SSE_DISCONNECTED",t)}},[]),(0,r.useEffect)(()=>{let e=()=>{eH("true"===document.documentElement.getAttribute("data-rust-tool-application"))};e();let t=()=>e();window.addEventListener("rust-tool-app-ready",t);let n=setTimeout(e,5e3);return()=>{window.removeEventListener("rust-tool-app-ready",t),clearTimeout(n)}},[]),(0,r.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("code"),t=sessionStorage.getItem("wx_pay_state");e&&t&&eP(!0)},[]),(0,r.useEffect)(()=>{let e=()=>eP(!0);return L.B.on("OPEN_RCOIN_MODAL",e),()=>{L.B.off("OPEN_RCOIN_MODAL",e)}},[]),(0,r.useEffect)(()=>{let e=()=>ew(!0);return L.B.on("OPEN_STEAM_INFO_MODAL",e),()=>{L.B.off("OPEN_STEAM_INFO_MODAL",e)}},[]),(0,r.useEffect)(()=>{let e=e=>{e_(e.balance)};return L.B.on("RCOIN_BALANCE_UPDATED",e),()=>{L.B.off("RCOIN_BALANCE_UPDATED",e)}},[]),(0,r.useEffect)(()=>{let e=e=>{if(e.steamProfile&&ef(e.steamProfile),e.steamBan&&eb(e.steamBan),e.rustToken){let t=tu(e.rustToken);if(t){let e=Math.floor(Date.now()/1e3);en(new Date(1e3*t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),e>=t&&er(!0)}}ev(!1)};return L.B.on("HOMEPAGE_DATA_LOADED",e),()=>{L.B.off("HOMEPAGE_DATA_LOADED",e)}},[]),(0,r.useEffect)(()=>{(async()=>{try{let e=await U.Aq.backendFetch("/api/pay/getrcoininfo",{method:"POST"}),t=await e.json();200===t.status&&e_(t.data.balance)}catch(e){console.error("获取 R币余额失败:",e)}})()},[]),(0,r.useEffect)(()=>{let e=async()=>{try{let e=await U.Aq.backendFetch("/api/notice/getunreadcount",{method:"POST"}),t=await e.json();200===t.status&&eX(t.data.count||0)}catch(e){console.error("获取未读通知数量失败:",e)}};e();let t=setInterval(e,6e4),n=()=>e();return L.B.on("NOTICE_READ",n),()=>{clearInterval(t),L.B.off("NOTICE_READ",n)}},[]);let ti=async()=>{e2(!0);try{let e=await U.Aq.backendFetch("/api/notice/getlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({page:1,pageSize:50})}),t=await e.json();200===t.status&&e6(t.data.list||[])}catch(e){console.error("获取站内信失败:",e)}finally{e2(!1)}},tr=async e=>{if(e8(e),e9(!0),!e.isRead)try{let t=await U.Aq.backendFetch("/api/notice/markread",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({noticeType:e.type,noticeId:e.id})}),n=await t.json();200===n.status&&(e6(t=>t.map(t=>t.id===e.id&&t.type===e.type?{...t,isRead:!0}:t)),e8(e=>e?{...e,isRead:!0}:null),L.B.emit("NOTICE_READ"))}catch(e){console.error("标记已读失败:",e)}},ta=async e=>{if(!e.rewardClaimed&&(e.rewardRcoin||e.rewardScore)){te(e.id);try{let t=await U.Aq.backendFetch("/api/notice/claimreward",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({noticeType:e.type,noticeId:e.id})}),n=await t.json();if(200===n.status){let t=n.data.rewards.map(e=>"".concat(e.amount," ").concat("rcoin"===e.type?"R币":"积分")).join(" + ");V.success("领取成功！获得 ".concat(t)),e6(t=>t.map(t=>t.id===e.id&&t.type===e.type?{...t,rewardClaimed:!0,isRead:!0}:t)),e8(e=>e?{...e,rewardClaimed:!0,isRead:!0}:null)}else V.error(n.errmessage||"领取失败")}catch(e){V.error("网络错误")}finally{te(null)}}};(0,r.useEffect)(()=>{var e;let t=null==(e=H.get("rusttoken"))?void 0:e.replace(/ /g,"+");t&&to(t)},[H]);let to=async e=>{ep(!0),eh("loading"),eg("");let t=new Promise(e=>{setTimeout(()=>e({timeout:!0}),1e4)}),n=(async()=>(await U.Aq.backendFetch("/api/f/saverusttoken",{method:"POST",body:JSON.stringify({token:e}),headers:{"Content-Type":"application/json"}})).json())();try{let e=await Promise.race([n,t]);if("timeout"in e){eh("timeout"),eg("请求超时，请重新获取凭证");return}200===e.status?(eh("success"),setTimeout(()=>{ep(!1),M.replace("/admin")},1500)):(eh("error"),eg(e.errmessage||"凭证更新失败"))}catch(e){eh("error"),eg("网络错误，请重试")}},ts=async()=>{try{eC(!0);let e=await U.Aq.backendFetch("/api/f/clearuserdata",{method:"POST"}),t=await e.json();if(200!==t.status)return void V.error(t.errmessage||"清空数据失败");let n=await U.Aq.backendFetch("/api/f/saverusttoken",{method:"POST",body:JSON.stringify({token:""}),headers:{"Content-Type":"application/json"}}),i=await n.json();200===i.status?(V.success("账号已更换，正在跳转..."),ez(!1),ew(!1),window.location.href="/admin"):V.error(i.errmessage||"操作失败")}catch(e){V.error("操作失败")}finally{eC(!1)}},tl=async()=>{X&&ee(!1);let e=X?null:window.open("about:blank","_blank");try{eO(!0);let t=await U.Aq.backendFetch("/api/f/getuserpagetoken",{method:"POST"}),n=await t.json();if(200===n.status){let t=window.location.origin,i="".concat(t,"/#/user/").concat(n.data.appid,"?autoLogin=1&token=").concat(n.data.token);X?window.location.href=i:e&&(e.location.href=i)}else 10001===n.status?(e&&e.close(),p.A.confirm({title:"未设置用户页",content:"您还没有设置用户页路径，是否现在去设置？",okText:"去设置",cancelText:"取消",onOk:()=>{M.push("/admin/userpage")}})):10002===n.status?(e&&e.close(),p.A.confirm({title:"未设置用户页密码",content:"您还没有设置用户页密码，是否现在去设置？",okText:"去设置",cancelText:"取消",onOk:()=>{M.push("/admin/userpage")}})):(e&&e.close(),V.error(n.errmessage||"获取用户页信息失败"))}catch(t){e&&e.close(),V.error("网络错误，请稍后重试")}finally{eO(!1)}},td=null==G?void 0:G.startsWith("/admin/help/"),tc=["/admin/pay/products"],tp=tc.some(e=>null==G?void 0:G.startsWith(e));(0,r.useEffect)(()=>{W&&!tp?ed(!0):ed(!1)},[W,tp,G]),(0,r.useEffect)(()=>{W&&!tp&&M.replace("/admin/pay/products")},[W,tp,M]),(0,r.useEffect)(()=>{if(!W||tp)return;let e=()=>{el||ed(!0)},t=e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation())};return document.addEventListener("click",e,!0),document.addEventListener("keydown",t,!0),()=>{document.removeEventListener("click",e,!0),document.removeEventListener("keydown",t,!0)}},[W,tp,el]);let tu=e=>{try{let t=e.split(".")[0],n=atob(t);return JSON.parse(n).exp||null}catch(e){return null}},th=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(ex&&!e)return void ev(!1);try{ev(!0);let e=await U.Aq.backendFetch("/api/f/gethomepageinfo",{method:"POST"}),t=await e.json();if(200===t.status){if(t.data.rustToken){let e=tu(t.data.rustToken);if(e){let t=Math.floor(Date.now()/1e3),n=new Date(1e3*e);en(n.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),t>=e&&er(!0)}try{let e=await U.Aq.backendFetch("/api/f/getsteaminfo",{method:"POST"}),t=await e.json();200===t.status&&(t.data.steamProfile&&ef(t.data.steamProfile),t.data.steamBan&&eb(t.data.steamBan))}catch(e){console.error("获取 Steam 信息失败:",e)}}try{let e=await U.Aq.backendFetch("/api/pay/getrcoininfo",{method:"POST"}),t=await e.json();200===t.status&&e_(t.data.balance)}catch(e){console.error("获取 R币余额失败:",e)}}}catch(e){console.error("检查凭证状态失败:",e)}finally{ev(!1)}};(0,r.useEffect)(()=>{X||ee(!1)},[X]),(0,r.useEffect)(()=>{eV&&(((null==G?void 0:G.replace(/\/$/,""))||"")!==((null==e$?void 0:e$.replace(/\/$/,""))||"")&&e$||(eY(!1),eK(null)))},[G,eV,e$]),(0,r.useEffect)(()=>{if(!eV)return;let e=setTimeout(()=>{eY(!1),eK(null)},5e3);return()=>clearTimeout(e)},[eV]),(0,r.useEffect)(()=>{if(ex)return void ev(!1);"/admin"!==G&&th(!0)},[G]);let ty=[{key:"/admin",icon:(0,i.jsx)(A.A,{}),label:"控制台"},{key:"setup",icon:(0,i.jsx)(v.A,{}),label:"基础设置",children:[{key:"/admin/device",label:"设备配对"},{key:"/admin/activation",label:"激活管理"}]},{key:"logic",icon:(0,i.jsx)(k.A,{}),label:"自动化逻辑",children:[{key:"/admin/eventlogic",label:"事件逻辑"},{key:"/admin/commandlogic",label:"指令逻辑"},{key:"/admin/callgroup",label:"呼叫组"}]},{key:"enter-userpage",icon:(0,i.jsx)(C.A,{}),label:eR?"正在打开...":"进入用户页",disabled:eR||td},...eG?[{key:"info-window",icon:(0,i.jsx)(T.A,{}),label:"信息窗口"}]:[],{key:"/admin/otherfunctions",icon:(0,i.jsx)(z.A,{}),label:"更多功能"}],tg=[{key:"/admin/pay/products",icon:(0,i.jsx)(R.A,{}),label:"兑换中心",className:"recharge-menu-wrapper"},{key:"https://www.rustplus.cn/docs/qy.html",icon:(0,i.jsx)(E.A,{}),label:"帮助文档"}],tx=async()=>{try{let e=window.__TAURI__;if(!e)return void V.error("Tauri API 未加载");let{WebviewWindow:t}=e.webviewWindow,{availWidth:n}=window.screen,i="".concat(window.location.origin,"/info-window");new t("info-window",{url:i,title:"信息窗口",width:320,height:400,x:n-320-20,y:20,resizable:!0,decorations:!1,alwaysOnTop:!0,transparent:!1,skipTaskbar:!0,focus:!0}).once("tauri://error",e=>{console.error("创建信息窗口失败:",e),V.error("创建信息窗口失败")})}catch(e){console.error("打开信息窗口失败:",e),V.error("打开信息窗口失败，请确保在客户端中运行")}},tf=e=>{if(td&&!e.startsWith("http")&&"enter-userpage"!==e&&"info-window"!==e)return void V.warning("请先完成当前引导步骤");if(W&&!e.startsWith("http")&&!tc.some(t=>e.startsWith(t)))return void ed(!0);if("info-window"===e)return W?void ed(!0):(tx(),void(X&&ee(!1)));if("enter-userpage"===e)return W?void ed(!0):td?void V.warning("请先完成引导设置"):void tl();if(e.startsWith("http"))window.open(e,"_blank");else{if(e===G){X&&ee(!1);return}eY(!0),eK(e),M.push(e)}X&&ee(!1)},tm=async()=>{(0,eI.ek)();let e=window.location.hostname;"localhost"===e||"127.0.0.1"===e||/^(\d{1,3}\.){3}\d{1,3}$/.test(e)||/^(\[)?([0-9a-fA-F:]+)(])?$/.test(e)?(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"):(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(U.Ay.domain,";"),document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(U.Ay.domain,";")),$(),window.location.href="/login"},tb=[{key:"steam",icon:(0,i.jsx)(B.A,{}),label:"Steam绑定信息",onClick:()=>ew(!0)},{key:"account",icon:(0,i.jsx)(I.A,{}),label:"账户安全",onClick:()=>eU(!0)},{type:"divider"},{key:"logout",icon:(0,i.jsx)(O.A,{}),label:"退出登录",onClick:tm}],tj=()=>[G||"/admin"],tw=()=>(null==G?void 0:G.includes("/admin/device"))||(null==G?void 0:G.includes("/admin/activation"))||(null==G?void 0:G.includes("/admin/userpage"))?["setup"]:(null==G?void 0:G.includes("/admin/eventlogic"))||(null==G?void 0:G.includes("/admin/commandlogic"))||(null==G?void 0:G.includes("/admin/callgroup"))?["logic"]:[];return(0,i.jsxs)(r.Fragment,{children:[(0,i.jsx)(eo,{disabled:W}),(0,i.jsx)(eD,{onRepairToken:ts}),(0,i.jsx)(eA,{open:eN,onClose:()=>eP(!1),onBalanceUpdate:e=>e_(e)}),(0,i.jsx)(eE,{open:eM,onCancel:()=>eU(!1)}),ec?(0,i.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"#1b1b1f",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:24,zIndex:99999},children:[(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"radial-gradient(ellipse at top left, rgba(99, 102, 241, 0.1) 0%, transparent 50%), radial-gradient(ellipse at bottom right, rgba(139, 92, 246, 0.08) 0%, transparent 50%)",pointerEvents:"none"}}),(0,i.jsxs)("div",{style:{position:"relative",width:100,height:100,zIndex:1},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:80,height:80,borderRadius:20,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",objectFit:"contain",boxShadow:"0 8px 32px rgba(99, 102, 241, 0.3)"}}),"loading"===eu&&(0,i.jsx)(a.A,{indicator:(0,i.jsx)(o.A,{style:{fontSize:100,color:"rgba(99, 102, 241, 0.6)"},spin:!0})})]}),(0,i.jsxs)(u.A,{direction:"vertical",align:"center",size:16,style:{zIndex:1},children:["loading"===eu&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.A.Title,{level:3,style:{margin:0,color:"#fff"},children:"正在获取凭证..."}),(0,i.jsx)("div",{style:{marginTop:12,padding:"16px 32px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(249, 115, 22, 0.15) 100%)",borderRadius:12,border:"2px solid rgba(239, 68, 68, 0.4)"},children:(0,i.jsx)(eJ,{style:{fontSize:18,fontWeight:600,color:"#f87171"},children:"⚠️ 请勿刷新浏览器"})}),(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:14},children:"正在保存您的凭证，请稍候..."})]}),"success"===eu&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(j.A,{style:{fontSize:24,color:"#10b981"}}),(0,i.jsx)(d.A.Title,{level:3,style:{margin:0,color:"#10b981"},children:"凭证获取成功！"})]}),(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:14},children:"正在跳转..."})]}),"error"===eu&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(w.A,{style:{fontSize:20,color:"#ef4444"}}),(0,i.jsx)(d.A.Title,{level:4,style:{margin:0,color:"#ef4444"},children:"凭证获取失败"})]}),(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:14},children:ey}),(0,i.jsx)(h.Ay,{type:"primary",onClick:()=>{ep(!1),M.replace("/admin")},style:{marginTop:16,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none",borderRadius:10},children:"返回控制台"})]}),"timeout"===eu&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.A,{children:[(0,i.jsx)(w.A,{style:{fontSize:24,color:"#f59e0b"}}),(0,i.jsx)(d.A.Title,{level:3,style:{margin:0,color:"#f59e0b"},children:"请求超时"})]}),(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:14,textAlign:"center"},children:"凭证获取超时，请重新登录 Steam 获取凭证"}),(0,i.jsxs)(u.A,{direction:"vertical",size:12,style:{marginTop:8},children:[(0,i.jsx)(h.Ay,{type:"primary",size:"large",icon:(0,i.jsx)(S.A,{}),onClick:()=>{window.location.href="https://companion-rust.facepunch.com/login"},style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none",borderRadius:10,height:48,paddingLeft:24,paddingRight:24},children:"重新获取凭证"}),(0,i.jsx)(h.Ay,{type:"text",onClick:()=>{ep(!1),M.replace("/admin")},style:{color:"rgba(255,255,255,0.5)"},children:"返回控制台"})]})]})]})]}):null,(W?(0,eI.Jy)():ea&&(0,eI.Jy)(),null),eV?(0,i.jsxs)("div",{style:{position:"fixed",top:0,left:X?0:K?72:240,right:0,bottom:0,background:"rgba(27, 27, 31, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:16,zIndex:1e3,backdropFilter:"blur(4px)"},children:[(0,i.jsx)(a.A,{indicator:(0,i.jsx)(o.A,{style:{fontSize:36,color:"#818cf8"},spin:!0})}),(0,i.jsx)(eJ,{style:{color:"rgba(255,255,255,0.6)",fontSize:14},children:"加载中..."})]}):null,(0,i.jsx)(J,{user:Y||{},children:(0,i.jsxs)(l.A,{style:{minHeight:"100vh",background:"#1b1b1f"},children:[(0,i.jsxs)(eq,{collapsible:!0,collapsed:!!X||K,onCollapse:Q,trigger:null,width:240,collapsedWidth:72*!X,style:{background:"linear-gradient(180deg, #1b1b1f 0%, #27272c 100%)",borderRight:"1px solid rgba(255, 255, 255, 0.06)",position:"fixed",height:"100vh",left:0,top:0,zIndex:100,display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,i.jsxs)("div",{style:{height:64,display:"flex",alignItems:"center",justifyContent:K?"center":"flex-start",padding:K?"0":"0 20px",borderBottom:"1px solid rgba(255, 255, 255, 0.06)"},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:36,height:36,borderRadius:10,flexShrink:0,objectFit:"contain"}}),!K&&(0,i.jsx)(eJ,{strong:!0,style:{marginLeft:12,fontSize:16,color:"#fff",whiteSpace:"nowrap"},children:"Rust 工具箱"})]}),(0,i.jsx)("div",{style:{flex:1,overflow:"auto",padding:"12px 8px"},children:(0,i.jsx)(y.A,{mode:"inline",selectedKeys:tj(),defaultOpenKeys:tw(),items:ty,onClick:e=>tf(e.key),style:{background:"transparent",border:"none"}})}),(0,i.jsx)("div",{style:{padding:"12px 8px",borderTop:"1px solid rgba(255, 255, 255, 0.06)"},children:(0,i.jsx)(y.A,{mode:"inline",selectable:!1,items:tg,onClick:e=>tf(e.key),style:{background:"transparent",border:"none"}})})]}),(0,i.jsxs)(l.A,{style:{marginLeft:X?0:K?72:240,transition:"margin-left 0.2s cubic-bezier(0.4, 0, 0.2, 1)",background:"#1b1b1f"},children:[(0,i.jsxs)(eL,{style:{background:"rgba(27, 27, 31, 0.8)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",borderBottom:"1px solid rgba(255, 255, 255, 0.06)",padding:X?"0 12px":"0 24px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:99,height:64},children:[(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",gap:16,flexShrink:0},children:(0,i.jsx)(h.Ay,{type:"text",icon:X||K?(0,i.jsx)(F.A,{}):(0,i.jsx)(_.A,{}),onClick:()=>X?ee(!0):Q(!K),style:{fontSize:18,width:40,height:40,borderRadius:10,color:"rgba(255, 255, 255, 0.7)"}})}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:X?6:8,flexShrink:0},children:[(0,i.jsxs)("div",{onClick:()=>{ea||tn(!0)},style:{display:"flex",alignItems:"center",gap:5,cursor:ea?"default":"pointer",padding:X?"5px 8px":"6px 12px",height:32,borderRadius:8,background:ea?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)",border:"1px solid ".concat(ea?"rgba(16, 185, 129, 0.25)":"rgba(239, 68, 68, 0.25)"),transition:"all 0.2s"},children:[(0,i.jsx)("div",{style:{width:7,height:7,borderRadius:"50%",background:ea?"#10b981":"#ef4444",boxShadow:ea?"0 0 6px rgba(16, 185, 129, 0.6)":"0 0 6px rgba(239, 68, 68, 0.6)",flexShrink:0}}),(0,i.jsx)(eJ,{style:{color:ea?"#6ee7b7":"#fca5a5",fontSize:X?12:13,fontWeight:500,whiteSpace:"nowrap"},children:"配对服务"})]}),(0,i.jsxs)("div",{onClick:()=>eP(!0),style:{display:"flex",alignItems:"center",gap:5,cursor:"pointer",padding:X?"5px 8px":"6px 12px",height:32,borderRadius:8,background:"linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%)",border:"1px solid rgba(99, 102, 241, 0.25)",transition:"all 0.2s"},children:[(0,i.jsx)("img",{src:"/Rmoney.ico",alt:"R币",style:{width:16,height:16,borderRadius:"50%",objectFit:"cover",flexShrink:0}}),(0,i.jsx)(eJ,{style:{color:"#a78bfa",fontWeight:600,fontSize:X?12:13,whiteSpace:"nowrap"},children:null!==eF?eF.toFixed(2):"--"})]}),(0,i.jsx)(g.A,{count:eQ,size:"small",offset:[-2,2],children:(0,i.jsx)(h.Ay,{type:"text",icon:(0,i.jsx)(N.A,{}),onClick:()=>{e0(!0),ti()},style:{color:"rgba(255, 255, 255, 0.6)",width:32,height:32,borderRadius:8,flexShrink:0}})}),(0,i.jsx)(x.A,{menu:{items:tb},trigger:["click"],placement:"bottomRight",children:(null==ex?void 0:ex.avatarfull)?(0,i.jsx)(f.A,{src:ex.avatarfull,size:32,style:{cursor:"pointer",flexShrink:0}}):(0,i.jsx)(h.Ay,{type:"text",icon:(0,i.jsx)(B.A,{}),style:{color:"rgba(255, 255, 255, 0.5)",width:32,height:32,borderRadius:8,flexShrink:0}})})]})]}),(0,i.jsx)(eW,{style:{padding:X?16:24,minHeight:"calc(100vh - 64px)",background:"#1b1b1f"},children:(0,i.jsx)("div",{style:{maxWidth:1400,margin:"0 auto"},children:n})})]})]})}),(0,i.jsx)(m.A,{placement:"left",open:Z,onClose:()=>ee(!1),width:280,closable:!1,styles:{body:{padding:0},header:{display:"none"}},style:{background:"#1b1b1f"},children:(0,i.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(180deg, #1b1b1f 0%, #27272c 100%)"},children:[(0,i.jsxs)("div",{style:{height:64,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 20px",borderBottom:"1px solid rgba(255, 255, 255, 0.06)"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,i.jsx)("img",{src:"https://www.rustplus.cn/logo.png",alt:"Logo",style:{width:36,height:36,borderRadius:10,flexShrink:0,objectFit:"contain"}}),(0,i.jsx)(eJ,{strong:!0,style:{marginLeft:12,fontSize:16,color:"#fff"},children:"Rust 工具箱"})]}),(0,i.jsx)(h.Ay,{type:"text",icon:(0,i.jsx)(P.A,{}),onClick:()=>ee(!1),style:{color:"rgba(255, 255, 255, 0.7)"}})]}),(0,i.jsx)("div",{style:{flex:1,overflow:"auto",padding:"12px 8px"},children:(0,i.jsx)(y.A,{mode:"inline",selectedKeys:tj(),defaultOpenKeys:tw(),items:ty,onClick:e=>tf(e.key),style:{background:"transparent",border:"none"}})}),(0,i.jsx)("div",{style:{padding:"12px 8px",borderTop:"1px solid rgba(255, 255, 255, 0.06)"},children:(0,i.jsx)(y.A,{mode:"inline",selectable:!1,items:tg,onClick:e=>tf(e.key),style:{background:"transparent",border:"none"}})})]})}),(0,i.jsx)(p.A,{open:ei,onCancel:()=>er(!1),centered:!0,width:520,styles:{content:{background:"#2d2d33",borderRadius:20,border:"1px solid rgba(239, 68, 68, 0.3)"}},footer:null,children:(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)("div",{style:{width:64,height:64,borderRadius:16,background:"rgba(239, 68, 68, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px"},children:(0,i.jsx)(D.A,{style:{fontSize:32,color:"#ef4444"}})}),(0,i.jsx)(d.A.Title,{level:4,style:{color:"#fff",marginBottom:8},children:"Rust 凭证已过期"}),(0,i.jsxs)(eJ,{type:"secondary",style:{display:"block",marginBottom:16},children:["您的凭证已于 ",(0,i.jsx)(eJ,{style:{color:"#ef4444"},children:et})," 过期"]}),(0,i.jsxs)("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)",borderRadius:12,padding:"16px",marginBottom:20,textAlign:"left"},children:[(0,i.jsx)(eJ,{strong:!0,style:{color:"#ef4444",display:"block",marginBottom:8},children:"⚠️ 凭证过期将导致以下功能无法使用："}),(0,i.jsxs)("ul",{style:{margin:0,paddingLeft:20,color:"rgba(255,255,255,0.7)"},children:[(0,i.jsx)("li",{children:"无法配对服务器"}),(0,i.jsx)("li",{children:"无法配对智能开关和智能警报"}),(0,i.jsx)("li",{children:"队友死亡位置推送无法正常工作"})]})]}),(0,i.jsxs)(u.A,{direction:"vertical",size:12,style:{width:"100%"},children:[(0,i.jsx)(h.Ay,{type:"primary",size:"large",icon:(0,i.jsx)(S.A,{}),onClick:()=>window.open("https://www.rustplus.cn/docs/pdsteam.html","_blank"),style:{width:"100%",height:48,borderRadius:12,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:"查看获取凭证教程"}),(0,i.jsxs)("div",{style:{padding:"12px 16px",background:"rgba(99, 102, 241, 0.1)",borderRadius:10,border:"1px solid rgba(99, 102, 241, 0.2)"},children:[(0,i.jsxs)(eJ,{type:"secondary",style:{fontSize:13},children:["已安装 ",(0,i.jsx)(eJ,{style:{color:"#818cf8"},children:"Rust凭证获取助手"}),"？"]}),(0,i.jsx)(h.Ay,{type:"link",size:"small",onClick:()=>window.open("https://companion-rust.facepunch.com/login","_blank"),style:{padding:"0 4px",color:"#818cf8"},children:"点击直接前往获取凭证 →"})]}),(0,i.jsx)(h.Ay,{type:"text",size:"large",onClick:()=>er(!1),style:{width:"100%",height:44,borderRadius:12,color:"rgba(255,255,255,0.5)"},children:"稍后再说"}),(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:12},children:"获取新凭证后会自动跳转回来，无需重新配对服务器"})]})]})}),(0,i.jsx)(p.A,{open:tt,onCancel:()=>tn(!1),footer:null,centered:!0,width:420,styles:{content:{background:"linear-gradient(180deg, #27272c 0%, #1f1f23 100%)",borderRadius:20,border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",padding:0},body:{padding:0}},children:(0,i.jsxs)("div",{style:{padding:"32px 28px",textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:72,height:72,borderRadius:18,background:"linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(249, 115, 22, 0.15) 100%)",display:"inline-flex",alignItems:"center",justifyContent:"center",marginBottom:20,border:"1px solid rgba(239, 68, 68, 0.25)"},children:(0,i.jsx)(C.A,{style:{fontSize:32,color:"#ef4444"}})}),(0,i.jsx)(d.A.Title,{level:4,style:{color:"#fff",marginBottom:8},children:"配对服务已断开"}),(0,i.jsx)(eJ,{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:14,display:"block",marginBottom:20,lineHeight:1.6},children:"配对服务的连接已断开，这会影响配对功能"}),(0,i.jsxs)(u.A,{direction:"vertical",size:12,style:{width:"100%"},children:[(0,i.jsx)(h.Ay,{type:"primary",size:"large",block:!0,onClick:()=>{(0,eI.ek)(),tn(!1),window.location.reload()},style:{height:48,borderRadius:12,background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,boxShadow:"0 4px 14px rgba(99, 102, 241, 0.35)"},children:"重新连接"}),(0,i.jsx)(h.Ay,{type:"text",size:"large",block:!0,onClick:()=>tn(!1),style:{height:44,borderRadius:12,color:"rgba(255,255,255,0.5)"},children:"暂不重连"})]})]})}),(0,i.jsxs)(p.A,{title:null,open:eZ,onCancel:()=>e0(!1),footer:null,width:X?"92vw":420,centered:!0,styles:{body:{padding:0},content:{padding:0}},children:[(0,i.jsx)("div",{style:{padding:"20px 20px 16px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,i.jsx)("div",{style:{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(N.A,{style:{fontSize:18,color:"#818cf8"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eJ,{strong:!0,style:{fontSize:16,display:"block"},children:"站内通知"}),eQ>0&&(0,i.jsxs)(eJ,{type:"secondary",style:{fontSize:12},children:[eQ," 条未读"]})]})]})}),(0,i.jsx)("div",{style:{maxHeight:"55vh",overflowY:"auto",padding:"12px 16px"},children:e1?(0,i.jsx)("div",{style:{textAlign:"center",padding:48},children:(0,i.jsx)(a.A,{size:"large"})}):0===e5.length?(0,i.jsx)("div",{style:{textAlign:"center",padding:48,color:"rgba(255,255,255,0.45)"},children:"暂无通知"}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:e5.map(e=>(0,i.jsxs)("div",{onClick:()=>tr(e),style:{padding:"12px",background:e.isRead?"transparent":"rgba(99, 102, 241, 0.06)",borderRadius:10,cursor:"pointer",border:"1px solid rgba(255,255,255,0.06)",transition:"all 0.2s",position:"relative"},children:[!e.isRead&&(0,i.jsx)("div",{style:{position:"absolute",top:14,left:12,width:6,height:6,borderRadius:"50%",background:"#6366f1"}}),(0,i.jsxs)("div",{style:{paddingLeft:14*!e.isRead},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,marginBottom:4},children:[(0,i.jsx)(eJ,{strong:!0,style:{fontSize:14,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),(e.rewardRcoin&&e.rewardRcoin>0||e.rewardScore&&e.rewardScore>0)&&!e.rewardClaimed&&(0,i.jsx)(b.A,{color:"gold",style:{margin:0,fontSize:10,lineHeight:"16px",padding:"0 6px"},children:"奖励"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:12,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.content.replace(/[#*`\[\]]/g,"").substring(0,50)}),(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:11,flexShrink:0},children:new Date(e.createdAt).toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})})]})]})]},"".concat(e.type,"-").concat(e.id)))})})]}),(0,i.jsx)(p.A,{title:null,open:e3,onCancel:()=>e9(!1),footer:null,width:X?"92vw":480,centered:!0,styles:{body:{padding:0},content:{padding:0}},children:e4&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{padding:"20px 20px 16px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[(0,i.jsx)(eJ,{strong:!0,style:{fontSize:16,display:"block",marginBottom:4},children:e4.title}),(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:12},children:new Date(e4.createdAt).toLocaleString("zh-CN")})]}),(0,i.jsx)("div",{style:{padding:"16px 20px",maxHeight:"40vh",overflowY:"auto",color:"rgba(255,255,255,0.85)",fontSize:14,lineHeight:1.8,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e4.content}),(e4.rewardRcoin&&e4.rewardRcoin>0||e4.rewardScore&&e4.rewardScore>0)&&(0,i.jsxs)("div",{style:{margin:"0 16px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",background:"rgba(99, 102, 241, 0.08)",padding:"12px 14px",borderRadius:10,border:"1px solid rgba(99, 102, 241, 0.15)"},children:[(0,i.jsxs)(u.A,{size:6,children:[(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:13},children:"附件奖励"}),e4.rewardRcoin>0&&(0,i.jsxs)(b.A,{color:"gold",style:{margin:0},children:["R币 +",e4.rewardRcoin]}),e4.rewardScore>0&&(0,i.jsxs)(b.A,{color:"blue",style:{margin:0},children:["积分 +",e4.rewardScore]})]}),(0,i.jsx)(h.Ay,{type:e4.rewardClaimed?"default":"primary",size:"small",disabled:e4.rewardClaimed,loading:e7===e4.id,onClick:()=>ta(e4),style:e4.rewardClaimed?{}:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:e4.rewardClaimed?"已领取":"领取"})]}),e4.link&&(0,i.jsx)("div",{style:{padding:"0 16px 16px"},children:(0,i.jsx)(h.Ay,{type:"default",block:!0,onClick:()=>{e4.link.startsWith("http")?window.open(e4.link,"_blank"):window.location.href=e4.link},style:{borderRadius:8},children:"查看详情"})})]})}),(0,i.jsx)(p.A,{open:el,closable:!1,maskClosable:!1,keyboard:!1,footer:null,centered:!0,width:480,styles:{mask:{background:"rgba(0, 0, 0, 0.85)"},content:{background:"linear-gradient(180deg, #27272c 0%, #1f1f23 100%)",borderRadius:20,border:"1px solid rgba(255, 255, 255, 0.08)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",padding:0},body:{padding:0}},children:(0,i.jsxs)("div",{style:{padding:"40px 32px",textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:80,height:80,borderRadius:20,background:"linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(249, 115, 22, 0.2) 100%)",display:"inline-flex",alignItems:"center",justifyContent:"center",marginBottom:24,border:"1px solid rgba(239, 68, 68, 0.3)"},children:(0,i.jsx)(D.A,{style:{fontSize:40,color:"#ef4444"}})}),(0,i.jsx)(d.A.Title,{level:3,style:{color:"#fff",marginBottom:12},children:"账号激活已过期"}),(0,i.jsx)(eJ,{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:15,display:"block",marginBottom:24},children:"您的账号激活期限已结束，请前往兑换中心续费后继续使用"}),(0,i.jsx)("div",{style:{padding:"16px 20px",background:"rgba(239, 68, 68, 0.1)",borderRadius:14,border:"1px solid rgba(239, 68, 68, 0.2)",marginBottom:24},children:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(w.A,{style:{color:"#ef4444"}}),(0,i.jsx)(eJ,{style:{color:"#ef4444"},children:"当前页面功能已被限制，请先续费"})]})}),(0,i.jsx)(h.Ay,{type:"primary",size:"large",icon:(0,i.jsx)(R.A,{}),block:!0,onClick:()=>{ed(!1),M.push("/admin/pay/products")},style:{height:52,borderRadius:14,background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none",fontWeight:500,fontSize:16,boxShadow:"0 4px 14px rgba(99, 102, 241, 0.35)"},children:"前往兑换中心"}),(0,i.jsx)("div",{style:{marginTop:16},children:(0,i.jsxs)(eJ,{type:"secondary",style:{fontSize:13},children:["遇到问题？",(0,i.jsx)("a",{href:"https://www.rustplus.cn",target:"_blank",rel:"noopener noreferrer",style:{color:"#818cf8",marginLeft:4},children:"联系客服"})]})})]})}),(0,i.jsx)(p.A,{title:null,open:ej,onCancel:()=>ew(!1),footer:null,centered:!0,width:400,children:(0,i.jsx)("div",{style:{padding:"8px 0"},children:ex?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:20},children:[(0,i.jsx)(f.A,{src:ex.avatarfull,icon:(0,i.jsx)(B.A,{}),size:72,style:{border:"3px solid rgba(99, 102, 241, 0.3)"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eJ,{strong:!0,style:{fontSize:18,display:"block"},children:ex.personaname}),ex.realname&&(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:13,display:"block"},children:ex.realname})]})]}),(0,i.jsx)("div",{style:{padding:14,borderRadius:10,background:"rgba(99, 102, 241, 0.08)",border:"1px solid rgba(99, 102, 241, 0.15)",marginBottom:16},children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:12,display:"block"},children:"SteamID"}),(0,i.jsx)(eJ,{style:{fontSize:14,fontFamily:"monospace"},children:ex.steamid})]}),(0,i.jsx)(h.Ay,{type:"text",size:"small",onClick:async()=>{await U.Aq.copyToClipboard(ex.steamid||""),V.success("已复制 SteamID")},style:{color:"#818cf8"},children:"复制"})]})}),em&&(0,i.jsxs)("div",{style:{padding:14,borderRadius:10,background:em.VACBanned||em.NumberOfGameBans||em.CommunityBanned?"rgba(239, 68, 68, 0.1)":"rgba(16, 185, 129, 0.1)",border:em.VACBanned||em.NumberOfGameBans||em.CommunityBanned?"1px solid rgba(239, 68, 68, 0.2)":"1px solid rgba(16, 185, 129, 0.2)",marginBottom:16},children:[(0,i.jsx)(eJ,{strong:!0,style:{display:"block",marginBottom:8,color:em.VACBanned||em.NumberOfGameBans||em.CommunityBanned?"#f87171":"#6ee7b7"},children:em.VACBanned||em.NumberOfGameBans||em.CommunityBanned?"⚠️ 存在封禁记录":"✓ 账号状态良好"}),(0,i.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,i.jsxs)("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:em.VACBanned?"rgba(239, 68, 68, 0.2)":"rgba(16, 185, 129, 0.2)",color:em.VACBanned?"#f87171":"#6ee7b7"},children:["VAC: ",em.NumberOfVACBans||0]}),(0,i.jsxs)("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:em.NumberOfGameBans?"rgba(239, 68, 68, 0.2)":"rgba(16, 185, 129, 0.2)",color:em.NumberOfGameBans?"#f87171":"#6ee7b7"},children:["游戏封禁: ",em.NumberOfGameBans||0]}),(0,i.jsxs)("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:em.CommunityBanned?"rgba(239, 68, 68, 0.2)":"rgba(16, 185, 129, 0.2)",color:em.CommunityBanned?"#f87171":"#6ee7b7"},children:["社区: ",em.CommunityBanned?"封禁":"正常"]})]}),(null!=(t=em.DaysSinceLastBan)?t:0)>0&&(0,i.jsxs)(eJ,{type:"secondary",style:{fontSize:11,display:"block",marginTop:6},children:["距上次封禁 ",em.DaysSinceLastBan," 天"]})]}),(0,i.jsxs)("div",{style:{padding:14,borderRadius:10,background:"rgba(255, 255, 255, 0.03)",border:"1px solid rgba(255, 255, 255, 0.06)",marginBottom:16},children:[(0,i.jsx)(eJ,{strong:!0,style:{fontSize:13,display:"block",marginBottom:10,color:"rgba(255,255,255,0.85)"},children:"账号信息"}),ex.timecreated&&(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:13},children:"注册时间"}),(0,i.jsx)(eJ,{style:{fontSize:13},children:new Date(1e3*ex.timecreated).toLocaleDateString("zh-CN")})]}),ex.loccountrycode&&(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:13},children:"地区"}),(0,i.jsx)(eJ,{style:{fontSize:13},children:ex.loccountrycode})]}),ex.timecreated&&(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:13},children:"账号年龄"}),(0,i.jsxs)(eJ,{style:{fontSize:13},children:[Math.floor((Date.now()/1e3-ex.timecreated)/31536e3)," 年"]})]})]}),(0,i.jsxs)(u.A,{direction:"vertical",style:{width:"100%"},size:12,children:[(0,i.jsx)(h.Ay,{type:"primary",block:!0,onClick:()=>window.open(ex.profileurl,"_blank"),style:{height:40,borderRadius:10,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:"查看 Steam 主页"}),(0,i.jsx)(h.Ay,{block:!0,type:"default",onClick:()=>ez(!0),style:{height:40,borderRadius:10,boxShadow:"none",color:"#ef4444",borderColor:"#ef4444"},children:"更换 Steam 账号"})]})]}):(0,i.jsxs)("div",{style:{textAlign:"center",padding:"20px 0"},children:[(0,i.jsx)(f.A,{icon:(0,i.jsx)(B.A,{}),size:72,style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",marginBottom:16}}),(0,i.jsx)(eJ,{strong:!0,style:{display:"block",fontSize:16,marginBottom:8},children:"未绑定 Steam 账号"}),(0,i.jsx)(eJ,{type:"secondary",style:{display:"block",marginBottom:20},children:"请先获取 Rust 凭证以绑定 Steam 账号"}),(0,i.jsx)(h.Ay,{type:"primary",onClick:()=>window.open("https://www.rustplus.cn/docs/pdsteam.html","_blank"),style:{height:40,borderRadius:10,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none"},children:"查看绑定教程"})]})})}),(0,i.jsx)(p.A,{title:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(D.A,{style:{color:"#ff4d4f",fontSize:20}}),(0,i.jsx)("span",{children:"确认更换 Steam 账号"})]}),open:eT,onCancel:()=>ez(!1),footer:[(0,i.jsx)(h.Ay,{onClick:()=>ez(!1),style:{borderRadius:6},children:"取消"},"cancel"),(0,i.jsx)(h.Ay,{type:"primary",loading:ek,onClick:ts,style:{borderRadius:6,boxShadow:"none",background:"#ef4444",borderColor:"#ef4444"},children:"确认更换"},"confirm")],centered:!0,width:400,children:(0,i.jsxs)("div",{style:{padding:"16px 0"},children:[(0,i.jsxs)("div",{style:{padding:16,borderRadius:8,background:"rgba(255, 77, 79, 0.1)",border:"1px solid rgba(255, 77, 79, 0.2)",marginBottom:16},children:[(0,i.jsx)(eJ,{strong:!0,style:{color:"#ff4d4f",display:"block",marginBottom:8},children:"⚠️ 警告：此操作不可逆"}),(0,i.jsx)(eJ,{type:"secondary",style:{fontSize:13},children:"更换账号将会清空以下所有数据："}),(0,i.jsxs)("ul",{style:{margin:"8px 0 0 0",paddingLeft:20,color:"rgba(255,255,255,0.65)",fontSize:13},children:[(0,i.jsx)("li",{children:"已配对的服务器信息"}),(0,i.jsx)("li",{children:"所有开关设备配置"}),(0,i.jsx)("li",{children:"事件逻辑和指令逻辑"}),(0,i.jsx)("li",{children:"呼叫组配置"}),(0,i.jsx)("li",{children:"用户页设置"})]})]}),(0,i.jsx)(eJ,{style:{display:"block",color:"rgba(255,255,255,0.85)"},children:"确定要更换 Steam 账号吗？"})]})})]})}let{Text:eU,Title:eG}=d.A;function eH(e){let{error:t,title:n="出错了",code:r,onRetry:a,showHomeButton:o=!0}=e,s="string"==typeof t?t:t.message,l=r?"".concat(n," (代码: ").concat(r,")"):n;return(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh",padding:24},children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:20,maxWidth:400,textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:72,height:72,borderRadius:18,background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(ea.A,{style:{fontSize:36,color:"#ef4444"}})}),(0,i.jsx)(eG,{level:4,style:{margin:0,color:"#fff"},children:l}),(0,i.jsx)(eU,{style:{color:"rgba(255, 255, 255, 0.6)"},children:s}),"object"==typeof t&&t.stack&&(0,i.jsx)("div",{style:{padding:"12px 16px",background:"rgba(255, 255, 255, 0.03)",borderRadius:12,border:"1px solid rgba(255, 255, 255, 0.06)",width:"100%"},children:(0,i.jsx)(eU,{type:"secondary",style:{fontSize:12,fontFamily:"monospace"},children:t.stack})}),(0,i.jsxs)(u.A,{size:12,style:{marginTop:8},children:[(0,i.jsx)(h.Ay,{type:"primary",icon:(0,i.jsx)(eO.A,{}),onClick:()=>{a?a():window.location.reload()},style:{height:44,paddingInline:24,borderRadius:12,background:"linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)",border:"none"},children:"重试"}),o&&(0,i.jsx)(h.Ay,{icon:(0,i.jsx)(A.A,{}),onClick:()=>{window.location.href="/"},style:{height:44,paddingInline:24,borderRadius:12,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:"返回首页"})]})]})})}function eV(e){let{children:t}=e,{isAuthenticated:n,isLoading:a,activationStatus:o,checkAuth:l}=(0,s.A)(),[d,c]=r.useState(!1);return((0,r.useEffect)(()=>{l()},[]),(0,r.useEffect)(()=>{a||n||d||(c(!0),window.location.href="/login")},[a,n,d]),a||d||!n)?null:"inactive"===o?(0,i.jsx)(eM,{isExpired:!0,children:t}):"unknown"===o?((0,eI.Jy)(),(0,i.jsx)(eH,{error:"数据加载失败，请检查网络连接或稍后重试。",title:"数据加载失败"})):(0,i.jsx)(eM,{children:t})}function eY(e){let{children:t}=e;return(0,i.jsx)(eV,{children:t})}function e$(e){let{children:t}=e,[n,s]=(0,r.useState)(!0),[l,d]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{!function(){if("undefined"==typeof document)return!1;for(let e of document.cookie.split(";")){let[t,n]=e.trim().split("=");if("authToken"===t&&n&&n.length>0)return!0}return!1}()?window.location.href="/login":d(!0),s(!1)},[]),n||!l)?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#1b1b1f"},children:(0,i.jsx)(a.A,{indicator:(0,i.jsx)(o.A,{style:{fontSize:48,color:"#6366f1"},spin:!0})})}):(0,i.jsx)(eY,{children:t})}},69176:(e,t,n)=>{"use strict";n.d(t,{A:()=>c,O:()=>d});var i=n(95155),r=n(12115),a=n(37783);let{backendFetch:o}=a.Aq;function s(){let e=window.location.hostname;"localhost"===e||"127.0.0.1"===e||/^(\d{1,3}\.){3}\d{1,3}$/.test(e)||/^(\[)?([0-9a-fA-F:]+)(])?$/.test(e)?(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"):(document.cookie="authToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(a.Ay.domain,";"),document.cookie="adminAuthUpdate=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.".concat(a.Ay.domain,";"))}let l=(0,r.createContext)(void 0);function d(e){let{children:t}=e,[n,a]=(0,r.useState)({isAuthenticated:!1,isLoading:!0,userInfo:null,activationStatus:"unknown"}),d=(0,r.useCallback)(e=>{a(t=>({...t,...e}))},[]),c=(0,r.useCallback)(async()=>{try{d({isLoading:!0});let e=await o("/api/f/getstate",{method:"POST",credentials:"include"});if(403===e.status){s(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}let t=await e.json();if(403===t.status){s(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"});return}if(200===t.status)return void d({isAuthenticated:!0,isLoading:!1,userInfo:t.userinfo||null,activationStatus:"active"===t.data?"active":"inactive"});s(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}catch(e){console.error("Auth check failed:",e),s(),d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})}},[d]),p=(0,r.useCallback)(()=>{d({isAuthenticated:!1,isLoading:!1,userInfo:null,activationStatus:"unknown"})},[d]),u={...n,checkAuth:c,logout:p,setAuthState:d};return(0,i.jsx)(l.Provider,{value:u,children:t})}function c(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},83487:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>l,Jy:()=>o,bT:()=>s,ek:()=>a});var i=n(95155),r=n(12115);function a(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");e&&e.classList.remove("hidden")}}function o(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");e&&e.classList.add("hidden")}}function s(){if("undefined"!=typeof document){let e=document.getElementById("app-loader");return null!==e&&!e.classList.contains("hidden")}return!1}function l(e){let{text:t="加载中...",subText:n}=e;return r.useEffect(()=>{o()},[]),(0,i.jsxs)("div",{className:"fullscreen-loader",children:[(0,i.jsx)("div",{className:"fullscreen-loader-bg"}),(0,i.jsxs)("div",{className:"fullscreen-loader-content",children:[(0,i.jsxs)("div",{className:"fullscreen-loader-logo-container",children:[(0,i.jsx)("img",{className:"fullscreen-loader-logo",src:"https://www.rustplus.cn/logo.png",alt:"Logo"}),(0,i.jsx)("div",{className:"fullscreen-loader-spinner"})]}),(0,i.jsx)("div",{className:"fullscreen-loader-text",children:t}),n&&(0,i.jsx)("div",{className:"fullscreen-loader-subtext",children:n})]})]})}},96750:(e,t,n)=>{"use strict";async function i(){return window.location.origin}n.d(t,{C:()=>i})}},e=>{e.O(0,[4041,6083,785,6240,9279,2245,9543,5445,6060,4540,9073,6133,2718,8272,4425,5702,5125,6861,1386,2759,8607,7954,5918,1247,4536,8441,1255,7358],()=>e(e.s=23551)),_N_E=e.O()}]);